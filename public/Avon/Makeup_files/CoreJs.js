var __extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},AddressModule,BannerModule,BreadcrumbsModule,ChangePasswordModule,ChangeRepModule,ContentModule,CouponsModule,FooterModule,ForgotPasswordModule,GenericTabModule,GlossaryModule,OnlineStoreModule,ProfileInfoModel,HeaderRepPanelModule,LayoutLeftNavigationModule,LayoutTopNavigationModule,LayoutTopUtilityModule,LoginModule,LooksWeLoveModule,LpmContextMenuModule,PageNavigatorModule,PayPalModule,ProductCarouselModule,ProductDetailModule,RegistrationModule,SearchModule,TipsModule;(function(n){"use strict";var t=function(t){function i(i,r,u,f,e,o,s,h,c){function a(){var t=[];return $.each(n.addressesScope.Session.Cart.Campaigns,function(i){$.each(n.addressesScope.Session.Cart.Campaigns[i].Items,function(r){n.addressesScope.Session.Cart.Campaigns[i].Items[r].AutoReplenishmentFrequency>0&&t.push(n.addressesScope.Session.Cart.Campaigns[i].Items[r])})}),t}function l(){return n.addressesScope.AutoReplenishmentExistsInCart=!1,$.each(n.addressesScope.Session.Cart.Campaigns,function(t){$.each(n.addressesScope.Session.Cart.Campaigns[t].Items,function(i){n.addressesScope.Session.Cart.Campaigns[t].Items[i].AutoReplenishmentFrequency>0&&(n.addressesScope.AutoReplenishmentExistsInCart=!0)})}),n.addressesScope.AutoReplenishmentExistsInCart}function v(t,i){n.addressesScope.ShowLoading(AVON.messages.spinner_saving);n.addressesScope.CustomerService.SaveMyAddresses([t],i,!1,!1)}function nt(){var t=[n.addressesScope.billingAddress];(n.addressesScope.SaveBillingAndShipping||n.addressesScope.shippingAddress.Address1)&&t.push(n.addressesScope.shippingAddress);n.addressesScope.ShowLoading(AVON.messages.spinner_saving);n.addressesScope.CustomerService.SaveMyAddresses(t,n.addressesScope.UpdateAvonAccountBilling,!1,!1)}function y(n){return n?n.match(/^(?=.*[0-9])([a-zA-Z0-9]{7,16})$/)!=null:!1}function p(t,i,r){n.addressesScope.ShowLoadingModal=t?!1:!0;n.addressesScope.IsNotCheckout=i?!1:!0;n.addressesScope.IsFirstTime=r?!0:!1;b();n.addressesScope.ValidForm=n.addressesScope.shippingAddressForm.$valid;n.addressesScope.ShippingSameAsBilling||(n.addressesScope.ValidForm=n.addressesScope.shippingAddressForm.$valid&&n.addressesScope.billingAddressForm.$valid);g();n.addressesScope.ShippingSameAsBilling||d();n.addressesScope.SaveBillingAndShipping=!0;(c.HasActiveSubscriptions()||l())&&$.each(AVON.RestrictedDevlieryStates,function(t,i){if(n.addressesScope.shippingAddress.State===i){n.addressesScope.ShowRestrictedStateModal=!0;n.addressesScope.SaveBillingAndShipping=!1;n.addressesScope.ModalOpened="IneligibleAutoReplenishment";$(".IneligibleAutoReplenishment.billingAddress").trigger("modal",{UrlToLoad:"",AllowExit:!0,KeepLoaded:!0,Model:null});n.addressesScope.AlaskaHawaiiAutoRepWarningShown=!0}})}function w(){n.addressesScope.ShowValidation=!0;n.addressesScope.RequiredInvalid=!0;n.addressesScope.SafeApply();r.$broadcast("AddressesScope.AddressValidation")}function b(){for(var i=!1,r=!1,t=0;t<n.addressesScope.ShippingStates.length;t++)if(n.addressesScope.ShippingStates[t].Code==n.addressesScope.shippingAddress.State){r=!0;break}for(r||(n.addressesScope.shippingAddress.State="",n.addressesScope.ValidForm=!1),t=0;t<n.addressesScope.BillingStates.length;t++)if(n.addressesScope.BillingStates[t].Code==n.addressesScope.billingAddress.State){i=!0;break}i||(n.addressesScope.billingAddress.State="",n.addressesScope.ValidForm=!1)}function k(t){t===void 0&&(t=!1);h(function(){n.addressesScope.ShowLoading(n.addressesScope.ShowLoadingModal?AVON.messages.spinner_registering:AVON.messages.spinner_saving)},250).then(function(){n.addressesScope.CustomerService.SaveMyAddresses([n.addressesScope.billingAddress,n.addressesScope.shippingAddress],t||!n.addressesScope.ShowLoadingModal,n.addressesScope.IsNotCheckout,n.addressesScope.IsFirstTime)})}function d(){n.addressesScope.IsBillingInternationalAddress()||(n.addressesScope.billingAddress.Zip.Code&&n.addressesScope.billingAddress.Zip.Code.length<5||n.addressesScope.billingAddressForm.Zip.$error.pattern&&n.addressesScope.billingAddressForm.Zip.$invalid)&&(n.addressesScope.billingAddressForm.Zip.$invalid=!0,n.addressesScope.billingAddressForm.Zip.$error.pattern=!0,n.addressesScope.ValidForm=!1)}function g(){(n.addressesScope.shippingAddress.Zip.Code&&n.addressesScope.shippingAddress.Zip.Code.length<5||n.addressesScope.shippingAddressForm.Zip.$error.pattern&&n.addressesScope.shippingAddressForm.Zip.$invalid)&&(n.addressesScope.shippingAddressForm.Zip.$invalid=!0,n.addressesScope.shippingAddressForm.Zip.$error.pattern=!0,n.addressesScope.ValidForm=!1)}function tt(){var t=n.addressesScope.billingAddress.PhoneNumber;t.Area&&t.Area.length===3?(n.addressesScope.billingAddressForm.Area.$invalid=!1,n.addressesScope.billingAddressForm.Area.$error.format=!1):(n.addressesScope.billingAddressForm.Area.$invalid=!0,n.addressesScope.billingAddressForm.Area.$error.format=!0,n.addressesScope.ValidForm=!1,n.addressesScope.billingAddressForm.$valid=!1);t.Prefix&&t.Prefix.length===3?(n.addressesScope.billingAddressForm.Prefix.$invalid=!1,n.addressesScope.billingAddressForm.Prefix.$error.format=!1):(n.addressesScope.billingAddressForm.Prefix.$invalid=!0,n.addressesScope.billingAddressForm.Prefix.$error.format=!0,n.addressesScope.ValidForm=!1,n.addressesScope.billingAddressForm.$valid=!1);t.Number&&t.Number.length===4?(n.addressesScope.billingAddressForm.Number.$invalid=!1,n.addressesScope.billingAddressForm.Number.$error.format=!1):(n.addressesScope.billingAddressForm.Number.$invalid=!0,n.addressesScope.billingAddressForm.Number.$error.format=!0,n.addressesScope.ValidForm=!1,n.addressesScope.billingAddressForm.$valid=!1)}t.call(this,i);this.$scope=i;this.autoReplenishService=c;this.isInternationalAddressEnabled=!1;n.addressesScope=i;n.addressesScope.CustomerService=u;n.addressesScope.RegistrationService=o;n.addressesScope.billingAddress=AVON.billingAddress;n.addressesScope.shippingAddress=AVON.shippingAddress;n.addressesScope.BillingStates=AVON.BillingStates;n.addressesScope.ShippingStates=AVON.ShippingStates;n.addressesScope.Countries=AVON.Countries;n.addressesScope.ShippingSameAsBilling=!0;n.addressesScope.ShowZipErrorMessage=!1;n.addressesScope.UpdateAvonAccountBilling=!1;n.addressesScope.UpdateAvonAccountShipping=!1;n.addressesScope.ShippingSameAsBillingPaymentForm=!1;n.addressesScope.ShowRestrictedStateModal=!1;n.addressesScope.ShowRestrictedStateInline=!1;n.addressesScope.ActiveAutoReplenishment=!1;n.addressesScope.SaveBillingAndShipping=!1;n.addressesScope.ReloadPageAfterAction=!1;n.addressesScope.ModalOpened="";n.addressesScope.RegistrationFullPageForm=angular.element("#checkoutStep1").val()=="true";n.addressesScope.PaymentPage=angular.element("#paymentPage").val()=="true";n.addressesScope.OrderingInfoPage=angular.element("#orderingInfoPage").val()=="true";n.addressesScope.RestrictedAutoRepType=RestrictedAutoRepType.None;n.addressesScope.AlaskaHawaiiAutoRepWarningShown=!1;n.addressesScope.ShowBillingCityState=AVON.isOdsDown;n.addressesScope.ShowShippingCityState=AVON.isOdsDown;n.addressesScope.ShowBillingPhoneNumber=!1;n.addressesScope.ShowShippingPhoneNumber=!1;n.addressesScope.DisplayBillingAddressEmailError=!1;n.addressesScope.EmailError=!1;n.addressesScope.HideEmailInput=!1;n.addressesScope.RequireFullAccount=AVON.RequireFullAccount;n.addressesScope.NotifySpecialOffers=!0;n.addressesScope.ShowZipValidation=!1;n.addressesScope.AccountAlreadyExists=!1;n.addressesScope.ContinueAsGuest=!1;n.addressesScope.GuestShopperWithRepId=!1;n.addressesScope.DisplayPrivacyPolicy=!0;n.addressesScope.DisplayPasswordInstructions=!0;n.addressesScope.SessionService.WhenReady().then(function(){n.addressesScope.RegisteredCustomerAsGuest={CustomerId:0,Rep:n.addressesScope.Session.Rep?n.addressesScope.Session.Rep:{Hash:0,Id:0,Address:"",CityStateZip:"",CityState:"",HomepageUrl:"",Name:"",FirstName:"",LastName:"",Phone:"",AlternativePhone:"",WebUrl:"",Status:"",IsInPilot:!1,IsGemini:!1}};n.addressesScope.Session.Rep.Id>0&&n.addressesScope.billingAddress.IsGuestShopper&&(AvonModule.AvonScope.Session.Customer.IsEligibleForGuestCheckout=!1,n.addressesScope.RequireFullAccount=!0,n.addressesScope.RepAttachedFullRegistrationRequired=!0,n.addressesScope.billingAddress.IsGuestShopper=!1,n.addressesScope.shippingAddress.IsGuestShopper=!1)});n.addressesScope.IsBillingUsaAddress=function(){return n.addressesScope.billingAddress.Country==="US"};n.addressesScope.IsBillingInternationalAddress=function(){return n.addressesScope.IsBillingUsaAddress()===!1};n.addressesScope.UseInternationalAddress=function(){n.addressesScope.billingAddress.Country=""};n.addressesScope.ShowCity=function(t){return t===!1?n.addressesScope.ShowShippingCityState:n.addressesScope.IsBillingInternationalAddress()?!0:n.addressesScope.ShowBillingCityState};n.addressesScope.DetermineIfInputShouldBeShownForUsaAddress=function(t){return t?!0:n.addressesScope.IsBillingUsaAddress()};n.addressesScope.DetermineIfInputShouldBeShownForInternationalAddress=function(t){return t?!1:n.addressesScope.IsBillingInternationalAddress()};n.addressesScope.UpdateCustomerType=function(t){n.addressesScope.SessionService.PostJson("/api/session/updatecustomertype",{customerType:t});n.addressesScope.Session.Customer.CustomerType=t};n.addressesScope.privacyUrl=$("#privacyPolicyUrl").val();n.addressesScope.conditionsOfUseUrl=$("#conditionsOfUseUrl").val();n.addressesScope.IsMyAccountPage=window.location.toString().indexOf("/orderinginfo")>-1?!0:!1;n.addressesScope.OrderInfoSaveBilling&&(n.addressesScope.UpdateAvonAccountBilling=n.addressesScope.OrderInfoSaveBilling);n.addressesScope.OrderInfoSaveShipping&&(n.addressesScope.UpdateAvonAccountShipping=n.addressesScope.OrderInfoSaveShipping);_.defer(function(){n.addressesScope.billingAddressForm.billingAddress_FirstName.$setViewValue(n.addressesScope.billingAddressForm.billingAddress_FirstName.$viewValue);n.addressesScope.billingAddressForm.billingAddress_LastName.$setViewValue(n.addressesScope.billingAddressForm.billingAddress_LastName.$viewValue);n.addressesScope.billingAddressForm.billingAddress_Address1.$setViewValue(n.addressesScope.billingAddressForm.billingAddress_Address1.$viewValue);n.addressesScope.billingAddressForm.billingAddress_Address2.$setViewValue(n.addressesScope.billingAddressForm.billingAddress_Address2.$viewValue);n.addressesScope.billingAddressForm.billingAddress_City.$setViewValue(n.addressesScope.billingAddressForm.billingAddress_City.$viewValue);n.addressesScope.IsBillingUsaAddress()&&n.addressesScope.billingAddressForm.Zip.$setViewValue(n.addressesScope.billingAddressForm.Zip.$viewValue);n.addressesScope.billingAddressForm.Area.$setViewValue(n.addressesScope.billingAddressForm.Area.$viewValue);n.addressesScope.billingAddressForm.Prefix.$setViewValue(n.addressesScope.billingAddressForm.Prefix.$viewValue);n.addressesScope.billingAddressForm.Number.$setViewValue(n.addressesScope.billingAddressForm.Number.$viewValue);n.addressesScope.billingAddress.City&&n.addressesScope.billingAddress.State&&(n.addressesScope.ShowBillingCityState=!0);n.addressesScope.shippingAddressForm.shippingAddress_FirstName.$setViewValue(n.addressesScope.shippingAddressForm.shippingAddress_FirstName.$viewValue);n.addressesScope.shippingAddressForm.shippingAddress_LastName.$setViewValue(n.addressesScope.shippingAddressForm.shippingAddress_LastName.$viewValue);n.addressesScope.shippingAddressForm.shippingAddress_Address1.$setViewValue(n.addressesScope.shippingAddressForm.shippingAddress_Address1.$viewValue);n.addressesScope.shippingAddressForm.shippingAddress_Address2.$setViewValue(n.addressesScope.shippingAddressForm.shippingAddress_Address2.$viewValue);n.addressesScope.shippingAddressForm.shippingAddress_City.$setViewValue(n.addressesScope.shippingAddressForm.shippingAddress_City.$viewValue);n.addressesScope.shippingAddressForm.Zip.$setViewValue(n.addressesScope.shippingAddressForm.Zip.$viewValue);n.addressesScope.shippingAddress.City&&n.addressesScope.shippingAddress.State&&(n.addressesScope.ShowShippingCityState=!0);var t=n.addressesScope.billingAddress.PhoneNumber.Area||"",i=n.addressesScope.billingAddress.PhoneNumber.Prefix||"",r=n.addressesScope.billingAddress.PhoneNumber.Number||"";n.addressesScope.billingAddress.PhoneNumber.FullNumber=t+i+r},200);AvonModule.AvonScope.QueryString().invalidDetails==="1"&&(n.addressesScope.HideEmailInput=!0,(n.addressesScope.billingAddress.Address1||n.addressesScope.shippingAddress.Address1)&&_.defer(function(){n.addressesScope.ShippingSameAsBilling=!1;b();n.addressesScope.billingAddress.State==""||n.addressesScope.shippingAddress.State==""?(n.addressesScope.ShowValidation=!0,n.addressesScope.RequiredInvalid=!0,n.addressesScope.SafeApply()):n.addressesScope.SaveBillingAndShippingAddresses(!0)},500));n.addressesScope.originalBillingAddress=angular.copy(n.addressesScope.billingAddress);n.addressesScope.originalShippingAddress=angular.copy(n.addressesScope.shippingAddress);n.addressesScope.updatePhoneNumber=function(){var t=n.addressesScope.billingAddress.PhoneNumber.FullNumber;t&&t.length>0?(n.addressesScope.billingAddress.PhoneNumber.Area=n.addressesScope.billingAddress.PhoneNumber.FullNumber.substring(0,3),n.addressesScope.billingAddress.PhoneNumber.Prefix=n.addressesScope.billingAddress.PhoneNumber.FullNumber.substring(3,6),n.addressesScope.billingAddress.PhoneNumber.Number=n.addressesScope.billingAddress.PhoneNumber.FullNumber.substring(6,10)):(n.addressesScope.billingAddress.PhoneNumber.Area="",n.addressesScope.billingAddress.PhoneNumber.Prefix="",n.addressesScope.billingAddress.PhoneNumber.Number="")};n.addressesScope.HasPhoneNumber=function(){var t=n.addressesScope.billingAddress.PhoneNumber;return t?!t.Area||t.Area.length!==3?!1:!t.Prefix||t.Prefix.length!==3?!1:!t.Number||t.Number.length!==4?!1:!0:!1};n.addressesScope.AllAutoRepSubscriptionsAreHazardous=function(){var t=c.AreAllSubscriptionsHazardous(),n=a(),i;return!t&&n.length===0?!1:(i=_.filter(n,function(n){return n.IsHazardous}),t&&n.length===i.length)};n.addressesScope.SomeAutoRepSubscriptionsAreHazardous=function(){var n=c.HasActiveHazardousSubscriptions(),t=a(),i=_.filter(t,function(n){return n.IsHazardous});return n||i.length>0};n.addressesScope.ZipIsValid=function(n){return n!==null&&n.length===5};n.addressesScope.ValidateRestrictedDeliveryState=function(t,i,r){n.addressesScope.ShowRestrictedStateModal=!1;n.addressesScope.ShowRestrictedStateInline=!1;n.addressesScope.ActiveAutoReplenishment=!1;n.addressesScope.ModalOpened="";n.addressesScope.SessionService.WhenReady().then(function(){if((i||n.addressesScope.UpdateAvonAccountShipping)&&(n.addressesScope.ActiveAutoReplenishment=c.HasActiveSubscriptions()),n.addressesScope.ActiveAutoReplenishment||(n.addressesScope.ActiveAutoReplenishment=l()||c.HasActiveSubscriptions()),n.addressesScope.ActiveAutoReplenishment&&(i||n.addressesScope.UpdateAvonAccountShipping)){var u=_.uniq(_.union(AVON.RestrictedDevlieryStates,AVON.SemiRestrictedDevlieryStates));$.each(u,function(i,u){if(n.addressesScope.shippingAddress.State===u)if(n.addressesScope.ShowRestrictedStateModal=!0,n.addressesScope.ModalOpened="IneligibleAutoReplenishment",n.addressesScope.RestrictedAutoRepType=_.contains(AVON.SemiRestrictedDevlieryStates,u)?n.addressesScope.SomeAutoRepSubscriptionsAreHazardous()?n.addressesScope.AllAutoRepSubscriptionsAreHazardous()?RestrictedAutoRepType.AlaskaHawaiiAllHazmat:RestrictedAutoRepType.AlaskaHawaiiSomeHazmat:RestrictedAutoRepType.AlaskaHawaiiNoHazmat:RestrictedAutoRepType.IslandState,t){var f={UrlToLoad:"",AllowExit:!0,KeepLoaded:!0,Model:null};r?$(".IneligibleAutoReplenishment.billingAddress").trigger("modal",f):$(".IneligibleAutoReplenishment.shippingAddress").trigger("modal",f);n.addressesScope.AlaskaHawaiiAutoRepWarningShown=!0}else n.addressesScope.ShowRestrictedStateInline=!0,n.addressesScope.CustomerService.ShowRestrictedStateInline(n.addressesScope.ShowRestrictedStateInline)})}});n.addressesScope.ShowRestrictedStateModal||(r?nt():n.addressesScope.SaveShippingAddress(),n.addressesScope.ShowRestrictedStateInline=!1,n.addressesScope.CustomerService.ShowRestrictedStateInline(n.addressesScope.ShowRestrictedStateInline))};n.addressesScope.InAlaskaHawaiiWithAutoRepInCart=function(){return l()&&_.contains(AVON.SemiRestrictedDevlieryStates,n.addressesScope.shippingAddress.State)};n.addressesScope.ShowIneligibleAutoRepModal=function(){n.addressesScope.DisplayShippingAddress=!0;n.addressesScope.RestrictedAutoRepType=_.contains(AVON.SemiRestrictedDevlieryStates,n.addressesScope.shippingAddress.State)?n.addressesScope.SomeAutoRepSubscriptionsAreHazardous()?n.addressesScope.AllAutoRepSubscriptionsAreHazardous()?RestrictedAutoRepType.AlaskaHawaiiAllHazmat:RestrictedAutoRepType.AlaskaHawaiiSomeHazmat:RestrictedAutoRepType.AlaskaHawaiiNoHazmat:RestrictedAutoRepType.IslandState;n.addressesScope.ModalOpened="InAlaskaHawaiiWithAutoRepInCartModal";$(".InAlaskaHawaiiWithAutoRepInCartModal").trigger("modal",{UrlToLoad:"",AllowExit:!0,KeepLoaded:!0,Model:null});n.addressesScope.AlaskaHawaiiAutoRepWarningShown=!0};n.addressesScope.$on("ModalClosed",function(){n.addressesScope.ModalOpened==="IneligibleAutoReplenishment"&&(n.addressesScope.ShowRestrictedStateInline=!1,n.addressesScope.CustomerService.ShowRestrictedStateInline(n.addressesScope.ShowRestrictedStateInline),n.addressesScope.shippingAddress.State=n.addressesScope.originalShippingAddress.State)});n.addressesScope.UpdateAutoReplenishmentSubscriptions=function(t){n.addressesScope.ModalOpened="";var i=[];$.each(n.addressesScope.Session.Cart.Campaigns,function(r){$.each(n.addressesScope.Session.Cart.Campaigns[r].Items,function(u){if(n.addressesScope.Session.Cart.Campaigns[r].Items[u].AutoReplenishmentFrequency>0&&(!t||n.addressesScope.Session.Cart.Campaigns[r].Items[u].IsHazardous)){var f={CampaignNumber:n.addressesScope.Session.Cart.Campaigns[r].Number,Sku:n.addressesScope.Session.Cart.Campaigns[r].Items[u].Sku,Quantity:0,AutoReplenishmentFrequency:n.addressesScope.Session.Cart.Campaigns[r].Items[u].AutoReplenishmentFrequency,AutoReplenishmentMultibuy:n.addressesScope.Session.Cart.Campaigns[r].Items[u].AutoReplenishmentMultibuy,AutoReplenishmentOverrideToBeOneTimeOnly:n.addressesScope.Session.Cart.Campaigns[r].Items[u].AutoReplenishmentOverrideToBeOneTimeOnly};i.push(f)}})});n.addressesScope.DeactivateAutoReplenishmentSubscriptions(t);n.addressesScope.ShowLoading(AVON.messages.spinner_loading);i.length>0&&e.update(i)};n.addressesScope.DeactivateAutoReplenishmentSubscriptions=function(t){n.addressesScope.ShowLoading(AVON.messages.spinner_saving);t?n.addressesScope.CustomerService.DiscontinueHazmatAutoReplenishmentProducts():n.addressesScope.CustomerService.DiscontinueAllAutoReplenishmentProducts();n.addressesScope.ShowRestrictedStateInline=!1;n.addressesScope.CustomerService.ShowRestrictedStateInline(n.addressesScope.ShowRestrictedStateInline)};n.addressesScope.$on("MyAccountService.DiscontinueAllAutoReplenishmentProducts",function(){n.addressesScope.SaveDetails()});n.addressesScope.$on("MyAccountService.DiscontinueHazmatAutoReplenishmentProducts",function(){n.addressesScope.SaveDetails()});n.addressesScope.SaveDetails=function(){n.addressesScope.ShowLoading(AVON.messages.spinner_saving);n.addressesScope.SaveBillingAndShipping?(n.addressesScope.ShowLoadingModal=!0,n.addressesScope.IsNotCheckout=!1,n.addressesScope.IsFirstTime=!1,k(n.addressesScope.Session.Customer.IsLoggedIn)):n.addressesScope.SaveShippingAddress()};n.addressesScope.CloseIneligibleForm=function(){n.addressesScope.ShowRestrictedStateInline=!1;n.addressesScope.CustomerService.ShowRestrictedStateInline(n.addressesScope.ShowRestrictedStateInline);n.addressesScope.shippingAddress.State=n.addressesScope.originalShippingAddress.State;n.addressesScope.billingAddress.State=n.addressesScope.originalBillingAddress.State;n.addressesScope.ShippingSameAsBillingPaymentForm=!1};n.addressesScope.ToggleShowRestrictedStateInline=function(){if(n.addressesScope.ShippingSameAsBillingPaymentForm&&n.addressesScope.ShowRestrictedStateInline){var t=n.addressesScope.billingAddress.State;n.addressesScope.CloseIneligibleForm();n.addressesScope.billingAddress.State=t}};n.addressesScope.SaveBillingAddress=function(){tt();n.addressesScope.ValidForm=n.addressesScope.billingAddressForm.$valid;d();n.addressesScope.ValidForm?n.addressesScope.ShippingSameAsBillingPaymentForm?(n.addressesScope.SaveBillingAndShipping=n.addressesScope.ShippingSameAsBillingPaymentForm,n.addressesScope.shippingAddress=angular.copy(n.addressesScope.billingAddress),n.addressesScope.shippingAddress.Type=1,n.addressesScope.ValidateRestrictedDeliveryState(n.addressesScope.IsMyAccountPage,!0,!0)):v(n.addressesScope.billingAddress,n.addressesScope.UpdateAvonAccountBilling):(n.addressesScope.ShowValidation=!0,n.addressesScope.RequiredInvalidBilling=!0)};n.addressesScope.SaveShippingAddress=function(){n.addressesScope.ValidForm=n.addressesScope.shippingAddressForm.$valid;g();n.addressesScope.ValidForm?v(n.addressesScope.shippingAddress,n.addressesScope.UpdateAvonAccountShipping):(n.addressesScope.ShowValidation=!0,n.addressesScope.RequiredInvalidShipping=!0)};n.addressesScope.SaveBillingAndShippingAddresses=function(t,i,r){if(p(t,i,r),n.addressesScope.ValidForm){if(n.addressesScope.ShippingSameAsBilling){var u=n.addressesScope.billingAddress.PhoneNumber;n.addressesScope.billingAddress=angular.copy(n.addressesScope.shippingAddress);n.addressesScope.billingAddress.Type=0;n.addressesScope.billingAddress.PhoneNumber=u}n.addressesScope.SaveBillingAndShipping&&k(n.addressesScope.Session.Customer.IsLoggedIn)}else w()};n.addressesScope.CheckIfEmailExists=function(){n.addressesScope.AccountAlreadyExists=!1;var t=$("#shippingAddress_Email");return!n.addressesScope.Session.Customer.HideWelcomeBackModal&&n.addressesScope.IsEmailValid(t.val())?(t.addClass("LoadingImage"),n.addressesScope.RegistrationService.getCustomerByEmail(t.val(),!1)):null};n.addressesScope.LoadSignInModal=function(){_.defer(function(){n.addressesScope.ShowLoading(AVON.messages.spinner_loading)},250);var t=n.addressesScope.HomePageUrl+"signin?returnurl=/checkout&email="+n.addressesScope.shippingAddress.Email;n.addressesScope.RedirectToUrl(t)};n.addressesScope.RegisteredUserContinueAsGuest=function(t){n.addressesScope.IsRegisteredGuestShopper=!0;var i=n.addressesScope.shippingAddress.Email;$("#WelcomeBack").trigger("close");n.addressesScope.ContinueAsGuest=!0;n.addressesScope.DisplayPrivacyPolicy=!1;n.addressesScope.GuestShopperWithRepId=!0;n.addressesScope.RequireFullAccount=!1;n.addressesScope.UpdateCustomerType(CustomerType.RegisteredCustomerAsGuest);t&&n.addressesScope.RegistrationService.getCustomerByEmail(i,t)};n.addressesScope.ResetContinueAsGuest=function(){n.addressesScope.ContinueAsGuest=!1};n.addressesScope.Session.Customer.CustomerType===CustomerType.RegisteredCustomerAsGuest&&n.addressesScope.QueryString().guestShopper&&n.addressesScope.RegisteredUserContinueAsGuest(!1);n.addressesScope.ValidateCustomerForm=function(){var t,i;return n.addressesScope.EmailError=!1,n.addressesScope.ShowPasswordValidation=!1,n.addressesScope.PasswordsDontMatch=!1,n.addressesScope.DisplayPasswordInstructions=!1,n.addressesScope.ValidationErrorStyle=!1,t=!1,n.addressesScope.ValidForm=!0,i=n.addressesScope.IsEmailValid(n.addressesScope.shippingAddress.Email),i||(n.addressesScope.ValidForm=!1,n.addressesScope.shippingAddressForm.shippingAddress_Email.$invalid=!0,n.addressesScope.EmailError=!0),n.addressesScope.shippingAddressForm.shippingAddress_FirstName.$invalid===!1&&n.addressesScope.shippingAddressForm.shippingAddress_LastName.$invalid===!1&&n.addressesScope.shippingAddressForm.shippingAddress_Email.$invalid===!1&&(n.addressesScope.ValidForm=!0),n.addressesScope.shippingAddressForm.Number.$invalid=!1,n.addressesScope.shippingAddressForm.Number.$error.format=!1,n.addressesScope.CreateAccount()&&(y(n.addressesScope.shippingAddress.Password)||(n.addressesScope.ValidForm=!1,t=!0,n.addressesScope.shippingAddressForm.shippingAddress_Password.$invalid=!0,n.addressesScope.ValidationErrorStyle=!0),y(n.addressesScope.shippingAddress.PasswordConfirm)||(n.addressesScope.ValidForm=!1,t=!0,n.addressesScope.shippingAddressForm.shippingAddress_PasswordConfirm.$invalid=!0,n.addressesScope.DisplayPasswordInstructions=!0,n.addressesScope.ValidationErrorStyle=!0),t===!1&&n.addressesScope.shippingAddress.Password!==n.addressesScope.shippingAddress.PasswordConfirm&&(n.addressesScope.ValidForm=!1,n.addressesScope.shippingAddressForm.shippingAddress_Password.$invalid=!0,n.addressesScope.shippingAddressForm.shippingAddress_PasswordConfirm.$invalid=!0,n.addressesScope.PasswordsDontMatch=!0,n.addressesScope.ValidationErrorStyle=!0,n.addressesScope.ValidationErrorStyle=!0),n.addressesScope.shippingAddress.PasswordHint||(n.addressesScope.ValidForm=!1,n.addressesScope.shippingAddressForm.shippingAddress_PasswordHint.$invalid=!0),n.addressesScope.shippingAddressForm.shippingAddress_FirstName.$invalid===!1&&n.addressesScope.shippingAddressForm.shippingAddress_LastName.$invalid===!1&&n.addressesScope.shippingAddressForm.shippingAddress_Email.$invalid===!1&&n.addressesScope.shippingAddressForm.shippingAddress_Password.$invalid===!1&&n.addressesScope.shippingAddressForm.shippingAddress_PasswordConfirm.$invalid===!1&&n.addressesScope.shippingAddressForm.shippingAddress_PasswordHint.$invalid===!1&&n.addressesScope.HasPhoneNumber()&&(n.addressesScope.ValidForm=!0)),n.addressesScope.PrivacyPolicyInput===!1&&(n.addressesScope.ShowAcceptedPrivacyPolicyError=!0,n.addressesScope.ValidForm=!1),n.addressesScope.ValidForm};n.addressesScope.CreateAccount=function(){return(n.addressesScope.CheckElementValue("#shippingAddress_PasswordInput")||n.addressesScope.CheckElementValue("#shippingAddress_PasswordConfirmInput")||n.addressesScope.CheckElementValue("#shippingAddress_PasswordHintInput")||n.addressesScope.RequireFullAccount)&&!n.addressesScope.GuestShopperWithRepId?!0:!1};n.addressesScope.InputFocus=function(){n.addressesScope.DisplayBillingAddressEmailError=!1;n.addressesScope.ValidationErrorStyle=!1;n.addressesScope.DisplayPasswordInstructions=!0;n.addressesScope.ShowValidation=!1;n.addressesScope.ShowAcceptedPrivacyPolicyError=!1;n.addressesScope.EmailAlreadyExists=!1};n.addressesScope.ViewPrivacyPolicy=function(){window.open(n.addressesScope.privacyUrl,"_blank")};n.addressesScope.ViewConditionsOfUse=function(){window.open(n.addressesScope.conditionsOfUseUrl,"_blank")};n.addressesScope.SubmitAddressDetails=function(t){n.addressesScope.RegistrationFullPageForm?r.$broadcast("AddressesScope.SubmitFullRegistrationDetails"):n.addressesScope.PaymentPage?(n.addressesScope.DisplayBillingAddress&&n.addressesScope.SaveBillingAddress(!0),n.addressesScope.DisplayShippingAddress&&n.addressesScope.ValidateRestrictedDeliveryState(!1)):n.addressesScope.OrderingInfoPage&&(t==="Billing"&&n.addressesScope.SaveBillingAddress(!0),t==="Shipping"&&n.addressesScope.ValidateRestrictedDeliveryState(!0,!0))};n.addressesScope.$on("AddressesScope.ValidateAddresses",function(t,i,u){n.addressesScope.ShowLoadingModal=u?!1:!0;p(n.addressesScope.ShowLoadingModal);n.addressesScope.ValidForm||w();i&&n.addressesScope.ValidForm&&r.$broadcast("RegistrationScope.SaveDetails")});n.addressesScope.$on("AddressesScope.SaveAddresses",function(){n.addressesScope.ShowLoadingModal=!0;n.addressesScope.SaveBillingAndShippingAddresses(!1)});n.addressesScope.$on("FormDirective.HidValidation",function(){n.addressesScope.billingAddressForm!=null&&(n.addressesScope.billingAddressForm.ServerErrors=[]);n.addressesScope.shippingAddressForm!=null&&(n.addressesScope.shippingAddressForm.ServerErrors=[]);n.addressesScope.ShowValidation&&(n.addressesScope.ShowValidation=!1)});n.addressesScope.$on("AddressesScope.ZipCodeDetails",function(t,i,u){i.IsValidZip?(n.addressesScope.ShowZipValidation=!1,u?(n.addressesScope.billingAddress.City=i.City,n.addressesScope.billingAddress.State=i.State,n.addressesScope.ShowBillingCityState=!0,n.addressesScope.billingAddressForm.Zip.$invalid=!1,n.addressesScope.billingAddressForm.Zip.$error.pattern=!1,$("input[name=Area]").focus()):(n.addressesScope.shippingAddress.City=i.City,n.addressesScope.shippingAddress.State=i.State,n.addressesScope.ShowShippingCityState=!0,n.addressesScope.shippingAddressForm.Zip.$invalid=!1,n.addressesScope.shippingAddressForm.Zip.$error.pattern=!1),_.defer(function(){n.addressesScope.UpdateInlineWaterMark();n.addressesScope.SafeApply();r.$broadcast("AddressController.UpdateInlineWaterMark")},250)):(n.addressesScope.ShowZipValidation=!0,u?(n.addressesScope.billingAddressForm.Zip.$invalid=!0,n.addressesScope.billingAddressForm.Zip.$error.pattern=!0):(n.addressesScope.shippingAddressForm.Zip.$invalid=!0,n.addressesScope.shippingAddressForm.Zip.$error.pattern=!0),n.addressesScope.SafeApply())});n.addressesScope.HideShippingAddress=function(){$("#EditAddressModal").trigger("close");n.addressesScope.shippingAddress=angular.copy(n.addressesScope.originalShippingAddress);n.addressesScope.ShowValidation=!1;n.addressesScope.RequiredInvalidBilling=!1;n.addressesScope.RequiredInvalidShipping=!1;n.addressesScope.shippingAddressForm.Zip.$invalid=!1;n.addressesScope.shippingAddressForm.Zip.$error.pattern=!1;n.addressesScope.IsBillingUsaAddress()&&(n.addressesScope.billingAddressForm.Zip.$invalid=!1,n.addressesScope.billingAddressForm.Zip.$error.pattern=!1);n.addressesScope.ShowZipValidation=!1;n.addressesScope.SafeApply()};n.addressesScope.GoToMyAccountHome=function(){location.href=n.addressesScope.Url.Action("Index","MyAccount")};n.addressesScope.requiredField=AVON.messages.validate_field_required;n.addressesScope.invalidEmailFormat=AVON.messages.validate_email_invalid;n.addressesScope.emailNotMatch=AVON.messages.validate_email_match;n.addressesScope.passwordInvalidFormat=AVON.messages.validate_password_invalid_format;n.addressesScope.passwordNotMatch=AVON.messages.validate_password_match;n.addressesScope.invalidNumber=AVON.messages.validate_invalid_number;n.addressesScope.invalidPhonenumber=AVON.messages.validate_invalid_phonenumber;n.addressesScope.$on("paymentController.RefreshWithPayPalAddress",function(t,i){i&&i.length==2&&(n.addressesScope.billingAddress=i[0],n.addressesScope.shippingAddress=i[1],n.addressesScope.originalBillingAddress=angular.copy(n.addressesScope.billingAddress),n.addressesScope.originalShippingAddress=angular.copy(n.addressesScope.shippingAddress),n.addressesScope.SafeApply())});n.addressesScope.$on("CustomerService.UpdateAddress",function(t,i){var u,r;i.ErrorCode===AjaxError.ValidationErrors?(n.addressesScope.RegistrationFullPageForm&&h(function(){n.addressesScope.ShowLoading(AVON.messages.spinner_registering)},250).then(function(){n.addressesScope.RedirectToUrl(n.addressesScope.Url.Action("BillingandShipping","Checkout"))}),n.addressesScope.ProcessAjaxValidationErrors(i),n.addressesScope.ShowValidation=!0,u=[],$.each(i.ValidationErrors,function(t,i){i.FieldName.indexOf("billingAddress")>-1&&(n.addressesScope.RequiredInvalidBilling=!0);i.FieldName.indexOf("shippingAddress")>-1&&(n.addressesScope.RequiredInvalidShipping=!0);i.FieldName.indexOf("PostalCode")>-1&&(n.addressesScope.billingAddressForm.billingAddress_PostalCode.$error.server=!1,n.addressesScope.billingAddressForm.billingAddress_PostalCode.$error.validatePostalCode=!0)}),n.addressesScope.IsBillingUsaAddress()&&n.addressesScope.billingAddressForm.Zip.$invalid==!1&&(n.addressesScope.ShowZipErrorMessage=!0)):n.addressesScope.RegistrationFullPageForm||window.location.href.indexOf("billingandshipping")>0?(n.addressesScope.QueryString().guest||n.addressesScope.IsRegisteredGuestShopper||(r={Type:TrackingEventType.CartNewCustAcct,Data:{customerId:AvonModule.AvonScope.Session.Customer.CustomerId}},f.TrackEventItem(r)),h(function(){n.addressesScope.ShowLoading(AVON.messages.spinner_registering)},250).then(function(){n.addressesScope.RedirectToUrl(n.addressesScope.Url.Action("Index","Checkout"))})):($(".IneligibleAutoReplenishment").trigger("close"),$("#EditAddressModal").trigger("close"),l()||(n.addressesScope.UpdateAvonAccountShipping=!1),n.addressesScope.UpdateAvonAccountBilling=!1,n.addressesScope.OrderInfoSaveBilling&&(n.addressesScope.UpdateAvonAccountBilling=n.addressesScope.OrderInfoSaveBilling),n.addressesScope.OrderInfoSaveShipping&&(n.addressesScope.UpdateAvonAccountShipping=n.addressesScope.OrderInfoSaveShipping),n.addressesScope.ShippingSameAsBillingPaymentForm=!1,n.addressesScope.ShowValidation=!1,n.addressesScope.RequiredInvalidBilling=!1,n.addressesScope.RequiredInvalidShipping=!1,n.addressesScope.originalBillingAddress=angular.copy(n.addressesScope.billingAddress),n.addressesScope.originalShippingAddress=angular.copy(n.addressesScope.shippingAddress),n.addressesScope.SafeApply())});$(document).ready(function(){$(".ErrorSummaryContainer").off("click","#DisplayLoginModal");$(".ErrorSummaryContainer").on("click","#DisplayLoginModal",function(t){t.preventDefault();n.addressesScope.ShowLoading(AVON.messages.spinner_loading);var i=n.addressesScope.HomePageUrl+"signin?email="+n.addressesScope.shippingAddress.Email;n.addressesScope.RedirectToUrl(i)});$(".ErrorSummaryContainer").off("click","#DisplayForgotPassword");$(".ErrorSummaryContainer").on("click","#DisplayForgotPassword",function(t){t.preventDefault();n.addressesScope.ShowLoading(AVON.messages.spinner_loading);n.addressesScope.RedirectToUrl(n.addressesScope.Url.Action("forgotpassword","login")+"?email="+n.addressesScope.shippingAddress.Email)});document.addEventListener("visibilitychange",function(){$(".InputContainer.inlineWaterMark.applyInlineWaterMark")&&$(window).scrollTop($(window).scrollTop()+1)})})}return __extends(i,t),i.$inject=["$scope","$rootScope","customerService","trackingService","bagService","registrationService","$compile","$timeout","autoReplenishService"],i}(BaseAngularController);n.AddressesCtrl=t})(AddressModule||(AddressModule={}));app.controller("AddressesController",AddressModule.AddressesCtrl),function(n){"use strict";var t=function(t){function i(i,r,u){t.call(this,i,u);n.bannerScope=i;n.bannerScope.ScrollDown=!1;n.bannerScope.ScrollPageTop=!0;n.bannerScope.BannerCollapsed=!1;n.bannerScope.IsTabletDevice=function(){return n.bannerScope.IsTouchDevice()&&$(".no-iphone.no-ipad.no-android").length==0};var f=$(".search-location-header"),e=$(".search-location-banner");n.bannerScope.ShoppingCartClick=function(){n.bannerScope.SessionReady&&(n.bannerScope.ShowLoading(AVON.messages.spinner_loading),n.bannerScope.RedirectToUrl(n.bannerScope.Url.Action("Index","Bag")))};n.bannerScope.GoToPage=function(n,t){t===void 0&&(t="_self");n!==undefined&&u.open(n,t)};n.bannerScope.GoToWishListPage=function(t){t.preventDefault();i.Session.Customer&&i.Session.Customer.IsLoggedIn?u.location.href=i.Url.Action("index","wishlist"):i.ShowLoginModal("wishlist",encodeURIComponent(n.bannerScope.Url.Action("index","wishlist")))};n.bannerScope.IsMobileOrTablet||angular.element(u).bind("scroll",function(){var t=30;n.bannerScope.BannerCollapsed&&this.pageYOffset<t?(n.bannerScope.BannerCollapsed=!1,r.$broadcast("BannerController.BannerExpand"),n.bannerScope.SafeApply()):!n.bannerScope.BannerCollapsed&&this.pageYOffset>=t&&(n.bannerScope.BannerCollapsed=!0,r.$broadcast("BannerController.BannerCollapse"),n.bannerScope.SafeApply())})}return __extends(i,t),i.$inject=["$scope","$rootScope","$window"],i}(BaseAngularController);n.BannerController=t}(BannerModule||(BannerModule={}));app.controller("BannerController",BannerModule.BannerController),function(n){"use strict";var t=function(t){function i(i){var u,r;if(t.call(this,i),n.breadcrumbsScope=i,n.breadcrumbsScope.Breadcrumbs=[{Url:" / ",Text:"Home",CrumbType:1,HasUrl:!0}],n.breadcrumbsScope.HideCategoryBreadcrumbsBeforeBrands=function(){n.breadcrumbsScope.HiddenBreadcrumbs=0;for(var t=0;t<n.breadcrumbsScope.Breadcrumbs.length-1;t++)n.breadcrumbsScope.Breadcrumbs[t].CrumbType==2&&n.breadcrumbsScope.Breadcrumbs[t+1].CrumbType==6&&(n.breadcrumbsScope.HiddenBreadcrumbs+=1)},n.breadcrumbsScope.VerifyProductAlternatives=function(){var t,i;if(AVON.AltBreadcrumbs){if(n.breadcrumbsScope.Breadcrumbs.length>2&&n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-2].Text=="Search"&&AVON.LanguageCode=="es"){n.breadcrumbsScope.Breadcrumbs[0].Text="Inicio";n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-2].Text="Búsqueda";return}if(n.breadcrumbsScope.Breadcrumbs.length>2&&n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-2].Text=="Búsqueda"&&AVON.LanguageCode=="en"){n.breadcrumbsScope.Breadcrumbs[0].Text="Home";n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-2].Text="Search";return}if(n.breadcrumbsScope.Breadcrumbs.length>2&&n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-2].CrumbType==5)return;if(n.breadcrumbsScope.Breadcrumbs.length>4&&n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-2].Text.toLowerCase()=="order details"&&AVON.LanguageCode=="es"){n.breadcrumbsScope.Breadcrumbs[0].Text="Inicio";n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-4].Text="Mi Cuenta";n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-3].Text="Historial De Pedidos";n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-2].Text="Detalles Del Pedido";return}if(n.breadcrumbsScope.Breadcrumbs.length>4&&n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-2].Text.toLowerCase()=="detalles del pedido"&&AVON.LanguageCode=="en"){n.breadcrumbsScope.Breadcrumbs[0].Text="Home";n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-4].Text="My Account";n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-3].Text="Order History";n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-2].Text="Order Details";return}if(n.breadcrumbsScope.Breadcrumbs.length>2&&n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-2].Text.toLowerCase()=="order details"||n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-2].Text.toLowerCase()=="detalles del pedido")return;if(n.breadcrumbsScope.Breadcrumbs.length>2&&n.breadcrumbsScope.Breadcrumbs[1].Text=="Sale"&&AVON.LanguageCode=="es"){n.breadcrumbsScope.Breadcrumbs[0].Text="Inicio";n.breadcrumbsScope.Breadcrumbs[1].Text="Promociones";return}if(n.breadcrumbsScope.Breadcrumbs.length>2&&n.breadcrumbsScope.Breadcrumbs[1].Text=="Promociones"&&AVON.LanguageCode=="en"){n.breadcrumbsScope.Breadcrumbs[0].Text="Home";n.breadcrumbsScope.Breadcrumbs[1].Text="Sale";return}if(n.breadcrumbsScope.Breadcrumbs.length>2&&(n.breadcrumbsScope.Breadcrumbs[1].Text=="Sale"||n.breadcrumbsScope.Breadcrumbs[1].Text=="Promociones"))return;if(t=-1,n.breadcrumbsScope.Breadcrumbs.length>1)for(i=0;i<AVON.AltBreadcrumbs.length&&t<0;i++)n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-2].Url.replace(/^\/es\//,"/")==AVON.AltBreadcrumbs[i][AVON.AltBreadcrumbs[i].length-2].Url.replace(/^\/es\//,"/")&&(t=i);t<0&&(t=0);n.breadcrumbsScope.Breadcrumbs=AVON.AltBreadcrumbs[t]}},u=n.breadcrumbsScope.GetValueFromSessionStorage("AvonBreadcrumbs"),u)for(n.breadcrumbsScope.Breadcrumbs=u,n.breadcrumbsScope.ArrivedFromProduct=n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-1].CrumbType==7;!n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-1].HasUrl;)n.breadcrumbsScope.Breadcrumbs.pop();if(AVON.setBreadcrumbs&&AVON.breadcrumbs&&AVON.breadcrumbs.length>0)n.breadcrumbsScope.Breadcrumbs=AVON.breadcrumbs;else for(r=1;r<AVON.breadcrumbs.length;r++)n.breadcrumbsScope.Breadcrumbs.push(AVON.breadcrumbs[r]);n.breadcrumbsScope.HideCategoryBreadcrumbsBeforeBrands();n.breadcrumbsScope.VerifyProductAlternatives();n.breadcrumbsScope.Breadcrumbs&&n.breadcrumbsScope.SetValueIntoSessionStorage("AvonBreadcrumbs",n.breadcrumbsScope.Breadcrumbs);n.breadcrumbsScope.Breadcrumbs&&n.breadcrumbsScope.Breadcrumbs.length-n.breadcrumbsScope.HiddenBreadcrumbs>2&&$("#MainContainer").addClass("ShowBreadcrumb");n.breadcrumbsScope.UpdateBreadcrumbs=function(t,i,r){for(var f,u=n.breadcrumbsScope.Breadcrumbs.length;u>t;u--)n.breadcrumbsScope.Breadcrumbs.pop();if(f=3,n.breadcrumbsScope.HiddenBreadcrumbs>0&&t==3&&(f=6),n.breadcrumbsScope.Breadcrumbs&&n.breadcrumbsScope.Breadcrumbs.length>0)while(t>n.breadcrumbsScope.Breadcrumbs.length+1)--t;n.breadcrumbsScope.Breadcrumbs[t-1]={Text:i,Url:r,CrumbType:f,HasUrl:r!==""&&r!==undefined};n.breadcrumbsScope.HideCategoryBreadcrumbsBeforeBrands();n.breadcrumbsScope.SetValueIntoSessionStorage("AvonBreadcrumbs",n.breadcrumbsScope.Breadcrumbs);n.breadcrumbsScope.SafeApply()};n.breadcrumbsScope.$on("breadcrumbsScope.UpdateBreadcrumbs",function(t,i,r,u){n.breadcrumbsScope.UpdateBreadcrumbs(i,r,u)})}return __extends(i,t),i.$inject=["$scope"],i}(BaseAngularController);n.BreadcrumbsController=t}(BreadcrumbsModule||(BreadcrumbsModule={}));app.controller("BreadcrumbsController",BreadcrumbsModule.BreadcrumbsController),function(n){"use strict";var t=function(t){function i(i,r){t.call(this,i);n.changePasswordScope=i;n.changePasswordScope.DisplayPasswordInstructions=!0;n.changePasswordScope.changePasswordModel=AVON.ChangePasswordModel;_.defer(function(){$("#changePasswordModel_PasswordInput").placeholder();$("#changePasswordModel_PasswordConfirmInput").placeholder()});n.changePasswordScope.ChangePassword=function(){n.changePasswordScope.ChangePasswordForm.$valid?(n.changePasswordScope.ShowValidation=!1,n.changePasswordScope.ShowLoading(AVON.messages.spinner_processing),r.changePassword(n.changePasswordScope.changePasswordModel,$("form[name=ChangePasswordForm]"))):(n.changePasswordScope.ChangePasswordForm.changePasswordModel_Password.$invalid&&(n.changePasswordScope.DisplayPasswordInstructions=!1),n.changePasswordScope.ShowValidation=!0)};n.changePasswordScope.InputFocus=function(){n.changePasswordScope.DisplayPasswordInstructions=!0};n.changePasswordScope.$on("LoginService.ChangePasswordResponse",function(t,i){i.ErrorCode===AjaxError.ValidationErrors&&n.changePasswordScope.ProcessAjaxValidationErrors(i);i.ErrorCode===0&&i.Data.Email!==null&&$("#ChangePasswordModal").trigger("close")})}return __extends(i,t),i.$inject=["$scope","loginService","trackingService"],i}(BaseAngularController);n.ChangePasswordCtrl=t}(ChangePasswordModule||(ChangePasswordModule={}));app.controller("ChangePasswordController",ChangePasswordModule.ChangePasswordCtrl),function(n){"use strict";var t=function(t){function i(i,r){t.call(this,i);n.changeRepScope=i;n.changeRepScope.ChangeRepModel=AVON.TempModalModel;n.changeRepScope.$on("ChangeRepService.ChangeRepDesktop",function(t,i){$("#ChangeRepContainer").trigger("close");i.ErrorCode===AjaxError.ValidationErrors&&n.changeRepScope.ProcessAjaxValidationErrors(i);$("input").css("cursor","default")});n.changeRepScope.ChangeRepDesktop=function(t,i,u,f){$("input").css("cursor","progress");r.ChangeRepDesktop(t,n.changeRepScope.removeRepWebUrl(i),f)}}return __extends(i,t),i.$inject=["$scope","changeRepService","$http","trackingService"],i}(BaseAngularController);n.ChangeRepCtrl=t}(ChangeRepModule||(ChangeRepModule={}));app.controller("ChangeRepController",ChangeRepModule.ChangeRepCtrl),function(n){var t=function(t){function i(i,r){function u(n){$(n.currentTarget).hasClass("BannerCarousel")&&(n.preventDefault(),n.stopPropagation())}t.call(this,i);n.contentScope=i;n.contentScope.ShowContent=AVON.ShowContent;n.contentScope.CategoryPageMainContentLeftMargin=59;n.contentScope.CarouselButtonWidth=27;n.contentScope.ContentWidth=1200;n.contentScope.LeftNavWidth=202;n.contentScope.carouselWidth=100+(n.contentScope.CategoryPageMainContentLeftMargin+n.contentScope.CarouselButtonWidth)/(n.contentScope.ContentWidth-n.contentScope.LeftNavWidth)*100;n.contentScope.$on("productListScope.UpdateMultipleSelectedFacets",function(n,t,i,r,u){AVON.ShowContent=(u.indexOf("All ")!=-1||u.indexOf("Todo ")!=-1)&&AVON.IsDescendantMegaBrand?!1:!0});n.contentScope.ContentWithOverlayDisplay=function(t,i){var f,s,c,l,o;$(".active").removeClass("active");u(t);var r=$(t.currentTarget),e=$(t.target),y=e.is("a"),h=e.prop("href");if((t.type=="click"||t.type=="tap")&&y&&t.preventDefault(),h&&n.contentScope.GoToPage(h),r.children("div.Overlay.active").length>0&&e.parents(".Overlay").length==0){n.contentScope.ContentWithOverlayHide(t);return}if(r.find(".OverlayButton").length>0){if(e.parents(".OverlayButton").length===0&&!e.hasClass("OverlayButton"))return;r.children("div.RotatedCaret45").addClass("active");r.children("div.Overlay").addClass("active");f=r.find(".OverlayButton").last();$(".Overlay.active").attr("style").indexOf("width")<0&&$(".Overlay.active").css({width:f.outerWidth(!0)});s=$("html").hasClass("ie")?f.position().left:f[0].offsetLeft;r.parents(".header-sections-footer-container").length&&(c=f.offset(),l=f.parents(".header-sections-footer-container").offset(),s=c.left-l.left);$(".Overlay.active").css({left:s});$(".RotatedCaret45.active").css({left:s});$(".RotatedCaret45.active").css({"margin-left":f.outerWidth(!0)/2})}else r.children("div.RotatedCaret45").addClass("active"),r.children("div.Overlay").addClass("active"),$(".RotatedCaret45.active").css({"margin-left":$(".Overlay.active").outerWidth(!0)/2-$(".RotatedCaret45.active").width()/2});var a=$("#TopUtilityBarContainer").length?$("#TopUtilityBarContainer").offset().left+$("#TopUtilityBarContainer").innerWidth():0,p=$(".Overlay.active").offset().left+$(".Overlay.active").innerWidth(),v=p-a,w=$("#BannerPageWidth").length?$("#BannerPageWidth").offset().left:0;if(v>0&&!$(".Overlay.active").attr("style")&&$(".Overlay.active").css({"margin-left":-v}),i){switch(i){case"Right":o=a-$(".Overlay.active").innerWidth();break;case"Left":o=$(".Overlay.active").offset().left-w;break;case"Center":o=$(".Overlay.active").offset().left+$("#TaglinesContainer").innerWidth()/2-$(".Overlay.active").innerWidth()/2}$(".Overlay.active").css({left:o});$(".RotatedCaret45.active").css({left:o})}};n.contentScope.ContentWithOverlayHide=function(n){$(".active").removeClass("active");n.stopPropagation()};n.contentScope.ContentWithModalDisplay=function(n){var t=angular.element(n.currentTarget),i=$(t[0]);i.find("div.ContentModal").trigger("modal")};n.contentScope.ContentWithAreaPopupDisplay=function(n,t){$("div.PopupModal."+t).trigger("modal",{AllowExit:!0,Model:null,KeepLoaded:!0,IgnoreBackground:!1})};n.contentScope.ContentWithPopupDisplay=function(t,i){var o=angular.element(t.currentTarget),h=$(o[0]),s=$(t.currentTarget),r=$(t.target),f=r.is("a"),e=r.prop("href"),u;if((t.type=="click"||t.type=="tap")&&f&&t.preventDefault(),e&&f&&n.contentScope.GoToPage(e),s.find(".PopupButton").length>0){if(r.parents(".PopupButton").length===0&&!r.hasClass("PopupButton"))return;u={AllowExit:!0,Model:null,KeepLoaded:!0,IgnoreBackground:!1};$("div.PopupModal."+i).trigger("modal",u)}else u={AllowExit:!0,Model:null,KeepLoaded:!0,IgnoreBackground:!1},$("div.PopupModal."+i).trigger("modal",u)};n.contentScope.HeroModuleAsideClick=function(n,t){t.length&&i.RedirectToUrl(t,!0)};n.contentScope.$on("Carousel_Updated",function(){var n=$(".BrandModule");n.waitForImages(function(){var n=AvonModule.AvonScope.GetMaxHeight(".BrandModule carousel div.Slide"),t=AvonModule.AvonScope.GetMaxHeight(".BrandModule carousel div.Slide div.Caption");$(".BrandModule carousel div.Slide").each(function(){var i=$(this).find("div.ContentRow"),r=$(this).find("div.Caption");i.height(n);r.height(t)})})});angular.element(document).ready(function(){var n=$("#MainContainer div.ContentModule");n.length==1&&n.css("margin-bottom","0");$(".ModalContainer .PopupModal").each(function(){var n=$(this).parent();n.appendTo("#Modals")})});n.contentScope.GoToPage=function(n,t){t===void 0&&(t="_self");n!==undefined&&r.open(n,t)}}return __extends(i,t),i.$inject=["$scope","$window"],i}(BaseAngularController);n.ContentCtrl=t}(ContentModule||(ContentModule={}));app.controller("ContentController",ContentModule.ContentCtrl),function(n){var t=function(n){function t(t){n.call(this,t);var i=t;i.LoadMore=function(){i.ShowCoupons=!0};$("#CouponsContainer .CouponItemContainer .CouponImage").each(function(){var n=$(this).width(),t=$(this).attr("data-img-width"),i=$(this).attr("data-img-height"),r=Number(t)/Number(i),u=n/r;$(this).height(u)})}return __extends(t,n),t.$inject=["$scope"],t}(BaseAngularController);n.CouponsController=t}(CouponsModule||(CouponsModule={}));app.controller("CouponsController",CouponsModule.CouponsController),function(n){var t=function(t){function i(i,r){t.call(this,i);n.footerScope=i;n.footerScope.FooterClassName=n.footerScope.Session.Customer.IsAttached?"NoSubscribePanel":"HasSubscribePanel";n.footerScope.GetTopSectionId=function(){return n.footerScope.Session.Customer.IsAttached?"NavAndSocial":"SubscribeAndSocial"};n.footerScope.subscribeService=r;n.footerScope.SessionService.WhenReady().then(function(t){t.Customer.IsAttached||n.footerScope.subscribeService.getSubscribeMarkup()});n.footerScope.$on("SubscribeService.SubscribeMarkupLoaded",function(t,i){n.footerScope.subscribeDiv=i});n.footerScope.SwitchView=function(t){t.preventDefault();n.footerScope.SessionService.SwitchView(!0)};n.footerScope.IsEarmarkVisible=function(){return angular.element("#earmark-container").length>0}}return __extends(i,t),i.$inject=["$scope","subscribeService"],i}(BaseAngularController);n.FooterController=t}(FooterModule||(FooterModule={}));app.controller("FooterController",FooterModule.FooterController),function(n){"use strict";var t=function(t){function i(i,r,u,f,e){var o,s;t.call(this,i);n.forgotPasswordscope=i;n.forgotPasswordscope.ForgotPasswordModel=AVON.ForgotPasswordModel;o=$("[id=LoginModel_EmailInput]");o.keyup(function(){$("[id=forgotPasswordModel_EmailInput]").val(o.val()).change()});n.forgotPasswordscope.ForgotPasswordSubmit=function(t){t||(t=$("[id=forgotPasswordModel_EmailInput]").val());n.forgotPasswordscope.ShowLoading(AVON.messages.spinner_processing);n.forgotPasswordscope.SubmitButtonClicked=="SendNewPasswordButton"?r.sendNewPassword(t,$("form[name=ForgotPasswordForm]")):(r.sendPasswordHint(t,$("form[name=ForgotPasswordForm]")),n.forgotPasswordscope.ForgotPasswordForm.ServerErrors.Summary!==undefined&&(n.forgotPasswordscope.ForgotPasswordForm.ServerErrors.Summary.$invalid=!1))};s=function(t){n.forgotPasswordscope.ForgotPasswordForm.ServerErrors.Summary!==undefined&&(n.forgotPasswordscope.ForgotPasswordForm.ServerErrors.Summary.$invalid=!1);t.ErrorCode===AjaxError.ValidationErrors&&(n.forgotPasswordscope.ProcessAjaxValidationErrors(t),_.defer(function(){var t=$("[id=forgotPasswordModel_EmailInput]").val();AVON.TempModalModel!==undefined?AVON.TempModalModel.Email=t:AVON.TempModalModel={Email:t};f(e.find(".ErrorSummaryContainer .ValidationSummaryServer span a"))(n.forgotPasswordscope)}))};n.forgotPasswordscope.SubmitForm=function(t){n.forgotPasswordscope.SubmitButtonClicked=t;n.forgotPasswordscope.ForgotPasswordSubmit($("[id=forgotPasswordModel_EmailInput]").val())};n.forgotPasswordscope.$on("LoginService.SendNewPasswordResponse",function(n,t){s(t);u.TrackEventItem({Type:TrackingEventType.ForgotPassword})});n.forgotPasswordscope.$on("LoginService.SendPasswordHintResponse",function(n,t){s(t);u.TrackEventItem({Type:TrackingEventType.ForgotPassword})})}return __extends(i,t),i.$inject=["$scope","loginService","trackingService","$compile","$element"],i}(BaseAngularController);n.ForgotPasswordCtrl=t}(ForgotPasswordModule||(ForgotPasswordModule={}));app.controller("ForgotPasswordController",ForgotPasswordModule.ForgotPasswordCtrl),function(n){var t=function(n){function t(i,r){n.call(this,i);var u;u=i;$(r).find("ul li").length>0&&(u.activeTabId=$(r).find("ul li")[0].id);u.OnTabClick=function(n,i,r,f,e){u.IsTouchDevice()||t.prototype.ToggleTabActive(u,n,i,r,f,e)};u.OnTabTap=function(n,i,r,f,e){u.IsTouchDevice()&&t.prototype.ToggleTabActive(u,n,i,r,f,e)};u.OnTabMouseEnter=function(n,i,r){u.IsTouchDevice()||t.prototype.ToggleTabState(u,n,i,r,TabToggleMode.OnTabMouseEnter)};u.OnTabMouseLeave=function(n,i,r){u.IsTouchDevice()||t.prototype.ToggleTabState(u,n,i,r,TabToggleMode.OnTabMouseLeave)};u.$on("ProductService.ProductsLoaded",function(){r.find(window.location.hash).length>0&&(u.LoadOperationsCount+=1,u.LoadOperationsCount>=2&&_.delay(function(){u.ScrollToTop(r,!1)},1e3))});u.$on("ProductService.PromotionsLoaded",function(){r.find(window.location.hash).length>0&&(u.LoadOperationsCount+=1,u.LoadOperationsCount>=2&&_.delay(function(){u.ScrollToTop(r,!1)},1e3))});_.defer(function(){r.find(window.location.hash.substring(1)).length>0&&r.find(window.location.hash.substring(1))[0].click()})}return __extends(t,n),t.prototype.ToggleTabActive=function(n,t,i,r,u,f){var s=n.activeTabId,e,o;n.activeTabId="";this.ToggleTabStateById(n,t,s,u,f,TabToggleMode.OnTabClick);this.ToggleTabState(n,t,i,r,TabToggleMode.OnTabClick);e=angular.element(this.getEventTarget(t));$(t.target).closest("#GenericTabs").find("ul li").removeClass("Selected");e.addClass("Selected");o=e.attr("id");n.activeTabId=o},t.prototype.getEventTarget=function(n){return n.currentTarget||n.target},t.prototype.ToggleTabState=function(n,t,i,r,u){var f=angular.element(this.getEventTarget(t));this.ToggleTabStateById(n,t,f.attr("id"),i,r,u)},t.prototype.ToggleTabStateById=function(n,t,i,r,u,f){var e=$("#"+i),o=e.attr("id");n.activeTabId!=o&&($(t.target).closest("#GenericTabs").find("ul li").removeClass("Hover"),f==TabToggleMode.OnTabMouseEnter&&e.addClass("Hover"),e.css("background-color",r),e.css("color",u))},t.$inject=["$scope","$element"],t}(BaseAngularController);n.GenericTabModuleController=t}(GenericTabModule||(GenericTabModule={}));app.controller("GenericTabModuleController",GenericTabModule.GenericTabModuleController),function(n){var t=function(n){function t(t){var i=this,r;n.call(this,t);r=t;angular.element(document).ready(function(){var n=$(".main-letter"),t=$(".glossary-letter");n.on("click",function(){var r=$(i),u=$("#"+r.attr("id")+"-content");n.removeClass("pink");r.addClass("pink");t.addClass("hide");u.removeClass("hide");u.addClass("show")})})}return __extends(t,n),t.$inject=["$scope"],t}(BaseAngularController);n.GlossaryModuleController=t}(GlossaryModule||(GlossaryModule={}));app.controller("GlossaryModuleController",GlossaryModule.GlossaryModuleController),function(n){(function(n){n[n.AboutText=1]="AboutText";n[n.WelcomeSlide=2]="WelcomeSlide";n[n.WelcomeText=3]="WelcomeText";n[n.LeftMarketingModule=4]="LeftMarketingModule";n[n.RightMarketingModule=5]="RightMarketingModule"})(n.OnlineStoreContentName||(n.OnlineStoreContentName={}));var t=n.OnlineStoreContentName}(OnlineStoreModule||(OnlineStoreModule={}));ProfileInfoModel=function(){function n(){}return n}(),function(n){var t=function(n){function t(t,i,r){n.call(this,t);var u=t;u.ProfileInfoModel=new ProfileInfoModel;u.SessionService.WhenReady().then(function(){u.Session.Rep.Id>0&&r.getRepresentativeDetails().then(function(n){return u.ProfileInfoModel=n.Data,u.ProfileInfoModel&&(u.FacebookUrl="https://www.facebook.com/"+u.ProfileInfoModel.FacebookHandle,u.TwitterUrl="https://www.twitter.com/"+u.ProfileInfoModel.TwitterHandle,u.InstagramUrl="https://www.instagram.com/"+u.ProfileInfoModel.InstagramHandle,u.PinterestUrl="https://www.pinterest.com/"+u.ProfileInfoModel.PinterestHandle),null})});u.DisplayContactModal=function(){u.ShowContactRepModal(null,"become_a_rep")};u.CanDisplayRepPhoneNumber=function(){return u.Session.Rep.IsGemini?u.Session.Rep.Phone!==""&&!u.isCustomerAttachedToRemovedRep()&&u.ProfileInfoModel.DisplayFirstPhoneNumber:u.Session.Rep.Phone!==""&&!u.isCustomerAttachedToRemovedRep()};u.CanDisplayRepAlternativePhoneNumber=function(){return u.Session.Rep.IsGemini?u.Session.Rep.AlternativePhone!==""&&!u.isCustomerAttachedToRemovedRep()&&u.ProfileInfoModel.DisplaySecondPhoneNumber:u.Session.Rep.AlternativePhone!==""&&!u.isCustomerAttachedToRemovedRep()};u.CanDisplayConnectWithMe=function(){return u.Session.Rep.HomepageUrl&&u.Session.Rep.HomepageUrl!==""};u.CanDisplayRepCityState=function(){return u.Session.Rep.IsGemini?u.Session.Rep.CityState!==""&&u.ProfileInfoModel.DisplayCityState:u.Session.Rep.CityState!==""};u.$on("FallbackSrc.FallbackImageLoaded",function(n,t){var r=t.parent(".leftRepPanel"),i;r&&(r.hide(),i=$(".middleRepPanel"),i&&!i.hasClass("NoRepImage")&&i.addClass("NoRepImage"))});u.ShowIcon=function(n){return n?!0:!1}}return __extends(t,n),t.$inject=["$scope","$rootScope","geminiRepDetailsService"],t}(BaseAngularController);n.HeaderRepPanelController=t}(HeaderRepPanelModule||(HeaderRepPanelModule={}));app.controller("HeaderRepPanelController",HeaderRepPanelModule.HeaderRepPanelController),function(n){var t=function(){function n(){}return n.Brand="B",n.Category="C",n.Search="S",n}();n.DeptType=t}(LayoutLeftNavigationModule||(LayoutLeftNavigationModule={})),function(n){var t=function(){function n(){}return n.Brands="Brands",n.BrandsES="Marcas",n.Category="Category",n.CategoryES="Categoría",n.Categories="Categories",n.CategoriesES="Categorías",n.Outlet="Outlet",n}();n.GroupName=t}(LayoutLeftNavigationModule||(LayoutLeftNavigationModule={})),function(n){"use strict";var t=function(t){function i(r,u,f,e,o,s){function w(n){return n.IncludeInAllBrandsPage&&n.IncludeInTopBrandsNavigation}function a(t,i,r){switch(t){case n.DeptType.Brand:return r?n.layoutLeftNavigationScope.DeptType===t&&i!==n.GroupName.Brands&&i!==n.GroupName.BrandsES:n.layoutLeftNavigationScope.DeptType===t&&i===n.GroupName.Brands||i===n.GroupName.BrandsES;case n.DeptType.Category:return r?n.layoutLeftNavigationScope.DeptType===t&&i!==n.GroupName.Categories&&i!==n.GroupName.CategoriesES&&i!==n.GroupName.Outlet&&i!==n.GroupName.Category&&i!==n.GroupName.CategoryES:n.layoutLeftNavigationScope.DeptType===t&&i===n.GroupName.Categories||i===n.GroupName.CategoriesES||i===n.GroupName.Outlet||i===n.GroupName.Category||i===n.GroupName.CategoryES;case n.DeptType.Search:return n.layoutLeftNavigationScope.DeptType===t}return!1}function b(t){return n.layoutLeftNavigationScope.SelectedCategoryId===t.Id}function k(t,i){i===void 0&&(i=!1);var r=i?n.GroupName.BrandsES:n.GroupName.Brands,u=t[0].GroupNames.indexOf(r),f=u>-1;return f&&(t[0].GroupNames.splice(u),t[0].GroupNames.unshift(r)),f}function tt(t,i){return _.any(t.GroupedChildren[i],function(t){return n.layoutLeftNavigationScope.ShowFacet(t)})}function g(t){var i=t===SliderFacetModelNames.priceRangeModel?n.layoutLeftNavigationScope.PageLoadPriceRange:n.layoutLeftNavigationScope.PageLoadDiscountRange;return _.isUndefined(n.layoutLeftNavigationScope[t])?!1:n.layoutLeftNavigationScope[t].minimum!==i.minimum||n.layoutLeftNavigationScope[t].maximum!==i.maximum}function nt(n){return(n*100).toFixed(2)}function it(){return!0}function l(){var t=window.ProductListModule,i,u,f,e,r;t!=null&&t.productListScope!=null&&(i=t.productListScope.productCategoryStructure&&t.productListScope.productCategoryStructure.Products&&t.productListScope.productCategoryStructure.Products.length>0&&t.productListScope.productCategoryStructure.Children.length===0?t.productListScope.productCategoryStructure.Products:t.productListScope.uniqueProducts,it()?(r=n.layoutLeftNavigationScope.ProductSearchLoaded||AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0||AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0||n.layoutLeftNavigationScope.Ratings.length>0?t.productListScope.filterLeftNavByProducts(i):i,n.layoutLeftNavigationScope.facetsToShow=_(r).chain().pluck("Facets").flatten().value(),n.layoutLeftNavigationScope.deptFacetsToShow=_(r).chain().pluck("CategoryIds").flatten().uniq().value(),n.layoutLeftNavigationScope.validRatings=_(r).chain().filter(function(t){return n.layoutLeftNavigationScope.ShowProductRating(t)}).map(function(n){return Math.floor(n.Rating+t.productListScope.RatingFudge)}).uniq().sortBy(function(n){return n}).value()):(u=n.layoutLeftNavigationScope.ProductSearchLoaded||AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0||AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0?t.productListScope.filterLeftNavRatingsByProducts(i):i,f=n.layoutLeftNavigationScope.ProductSearchLoaded||AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0||n.layoutLeftNavigationScope.Ratings.length>0?t.productListScope.filterLeftNavDeptByProducts(i):i,n.layoutLeftNavigationScope.facetsToShow=[],AVON.Navigation&&AVON.Navigation.ShopBys&&(e=n.layoutLeftNavigationScope.ProductSearchLoaded||AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0||AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0||n.layoutLeftNavigationScope.Ratings.length>0?t.productListScope.filterLeftNavByFacets(AVON.Navigation.ShopBys,!0,i):t.productListScope.filterLeftNavByFacets(AVON.Navigation.ShopBys,!1,i),n.layoutLeftNavigationScope.facetsToShow=_(e).chain().pluck("Id").flatten().uniq().value()),n.layoutLeftNavigationScope.deptFacetsToShow=_(f).chain().pluck("CategoryIds").flatten().uniq().value(),n.layoutLeftNavigationScope.validRatings=_(u).chain().filter(function(t){return n.layoutLeftNavigationScope.ShowProductRating(t)}).map(function(n){return Math.floor(n.Rating+t.productListScope.RatingFudge)}).uniq().sortBy(function(n){return n}).value()));n.layoutLeftNavigationScope.setClearAll()}function v(){var n=".SelectedFacetContainer",i=$(n).is(":animated"),t="html, body",r=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match("CriOS")!=null,u=$(n).offset().top,f=$(window).scrollTop();i===!1&&f>u&&(r?_.delay(function(){return $(t).animate({scrollTop:$(n).offset().top-160},1e3)},10):$(t).animate({scrollTop:$(n).offset().top-160},1e3))}var h=this,d,c,y,p;t.call(this,r);this.$rootScope=u;this.historyService=s;n.layoutLeftNavigationScope=r;n.layoutLeftNavigationScope.SelectedFacetIds=[];n.layoutLeftNavigationScope.SelectedRatings=[];n.layoutLeftNavigationScope.StateIndex=0;n.layoutLeftNavigationScope.SelectedSortByValue=SortOption.None;AVON.LeftNavigation&&(n.layoutLeftNavigationScope.MenuItems=AVON.LeftNavigation.MenuItems,n.layoutLeftNavigationScope.SubCategoryId=AVON.LeftNavigation.SubCategoryId,n.layoutLeftNavigationScope.TopLevelCategoryName=AVON.LeftNavigation.TopLevelCategoryName,n.layoutLeftNavigationScope.DeptType=AVON.LeftNavigation.DeptType,n.layoutLeftNavigationScope.ShowFacets=AVON.LeftNavigation.ShowFacets,n.layoutLeftNavigationScope.CategoryDeepLinkModel=AVON.CategoryDeepLinksModel);AVON.Navigation&&(n.layoutLeftNavigationScope.Navigation=AVON.Navigation);n.layoutLeftNavigationScope.isNewAndNowPage=function(n){return n.toString()==="9300"};n.layoutLeftNavigationScope.deptFacetsToShow=[];n.layoutLeftNavigationScope.facetsToShow=[];n.layoutLeftNavigationScope.facetClicked=!1;n.layoutLeftNavigationScope.validRatings=[];n.layoutLeftNavigationScope.PriceSliderChangeIndex=0;n.layoutLeftNavigationScope.DiscountSliderChangeIndex=0;n.layoutLeftNavigationScope.menuItemHasPromotionThumbnails=function(n,t){return n==undefined||_.isNull(n[t])?!1:n[t].ImageItems.length>0?!0:n[t].RichTextItems.length>0?!0:!1};n.layoutLeftNavigationScope.groupNameIsNotBrand=function(t){return t!==n.GroupName.Brands&&t!==n.GroupName.BrandsES};n.layoutLeftNavigationScope.isFacetToggle=function(t){return n.layoutLeftNavigationScope.isDepartmentTypeSearch()||!n.layoutLeftNavigationScope.isSubCategoryIdZero()||t===n.GroupName.Outlet};n.layoutLeftNavigationScope.isDepartmentTypeBrand=function(t,i){return i===void 0&&(i=!1),a(n.DeptType.Brand,t,i)};n.layoutLeftNavigationScope.isDepartmentTypeCategory=function(t,i){return i===void 0&&(i=!1),a(n.DeptType.Category,t,i)};n.layoutLeftNavigationScope.isDepartmentTypeSearch=function(){return a(n.DeptType.Search)};n.layoutLeftNavigationScope.isBrandDeptType=function(){return n.layoutLeftNavigationScope.DeptType===n.DeptType.Brand};n.layoutLeftNavigationScope.isMenuItemBrand=function(t,i){return a(n.DeptType.Brand,i)&&t.GroupedChildren[i].length>0};n.layoutLeftNavigationScope.isMenuItemShownInLeftNav=function(t,i){i===void 0&&(i=!1);var r=t.IncludeInLeftNavigation===!0&&t.Id===n.layoutLeftNavigationScope.SubCategoryId;return i?r&&t.Children.length>0:r};n.layoutLeftNavigationScope.applySelectedCategoryClass=function(n){if(w(n)){var t=window.location.pathname,i=t.split("/").slice(-1)[0];return i==="all"&&b(n)?"SelectedCategory":""}return b(n)?"SelectedCategory":""};n.layoutLeftNavigationScope.applySearchClass=function(){return n.layoutLeftNavigationScope.DeptType===n.DeptType.Search?"SearchLeftNavGroupItem":""};n.layoutLeftNavigationScope.applyNewAndNowPageClass=function(t){return n.layoutLeftNavigationScope.isNewAndNowPage(t)?"NewAndNowPage":""};n.layoutLeftNavigationScope.isSubCategoryIdZero=function(){return n.layoutLeftNavigationScope.SubCategoryId===0};n.layoutLeftNavigationScope.renderCategoryUrl=function(n,t){return(t===void 0&&(t=!1),w(n))?n.Url+"/all":n.IncludeInAllBrandsPage&&n.Children.length===0?n.Url+"/all":_.isEmpty(n)?"":n.Url};n.layoutLeftNavigationScope.trustHtmlModel=function(n){return f.trustAsHtml(n)};n.layoutLeftNavigationScope.PrimeFacets=[];n.layoutLeftNavigationScope.Ratings=[];_.delay(function(){var n=$("a:contains('Outlet')");n.hasClass("active")&&n.addClass("SelectedCategory");n.find("i").remove()});n.layoutLeftNavigationScope.SelectedCategoryId=AVON.SelectedCategoryId;AvonModule.AvonScope.LeftNavigationSelectedLink=AVON.SelectedCategoryId;AvonModule.AvonScope.LeftNavigationPinkLink=AVON.SelectedCategoryId;AvonModule.AvonScope.LeftNavigationSelectedLinkParent=AVON.SelectedCategoryId;_.delay(function(){var n=$("ul.Categories");$("li",n).length==1&&n.parent().hide()},1e3);n.layoutLeftNavigationScope.DeptType===n.DeptType.Brand&&n.layoutLeftNavigationScope.MenuItems[0]&&(d=k(n.layoutLeftNavigationScope.MenuItems,!1),d||k(n.layoutLeftNavigationScope.MenuItems,!0));n.layoutLeftNavigationScope.IsRatingChecked=function(t){return n.layoutLeftNavigationScope.Ratings.indexOf(t)>-1};n.layoutLeftNavigationScope.$on("layoutLeftNavigationScope.PopulateSelectedRatings",function(t,i){_.each(i,function(t){n.layoutLeftNavigationScope.Ratings.push(t)});n.layoutLeftNavigationScope.setClearAll()});n.layoutLeftNavigationScope.UpdateRatings=function(t,r){var e,f;v();t.target.checked?n.layoutLeftNavigationScope.Ratings.indexOf(r)===-1&&n.layoutLeftNavigationScope.Ratings.push(r):n.layoutLeftNavigationScope.Ratings=_.filter(n.layoutLeftNavigationScope.Ratings,function(n){return n!==r});n.layoutLeftNavigationScope.ProductSearchLoaded||n.layoutLeftNavigationScope.SkipPushState||!h.historyService.IsPushStateSupported||(e=n.layoutLeftNavigationScope.GetUpdatedUrl(n.layoutLeftNavigationScope.RatingsQueryStringParamName,n.layoutLeftNavigationScope.Ratings),c()||s.PushStateUrl(window.location.href),f=h.getCurrentPageState(),s.ReplaceState(i.HistoryStateKey,f,e),n.layoutLeftNavigationScope.DeepLinkPageState&&(n.layoutLeftNavigationScope.DeepLinkPageState=f));n.layoutLeftNavigationScope.SkipPushState||(n.layoutLeftNavigationScope.RatingSelected=n.layoutLeftNavigationScope.Ratings&&n.layoutLeftNavigationScope.Ratings.length>0);u.$broadcast("productListScope.UpdateRatings",n.layoutLeftNavigationScope.Ratings);n.layoutLeftNavigationScope.UpdateDiscountAndPriceModel();n.layoutLeftNavigationScope.setClearAll()};n.layoutLeftNavigationScope.$on("productListScope.RatingRemoved",function(t,i){var r=n.layoutLeftNavigationScope.Ratings.indexOf(i);r>-1&&n.layoutLeftNavigationScope.Ratings.splice(r,1)});n.layoutLeftNavigationScope.ClearRatings=function(t,r){var e,f;r===void 0&&(r=!0);n.layoutLeftNavigationScope.RatingSelected=!1;t=t||!1;t===!1&&v();$(".LeftNavGroupItem .ratingCheckbox").prop("checked",!1);n.layoutLeftNavigationScope.Ratings=[];u.$broadcast("productListScope.UpdateRatings",n.layoutLeftNavigationScope.Ratings);r&&!n.layoutLeftNavigationScope.ProductSearchLoaded&&!n.layoutLeftNavigationScope.SkipPushState&&h.historyService.IsPushStateSupported&&(e=n.layoutLeftNavigationScope.GetUpdatedUrl(n.layoutLeftNavigationScope.RatingsQueryStringParamName,n.layoutLeftNavigationScope.Ratings),c()||s.PushStateUrl(window.location.href),f=h.getCurrentPageState(),s.ReplaceState(i.HistoryStateKey,f,e),n.layoutLeftNavigationScope.DeepLinkPageState&&(n.layoutLeftNavigationScope.DeepLinkPageState=f));n.layoutLeftNavigationScope.UpdateDiscountAndPriceModel()};n.layoutLeftNavigationScope.ShowSubBrands=function(){return $(".subNav").length>0};n.layoutLeftNavigationScope.showProductList=function(){return AVON.ShowProductList};n.layoutLeftNavigationScope.$on("productListScope.UpdateMultipleSelectedFacets",function(){AVON.ShowProductList=!0});n.layoutLeftNavigationScope.$on("ProductListController.ProductsLoaded",function(t,i){n.layoutLeftNavigationScope.PageLoadUrl=document.location.href;n.layoutLeftNavigationScope.ProductsLoaded=!0;l();n.layoutLeftNavigationScope.ShowRatings=i});n.layoutLeftNavigationScope.$on("ProductListController.UpdateSelectedCategory",function(t,i){n.layoutLeftNavigationScope.LinkClick(null,i,null,!1)});n.layoutLeftNavigationScope.ToggleGroupSection=function(n){var r=angular.element(n.currentTarget),i=r.parent(),u=i.next("ul").length>0?i.next("ul"):i.next(".facet-slider-container"),t=r.find("i");t.hasClass("fa-chevron-circle-down")?(u.addClass("Hidden"),t.removeClass("fa-chevron-circle-down"),t.addClass("fa-chevron-circle-right")):(u.removeClass("Hidden"),t.removeClass("fa-chevron-circle-right"),t.addClass("fa-chevron-circle-down"))};n.layoutLeftNavigationScope.ClearGroupSection=function(n,t,i){for(var e,f=[],r=0;r<i.length;r++)f.push(i[r].Id),$("#LeftNavCheckbox-"+i[r].Id).prop("checked",!1);e=angular.element(n.currentTarget);e.removeClass("Active");u.$broadcast("productListScope.UpdateMultipleSelectedFacets",t,f,!1)};c=function(){return n.layoutLeftNavigationScope.PageLoadUrl!==document.location.href};n.layoutLeftNavigationScope.UpdateSelectedFacets=function(t,r,f,e,o,a,y){var d,w,p,g,nt,b,k;y===void 0&&(y=!1);d=$("#TaglinesContainer");n.layoutLeftNavigationScope.SkipPushState||(n.layoutLeftNavigationScope.SelectedFacetIds=[]);d.length>0&&v();w=t&&t.target.checked||a;o?w&&AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.indexOf(f)<0?(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.push(f),AvonModule.AvonScope.$broadcast("layoutLeftNavigationScope.FacetAdded",f,e,y)):!w&&AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.indexOf(f)>=0&&(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets=_(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets).without(f),AvonModule.AvonScope.$broadcast("layoutLeftNavigationScope.FacetRemoved")):(p=_(AvonModule.AvonScope.LeftNavigationSelectedFacets).findWhere({Title:r}),p==null&&(p={Title:r,Facets:[],ValidDeptIds:[],IsDepartmentShopBy:o},AvonModule.AvonScope.LeftNavigationSelectedFacets.push(p)),w&&_(p.Facets).chain().pluck("Id").flatten().uniq().value().indexOf(f)<0?(g={Id:f,Text:e},p.Facets.push(g),AvonModule.AvonScope.$broadcast("layoutLeftNavigationScope.FacetAdded",f,e,y)):!w&&_(p.Facets).chain().pluck("Id").flatten().uniq().value().indexOf(f)>=0&&(p.Facets=_(p.Facets).filter(function(n){return n.Id!=f}),AvonModule.AvonScope.LeftNavigationSelectedFacets=_(AvonModule.AvonScope.LeftNavigationSelectedFacets).filter(function(n){return n.Facets.length>0}),AvonModule.AvonScope.$broadcast("layoutLeftNavigationScope.FacetRemoved")));n.layoutLeftNavigationScope.ProductSearchLoaded||n.layoutLeftNavigationScope.SkipPushState||!h.historyService.IsPushStateSupported||(c()||s.PushStateUrl(window.location.href),h.getSelectedFacetIds(),nt=n.layoutLeftNavigationScope.GetUpdatedUrl(n.layoutLeftNavigationScope.FacetQueryStringParamName,n.layoutLeftNavigationScope.SelectedFacetIds),b=h.getCurrentPageState(),s.ReplaceState(i.HistoryStateKey,b,nt),n.layoutLeftNavigationScope.DeepLinkPageState&&(n.layoutLeftNavigationScope.DeepLinkPageState=b));l();n.layoutLeftNavigationScope.facetClicked=!0;u.$broadcast("productListScope.EnableFacetClear",f);n.layoutLeftNavigationScope.UpdateDiscountAndPriceModel();n.layoutLeftNavigationScope.ProductSearchLoaded&&AVON.NavigationOriginalSearchFacets&&(n.layoutLeftNavigationScope.MatchedHiddenFacetsForSearch||(n.layoutLeftNavigationScope.MatchedHiddenFacetsForSearch=_.filter(AVON.NavigationOriginalSearchFacets,function(n){return n.Text.toLowerCase()===e.toLowerCase()&&n.Id!==f})),n.layoutLeftNavigationScope.MatchedHiddenFacetsForSearch&&(n.layoutLeftNavigationScope.MatchedHiddenFacetsForSearch.length>0?(k=n.layoutLeftNavigationScope.MatchedHiddenFacetsForSearch.pop(),n.layoutLeftNavigationScope.UpdateSelectedFacets(null,r,k.Id,k.Text,o,w,!0)):n.layoutLeftNavigationScope.MatchedHiddenFacetsForSearch=null))};s.OnPopState(i.HistoryStateKey,function(t){var a,v,b,w,k;n.layoutLeftNavigationScope.SkipPushState=!0;var i=t.state,r="",c="",f="",e="",o="",l;if(i&&i.Index!==undefined&&(l=n.layoutLeftNavigationScope.PopStateIndex!==undefined?i.Index>0&&i.Index<n.layoutLeftNavigationScope.PopStateIndex?"back":"forward":i.Index>0&&i.Index<n.layoutLeftNavigationScope.StateIndex?"back":"forward",n.layoutLeftNavigationScope.PopStateIndex=i.Index),i&&i.category)i.Data.ParentLinkId!==i.category.Id&&(a=$("#link-"+i.Data.ParentLinkId+" > a:first-of-type"),a&&a.trigger("click")),v=$("#link-"+i.category.Id+" > a:first-of-type"),v&&v.trigger("click");else{if(b=window.location.pathname.split("/").pop(),_.each(AVON.Navigation.LinkGroups,function(n){w=_.find(n.Links,function(n){return n.Text.formatUrlNugget()===b.formatUrlNugget()})}),w&&(k=$("#link-"+w.Id+" > a:first-of-type"),!k.hasClass("SelectedCategory"))){window.location.reload();return}if((!l||l==="back")&&h.pageStateIsUnchanged(i)){n.layoutLeftNavigationScope.ShowLoading("");s.Go(-1);return}r=app.GetQuerystringParameterByName(n.layoutLeftNavigationScope.FacetQueryStringParamName);c=app.GetQuerystringParameterByName(n.layoutLeftNavigationScope.RatingsQueryStringParamName);f=app.GetQuerystringParameterByName(n.layoutLeftNavigationScope.PriceQueryStringParamName);e=app.GetQuerystringParameterByName(n.layoutLeftNavigationScope.DiscountQueryStringParamName);o=app.GetQuerystringParameterByName(n.layoutLeftNavigationScope.SortByQueryStringParamName);i&&i.SelectedFacetIds?(n.layoutLeftNavigationScope.SelectedFacetIds.length>0&&y(n.layoutLeftNavigationScope.SelectedFacetIds,r),n.layoutLeftNavigationScope.Ratings.length>0&&p(n.layoutLeftNavigationScope.Ratings,r),n.layoutLeftNavigationScope.SelectedFacetIds=i.SelectedFacetIds,n.layoutLeftNavigationScope.SelectedRatings=i.SelectedRatings,n.layoutLeftNavigationScope.PriceRangeFacetSelected=i.SelectedPriceRange.PriceRangeFacetSelected,n.layoutLeftNavigationScope.DiscountRangeFacetSelected=i.SelectedDiscountRange.DiscountRangeFacetSelected,u.$broadcast("productListScope.SetDiscountRangeSelected",n.layoutLeftNavigationScope.PriceRangeFacetSelected),u.$broadcast("productListScope.SetPriceRangeSelected",n.layoutLeftNavigationScope.DiscountRangeFacetSelected)):(n.layoutLeftNavigationScope.SelectedFacetIds.length===0&&(_.each(AvonModule.AvonScope.LeftNavigationSelectedFacets,function(t){t.Facets.map(function(t){n.layoutLeftNavigationScope.SelectedFacetIds.push(t.Id)})}),n.layoutLeftNavigationScope.SelectedFacetIds=n.layoutLeftNavigationScope.SelectedFacetIds.concat(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets)),_.each(n.layoutLeftNavigationScope.Ratings,function(t){n.layoutLeftNavigationScope.SelectedRatings.push(t)}));(n.layoutLeftNavigationScope.PriceRangeFacetSelected||n.layoutLeftNavigationScope.PriceRangeDeepLink)&&i&&i.SelectedDiscountRange&&f.length>0?(n.layoutLeftNavigationScope.priceRangeModel.minimumDisplayValue=i.SelectedPriceRange.Minimum,n.layoutLeftNavigationScope.priceRangeModel.maximumDisplayValue=i.SelectedPriceRange.Maximum,n.layoutLeftNavigationScope.priceRangeModel.floor=0,n.layoutLeftNavigationScope.priceRangeModel.ceil=i.SelectedPriceRange.Ceil,n.layoutLeftNavigationScope.onPriceRangeSliderChange(),n.layoutLeftNavigationScope.SafeApply()):(u.$broadcast("productListScope.SetPriceRangeSelected",!1),f.length===0?n.layoutLeftNavigationScope.UpdateDiscountAndPriceModel():(n.layoutLeftNavigationScope.priceRangeModel.minimumDisplayValue=n.layoutLeftNavigationScope.PageLoadPriceRange.minimumDisplayValue,n.layoutLeftNavigationScope.priceRangeModel.maximumDisplayValue=n.layoutLeftNavigationScope.PageLoadPriceRange.maximumDisplayValue,n.layoutLeftNavigationScope.priceRangeModel.floor=0,n.layoutLeftNavigationScope.priceRangeModel.ceil=n.layoutLeftNavigationScope.PageLoadPriceRange.ceil,n.layoutLeftNavigationScope.onPriceRangeSliderChange()),n.layoutLeftNavigationScope.SafeApply());(n.layoutLeftNavigationScope.DiscountRangeFacetSelected||n.layoutLeftNavigationScope.DiscountRangeDeepLink)&&i&&i.SelectedDiscountRange&&e.length>0?(n.layoutLeftNavigationScope.discountLevelModel.minimum=i.SelectedDiscountRange.Minimum,n.layoutLeftNavigationScope.discountLevelModel.maximum=i.SelectedDiscountRange.Maximum,n.layoutLeftNavigationScope.discountLevelModel.floor=0,n.layoutLeftNavigationScope.discountLevelModel.ceil=i.SelectedDiscountRange.Ceil,n.layoutLeftNavigationScope.onDiscountLevelSliderChange(),n.layoutLeftNavigationScope.SafeApply()):(u.$broadcast("productListScope.SetDiscountRangeSelected",!1),e.length===0?n.layoutLeftNavigationScope.UpdateDiscountAndPriceModel():(n.layoutLeftNavigationScope.discountLevelModel.minimum=n.layoutLeftNavigationScope.PageLoadDiscountRange.minimum,n.layoutLeftNavigationScope.discountLevelModel.maximum=n.layoutLeftNavigationScope.PageLoadDiscountRange.maximum,n.layoutLeftNavigationScope.discountLevelModel.floor=0,n.layoutLeftNavigationScope.discountLevelModel.ceil=n.layoutLeftNavigationScope.PageLoadDiscountRange.ceil,n.layoutLeftNavigationScope.onDiscountLevelSliderChange()),n.layoutLeftNavigationScope.SafeApply());p(n.layoutLeftNavigationScope.SelectedRatings,c);y(n.layoutLeftNavigationScope.SelectedFacetIds,r);n.layoutLeftNavigationScope.SelectedSortByValue=o.length===0?SortOption.None:parseInt(o);u.$broadcast("productListScope.SortByUpdated",n.layoutLeftNavigationScope.SelectedSortByValue)}_.defer(function(){n.layoutLeftNavigationScope.SkipPushState=!1;n.layoutLeftNavigationScope.facetClicked=!n.layoutLeftNavigationScope.facetClicked&&r.length>0;n.layoutLeftNavigationScope.RatingSelected=!n.layoutLeftNavigationScope.RatingSelected&&c.length>0;n.layoutLeftNavigationScope.PriceRangeFacetSelected=!n.layoutLeftNavigationScope.PriceRangeFacetSelected&&f.length>0||i&&i.SelectedPriceRange&&i.SelectedPriceRange.PriceRangeFacetSelected;n.layoutLeftNavigationScope.DiscountRangeFacetSelected=!n.layoutLeftNavigationScope.DiscountRangeFacetSelected&&e.length>0||i&&i.SelectedDiscountRange&&i.SelectedDiscountRange.DiscountRangeFacetSelected;n.layoutLeftNavigationScope.SortingSelected=!n.layoutLeftNavigationScope.SortingSelected&&o.length>0;n.layoutLeftNavigationScope.setClearAll()})});y=function(n,t){_.each(n,function(n){var i=$("#LeftNavCheckbox-"+n);i&&i.is(":checked")&&t.indexOf(n.toString())===-1&&i.trigger("click");i&&!i.is(":checked")&&t.indexOf(n.toString())>=0&&i.trigger("click")})};p=function(n,t){_.each(n,function(n){var i=$("#rating-"+n);i&&i.is(":checked")&&t.indexOf(n.toString())===-1&&i.trigger("click");i&&!i.is(":checked")&&t.indexOf(n.toString())>=0&&i.trigger("click")})};n.layoutLeftNavigationScope.UpdateDiscountAndPriceModel=function(){n.layoutLeftNavigationScope.ProductSearchLoaded||u.$broadcast("productListScope.UpdateDiscountAndPriceModel")};n.layoutLeftNavigationScope.ClearShopByFacets=function(t,r,u,f){var o,e,a,p,y;f===void 0&&(f=!0);u=u||!1;u===!1&&v();o="#shopByFacetList-"+n.layoutLeftNavigationScope.cleanText(t);$(o).find("input[type=checkbox]").prop("checked",!1);$(o).parent(".LeftNavGroupItem").find(".Active").removeClass("Active");e=_(AvonModule.AvonScope.LeftNavigationSelectedFacets).findWhere({Title:t});e!=null?(_.each(e.Facets,function(t){var i=n.layoutLeftNavigationScope.SelectedFacetIds.indexOf(t.Id);i>-1&&n.layoutLeftNavigationScope.SelectedFacetIds.splice(i,1)}),e.Facets=[],AvonModule.AvonScope.LeftNavigationSelectedFacets=_(AvonModule.AvonScope.LeftNavigationSelectedFacets).filter(function(n){return n.Facets.length>0})):r&&(_.each(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets,function(t){var i=n.layoutLeftNavigationScope.SelectedFacetIds.indexOf(t);i>-1&&n.layoutLeftNavigationScope.SelectedFacetIds.splice(i,1)}),AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>1?(a=_(n.layoutLeftNavigationScope.Navigation.ShopBys).findWhere({Title:t}),a&&_.each(a.Facets,function(t){n.layoutLeftNavigationScope.MatchedHiddenFacetsForSearch||(n.layoutLeftNavigationScope.MatchedHiddenFacetsForSearch=_.filter(AVON.NavigationOriginalSearchFacets,function(n){return n.Text.toLowerCase()===t.Text.toLowerCase()&&n.Id!==t.Id}));_.each(n.layoutLeftNavigationScope.MatchedHiddenFacetsForSearch,function(n){var t=AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.indexOf(n.Id);t>-1&&AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.splice(t,1)});n.layoutLeftNavigationScope.MatchedHiddenFacetsForSearch=null;var i=AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.indexOf(t.Id);i>-1&&AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.splice(i,1)})):AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets=[]);f&&!n.layoutLeftNavigationScope.ProductSearchLoaded&&!n.layoutLeftNavigationScope.SkipPushState&&h.historyService.IsPushStateSupported&&(p=n.layoutLeftNavigationScope.GetUpdatedUrl(n.layoutLeftNavigationScope.FacetQueryStringParamName,n.layoutLeftNavigationScope.SelectedFacetIds),c()||s.PushStateUrl(window.location.href),y=h.getCurrentPageState(),s.ReplaceState(i.HistoryStateKey,y,p),n.layoutLeftNavigationScope.DeepLinkPageState&&(n.layoutLeftNavigationScope.DeepLinkPageState=y));l();n.layoutLeftNavigationScope.UpdateDiscountAndPriceModel();AvonModule.AvonScope.$broadcast("layoutLeftNavigationScope.FacetRemoved")};n.layoutLeftNavigationScope.ClearShopAll=function(){for(var t in n.layoutLeftNavigationScope.Navigation.ShopBys)n.layoutLeftNavigationScope.ClearShopByFacets(n.layoutLeftNavigationScope.Navigation.ShopBys[t].Title,n.layoutLeftNavigationScope.Navigation.ShopBys[t].IsDepartmentShopBy,!0,!0);n.layoutLeftNavigationScope.ClearRatings(!0,!0);u.$broadcast("layoutLeftNavigationScope.ClearPriceAndDiscount")};n.layoutLeftNavigationScope.cleanText=function(n){return n.toLocaleLowerCase().replace(/[^0-9a-z]/gi,"")};n.layoutLeftNavigationScope.FacetsToShow=function(){var n=window.ProductListModule;if(n!=null&&n.productListScope!=null){var i=n.productListScope.productCategoryStructure!=null&&n.productListScope.productCategoryStructure.Products!=null&&n.productListScope.productCategoryStructure.Products.length>0,t=i?n.productListScope.productCategoryStructure.Products:n.productListScope.products,r=_(t).pluck("Id");return _(t).chain().select(function(n){return r.indexOf(n.Id)>=0}).pluck("Facets").flatten().uniq().value()}return[]};n.layoutLeftNavigationScope.DepartmentFacetsToShow=function(){var n=window.ProductListModule;if(n!=null&&n.productListScope!=null){var i=n.productListScope.productCategoryStructure!=null&&n.productListScope.productCategoryStructure.Products!=null&&n.productListScope.productCategoryStructure.Products.length>0,t=i?n.productListScope.productCategoryStructure.Products:n.productListScope.products,r=_(t).pluck("Id");return _(t).chain().select(function(n){return r.indexOf(n.Id)>=0}).pluck("CategoryIds").flatten().uniq().value()}return[]};n.layoutLeftNavigationScope.isValidRating=function(t){return $("#rating-"+t).prop("checked")===!0?!0:n.layoutLeftNavigationScope.validRatings.indexOf(t)>=0};n.layoutLeftNavigationScope.filterFacets=function(t){return n.layoutLeftNavigationScope.FacetsToShow().indexOf(t.Id)>=0};n.layoutLeftNavigationScope.filterDepartmentFacets=function(t){return n.layoutLeftNavigationScope.DepartmentFacets=n.layoutLeftNavigationScope.DepartmentFacetsToShow(),n.layoutLeftNavigationScope.DepartmentFacets.indexOf(t.Id)>=0};n.layoutLeftNavigationScope.SetExclusiveFacet=function(t,i,r){n.layoutLeftNavigationScope.SelectedCategoryId=r;u.$broadcast("productListScope.SetExclusiveFacet",i,r)};n.layoutLeftNavigationScope.isEnabledFacet=function(t,i,r){if(r===void 0&&(r=!1),!n.layoutLeftNavigationScope.facetClicked&&!n.layoutLeftNavigationScope.RatingSelected||$("#LeftNavCheckbox-"+i.Id).prop("checked")===!0)return!0;var u;return u=r?n.layoutLeftNavigationScope.deptFacetsToShow.indexOf(i.Id)>-1:n.layoutLeftNavigationScope.facetsToShow.indexOf(i.Id)>-1,i.IsEnabled=u,u};n.layoutLeftNavigationScope.ShowFacet=function(t){return!_.isNull(t)&&t.IncludeInLeftNavigation&&_.contains(n.layoutLeftNavigationScope.PrimeFacets,t.Id)?!0:!1};n.layoutLeftNavigationScope.isGroupNameOutlet=function(t){return t===n.GroupName.Outlet};n.layoutLeftNavigationScope.isProductLinePage=function(t){return t.Url===""?!0:_.contains(t.GroupNames,n.GroupName.Outlet)?!0:!1};n.layoutLeftNavigationScope.ShowFacetGroup=function(t,i){if(n.layoutLeftNavigationScope.isDepartmentTypeSearch()||n.layoutLeftNavigationScope.isDepartmentTypeBrand(i,!0)||n.layoutLeftNavigationScope.isDepartmentTypeCategory(i,!0)){var r=tt(t,i);if(r===!1)return r}return!0};n.layoutLeftNavigationScope.LinkClick=function(t,i,r,f){var e=i.Id,o=i.IsFalseCategory,s,c,l,a;o||(AvonModule.AvonScope.LeftNavigationSelectedLink=e,AvonModule.AvonScope.LeftNavigationSelectedLinkParent=r?r.Id:i.Id,u.$broadcast("Navigation.SelectedLinkUpdated"));AvonModule.AvonScope.LeftNavigationPinkLink=e;AvonModule.AvonScope.LeftNavigationSelectedFacets=[];for(s in n.layoutLeftNavigationScope.Navigation.ShopBys)n.layoutLeftNavigationScope.ClearShopByFacets(n.layoutLeftNavigationScope.Navigation.ShopBys[s].Title,!1,!0,!1);AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets=[];n.layoutLeftNavigationScope.facetClicked=!1;c={Id:e,Caption:i.Text,Url:i.Url};n.layoutLeftNavigationScope.ShowLoading("");l=o?!1:!f;a=o?4:f?4:3;h.UpdateSelectedCategory(t,c,r,i,l,a)};n.layoutLeftNavigationScope.$on("productListScope.CategoryFacetDeepLink",function(t,i){n.layoutLeftNavigationScope.SkipPushState=!0;var r=$("#LeftNavCheckbox-"+i);r.length>0&&r.trigger("click");_.defer(function(){n.layoutLeftNavigationScope.SkipPushState=!1;n.layoutLeftNavigationScope.setClearAll()})});n.layoutLeftNavigationScope.filterShopBysByDepartment=function(t){var i=window.ProductListModule,r,u;return i!=null&&i.productListScope!=null&&!i.productListScope.ShowProductList?!1:(r=t.IsDepartmentShopBy||t.ValidDeptIds.indexOf(AvonModule.AvonScope.LeftNavigationSelectedLink)>=0,u=t.IsDepartmentShopBy?e("filter")(t.Facets,n.layoutLeftNavigationScope.filterDepartmentFacets).length>0:e("filter")(t.Facets,n.layoutLeftNavigationScope.filterFacets).length>0,r&&u)};n.layoutLeftNavigationScope.$on("layoutLeftNavigationScope.UpdatePrimeFacets",function(t,i){(n.layoutLeftNavigationScope.PrimeFacets.length==0||n.layoutLeftNavigationScope.DeptType!==n.DeptType.Brand||n.layoutLeftNavigationScope.SelectedCategoryId==n.layoutLeftNavigationScope.SubCategoryId)&&(n.layoutLeftNavigationScope.PrimeFacets=i)});n.layoutLeftNavigationScope.$on("ProductListService.ProductSearchLoaded",function(t,i){if(AVON.NavigationOriginalSearchFacets=[],AVON.Navigation=i.Data.Navigation,n.layoutLeftNavigationScope.Navigation=i.Data.Navigation,AVON.Navigation&&AVON.Navigation.ShopBys){var r=_.find(AVON.Navigation.ShopBys,function(t){return t.Title.trim().toLowerCase()===n.GroupName.Categories.toLowerCase()||t.Title.trim().toLowerCase()===n.GroupName.CategoriesES.toLowerCase()});AVON.Navigation.ShopBys.forEach(function(t){t.Facets&&(t.Facets=_.uniq(t.Facets,function(n){return n.Text.trim().toLowerCase()}),_.each(t.Facets,function(i,u){if(n.layoutLeftNavigationScope.filterDepartmentFacets(i)&&AVON.NavigationOriginalSearchFacets.push(i),t.Title.trim().toLowerCase()!==n.GroupName.Categories.toLowerCase()&&t.Title.trim().toLowerCase()!==n.GroupName.CategoriesES.toLowerCase()&&r){var f=_.find(r.Facets,function(n){return i.Text.toLowerCase()===n.Text.toLowerCase()});f&&t.Facets.splice(u,1)}}))})}n.layoutLeftNavigationScope.ProductSearchLoaded=!0;AVON.ShowProductList=!0;n.layoutLeftNavigationScope.showProductList();l();n.layoutLeftNavigationScope.SafeApply()});n.layoutLeftNavigationScope.$on("ProductListService.ProductSpotsLoaded",function(t,i){n.layoutLeftNavigationScope.Navigation.Content.LeftBottomPromotionThumbnails=i.LeftBottomPromotionThumbnails;n.layoutLeftNavigationScope.Navigation.Content.LeftTopPromotionThumbnails=i.LeftTopPromotionThumbnails;n.layoutLeftNavigationScope.SafeApply();$(".LeftNavPromotionSpot.BottomSpot").removeClass("Hidden")});n.layoutLeftNavigationScope.$on("productListScope.discountLevelModelPopulated",function(t,i){n.layoutLeftNavigationScope.PageLoadDiscountRange=$.extend({},i);n.layoutLeftNavigationScope.discountLevelModel=i});n.layoutLeftNavigationScope.$on("productListScope.setSortUrl",function(t,r,u){c()||s.PushStateUrl(window.location.href);var f=h.getCurrentPageState();s.ReplaceState(i.HistoryStateKey,f,r);n.layoutLeftNavigationScope.SelectedSortByValue=u;n.layoutLeftNavigationScope.DeepLinkPageState&&(n.layoutLeftNavigationScope.DeepLinkPageState=f);n.layoutLeftNavigationScope.SkipPushState||(n.layoutLeftNavigationScope.SortingSelected=!0)});n.layoutLeftNavigationScope.$on("productListScope.priceRangeModelPopulated",function(t,i){n.layoutLeftNavigationScope.PageLoadPriceRange=$.extend({},i);n.layoutLeftNavigationScope.priceRangeModel=i});n.layoutLeftNavigationScope.$on("productListScope.facetRemoved",function(){l();n.layoutLeftNavigationScope.SafeApply()});n.layoutLeftNavigationScope.$on("productListScope.UpdateFacetState",function(){var r,t;!n.layoutLeftNavigationScope.ProductSearchLoaded&&h.historyService.IsPushStateSupported&&(h.getSelectedFacetIds(),r=n.layoutLeftNavigationScope.GetUpdatedUrl(n.layoutLeftNavigationScope.FacetQueryStringParamName,n.layoutLeftNavigationScope.SelectedFacetIds),c()||s.PushStateUrl(window.location.href),t=h.getCurrentPageState(),s.ReplaceState(i.HistoryStateKey,t,r),n.layoutLeftNavigationScope.DeepLinkPageState&&(n.layoutLeftNavigationScope.DeepLinkPageState=t))});n.layoutLeftNavigationScope.setClearAll=function(){var t=AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0||AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0||n.layoutLeftNavigationScope.Ratings.length>0,r,i;n.layoutLeftNavigationScope.PriceRangeFacetSelected&&(t=!0);n.layoutLeftNavigationScope.DiscountRangeFacetSelected&&(t=!0);r=$("#LeftNavRefineBy");i=r.find(".LeftNavClearItem");t?i.addClass("Active"):i.removeClass("Active");n.layoutLeftNavigationScope.SafeApply()};n.layoutLeftNavigationScope.$on("productListScope.FacetModelDeepLink",function(t,i,r){i===SliderFacetModelNames.discountLevelModel?(n.layoutLeftNavigationScope.DiscountRangeDeepLink=!0,n.layoutLeftNavigationScope.PageLoadDiscountRange=$.extend({},r),n.layoutLeftNavigationScope.DiscountRangeFacetSelected=!0):(n.layoutLeftNavigationScope.PriceRangeDeepLink=!0,n.layoutLeftNavigationScope.PageLoadPriceRange=$.extend({},r),n.layoutLeftNavigationScope.PriceRangeFacetSelected=!0);n.layoutLeftNavigationScope.setClearAll()});n.layoutLeftNavigationScope.onDiscountLevelSliderTranslate=function(n){return n+"%"};n.layoutLeftNavigationScope.onPriceRangeSliderTranslate=function(n){return"$"+n};n.layoutLeftNavigationScope.$on("productListScope.PriceRangeCleared",function(t,r){var f,u;n.layoutLeftNavigationScope.PriceRangeFacetSelected=!1;l();r&&!n.layoutLeftNavigationScope.ProductSearchLoaded&&!n.layoutLeftNavigationScope.SkipPushState&&h.historyService.IsPushStateSupported&&(f=n.layoutLeftNavigationScope.GetUpdatedUrl(n.layoutLeftNavigationScope.PriceQueryStringParamName,null),c()||s.PushStateUrl(window.location.href),u=h.getCurrentPageState(),s.ReplaceState(i.HistoryStateKey,u,f),n.layoutLeftNavigationScope.DeepLinkPageState&&(n.layoutLeftNavigationScope.DeepLinkPageState=u))});n.layoutLeftNavigationScope.$on("productListScope.DiscountRangeCleared",function(t,r){var f,u;n.layoutLeftNavigationScope.DiscountRangeFacetSelected=!1;l();r&&!n.layoutLeftNavigationScope.ProductSearchLoaded&&!n.layoutLeftNavigationScope.SkipPushState&&h.historyService.IsPushStateSupported&&(f=n.layoutLeftNavigationScope.GetUpdatedUrl(n.layoutLeftNavigationScope.DiscountQueryStringParamName,null),c()||s.PushStateUrl(window.location.href),u=h.getCurrentPageState(),s.ReplaceState(i.HistoryStateKey,u,f),n.layoutLeftNavigationScope.DeepLinkPageState&&(n.layoutLeftNavigationScope.DeepLinkPageState=u))});n.layoutLeftNavigationScope.$on("ProductListController.DeepLinkProcessed",function(){n.layoutLeftNavigationScope.DeepLinkPageState=h.getCurrentPageState();s.ReplaceState(i.HistoryStateKey,n.layoutLeftNavigationScope.DeepLinkPageState,window.location.href)});n.layoutLeftNavigationScope.shouldSubLinksRender=function(t){if(t.Id==n.layoutLeftNavigationScope.LeftNavigationSelectedLinkParent)return!0;if(t.SubLinks.length>0){var i=_.any(t.SubLinks,function(t){return t.Id==n.layoutLeftNavigationScope.LeftNavigationSelectedLink});if(i)return!0}return!1};n.layoutLeftNavigationScope.onDiscountLevelSliderChange=function(){var f=g(SliderFacetModelNames.discountLevelModel),t,e,r;n.layoutLeftNavigationScope.ProductSearchLoaded||n.layoutLeftNavigationScope.SkipPushState||!h.historyService.IsPushStateSupported||(t=[],f&&(t.push(n.layoutLeftNavigationScope.discountLevelModel.minimum),t.push(n.layoutLeftNavigationScope.discountLevelModel.maximum)),e=n.layoutLeftNavigationScope.GetUpdatedUrl(n.layoutLeftNavigationScope.DiscountQueryStringParamName,t),c()||s.PushStateUrl(window.location.href),r=h.getCurrentPageState(n.layoutLeftNavigationScope.PriceRangeFacetSelected,!0),s.ReplaceState(i.HistoryStateKey,r,e),n.layoutLeftNavigationScope.DeepLinkPageState&&(n.layoutLeftNavigationScope.DeepLinkPageState=r));n.layoutLeftNavigationScope.DiscountRangeFacetSelected=f;n.layoutLeftNavigationScope.setClearAll();u.$broadcast("productListScope.updateFacets",n.layoutLeftNavigationScope.discountLevelModel,SliderFacetModelNames.discountLevelModel);u.$broadcast("productListScope.SetDiscountRangeSelected",n.layoutLeftNavigationScope.DiscountRangeFacetSelected)};n.layoutLeftNavigationScope.onPriceRangeSliderChange=function(){var e=n.layoutLeftNavigationScope.priceRangeModel.minimumDisplayValue,o=n.layoutLeftNavigationScope.priceRangeModel.maximumDisplayValue,r,t,l,f;n.layoutLeftNavigationScope.priceRangeModel.minimum=e;n.layoutLeftNavigationScope.priceRangeModel.maximum=o;r=g(SliderFacetModelNames.priceRangeModel);n.layoutLeftNavigationScope.ProductSearchLoaded||n.layoutLeftNavigationScope.SkipPushState||!h.historyService.IsPushStateSupported||(t=[],r&&(t.push(Math.floor(nt(e))),t.push(Math.ceil(nt(o)))),l=n.layoutLeftNavigationScope.GetUpdatedUrl(n.layoutLeftNavigationScope.PriceQueryStringParamName,t),c()||s.PushStateUrl(window.location.href),f=h.getCurrentPageState(!0,n.layoutLeftNavigationScope.DiscountRangeFacetSelected),s.ReplaceState(i.HistoryStateKey,f,l),n.layoutLeftNavigationScope.DeepLinkPageState&&(n.layoutLeftNavigationScope.DeepLinkPageState=f));n.layoutLeftNavigationScope.PriceRangeFacetSelected=r;n.layoutLeftNavigationScope.setClearAll();u.$broadcast("productListScope.updateFacets",n.layoutLeftNavigationScope.priceRangeModel,SliderFacetModelNames.priceRangeModel);u.$broadcast("productListScope.SetPriceRangeSelected",n.layoutLeftNavigationScope.PriceRangeFacetSelected)};n.layoutLeftNavigationScope.isFacetModelReady=function(n){return!_.isEmpty(n)&&n.facets.length>0};n.layoutLeftNavigationScope.GetAnalyticsAttributeValue=function(){for(var n=[],t=0;t<arguments.length;t++)n[+t]=arguments[t];return AVON.TopCategoryName?n.unshift(AVON.TopCategoryName):AVON.breadcrumbs.length>1&&n.unshift(AVON.breadcrumbs[0].Text),o.GetAnalyticsAttributeValue("navleft",n)}}return __extends(i,t),i.prototype.UpdateSelectedCategory=function(t,r,u,f,e,o){var it=u?u.Id:f.Id,rt=t?$(t.currentTarget).text():f.Text,v,nt,b,l,k,a,s,d,y,tt,c,w;n.layoutLeftNavigationScope.SelectedCategoryId=r.Id;for(v in n.layoutLeftNavigationScope.MenuItems)for(nt in n.layoutLeftNavigationScope.MenuItems[v].GroupNames)if(b=n.layoutLeftNavigationScope.MenuItems[v].GroupNames[nt],l=n.layoutLeftNavigationScope.MenuItems[v].GroupedChildren[b],l){for(k=[],a=0;a<l.length;a++)k.push(l[a].Id),$("#LeftNavCheckbox-"+l[a].Id).prop("checked",!1);this.$rootScope.$broadcast("productListScope.UpdateMultipleSelectedFacets",b,k,!1,rt)}if(_.defer(function(){n.layoutLeftNavigationScope.ClearRatings(!0,!1)}),s=window.location.search.toLowerCase(),s.indexOf(n.layoutLeftNavigationScope.FacetQueryStringParamName)>-1&&(s=n.layoutLeftNavigationScope.RemoveQueryStringParameterByName(n.layoutLeftNavigationScope.FacetQueryStringParamName,s)),s.indexOf(n.layoutLeftNavigationScope.DiscountQueryStringParamName)>-1&&(s=n.layoutLeftNavigationScope.RemoveQueryStringParameterByName(n.layoutLeftNavigationScope.DiscountQueryStringParamName,s)),s.indexOf(n.layoutLeftNavigationScope.PriceQueryStringParamName)>-1&&(s=n.layoutLeftNavigationScope.RemoveQueryStringParameterByName(n.layoutLeftNavigationScope.PriceQueryStringParamName,s)),s.indexOf(n.layoutLeftNavigationScope.RatingsQueryStringParamName)>-1&&(s=n.layoutLeftNavigationScope.RemoveQueryStringParameterByName(n.layoutLeftNavigationScope.RatingsQueryStringParamName,s)),s.indexOf(n.layoutLeftNavigationScope.SortByQueryStringParamName)>-1&&(s=n.layoutLeftNavigationScope.RemoveQueryStringParameterByName(n.layoutLeftNavigationScope.SortByQueryStringParamName,s)),d={Index:undefined,SelectedDiscountRange:undefined,SelectedFacetIds:undefined,SelectedPriceRange:undefined,SelectedRatings:undefined,Data:{ParentLinkId:it},category:r,setSubCategory:e},this.historyService.IsPushStateSupported&&!n.layoutLeftNavigationScope.SkipPushState)if(o<4||n.layoutLeftNavigationScope.DeptType!==n.DeptType.Brand)y=r.Url+s,tt=n.layoutLeftNavigationScope.LanguageCode=="es"&&y.indexOf("/es")===-1?"/es"+y:y,this.historyService.PushState(i.HistoryStateKey,d,"",tt);else{var g=r.Url.replace(/^\//i,"").replace(/\/$/,"").split("/"),p=g[g.length-1],h=document.location.pathname.replace(/^\//i,"").replace(/\/$/,"").split("/");for(n.layoutLeftNavigationScope.LanguageCode=="en"?h.length==4?h[3]=p:h.push(p):h.length==5?h[4]=p:h.push(p),c="/",w=0;w<h.length;w++)c+=h[w]+"/";c+=s;this.historyService.PushState(i.HistoryStateKey,d,c);g[0]!="es"?($("#TopUtilityBarSection li a[hreflang=en]").attr("href",c),$("#TopUtilityBarSection li a[hreflang=es]").attr("href","/es"+c)):($("#TopUtilityBarSection li a[hreflang=en]").attr("href",c.replace("/es/","/")),$("#TopUtilityBarSection li a[hreflang=es]").attr("href",c))}n.layoutLeftNavigationScope.SafeApply();e&&(n.layoutLeftNavigationScope.SubCategoryId=r.Id,n.layoutLeftNavigationScope.SafeApply());this.$rootScope.$broadcast("breadcrumbsScope.UpdateBreadcrumbs",o,r.Caption,r.Url);this.$rootScope.$broadcast("productListScope.UpdateSelectedCategory",n.layoutLeftNavigationScope.TopLevelCategoryName,r,u,f,e)},i.prototype.getCurrentPageState=function(t,i){t===undefined&&(t=n.layoutLeftNavigationScope.PriceRangeDeepLink?n.layoutLeftNavigationScope.PriceRangeDeepLink:n.layoutLeftNavigationScope.PriceRangeFacetSelected);i===undefined&&(i=n.layoutLeftNavigationScope.DiscountRangeDeepLink?n.layoutLeftNavigationScope.DiscountRangeDeepLink:n.layoutLeftNavigationScope.DiscountRangeFacetSelected);n.layoutLeftNavigationScope.PageState||(n.layoutLeftNavigationScope.PageState=[]);this.getSelectedFacetIds();return{category:undefined,Data:undefined,setSubCategory:undefined,Index:n.layoutLeftNavigationScope.StateIndex++,SelectedFacetIds:n.layoutLeftNavigationScope.SelectedFacetIds,SelectedRatings:n.layoutLeftNavigationScope.Ratings,SelectedPriceRange:{PriceRangeFacetSelected:t,Minimum:n.layoutLeftNavigationScope.priceRangeModel.minimumDisplayValue,Maximum:n.layoutLeftNavigationScope.priceRangeModel.maximumDisplayValue,Floor:n.layoutLeftNavigationScope.priceRangeModel.floor,Ceil:n.layoutLeftNavigationScope.priceRangeModel.ceil},SelectedDiscountRange:{DiscountRangeFacetSelected:i,Minimum:n.layoutLeftNavigationScope.discountLevelModel.minimum,Maximum:n.layoutLeftNavigationScope.discountLevelModel.maximum,Floor:n.layoutLeftNavigationScope.discountLevelModel.floor,Ceil:n.layoutLeftNavigationScope.discountLevelModel.ceil}}},i.prototype.getSelectedFacetIds=function(){n.layoutLeftNavigationScope.SelectedFacetIds=[];_.each(AvonModule.AvonScope.LeftNavigationSelectedFacets,function(t){t.Facets.map(function(t){n.layoutLeftNavigationScope.SelectedFacetIds.push(t.Id)})});n.layoutLeftNavigationScope.SelectedFacetIds=n.layoutLeftNavigationScope.SelectedFacetIds.concat(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets)},i.prototype.compareWithDeepLinkPageState=function(t){var i=!1;return n.layoutLeftNavigationScope.DeepLinkPageState&&(t?(i=n.layoutLeftNavigationScope.DeepLinkPageState.SelectedFacetIds.sort().join(",")===t.SelectedFacetIds.sort().join(","),i&&(i=n.layoutLeftNavigationScope.DeepLinkPageState.SelectedRatings.sort().join(",")===t.SelectedRatings.sort().join(",")),i&&(i=n.layoutLeftNavigationScope.DeepLinkPageState.SelectedSortByValue===t.SelectedSortByValue),i&&(i=n.layoutLeftNavigationScope.DeepLinkPageState.SelectedPriceRange.Minimum===t.SelectedPriceRange.Minimum&&n.layoutLeftNavigationScope.DeepLinkPageState.SelectedPriceRange.Maximum===t.SelectedPriceRange.Maximum),i&&(i=n.layoutLeftNavigationScope.DeepLinkPageState.SelectedDiscountRange.Minimum===t.SelectedDiscountRange.Minimum&&n.layoutLeftNavigationScope.DeepLinkPageState.SelectedDiscountRange.Maximum===t.SelectedDiscountRange.Maximum)):(i=n.layoutLeftNavigationScope.DeepLinkPageState.SelectedFacetIds.sort().join(",")===n.layoutLeftNavigationScope.SelectedFacetIds.sort().join(","),i&&(i=n.layoutLeftNavigationScope.DeepLinkPageState.SelectedRatings.sort().join(",")===n.layoutLeftNavigationScope.Ratings.sort().join(",")),i&&(i=n.layoutLeftNavigationScope.DeepLinkPageState.SelectedSortByValue===n.layoutLeftNavigationScope.SelectedSortByValue),i&&(i=n.layoutLeftNavigationScope.DeepLinkPageState.SelectedPriceRange.Minimum===n.layoutLeftNavigationScope.priceRangeModel.minimumDisplayValue&&n.layoutLeftNavigationScope.DeepLinkPageState.SelectedPriceRange.Maximum===n.layoutLeftNavigationScope.priceRangeModel.maximum),i&&(i=n.layoutLeftNavigationScope.DeepLinkPageState.SelectedDiscountRange.Minimum===n.layoutLeftNavigationScope.discountLevelModel.minimum&&n.layoutLeftNavigationScope.DeepLinkPageState.SelectedDiscountRange.Maximum===n.layoutLeftNavigationScope.discountLevelModel.maximum))),i},i.prototype.pageStateIsUnchanged=function(t){return t?this.compareWithDeepLinkPageState(t):n.layoutLeftNavigationScope.DeepLinkPageState?this.compareWithDeepLinkPageState(t):n.layoutLeftNavigationScope.SelectedFacetIds.length===0&&n.layoutLeftNavigationScope.Ratings.length===0&&n.layoutLeftNavigationScope.SelectedSortByValue===SortOption.None&&!n.layoutLeftNavigationScope.PriceRangeFacetSelected&&!n.layoutLeftNavigationScope.DiscountRangeFacetSelected},i.$inject=["$scope","$rootScope","$sce","$filter","analyticsService","historyService"],i.HistoryStateKey="LayoutLeftNavigationFacets",i}(BaseAngularController);n.LayoutLeftNavigationController=t}(LayoutLeftNavigationModule||(LayoutLeftNavigationModule={}));app.controller("LayoutLeftNavigationController",LayoutLeftNavigationModule.LayoutLeftNavigationController),function(n){var t=function(n){function t(i,r,u){function e(n){var i=$(".miniMenu"),r=$(n).find(".level3Menu"),u=i.find(".level2Menu"),t;i.addClass("active");$(n).addClass("active");r.addClass("active");t=r.height()+2;u.css("height",t+"px").css("min-height",t+"px")}function s(n){$(n).find(".level3Menu").removeClass("active");$(n).removeClass("active")}function o(){$(".miniMenuList").find(".active").removeClass("active")}function h(){var n=$(".miniMenu"),t=n.find(".level2Menu");return n.removeClass("active"),t.css("height","").css("min-height",""),!0}var f=this;n.call(this,i);this.$window=u;i.SessionService.WhenReady().then(function(){i.IsIPad&&$(".topMenu > a").css("font-size","1.7rem")});$(window).scroll(function(){$(window).scrollTop()>=1200?$(t.BackToTopContainerSelector).addClass("Active"):$(t.BackToTopContainerSelector).removeClass("Active")});$(window).click(function(n){var t=$(n.target);i.isTouchCapableDevice&&navigator.userAgent.match(/iPad/i)!=null&&!t.hasClass("miniMenuLink")&&($(".miniMenu").removeClass("active"),o())});i.isTouchCapableDevice&&navigator.userAgent.match(/iPad/i)!=null||t.MiniMenuList.menuAim({activate:e,deactivate:s,exitMenu:h});i.GoToPage=function(n,t){t===void 0&&(t="_self");n!==undefined&&u.open(n,t)};i.navigationRowTapped=function(n){var t=$(n.target),r,u,s;navigator.userAgent.match(/iPad/i)!=null;switch(n.pointerType){case"touch":r=$(t.siblings(".level3Menu")[0]);t.hasClass("miniMenuLink")&&(r.hasClass("active")?(u=$(n.target),f.processLink(u),n.preventDefault(),n.srcEvent.stopImmediatePropagation()):(o(),e(t.parent())));break;case"mouse":s=t.prop("tagName");f.processMenuLinks(n.srcEvent,t,s,i.isTouchCapableDevice);break;default:n.preventDefault();n.srcEvent.stopImmediatePropagation()}};i.navigationRowDoubleTapped=function(n){var t=$(n.target);i.IsLeavingFundraiserPageWithoutShopping()&&t.is("a.topMenuLink")||t.is("a.miniMenuLink")||f.processLink(t);n.preventDefault();n.srcEvent.stopImmediatePropagation()};i.navigationRowClicked=function(n){var t=$(n.target),r,u;if(i.isTouchCapableDevice){if(t.hasClass("miniMenuLink")||t.hasClass("topMenuLink")){n.preventDefault();n.stopImmediatePropagation();return}}else{if(r=t.prop("tagName"),u=t.prop("href"),u==="#"||t.hasClass("isEmptyLink"))return n.preventDefault(),n.stopImmediatePropagation(),!1;if(r==="SPAN"&&t.parents(".header-sections-footer-container"))return;n.type==="click"&&f.processMenuLinks(n,t,r,i.isTouchCapableDevice)}}}return __extends(t,n),t.prototype.processLink=function(n){var t=n.prop("href"),i=n.prop("target");_.isUndefined(t)||_.isUndefined(i)||(i=="_self"?window.location=t:window.open(t,i))},t.prototype.processMenuLinks=function(n,t,i,r){var u;if(n.preventDefault(),i==="A"){this.processLink(t);return}if(i==="I"){u=t.parent("a");u&&(r&&!u.hasClass("lastNavItem")&&this.processLink(u),r||this.processLink(u));return}if(i==="IMG"){u=t.parentsUntil(".ContentStack").closest("a");u&&this.processLink(u);return}if(t.hasClass("PinkLink")){u=t.closest("a");u&&this.processLink(u);return}if(!r){(t.hasClass("miniMenuLink")||t.hasClass("topMenuLink"))&&this.processLink(t);return}},t.$inject=["$scope","NavigationService","$window"],t.BackToTopContainerSelector="#BackToTopContainer",t.HeadLogoSectionSelector="#HeadLogoSection",t.MiniMenuList=angular.element(".miniMenuList"),t}(BaseAngularController);n.LayoutTopNavigationController=t}(LayoutTopNavigationModule||(LayoutTopNavigationModule={}));app.controller("LayoutTopNavigationController",LayoutTopNavigationModule.LayoutTopNavigationController),function(n){"use strict";var t=function(t){function i(i,r,u,f){t.call(this,i,f);n.layoutTopUtilityScope=i;var e=$("#TopUtilityBarContainer"),o=$("#HeadLogoSection");$("#BannerSection").length===0&&(e.css("top",0),o.css("top",0));n.layoutTopUtilityScope.OnCustomerMenuEnter=function(n){var i=angular.element(n.currentTarget);i.parent().children("div").addClass("active");$(".RotatedCaret45.active").css({"margin-left":$(".TopAccountBarUserOverlay").parent().outerWidth(!1)/2-$(".RotatedCaret45.active").width()/2});$(".TopAccountBarUserOverlay").innerWidth($(".TopAccountBarUserOverlay").parent().width());var r=$("#TopUtilityBarContainer").offset().left+$("#TopUtilityBarContainer").innerWidth(),u=$(".Overlay.active").offset().left+$(".Overlay.active").innerWidth(),t=u-r;t>0&&!$(".Overlay.active").attr("style")&&$(".Overlay.active").css({"margin-left":-t})};n.layoutTopUtilityScope.OnCustomerMenuLeave=function(){$("#TopUtilityBarSection .active").removeClass("active")};n.layoutTopUtilityScope.OnRepMenuLeave=function(){$("#TopUtilityBarSection .active").removeClass("active")};n.layoutTopUtilityScope.PrepareAndShowLoginModal=function(){angular.element("#ViewBagPage").length&&(AVON.TempModalModel={Mode:"FullRegistration"});angular.element("#FullRegistrationForm").length&&(AVON.TempModalModel={Mode:"HideCreateAccount"});AVON.RedirectToPowerReviews=!1;n.layoutTopUtilityScope.ShowLoginModal()};n.layoutTopUtilityScope.LoginModal=function(){if(typeof FB=="undefined"){n.layoutTopUtilityScope.PrepareAndShowLoginModal();return}FB.getLoginStatus(function(){n.layoutTopUtilityScope.PrepareAndShowLoginModal()},!0)};n.layoutTopUtilityScope.ShoppingCartClick=function(){n.layoutTopUtilityScope.SessionReady&&(n.layoutTopUtilityScope.ShowLoading(AVON.messages.spinner_loading),n.layoutTopUtilityScope.RedirectToUrl(n.layoutTopUtilityScope.Url.Action("Index","Bag")))};n.layoutTopUtilityScope.LogOut=function(){var t=f.location.href;u.logOut(!1,t,n.layoutTopUtilityScope.HomePageUrl)};n.layoutTopUtilityScope.ForgetMe=function(t){u.logOut(!0,t,n.layoutTopUtilityScope.HomePageUrl)};n.layoutTopUtilityScope.GoToWishListPage=function(t){t.preventDefault();n.layoutTopUtilityScope.Session.Customer&&n.layoutTopUtilityScope.Session.Customer.IsLoggedIn?f.location.href=i.Url.Action("index","wishlist"):n.layoutTopUtilityScope.ShowLoginModal("wishlist",n.layoutTopUtilityScope.Url.Action("index","wishlist"))}}return __extends(i,t),i.$inject=["$scope","$rootScope","loginService","$window"],i}(BaseAngularController);n.LayoutTopUtilityController=t}(LayoutTopUtilityModule||(LayoutTopUtilityModule={}));app.controller("LayoutTopUtilityController",LayoutTopUtilityModule.LayoutTopUtilityController),function(n){var t=function(n){function t(t,i,r,u,f,e){function c(){var n=AvonModule.AvonScope.QueryString().email;n&&(t.LoginModel.Email=n)}function h(){t.LoginModel=AVON.LoginModel;t.LoginModel={Email:"",Password:"",Mode:"",ReturnUrl:""};t.displayProperties=t.displayProperties||{showForgotPasswordForm:!1};_.defer(function(){angular.element("[id=FacebookLoginButton]").focus();angular.element("[id=LoginModel_EmailInput]").placeholder();angular.element("[id=LoginModel_PasswordInput]").placeholder();angular.element("[id=firstTimeFacebookUser_PasswordInput]").val("");angular.element("[id=firstTimeFacebookUser_PasswordInput]").placeholder();t.UpdateInlineWaterMark()},200);t.ShowValidation=!1;t.RequiredInvalid=!1;t.hasItemsInCart=t.Session.Cart?t.Session.Cart.QtyItemsInCart>0:!1;c()}var o=this,s;n.call(this,t);new h;this.LoginModalMode=$("input#Mode").val();angular.element("#FullRegistrationForm").length&&(t.HideCreateAccountOption=!0);r.displayForgotPassword&&(s=r.forgotEmail,t.displayProperties.showForgotPasswordForm=!0,_.defer(function(){angular.element("[id=forgotPasswordModel_EmailInput]").val(s)},200),r.displayForgotPassword=!1,r.forgotEmail="");t.privacyUrl=$("#privacyPolicyUrl").val();t.conditionsOfUseUrl=$("#conditionsOfUseUrl").val();t.privacyPolicyModalModel=AVON.privacyPolicyModalModel||{NotifySpecialOffers:!0};t.firstTimeFacebookUser=AVON.firstTimeFacebookUser||{AccessToken:"",FacebookId:"0",CustomerEmail:"",Password:""};AVON.TempModalModel&&AVON.TempModalModel.Mode==="HideCreateAccount"&&(t.HideCreateAccountOption=!0);$(document).on("click","#DisplayRegistrationModal",function(n){var i,r;n.preventDefault();i=ForgotPasswordModule.forgotPasswordscope.ForgotPasswordForm.forgotPasswordModel_Email.$modelValue;$("#LoginModal").trigger("close");t.ShowLoading(AVON.messages.spinner_loading);t.IsShoppingBagPage()?t.RedirectToUrl(t.Url.Action("RegistrationFullPage","Checkout")):(r={UrlToLoad:"/login/registrationoverlay",AllowExit:!0,KeepLoaded:!1,Model:{Email:i}},$("#RegistrationModal").trigger("modal",r))});t.Login=function(){if(t.$broadcast("autofill:update"),t.LoginForm.$valid){AVON.TempModalModel?AVON.TempModalModel.Email=t.LoginModel.Email:AVON.TempModalModel={Email:t.LoginModel.Email};t.ShowValidation=!1;t.ShowLoading(AVON.messages.spinner_login);var n=$("#ReturnUrl").val();t.LoginModel.ReturnUrl=n;r.login(t.LoginModel,$("form[name=LoginForm]"),t)}else t.LoginForm.ServerErrors.Summary===undefined||t.ShowValidation||(t.LoginForm.ServerErrors.Summary.$invalid=!1),t.ShowValidation=!0,ForgotPasswordModule.forgotPasswordscope&&(ForgotPasswordModule.forgotPasswordscope.ShowValidation=!1)};t.onKeyPress=function(n){n.which===13&&(n.preventDefault(),t.Login())};t.CreateNewAccountModal=function(){t.ShowLoading(AVON.messages.spinner_loading);$("#LoginModal").trigger("close");$("#RegistrationModal").trigger("modal")};t.UpdatePrivacyPolicy=function(){var i=AVON.TempModalModel.FacebookAccessToken,u=t.UpdatePrivacyPolicyForm.privacyPolicyModalModel_NotifySpecialOffers.$viewValue,n;t.UpdatePrivacyPolicyForm.$valid?(t.ShowValidation=!1,$("#AjaxModal").trigger("close"),n=$("#ReturnUrl").val(),t.ShowLoading(AVON.messages.spinner_login),r.registerWithFacebook(i,u,n)):t.ShowValidation=!0};t.FacebookLogin=function(){t.ShowLoading(AVON.messages.spinner_facebook);$("html.ff").length===0?FB.login(t.FacebookLoginCallback,{scope:"email"}):_.delay(function(){FB.login(t.FacebookLoginCallback,{scope:"email"})},100)};t.FacebookLoginCallback=function(n){if(n.authResponse){var i=$("#ReturnUrl").val();t.HideLoading();t.ShowLoading(AVON.messages.spinner_login);r.loginWIthFacebook(n.authResponse.accessToken,"",i)}else t.HideLoading()};t.FirstTimeFacebookUserLogin=function(){if(t.FirstTimeFacebookUserPasswordForm.$valid){var n=t.FirstTimeFacebookUserPasswordForm.firstTimeFacebookUser_Password.$modelValue,i=$("[name=firstTimeFacebookUser_Password]").attr("accesstoken"),u=$("#ReturnUrl").val();t.ShowLoading(AVON.messages.spinner_login);r.loginWIthFacebook(i,n,u)}else t.ShowValidation=!0,t.FirstTimeFacebookUserPasswordForm.firstTimeFacebookUser_Password.$error.regex=!1,$("#PasswordError").show()};t.ViewPrivacyPolicy=function(){window.open(t.privacyUrl,"AVONPop","toolbar=no,width=640,height=550,status=no,scrollbars=yes,resize=yes,menubar=no").focus()};t.ViewConditionsOfUse=function(){window.open(t.conditionsOfUseUrl,"AVONPop","toolbar=no,width=640,height=550,status=no,scrollbars=yes,resize=yes,menubar=no").focus()};t.GetSignInAnalyticsAttribute=function(){var n;switch(o.LoginModalMode){case"Checkout":n="chckt-signin-btn";break;default:n="login-signin-btn"}return n};t.GetForgotPasswordAnalyticsAttribute=function(){var n;switch(o.LoginModalMode){case"Checkout":n="chckt-frgtpw-lnk";break;default:n="login-frgtpw-lnk"}return n};t.GetCheckoutAsGuestAnalyticsAttribute=function(){var n;switch(o.LoginModalMode){case"Checkout":n="chckt-gst-btn";break;default:n=""}return n};t.GetSignInWithFacebookAnalyticsAttribute=function(){var n;switch(o.LoginModalMode){case"Checkout":n="chckt-fb-btn";break;default:n="login-fb-btn"}return n};t.GetSendPasswordHintAnalyticsAttribute=function(){var n;switch(o.LoginModalMode){case"Checkout":n="chckt-sndhntpw-btn";break;default:n="login-sndhntpw-btn"}return n};t.GetSendNewPasswordAnalyticsAttribute=function(){var n;switch(o.LoginModalMode){case"Checkout":n="chckt-rstpw-btn";break;default:n="login-rstpw-btn"}return n};t.$on("ModalClosed",function(){new h;i.$broadcast("RegistrationScope.RegistrationValidation")});t.$on("LoginService.LoginResponse",function(n,i,r){ForgotPasswordModule.forgotPasswordscope&&(ForgotPasswordModule.forgotPasswordscope.ShowValidation=!1);i.ErrorCode===AjaxError.ValidationErrors?r==t&&(t.HideLoading(),t.ShowValidation=!0,t.ProcessAjaxValidationErrors(i),_.defer(function(){$.each(i.ValidationErrors,function(n,i){t.LoginForm[i.FieldName]!==undefined&&(t.LoginForm[i.FieldName].$invalid=!0);var u=$(".ErrorSummaryContainer .ValidationSummaryServer span a");e(u)(r)})})):(f.TrackEventItem({Type:TrackingEventType.LoginSuccessful}),i.OpenModalId||i.IdToReplace?$("#LoginModal").trigger("close"):AVON.RedirectToPowerReviews&&AVON.PowerReviewLink&&(i.Processed=!0,setTimeout(function(){AvonModule.AvonScope.ShowLoading(AVON.messages.spinner_loading);AVON.common.redirectTo(AVON.PowerReviewLink)},250)))});t.$on("LoginService.AutoLoginResponse",function(n,t){t.ErrorCode===AjaxError.None&&(f.TrackEventItem({Type:TrackingEventType.LoginSuccessful}),AvonModule.AvonScope.postLoginAction&&AVON.RedirectToBazaarVoice&&(t.Processed=!0,setTimeout(function(){AvonModule.AvonScope.ShowLoading(AVON.messages.spinner_loading);AvonModule.AvonScope.postLoginAction()},250)))});t.$on("LoginService.FacebookLoginResponse",function(n,i){t.HideLoading();$("#LoginModal").trigger("close");i.status===200&&i.data.Data==""?($("#FirstTimeFacebookUserModal").trigger("close"),f.TrackEventItem({Type:TrackingEventType.LoginSuccessful}),AVON.RedirectToPowerReviews&&AVON.PowerReviewLink?(i.data.Processed=!0,setTimeout(function(){AvonModule.AvonScope.ShowLoading(AVON.messages.spinner_loading);AVON.common.redirectTo(AVON.PowerReviewLink)},250)):AvonModule.AvonScope.postLoginAction?(i.data.Processed=!0,setTimeout(function(){AvonModule.AvonScope.ShowLoading(AVON.messages.spinner_loading);AvonModule.AvonScope.postLoginAction()},250)):i.data.RedirectUrl&&top.location.replace(i.data.RedirectUrl)):i.data.Data===2&&$("#PasswordError").show()});t.$on("LoginService.FacebookRegisterResponse",function(n,t){if(t.status===200){if(t.data.Data.ErrorMessage==="emailrequired"){$("#FacebookRegisterModalError").trigger("modal");return}f.TrackEventItem({Type:TrackingEventType.LoginSuccessful});AVON.RedirectToPowerReviews&&AVON.PowerReviewLink?(t.data.Processed=!0,setTimeout(function(){AvonModule.AvonScope.ShowLoading(AVON.messages.spinner_loading);AVON.common.redirectTo(AVON.PowerReviewLink)},250)):AvonModule.AvonScope.postLoginAction&&(t.data.Processed=!0,setTimeout(function(){AvonModule.AvonScope.postLoginAction()},250))}})}return __extends(t,n),t.$inject=["$scope","$rootScope","loginService","$http","trackingService","$compile"],t}(BaseAngularController);n.LoginCtrl=t}(LoginModule||(LoginModule={}));app.controller("LoginController",LoginModule.LoginCtrl),function(n){var t=function(t){function i(i,r){var u=this;t.call(this,i);n.looksWeLoveScope=i;n.looksWeLoveScope.ShowLooksWeLoveOverlay=function(t){if(!n.looksWeLoveScope.IsTouchDevice()){var i=angular.element(t.currentTarget),r=i.attr("id");n.looksWeLoveScope.ShowLooksWeLoveImageId=r}};n.looksWeLoveScope.HideLooksWeLoveOverlay=function(){n.looksWeLoveScope.IsTouchDevice()||(n.looksWeLoveScope.ShowLooksWeLoveImageId=n.looksWeLoveScope.CurrentShowLooksWeLoveImageId)};n.looksWeLoveScope.ShowLooksWeLoveImageContentClick=function(n){u.ShowLooksWeLoveImageContent(n)};n.looksWeLoveScope.$on("ProductService.ProductsLoaded",function(){if(r.find(window.location.hash).length>0&&(n.looksWeLoveScope.LoadOperationsCount+=1,n.looksWeLoveScope.LoadOperationsCount>=2)){var t=$(window.location.hash)[0].id;n.looksWeLoveScope.ShowLooksWeLoveImageContentId="Content-"+t;n.looksWeLoveScope.ShowLooksWeLoveImageId=t;n.looksWeLoveScope.CurrentShowLooksWeLoveImageId=n.looksWeLoveScope.ShowLooksWeLoveImageId;_.delay(function(){n.looksWeLoveScope.ScrollToTop(r,!1)},1e3)}});n.looksWeLoveScope.$on("ProductService.PromotionsLoaded",function(){if(r.find(window.location.hash).length>0&&(n.looksWeLoveScope.LoadOperationsCount+=1,n.looksWeLoveScope.LoadOperationsCount>=2)){var t=$(window.location.hash)[0].id;n.looksWeLoveScope.ShowLooksWeLoveImageContentId="Content-"+t;n.looksWeLoveScope.ShowLooksWeLoveImageId=t;n.looksWeLoveScope.CurrentShowLooksWeLoveImageId=n.looksWeLoveScope.ShowLooksWeLoveImageId;_.delay(function(){n.looksWeLoveScope.ScrollToTop(r,!1)},1e3)}});_.defer(function(){n.looksWeLoveScope.ShowLooksWeLoveImageId=r.find(".ImageRowWrapper > div")[0].id;n.looksWeLoveScope.ShowLooksWeLoveImageContentId="Content-"+n.looksWeLoveScope.ShowLooksWeLoveImageId;n.looksWeLoveScope.CurrentShowLooksWeLoveImageId=n.looksWeLoveScope.ShowLooksWeLoveImageId})}return __extends(i,t),i.prototype.ShowLooksWeLoveImageContent=function(t){var r=angular.element(t.currentTarget),i=r.attr("id");n.looksWeLoveScope.ShowLooksWeLoveImageContentId="Content-"+i;n.looksWeLoveScope.ShowLooksWeLoveImageId=i;n.looksWeLoveScope.CurrentShowLooksWeLoveImageId=n.looksWeLoveScope.ShowLooksWeLoveImageId},i.$inject=["$scope","$element"],i}(BaseAngularController);n.LooksWeLoveController=t}(LooksWeLoveModule||(LooksWeLoveModule={}));app.controller("LooksWeLoveController",LooksWeLoveModule.LooksWeLoveController),function(n){"use strict";var t=function(t){function i(i,r){t.call(this,i);n.lpmContextMenuScope=i;n.lpmContextMenuScope.LpmMenuOpen=!1;n.lpmContextMenuScope.Options=[];n.lpmContextMenuScope.ContextMenuOpenedHeight="134px";n.lpmContextMenuScope.SessionService.WhenReady().then(function(t){n.lpmContextMenuScope.CampaignNumber=t.Customer.Campaign;n.lpmContextMenuScope.PreviewAtDate=t.LpmPreview.PreviewAtDate});n.lpmContextMenuScope.GetActiveCampaigns=function(){r.GetActiveCampaigns()};n.lpmContextMenuScope.GetActiveLookup=function(){r.GetActiveLookup()};n.lpmContextMenuScope.GetEnvironmentInfo=function(){r.GetEnvironmentInfo()};n.lpmContextMenuScope.GetActiveCampaigns();n.lpmContextMenuScope.GetActiveLookup();n.lpmContextMenuScope.GetEnvironmentInfo();n.lpmContextMenuScope.UpdateCampaign=function(){n.lpmContextMenuScope.ShowLoading(AVON.messages.spinner_processing);var t=document.location.pathname+document.location.search;r.SetCampaign(n.lpmContextMenuScope.CampaignNumber,t)};n.lpmContextMenuScope.GetPreviewByDate=function(){var t=n.lpmContextMenuScope.PreviewAtDate,i="/content/togglepreview/true/previewatdate/"+t;n.lpmContextMenuScope.RedirectToUrl(i)};n.lpmContextMenuScope.UpdateCampaignAndPreviewDate=function(){n.lpmContextMenuScope.ShowLoading(AVON.messages.spinner_processing);r.SetCampaign(n.lpmContextMenuScope.CampaignNumber,null);_.delay(function(){if(n.lpmContextMenuScope.ShowLoading(AVON.messages.spinner_processing),n.lpmContextMenuScope.PreviewAtDate!=""){var t=n.lpmContextMenuScope.PreviewAtDate,i="/content/togglepreview/true/previewatdate/"+t;n.lpmContextMenuScope.RedirectToUrl(i)}else window.location.reload(!0)},500)};n.lpmContextMenuScope.$on("LpmContextMenuService.ActiveCampaignsReceived",function(t,i){var r=i.Data;_.each(r,function(t){n.lpmContextMenuScope.Options.push({text:t.CampaignNumber,value:t.CampaignNumber})})});n.lpmContextMenuScope.$on("LpmContextMenuService.ActiveLookupReceived",function(t,i){var r=i.Data;n.lpmContextMenuScope.Lookup=r});n.lpmContextMenuScope.$on("LpmContextMenuService.EnvironmentInfoReceived",function(t,i){var r=i.Data;n.lpmContextMenuScope.Environment=r.Environment.toTitleCase();n.lpmContextMenuScope.BuildVersion=r.BuildVersion});n.lpmContextMenuScope.LpmMenuSlide=function(){return(n.lpmContextMenuScope.LpmMenuOpen=!n.lpmContextMenuScope.LpmMenuOpen)?n.lpmContextMenuScope.OpenLpmMenu():n.lpmContextMenuScope.CloseLpmMenu()};n.lpmContextMenuScope.OpenLpmMenu=function(){n.lpmContextMenuScope.LpmMenuOpen=!0;$("#LpmContextMenu").css("visibility","visible");$("#LpmContextMenu").animate({top:"+="+n.lpmContextMenuScope.ContextMenuOpenedHeight},"slow");$("#LpmContext").animate({top:"+="+n.lpmContextMenuScope.ContextMenuOpenedHeight},"slow")};n.lpmContextMenuScope.CloseLpmMenu=function(){n.lpmContextMenuScope.LpmMenuOpen=!1;$("#LpmContextMenu").animate({top:"-="+n.lpmContextMenuScope.ContextMenuOpenedHeight},"slow");$("#LpmContext").animate({top:"-="+n.lpmContextMenuScope.ContextMenuOpenedHeight},"slow",function(){$("#LpmContextMenu").css("visibility","hidden")})};$(document).ready(function(){$("#LpmContextMenu").css({top:"-"+n.lpmContextMenuScope.ContextMenuOpenedHeight})});n.lpmContextMenuScope.ShowContextMenu=!0;n.lpmContextMenuScope.$on("BannerController.BannerExpand",function(){n.lpmContextMenuScope.ShowContextMenu=!0;$("#LpmContext").css({top:"0"})});n.lpmContextMenuScope.$on("BannerController.BannerCollapse",function(){$("#LpmContextMenu").css({top:"-"+n.lpmContextMenuScope.ContextMenuOpenedHeight});n.lpmContextMenuScope.ShowContextMenu=!1;n.lpmContextMenuScope.LpmMenuOpen=!1})}return __extends(i,t),i.$inject=["$scope","LpmContextMenuService"],i}(BaseAngularController);n.LpmContextMenuController=t}(LpmContextMenuModule||(LpmContextMenuModule={}));app.controller("LpmContextMenuController",LpmContextMenuModule.LpmContextMenuController),function(n){"use strict";var t=function(t){function i(i){t.call(this,i);n.pageNavigatorScope=i;n.pageNavigatorScope.isActiveLink=!1;n.pageNavigatorScope.SetLinkActiveState=function(){n.pageNavigatorScope.isActiveLink=!0}}return __extends(i,t),i.$inject=["$scope"],i}(BaseAngularController);n.PageNavigatorModuleController=t}(PageNavigatorModule||(PageNavigatorModule={}));app.controller("PageNavigatorModuleController",PageNavigatorModule.PageNavigatorModuleController);$(document).ready(function(){location.hash?$("a[href$='"+location.hash+"']").addClass("active"):$("a[href='"+location.pathname+"']").addClass("active");$(".PageNavigatorModule #PageNavigator a").click(function(){$("#PageNavigator a").removeClass("active");$(this).addClass("active")})}),function(n){var t=function(n){function t(t,i,r,u){n.call(this,t);t.ContinueToPayPal=function(){u.TrackEventItem({Type:TrackingEventType.CartViewBagPayPalContinue})};t.CancelPayPal=function(){u.TrackEventItem({Type:TrackingEventType.CartViewBagPayPalCancel});$("#PayPalExpressModal").trigger("close")}}return __extends(t,n),t.$inject=["$scope","$rootScope","$http","trackingService"],t}(BaseAngularController);n.PayPalCtrl=t}(PayPalModule||(PayPalModule={}));app.controller("PayPalController",PayPalModule.PayPalCtrl),function(n){var t=function(t){function i(i){t.call(this,i);n.productCarouselScope=i;n.productCarouselScope.starRange=_.range(5);n.productCarouselScope.products=AVON.productCarouselProducts;n.productCarouselScope.MaxProductNameAllowed=55;n.productCarouselScope.GetFilledStars=function(n){return{width:n*20-3+"%"}};n.productCarouselScope.GetProductName=function(t){return t.length>n.productCarouselScope.MaxProductNameAllowed?t.substring(0,n.productCarouselScope.MaxProductNameAllowed)+"<span>...<\/span>":t}}return __extends(i,t),i.$inject=["$scope"],i}(BaseAngularController);n.ProductCarouselController=t}(ProductCarouselModule||(ProductCarouselModule={}));app.controller("ProductCarouselController",ProductCarouselModule.ProductCarouselController),function(n){var t=function(n){function t(t,i,r,u,f,e,o,s,h){function rt(){$(document).find("#BVRRDisplayContentNoReviewsID").length===0&&(c.DisplayProductReviews=!0,c.SafeApply())}var l=this,p,c,g,v,w,nt,a,tt,it,b,k,d,y;n.call(this,t,e);this.$scope=t;this.bagService=i;this.$compile=u;this.trackingService=f;this.wishListService=o;this.facebookService=s;p=function(){return{qty:null,selectedValue:"",variant:null,AutoReplenishmentFrequency:0,AutoReplenishmentMultibuy:!1,AutoReplenishmentOverrideToBeOneTimeOnly:!1,AutoReplenishmentAutomaticallyAddedToBag:!1}};c=t;c.starRange=_.range(5);c.product=AVON.product;c.IngredientsContentsOriginal=c.SecureHtml(this.formatIngredients(AVON.product.Ingredients));c.productIngredientsFormatted=c.IngredientsContentsOriginal;c.product.Description=c.SecureHtml(c.product.Description);c.DescriptionContentsOriginal=c.product.Description;c.TempShoppingBag=[];c.NotifyMeShadeItem=null;c.products=AVON.productList;c.DisplayProductReviews=!1;c.IsVariantAvailbleSoonMessage=!1;c.AddToBagClientSideValidationError=!1;c.ZeroQuantityClientSideValidationError=!1;c.ImagesIndexLoaded=[];g=c.product.Availability!==CanBuy.NotForIndividualSale&&c.product.Availability!==CanBuy.AvailableSoon&&c.product.Availability!==CanBuy.NotAvailableOnTheOnlineStore&&c.product.PriceModel.AutoReplenishmentPrice>0;c.AutoReplenishmentOptionModel=window.location.search.toLowerCase().indexOf("arsub=1")>0&&g||c.product.Availability==CanBuy.AutoReplenishmentOnly?"AutoReplenishment":"OneTime";c.AutoReplenishmentFrequency=0;c.HasProductSubscriptionForAutoReplenishment=!1;c.AutoReplenishmentButton=0;c.ProductHasAutoReplenishmentPurchaseOption=!1;c.AutoReplenishmentVariantSubscriptions=[];c.AutoReplenishmentFrequencyList=[];c.FrequencySelectError=!1;c.IsAutoReplenishmentProductJustAdded=!1;this.selectedVariantWithImage=null;t.HoveredVariantWithImage=null;c.EnsureTempBagHasEmptyItem=function(){if(c.TempShoppingBag.length>0){var n=c.TempShoppingBag[c.TempShoppingBag.length-1];(n.qty!=null||n.selectedValue!=""||n.variant!=null)&&c.TempShoppingBag.push(p())}else c.TempShoppingBag.push(p())};c.$on(ModalDirectiveModule.ModalDirective.ModalClosedBroadcastName,function(n,t){t==="QuickView"&&c.IsQuickShopModalOpen&&(c.$$listeners=[])});this.facebookService.reDrawAllIcons();c.AddingVariant=!0;this.lastShadeQtyUpdatedViaSwatchClick=null;c.TrackProductViewEvent=function(){c.IsQuickShopModalOpen?l.trackingService.TrackEventItem({Type:TrackingEventType.QuickShopProductView}):l.trackingService.TrackProductViewEvent()};c.SessionService.WhenReady().then(function(){c.TrackProductViewEvent();c.ProductHasAutoReplenishmentPurchaseOption=c.product.PriceModel.AutoReplenishmentPrice>0;c.AutoReplenishmentFrequencyList=c.product.AutoReplenishmentFrequencyList;c.AutoReplenishmentFrequencyList&&c.AutoReplenishmentFrequencyList.length>0&&(c.AutoReplenishmentFrequency=c.AutoReplenishmentFrequencyList[0]);$.each(c.product.VariantGroups,function(n,t){$.each(t.Variants,function(n,t){h.IsSubscribedToProductWithSku(t.Sku)&&c.AutoReplenishmentVariantSubscriptions.push(t.Sku)})});c.AutoReplenishmentVariantSubscriptions.length>=1&&(c.HasProductSubscriptionForAutoReplenishment=!0,c.product.IsMultiVariantProduct||(c.AutoReplenishmentButton=1));c.EnsureTempBagHasEmptyItem()});c.ScrollTo=function(n,t){t===void 0&&(t=!0);var i=0,r=$("#TopNavigationContainer");r&&!r.hasClass("FixedMenu")&&t&&(i=72);window.scrollTo(0,$("#"+n).offset().top-i)};c.HasAutoReplenishmentSubscription=function(n){var t=!1;return c.AutoReplenishmentOptionModel==="AutoReplenishment"&&n!==null&&n.hasOwnProperty("Sku")&&(t=h.IsSubscribedToProductWithSku(n.Sku)),c.CheckForAutoReplenishmentAlreadySubscribed(),t};c.HasAutoReplenishmentSingleVariantItemInBag=function(){var n=!1;return c.product.IsMultiVariantProduct&&(c.product.Availability!==CanBuy.AutoReplenishmentOnly||c.product.IsMultiVariantProduct)||$.each(AvonModule.AvonScope.Session.Cart.Campaigns,function(t,i){$.each(i.Items,function(t,i){i.Sku===c.product.VariantGroups[0].Variants[0].Sku&&i.AutoReplenishmentFrequency>0&&(n=!0)})}),n};c.HasAutoReplenishmentVariantItemInBag=function(n){var t=!1;return c.AutoReplenishmentOptionModel==="AutoReplenishment"&&n.hasOwnProperty("variant")&&n.variant!==null&&n.variant.hasOwnProperty("Sku")&&$.each(AvonModule.AvonScope.Session.Cart.Campaigns,function(i,r){$.each(r.Items,function(i,r){r.Sku===n.variant.Sku&&r.AutoReplenishmentFrequency>0&&(t=!0)})}),t};c.CheckForAutoReplenishmentAlreadySubscribed=function(){var n=[];n.length=0;$.each(c.TempShoppingBag,function(t,i){$.each(c.AutoReplenishmentVariantSubscriptions,function(t,r){i.hasOwnProperty("variant")&&i.variant!==null&&i.variant.hasOwnProperty("Sku")&&r===i.variant.Sku&&n.push(r)})});c.HasProductSubscriptionForAutoReplenishment=n.length!==0&&n.length===c.TempShoppingBag.length-1?!0:!1};v=$("#ContentModal");$("#ProductQuickShopContainer").addClass("Ready");$(".ClickToEnlarge").hide();w=$(".NotifyMeQuickShopForm").length?$("#QuickView").find(".Columns_2"):$(document).find(".Columns_2");c.IsQuickShopModalOpen&&(nt={Type:TrackingEventType.ProductImageView,Data:{imageIndexes:[0],profileNumber:c.product.ProfileNumber}},f.TrackEventItem(nt));a=function(){c.AddToBagClientSideValidationError=!1;c.ZeroQuantityClientSideValidationError=!1;c.FrequencySelectError=!1;c.SafeApply();$(".FrequencySelect").removeClass("FormError");$(".QtyError").removeClass("QtyError")};_.defer(function(){w.find(".VariantSelect").off("select2-opening");w.find(".VariantSelect").on("select2-opening",function(){a()})},200);_.defer(function(){t.$watch("products",function(){_.defer(function(){app.safeLoadImages($(".ProductSmallImageCarousel"))})},!0);setTimeout(function(){rt()},4e3)});c.IsShadeSelected=function(n){return c.GetVariantFromTempShoppingBag(n.Sku)!=null};c.DisplayBothAutoReplenishmentAndNormalPurchaseOptions=function(n){return n!==CanBuy.AutoReplenishmentOnly&&n!==CanBuy.NotForIndividualSale&&n!==CanBuy.NoLongerAvailable&&n!==CanBuy.AvailableSoon&&n!==CanBuy.NotAvailableOnTheOnlineStore&&c.ProductHasAutoReplenishmentPurchaseOption};c.RemoveItemFromTempShoppingBag=function(n){var t=c.TempShoppingBag.indexOf(n);c.TempShoppingBag.splice(t,1);c.EnsureTempBagHasEmptyItem();c.CheckForAutoReplenishmentAlreadyAddedOrSubscribed();l.selectedVariantWithImage==n.variant&&l.RevertAllToOriginalProductImage()};c.ShowAddToBag=function(){if(c.ConditionalProductCheck()&&(c.product.Availability=c.ConditionProductRemainingQuantityAllowedToBuy>0?1:5),c.product.Availability!=CanBuy.Available&&c.product.Availability!=CanBuy.AutoReplenishmentOnly)return!1;if(!c.product.IsMultiVariantProduct)return!0;var n=!1;return $.each(c.TempShoppingBag,function(t,i){if(i.variant==null||i.variant.Availability==CanBuy.Available)return n=!0,!1}),n};c.ShowNotifyMeButton=function(){return c.product.Availability==CanBuy.AvailableSoon?!0:!c.product.IsShadeVariant&&c.TempShoppingBag.length==1&&c.TempShoppingBag[0].variant!=null&&c.TempShoppingBag[0].variant.Availability==CanBuy.AvailableSoon?!0:!1};c.IsOptionDisabled=function(n){return n==null||n.Availability==CanBuy.Available||n.Availability==CanBuy.AvailableSoon||n.Availability==CanBuy.AutoReplenishmentOnly?!1:!0};c.GetVariantFromTempShoppingBag=function(n){var t=null;return $.each(c.TempShoppingBag,function(i,r){if(r.variant!=null&&r.variant.Sku==n)return t=r,!1}),t};tt=function(){var n,t;c.TempShoppingBag.length>0&&(n=c.TempShoppingBag[c.TempShoppingBag.length-1],n.qty==null&&n.selectedValue==""&&n.variant==null&&(t=c.TempShoppingBag.indexOf(n),c.TempShoppingBag.splice(t,1)))};c.ShadeChanged=function(n){var r,i;if(c.AddingVariant=!1,a(),n.selectedValue.length==0){_.defer(function(){t.SafeApply(function(){return c.RemoveItemFromTempShoppingBag(n)})});return}for(r=c.TempShoppingBag.indexOf(n),n.variant=c.GetVariantFromProduct(n.selectedValue),i=0;i<c.TempShoppingBag.length-1;i++)if(c.TempShoppingBag[i].variant==n.variant&&i!=r){n.variant.Availability==CanBuy.Available&&(n.qty==null&&(n.qty=1),c.TempShoppingBag[i].qty=Number(n.qty)+Number(c.TempShoppingBag[i].qty));_.defer(function(){c.RemoveItemFromTempShoppingBag(n);t.SafeApply()});break}(n.qty===null||n.qty==="")&&n.variant.Availability===1&&(n.qty=1);c.AutoReplenishmentOptionModel==="AutoReplenishment"&&c.HasAutoReplenishmentSubscription(n.variant)&&(c.AddingVariant=!0);c.EnsureTempBagHasEmptyItem();c.CheckForAutoReplenishmentAlreadyAddedOrSubscribed();l.lastShadeQtyUpdatedViaSwatchClick=null;l.ShowSelectedVariantImage(n.variant);n.variant.HasProductImage&&t.BroadcastToElement(c,".ProductImageCarousel","Carousel_ShowSlide",0,!1)};c.NonShadeVariantChanged=function(){a();var n=c.TempShoppingBag[0];if(n.selectedValue.length==0){n.qty=null;n.variant=null;return}n.variant=c.GetVariantFromProduct(n.selectedValue);(n.qty===null||n.qty==="")&&n.variant.Availability===1&&(n.qty=1)};c.ShadeSwatchClicked=function(n){var i,u,r,f;a();tt();i=c.GetVariantFromTempShoppingBag(n.Sku);u=!1;i==null?(n.Availability==CanBuy.Available||n.Availability==CanBuy.AvailableSoon||n.Availability==CanBuy.AutoReplenishmentOnly)&&(c.AddingVariant===!1&&c.TempShoppingBag.length>0?(r=c.TempShoppingBag.length-1,c.TempShoppingBag[r].selectedValue=n.Sku,c.TempShoppingBag[r].variant=n,c.TempShoppingBag[r].AutoReplenishmentFrequency=0,n.Availability===CanBuy.Available||n.Availability===CanBuy.AutoReplenishmentOnly?c.TempShoppingBag[r].qty||(c.TempShoppingBag[r].qty=1):c.TempShoppingBag[r].qty=null):(f={qty:n.Availability==CanBuy.Available||n.Availability==CanBuy.AutoReplenishmentOnly?1:null,selectedValue:n.Sku,variant:n,AutoReplenishmentFrequency:0,AutoReplenishmentMultibuy:!1,AutoReplenishmentOverrideToBeOneTimeOnly:!1,AutoReplenishmentAutomaticallyAddedToBag:!1},c.TempShoppingBag.push(f)),u=!0,l.lastShadeQtyUpdatedViaSwatchClick=null):(i.variant.Availability==CanBuy.Available||i.variant.Availability==CanBuy.AutoReplenishmentOnly)&&(i.qty=parseInt(i.qty+"")+1,u=!0,l.lastShadeQtyUpdatedViaSwatchClick=i.variant);it(n.Sku);c.EnsureTempBagHasEmptyItem();c.CheckForAutoReplenishmentAlreadyAddedOrSubscribed();u&&(c.AddingVariant=c.AutoReplenishmentOptionModel==="AutoReplenishment"&&c.HasAutoReplenishmentSubscription(n)?!0:!1);l.ShowSelectedVariantImage(n);n.HasProductImage&&t.BroadcastToElement(c,".ProductImageCarousel","Carousel_ShowSlide",0,!1)};it=function(n){var t="$('#dd"+n+"').val('"+n+"')";setTimeout(t,0)};c.CheckForAutoReplenishmentAlreadyAddedOrSubscribed=function(){var t=[],n=[];return t.length=0,n.length=0,$.each(c.TempShoppingBag,function(n,i){$.each(AvonModule.AvonScope.Session.Cart.Campaigns,function(n,r){$.each(r.Items,function(n,r){i.variant!==null&&r.Sku===i.variant.Sku&&i.AutoReplenishmentFrequency>0&&t.push(r.Sku)})})}),$.each(c.TempShoppingBag,function(t,i){$.each(c.AutoReplenishmentVariantSubscriptions,function(t,r){i.hasOwnProperty("variant")&&i.variant!==null&&i.variant.hasOwnProperty("Sku")&&r===i.variant.Sku&&n.push(r)})}),t.length+n.length!==0&&t.length+n.length===c.TempShoppingBag.length-1?n.length!==0&&n.length===c.TempShoppingBag.length-1?(c.AutoReplenishmentButton=1,1):(c.AutoReplenishmentButton=2,2):(c.AutoReplenishmentButton=0,0)};c.ShowAlreadyAdded=function(){return c.AutoReplenishmentOptionModel==="AutoReplenishment"&&c.AutoReplenishmentButton==1&&c.product.IsMultiVariantProduct===!1?!1:c.product.AutoReplenishmentMultibuy===!1&&(c.HasAutoReplenishmentSingleVariantItemInBag()||c.AutoReplenishmentButton===2&&c.product.IsMultiVariantProduct===!1)};c.GetVariantFromProduct=function(n){var t=null;return $.each(c.product.VariantGroups,function(i,r){if(t!=null)return!1;$.each(r.Variants,function(i,r){if(r.Sku==n)return t=r,!1})}),t};b=function(n){var i="/product/notifymemodal?pfid="+c.product.Id.toString()+"&fsc="+n,t;c.ShowLoading(AVON.messages.spinner_loading);t={AllowExit:!0,Model:null,KeepLoaded:!1,UrlToLoad:i};v.trigger("modal",t)};c.OpenNotifyMeForShade=function(n,i,r){c.NotifyMeShadeItem=n;i?($(".NotifyMeQuickShopForm"+r).show(),$(".NotifyFormContainer"+r).load("/product/notifymemodal?pfid="+c.product.Id.toString()+"&fsc="+n.variant.Fsc+"&quickshop=true",null,function(){u($(".NotifyFormContainer"+r).contents())(t);$(".NotifyMeSuccessQuickShopViewContainer").hide()})):b(n.variant.Fsc)};c.OpenNotifyMe=function(n){var i="";c.product.IsMultiVariantProduct&&!c.product.IsShadeVariant&&(i=c.TempShoppingBag[0].variant!==null?c.TempShoppingBag[0].variant.Fsc:c.product.VariantGroups[0].Variants[0].Fsc);n?($(".NotifyMeQuickShopForm").show(),$(".NotifyFormContainer").load("/product/notifymemodal?pfid="+c.product.Id.toString()+"&fsc="+i+"&quickshop=true",null,function(){u($(".NotifyFormContainer").contents())(t);$(".NotifyMeSuccessQuickShopViewContainer").hide();$(".NotifyMeButton").hide()})):b(i)};c.OnShadeEnter=function(n,t){var r=$(angular.element(n.currentTarget).find(".VariantImage")[0]),i,u;r.siblings("div").addClass("active");i=r.siblings(".Overlay.active");i.width(i.parent().width()-(i.outerWidth(!0)-i.width()));u=r.siblings(".RotatedCaret45.active");i.css("margin-top",function(){return"-"+(i.height()+18)+"px"});l.ShowHoveredVariantImage(t)};c.OnShadeLeave=function(n){var t=$(angular.element(n.currentTarget)[0]);t.children(".active").removeClass("active")};t.OnShadeGroupLeave=function(){t.HoveredVariantWithImage=null};c.ShowShadeRemoveButton=function(n){var t=c.TempShoppingBag.length;return t==1?!1:n+1==t?!1:!0};k=function(n){if(!$.isNumeric(n))return 1;var t=parseInt(n);return t>0&&t<100?t:1};c.GetBagItems=function(){c.ShoppingBag=[];var t=c.product,i=c.TempShoppingBag,n=c.getValidBagItems(i);return n.length===0?n:(t.IsMultiVariantProduct||t.Availability!=CanBuy.Available&&t.Availability!=CanBuy.AutoReplenishmentOnly||(n[0].variant=t.VariantGroups[0].Variants[0]),$.each(n,function(n,t){var r,i,u;t.variant!=null&&(t.variant.Availability==CanBuy.Available||t.variant.Availability==CanBuy.AutoReplenishmentOnly)&&(r=c.FindVariantInBag(t.variant.Sku),r===null?(i=new AddBagItem,i.Quantity=k(t.qty),i.Sku=t.variant.Sku,i.OrderType="Customer",i.AutoReplenishmentFrequency=t.AutoReplenishmentFrequency,i.AutoReplenishmentMultiBuy=t.AutoReplenishmentMultibuy,i.AutoReplenishmentOverrideToBeOneTimeOnly=t.AutoReplenishmentOverrideToBeOneTimeOnly,c.ShoppingBag.push(i)):n>0&&t.qty.toString()!=""&&t.qty>0&&t.qty<99&&(u=parseInt(c.ShoppingBag[r].Quantity+"")+parseInt(k(t.qty)+""),c.ShoppingBag[r].Quantity=u))}),n)};c.QuickshopFindingMethod=function(){return window.location.href.indexOf("/search")!==-1?TrackingAddToCartType.SearchResultsQuickshop:window.location.href.indexOf("/brochure")!==-1?TrackingAddToCartType.BrochureQuickshop:window.location.href.indexOf("/crusade")!==-1?TrackingAddToCartType.Causes:window.location.href.indexOf("/bag")!==-1?TrackingAddToCartType.Bag:window.location.href.indexOf("/products/productline")!==-1&&c.IsQuickShopModalOpen?TrackingAddToCartType.ProductLinePage:window.location.href.indexOf("/product")!==-1?c.IsQuickShopModalOpen?TrackingAddToCartType.ProductDetailPageQuickShopModal:TrackingAddToCartType.ProductDetailPage:window.location.href.indexOf("/category")!==-1||window.location.href.indexOf("/promotions")!==-1?TrackingAddToCartType.ProductCategory:window.location.href.indexOf("/blog")!==-1?TrackingAddToCartType.BlogQuickShop:window.location.href.indexOf("/myaccount")!==-1?TrackingAddToCartType.OrderHistoryQuickShop:TrackingAddToCartType.ProductDetailQuickshop};c.addToBag=function(n,t){var e,i,r,u,f,o;if(c.IsAutoReplenishmentProductJustAdded=!1,!($(".AddToBagQuickshop.Button2").length>0)){for(a(),c.AddButtonClicked=$(n.target),c.GetBagItems(),e=$("input.Quantity:visible"),i=[],r=0;r<e.length;r++)u=$(e[r]),u.val()==0&&u.val().trim()!=""&&i.push(u);if(i.length>0){for(c.ZeroQuantityClientSideValidationError=!0,f=0;f<i.length;f++)i[f].addClass("QtyError");return}if(c.ShoppingBag.length===0){c.AddToBagClientSideValidationError=!0;return}c.ShowLoading(AVON.messages.spinner_adding);AVON.product=c.product;o=c.QuickshopFindingMethod();l.bagService.addMultipleItemsToBag(c.ShoppingBag,t,o)}};c.addAutoReplenishmentToBag=function(n,t){if(c.AutoReplenishmentOptionModel==="AutoReplenishment"&&c.AddingVariant&&l.AreAllArSelectedItemsAlreadySubscribed()){c.AddToBagClientSideValidationError=!0;return}if(c.AddButtonClicked=$(n.target),c.AutoReplenishmentOptionModel!=="AutoReplenishment"||c.AutoReplenishmentFrequencyList.length!==1||c.AutoReplenishmentFrequency||(c.AutoReplenishmentFrequency=c.AutoReplenishmentFrequencyList[0]),c.AutoReplenishmentFrequency){c.FrequencySelectError=!1;var i=c.TempShoppingBag,r=[];$.each(i,function(n,t){$.each(c.AutoReplenishmentVariantSubscriptions,function(n,i){t.hasOwnProperty("variant")&&t.variant!==null&&t.variant.hasOwnProperty("Sku")&&i===t.variant.Sku&&r.push(t)});t.AutoReplenishmentFrequency=c.AutoReplenishmentFrequency;t.AutoReplenishmentMultibuy=c.product.AutoReplenishmentMultibuy});r.length>0&&$.each(r,function(n,t){var r=i.indexOf(t);i.splice(r,1)});c.addToBag(n,t)}else c.FrequencySelectError=!0,$(".FrequencySelect").addClass("FormError"),c.GetBagItems(),c.ShoppingBag.length===0&&(c.AddToBagClientSideValidationError=!0)};c.AutoReplenishmentFrequencyChanged=function(){a()};c.AutoReplenishmentOptionChange=function(){var n;if(c.AddToBagClientSideValidationError=!1,c.ZeroQuantityClientSideValidationError=!1,c.FrequencySelectError=!1,c.AutoReplenishmentOptionModel==="AutoReplenishment"){for($.each(c.product.VariantGroups,function(n,t){$.each(t.Variants,function(n,t){$.each(c.AutoReplenishmentVariantSubscriptions,function(n,i){t.Sku===i&&c.TempShoppingBag.push({qty:t.Availability===CanBuy.Available||t.Availability===CanBuy.AutoReplenishmentOnly?1:null,selectedValue:t.Sku,variant:t,AutoReplenishmentFrequency:0,AutoReplenishmentMultibuy:!1,AutoReplenishmentOverrideToBeOneTimeOnly:!1,AutoReplenishmentAutomaticallyAddedToBag:!0})})})}),n=c.TempShoppingBag.length-1;n>=0;n--)c.TempShoppingBag[n].qty>1&&(c.TempShoppingBag[n].qty=1),c.TempShoppingBag.length>0&&(c.TempShoppingBag[n].selectedValue===""||c.TempShoppingBag[n].qty===null)&&c.TempShoppingBag.splice(n,1);c.TempShoppingBag=_.map(_.groupBy(c.TempShoppingBag,function(n){return n.selectedValue}),function(n){return n[0]})}if(c.AutoReplenishmentOptionModel==="OneTime")for(c.AddingVariant=!1,n=c.TempShoppingBag.length-1;n>=0;n--)c.TempShoppingBag[n].AutoReplenishmentAutomaticallyAddedToBag&&c.TempShoppingBag.splice(n,1);c.EnsureTempBagHasEmptyItem()};c.$on("BagService.AddToBagSuccess",function(n,t){var i=t,r;for(c.IsAutoReplenishmentProductJustAdded=i.ItemsAdded&&i.ItemsAdded.length>0?i.ItemsAdded[0].AutoReplenishmentFrequency>0:!1,c.ProductsAddedCount=0,r=0;r<i.ItemsAdded.length;r++)c.ProductsAddedCount+=i.ItemsAdded[r].Quantity;c.TempShoppingBag=[];c.TempShoppingBag.push(p());c.ShowAddToBag();$("#QuickView").addClass("AddedToBag")});c.CloseModal=function(){$("#QuickView").trigger("close")};c.$on("ProductAddedToBagModalClosed",function(){c.ShowAddToBag();_.defer(function(){c.ShowAlreadyAdded()&&(c.SafeApply(),$("select.FrequencySelect").prop("disabled",!0))})});c.ConditionalProductCheck=function(){var t=!1,n;if(c.Session.Cart.ConditionalProducts)for(n=0;n<c.Session.Cart.ConditionalProducts.length;n++)c.Session.Cart.ConditionalProducts[n].PfId===c.product.Id&&c.Session.Cart.ConditionalProducts[n].Campaign===c.Session.Customer.Campaign&&(c.ConditionProductRemainingQuantityAllowedToBuy=c.Session.Cart.ConditionalProducts[n].QuantityAllowedToBuy,t=!0,$(".QuantityAllowedToBuy").text(c.ConditionProductRemainingQuantityAllowedToBuy));return t};c.$on("NotifyMeService.NotifyMeQuickShopResponse",function(n,t){setTimeout(function(){d(t)},4e3)});c.$on("NotifyMeService.NotifyMeResponse",function(n,t){d(t)});d=function(n){n.ErrorCode===AjaxError.None&&(c.product.IsShadeVariant&&c.NotifyMeShadeItem!=null&&c.RemoveItemFromTempShoppingBag(c.NotifyMeShadeItem),c.product.IsMultiVariantProduct&&!c.product.IsShadeVariant&&c.RemoveItemFromTempShoppingBag(c.NotifyMeShadeItem),c.TempShoppingBag.length<=1&&(c.AddingVariant=!0))};c.RedirectAndPlayVideo=function(n,t){c.ShowLoading(AVON.messages.spinner_loading);var i=c.product.Sku.substring(0,c.product.Sku.lastIndexOf("-"));c.RedirectToUrl("/product/"+c.product.SeoName+"-"+i+"?videoId="+n+"&videoType="+t)};c.VideoImageUrl=function(n){var t=n.indexOf("?")>0?n.indexOf("?"):n.length;return n=n.substring(0,t),"https://i1.ytimg.com/vi/"+n+"/sddefault.jpg"};c.BrightcoveThumbnailUrl=function(n){var t=$(".SmallImages .SmallImage .brightcove-image-thumbnail");t.length>0&&$.each(t,function(t,i){$(i).css("background-image","url("+n+")")})};c.FindVariantInBag=function(n){for(var t=0,i=c.ShoppingBag.length;t<i;t++)if(c.ShoppingBag[t].Sku===n)return t;return null};c.IsVariantAvailable=function(n){return n.Availability==CanBuy.Available||n.Availability==CanBuy.AutoReplenishmentOnly};c.IsVariantAvailableSoon=function(n){return n.Availability==CanBuy.AvailableSoon};c.DisplayVariantLineNumber=function(n,t){return ProductHelper.DisplayVariantLineNumber(n,t)};c.IsVariantShade=function(n){return n===1};c.ActiveTabIndex=0;c.ShowDetailTab=function(n){c.ActiveTabIndex=n};r.$on("EllipsisComplete",function(){});c.DisplayChartSize=function(n){if(AVON.IsTabletDevice||$(".android").length>0){e.open(n,"_blank");return}_.defer(function(){var t={AllowExit:!0,Model:null,KeepLoaded:!1,UrlToLoad:""+n+"",UseIFrame:!0,IFrameWidth:"750px",IFrameHeight:"750px"};v.trigger("modal",t)})};c.ShowPromotionOverlay=function(n){var i=$(angular.element(n.currentTarget)[0]),t,r,u;if(i.siblings("div").addClass("active"),t=i.siblings(".Overlay.active"),t.width(i.width()-(t.outerWidth(!0)-t.width())),r=$(".NavBar"),r.length>0){var e=r.offset().left+r.innerWidth(),o=t.offset().left+t.innerWidth(),f=o-e;f>0&&t.css({"margin-left":-f})}u=i.siblings(".RotatedCaret45.active");u.css({"margin-left":i.width()/2-u.width()/2})};c.HidePromotionOverlay=function(n){var t=$(angular.element(n.currentTarget)[0]);t.children(".active").removeClass("active")};y=[];c.$on("FallbackSrc.ImageFound",function(n,t){var i=t.element;i.parent(".SmallImage")&&i.attr("data-zoom-image")!==undefined&&$.inArray(i.attr("data-zoom-image"),y)===-1&&y.push(i.attr("data-zoom-image"))});c.$on("SecondaryImage.ImageFound",function(n,t,i){var r=t.element,e,u,o,s;r.parent(".SmallImage")&&r.attr("data-zoom-image")!==undefined&&$.inArray(r.attr("data-zoom-image"),y)===-1&&(c.ImagesIndexLoaded.indexOf(i)<0&&(e=r.attr("data-zoom-image"),u=r.attr("src"),u=u.substring(0,u.lastIndexOf("?"))+e.substring(e.lastIndexOf("?")),r.attr("data-zoom-image",u),c.ImagesIndexLoaded.push(i),o=r.parent(".SmallImage").index(),y[o]=r.attr("data-zoom-image"),r.parent(".SmallImage").data("index",i)),s={Type:TrackingEventType.ProductImageView,Data:{imageIndexes:c.ImagesIndexLoaded,profileNumber:c.product.ProfileNumber}},f.TrackEventItem(s))});c.$on("SecondaryImage.NoImageFound",function(n,t){t.parent(".SmallImage")&&t.attr("data-zoom-image")!==undefined&&$.inArray(t.attr("data-zoom-image"),y)===-1||t.hasClass("ProductImage")&&(t.attr("src","/images/Responsive/Product/PhotoNotAvailable.png"),r.$broadcast("FallbackSrc.NoImageFound",t))});c.ShowProductImage=function(n){t.BroadcastToElement(c,".ProductImageCarousel","Carousel_ShowSlide",n,!0)};c.starWidthStyle=function(){return{width:c.product.Rating*20+"%"}};t.$on("Carousel_SlideShown",function(n,t){var i,r;t.container.attr("id")==="ProductImageCarousel"&&(i=t.container.find(".Slide").children(),i.removeClass("ProductImageActive"),r=t.container.find(".Slide:nth-child("+(t.currentIndex+1)+")").children(),r.addClass("ProductImageActive"))});c.DisplayImageModal=function(n){var f=n?$(n.currentTarget):$("img.ProductImage.ProductImageActive"),t=f.clone(),r,u,i;v.html("");r=t.attr("data-original-src");u=r?t.attr("src"):t.attr("data-zoom-image");i=t.removeAttr("data-zoom-image").removeAttr("data-zoom-max-width").removeAttr("data-zoom-max-height").removeClass("ProductImageActive");i=$(i).attr("src",u);i.appendTo(v);v.trigger("modal")};c.AddSelectedProductsToWishList=function(n){var i,r,e,u,o;t.Session.Customer.IsLoggedIn?(i=angular.element(n.currentTarget).find("i"),i.addClass("loading-spinner"),i.attr("disabled","true"),r=l.getItemsForWishList(),e=l.wishListService.AddToWishList(r),e.finally(function(){var t,n,u;for(i.removeClass("loading-spinner"),i.removeAttr("disabled"),t=[],n=0;n<r.length;n++)t.push(r[n].Sku);u={Type:TrackingEventType.WishListItemsAdded,Data:{trackingItems:t,wishListState:c.Session.Customer.WishList.Products.length>0?"exist":"new",findingMethod:c.IsQuickShopModalOpen?"Product list":"Product detail"}};f.TrackEventItem(u)})):(u=angular.element($("#Modals>.ModalContainer.Shown>*[modal]")),u.length&&u.trigger("close"),o=window.location.href,c.ShowLoginModal("wishlist",o))};c.RemoveSelectedProductsFromWishList=function(n){var i,u,r;t.Session.Customer.IsLoggedIn?(i=angular.element(n.currentTarget).find("i"),i.addClass("loading-spinner"),i.attr("disabled","true"),r=l.getItemsForWishList(),u=(r.length!==1||r[0].Sku)&&l.$scope.product.IsMultiVariantProduct?l.wishListService.RemoveSelectedProductsFromWishList(r):l.wishListService.RemoveAllVariantsFromWishList(l.$scope.product.Id),u.finally(function(){i.removeClass("loading-spinner");i.removeAttr("disabled")})):t.ShowLoginModal("wishlist")};c.HideWishList=function(){return!0};c.IsProductOrAnyVariantsInWishList=function(){var n=!1,r=l.$scope.product.Id,i;return t.Session.Customer&&t.Session.Customer.IsLoggedIn?(i=l.getSelectedVariants(r),n=i.length>0?l.wishListService.CheckIfAllVariantsExistInWishList(i):l.wishListService.CheckIfAnyVariantExistsInWishList(r)):n=!1,n};c.ShowWishListIcon=function(){return c.Session.Customer.IsLoggedIn};c.SetAutoReplenishmentOptionModel=function(n){c.AutoReplenishmentOptionModel=n};c.ShowAddVariant=function(){c.AddingVariant=!0};c.LimitProductImageThumbnails=function(n,i){var r=5;return i<(t.product.MediaAssociation?r-Math.min(t.product.MediaAssociation.length,4):r)};t.GetProductImage=function(n,i){return l.selectedVariantWithImage&&i==0?t.cdn.variantProductImage(l.selectedVariantWithImage.Fsc,700):t.cdn.productImageXtraLarge(n)}}return __extends(t,n),t.prototype.formatIngredients=function(n){return n?n.replaceAll(",","<br />"):""},t.prototype.getSelectedVariants=function(n){var t=[],i=CanBuy.Available,s,r,f,e,o,u;if(this.$scope.product.HasVariants)if(this.$scope.product.IsMultiVariantProduct)for(s=this.$scope.AutoReplenishmentFrequency>0?this.$scope.AutoReplenishmentFrequency:null,r=0,f=this.$scope.TempShoppingBag;r<f.length;r++)e=f[r],e.variant&&t.push(new WishListItem(n,e.variant.Sku,s,i));else this.$scope.product.VariantGroups.length==1&&this.$scope.product.VariantGroups[0].Variants.length==1&&t.push(new WishListItem(n,this.$scope.product.VariantGroups[0].Variants[0].Sku,null,i));else this.$scope.product.PriceModel.AutoReplenishmentPrice>0&&this.$scope.product.Availability==CanBuy.AutoReplenishmentOnly&&this.$scope.AutoReplenishmentFrequency>0&&(o=null,this.$scope.product.Availability==CanBuy.NoLongerAvailable||this.$scope.product.IsMultiVariantProduct||(u=this.$scope.product.VariantGroups[0].Variants[0],u&&(o=u.Sku,i=u.Availability)),t.push(new WishListItem(n,o,this.$scope.AutoReplenishmentFrequency,i)));return t},t.prototype.getGenericProduct=function(n){var i=null,r=CanBuy.Available,t;return this.$scope.product.IsMultiVariantProduct||this.$scope.product.Availability==CanBuy.NoLongerAvailable||(t=this.$scope.product.VariantGroups[0].Variants[0],t&&(i=t.Sku,r=t.Availability)),new WishListItem(n,i,null,r)},t.prototype.getItemsForWishList=function(){var n=[],t=this.$scope.product.Id;return n=this.getSelectedVariants(t),n.length==0&&n.push(this.getGenericProduct(t)),n},t.prototype.RevertAllToOriginalProductImage=function(){this.$scope.HoveredVariantWithImage=null;this.selectedVariantWithImage=null},t.prototype.AreAllArSelectedItemsAlreadySubscribed=function(){var t=this,n;return this.$scope.AutoReplenishmentOptionModel!=="AutoReplenishment"?!1:(n=[],n.length=0,$.each(this.$scope.TempShoppingBag,function(i,r){$.each(t.$scope.AutoReplenishmentVariantSubscriptions,function(t,i){r.hasOwnProperty("variant")&&r.variant!==null&&r.variant.hasOwnProperty("Sku")&&i===r.variant.Sku&&n.push(i)})}),n.length===this.$scope.TempShoppingBag.length-1&&n.length>0?!0:!1)},t.prototype.ShowSelectedVariantImage=function(n){n.HasProductImage&&(this.selectedVariantWithImage=n)},t.prototype.ShowHoveredVariantImage=function(n){n&&n.HasProductImage&&(this.$scope.HoveredVariantWithImage=n)},t.$inject=["$scope","bagService","$rootScope","$compile","trackingService","$window","wishListService","facebookService","autoReplenishService"],t}(BaseAngularController);n.ProductQuickShopController=t}(ProductDetailModule||(ProductDetailModule={}));app.controller("ProductQuickShopController",ProductDetailModule.ProductQuickShopController),function(n){var t=function(t){function i(i,r,u,f,e,o,s,h){function l(n,t){var i=$(":focus"),r=angular.element("[id="+n+"]"),u=r.attr("placeholder");r.attr("placeholder",t);c&&((n==="registrationModel_LoginInfo_PasswordInput"||n==="registrationModel_LoginInfo_PasswordConfirmInput")&&angular.element("[id="+n+"-clone]").removePasswordPlaceHolder(),r.changePlaceholder(u),i&&i.length>0&&i.val(i.val()).focus())}function v(t){if($("[id=registrationModel_LoginInfo_PasswordInput]").length>0){var i=$("[id=registrationModel_LoginInfo_PasswordInput]").attr("placeholder").replace("*",""),r=$("[id=registrationModel_LoginInfo_PasswordConfirmInput]").attr("placeholder").replace("*",""),u=$("[id=registrationModel_LoginInfo_PasswordHintInput]").attr("placeholder").replace("*","");t||n.registrationScope.RequireFullAccount?(l("registrationModel_LoginInfo_PasswordInput",i+"*"),l("registrationModel_LoginInfo_PasswordConfirmInput",r+"*"),l("registrationModel_LoginInfo_PasswordHintInput",u+"*"),n.registrationScope.HideGuestCheckoutMessage=!0):(l("registrationModel_LoginInfo_PasswordInput",i),l("registrationModel_LoginInfo_PasswordConfirmInput",r),l("registrationModel_LoginInfo_PasswordHintInput",u),n.registrationScope.HideGuestCheckoutMessage=!1);n.registrationScope.SafeApply()}}function d(t){angular.element("#registrationModel_LoginInfo_PasswordInput").val()!=""||angular.element("#registrationModel_LoginInfo_PasswordConfirmInput").val()!=""||angular.element("#registrationModel_LoginInfo_PasswordHintInput").val()!=""||n.registrationScope.RequireFullAccount?v(!0,t):v(!1,t)}function g(n){n.attr("id")==="registrationModel_LoginInfo_FirstNameInput"&&$("#shippingAddress_FirstNameInput").val(n.val()).removeClass("placeholder").change();n.attr("id")==="registrationModel_LoginInfo_LastNameInput"&&$("#shippingAddress_LastNameInput").val(n.val()).removeClass("placeholder").change();_.defer(function(){AddressModule.addressesScope.UpdateInlineWaterMark();AddressModule.addressesScope.SafeApply()},250)}function w(){n.registrationScope.registrationModel=h.OdsIsDown===!1&&(AVON.registrationModel||{NotifySpecialOffers:!0});n.registrationScope.registrationModel.LoginInfo&&n.registrationScope.registrationModel.LoginInfo.FirstName&&n.registrationScope.registrationModel.LoginInfo.FirstName.length==0&&(n.registrationScope.registrationModel.LoginInfo={FirstName:"",LastName:"",Email:"",EmailConfirm:"",Password:"",PasswordConfirm:"",PasswordHint:"",PhoneNumber:null});n.registrationScope.showAcceptedPrivacyPolicyError=!1;n.registrationScope.DisplayPasswordInstructions=!0;this.isModalDisplay=!1;n.registrationScope.ShowValidation=!1;n.registrationScope.RegistrationFullPageForm=angular.element("#registrationFullPage").val()=="true";n.registrationScope.CreateAnAccount=n.registrationScope.RegistrationModal;n.registrationScope.RequireFullAccount=AVON.RequireFullAccount;c&&(angular.element("#registrationModel_LoginInfo_FirstNameInput").placeholder(),angular.element("#registrationModel_LoginInfo_LastNameInput").placeholder(),angular.element("#registrationModel_LoginInfo_EmailInput").placeholder(),angular.element("#registrationModel_LoginInfo_PasswordInput").placeholder(),angular.element("#registrationModel_LoginInfo_PasswordConfirmInput").placeholder(),angular.element("#registrationModel_LoginInfo_PasswordHintInput").placeholder());n.registrationScope.RegistrationFullPageForm&&(v(!0),_.defer(function(){n.registrationScope.UpdateInlineWaterMark();n.registrationScope.SafeApply();angular.element("#registrationModel_LoginInfo_FirstNameInput").focus()},250))}function nt(){n.registrationScope.registrationModel.IsGuestShopper=!1}function tt(){var t=Math.floor(Math.random()*10),i;n.registrationScope.registrationModel.ReturnUrl=$("#registrationModel_ReturnUrl").val();n.registrationScope.registrationModel.PrivacyPolicy=!0;n.registrationScope.registrationModel.LoginInfo.Password="password"+t;n.registrationScope.registrationModel.LoginInfo.PasswordConfirm="password"+t;n.registrationScope.registrationModel.LoginInfo.PasswordHint="GuestShopper";n.registrationScope.registrationModel.IsGuestShopper=!0;i=n.registrationScope.IsEmailValid(n.registrationScope.registrationModel.LoginInfo.Email);i||(n.registrationScope.RegistrationForm.registrationModel_LoginInfo_Email.$invalid=!0);n.registrationScope.RegistrationFullPageForm&&AddressModule.addressesScope&&!n.registrationScope.HasPhoneNumber()&&n.registrationScope.RegistrationForm.Number&&(n.registrationScope.RegistrationForm.Number.$invalid=!0,n.registrationScope.RegistrationForm.Number.$error.format=!0,n.registrationScope.ShowValidation=!0,n.registrationScope.SafeApply(),n.registrationScope.RegistrationForm.$valid=!1);n.registrationScope.RegistrationForm.registrationModel_LoginInfo_FirstName.$invalid===!1&&n.registrationScope.RegistrationForm.registrationModel_LoginInfo_LastName.$invalid===!1&&n.registrationScope.RegistrationForm.registrationModel_LoginInfo_Email.$invalid===!1&&(n.registrationScope.RegistrationForm.$valid=!0,n.registrationScope.RegistrationFullPageForm&&AddressModule.addressesScope&&!n.registrationScope.HasPhoneNumber()&&(n.registrationScope.RegistrationForm.$valid=!1))}function b(){var t,u,i,r;n.registrationScope.HideLoading();n.registrationScope.DisplayEmailError=!1;n.registrationScope.PasswordsEmpty=!1;n.registrationScope.PasswordsDontMatch=!1;t=!1;n.registrationScope.registrationModel.PrivacyPolicy===!1&&(n.registrationScope.showAcceptedPrivacyPolicyError=!0);n.registrationScope.RegistrationForm.ServerErrors.Summary===undefined||n.registrationScope.ShowValidation||(n.registrationScope.RegistrationForm.ServerErrors.Summary.$invalid=!1);a(n.registrationScope.registrationModel.LoginInfo.Password)||(n.registrationScope.RegistrationForm.registrationModel_LoginInfo_Password.$invalid=!0,t=!0);a(n.registrationScope.registrationModel.LoginInfo.PasswordConfirm)||(n.registrationScope.RegistrationForm.registrationModel_LoginInfo_PasswordConfirm.$invalid=!0,t=!0);u=n.registrationScope.IsEmailValid(n.registrationScope.registrationModel.LoginInfo.Email);u||(n.registrationScope.RegistrationForm.registrationModel_LoginInfo_Email.$invalid=!0,n.registrationScope.DisplayEmailError=!0);i=n.registrationScope.registrationModel.LoginInfo.Password;r=n.registrationScope.registrationModel.LoginInfo.PasswordConfirm;n.registrationScope.DisplayPasswordInstructions=!1;n.registrationScope.ValidationErrorStyle=!1;i===""&&r===""&&(n.registrationScope.PasswordsEmpty=!0,n.registrationScope.ValidationErrorStyle=!0);t===!1&&i!==r&&(n.registrationScope.RegistrationForm.registrationModel_LoginInfo_Password.$invalid=!0,n.registrationScope.RegistrationForm.registrationModel_LoginInfo_PasswordConfirm.$invalid=!0,n.registrationScope.PasswordsDontMatch=!0,n.registrationScope.ValidationErrorStyle=!0);!c||a(n.registrationScope.registrationModel.LoginInfo.Password)&&a(n.registrationScope.registrationModel.LoginInfo.PasswordConfirm)||(n.registrationScope.PasswordsEmpty=!0,n.registrationScope.ValidationErrorStyle=!0);n.registrationScope.ShowValidation=!0;n.registrationScope.RequiredInvalid=!0;n.registrationScope.TrackUserValidationErrors(n.registrationScope.RegistrationForm.$error)}function a(n){return n?n.match(/^(?=.*[0-9])([a-zA-Z0-9]{7,16})$/)!=null:!1}function k(){n.registrationScope.registrationModel.LoginInfo.Password=$("#registrationModel_LoginInfo_PasswordInput").val();n.registrationScope.registrationModel.LoginInfo.PasswordConfirm=$("#registrationModel_LoginInfo_PasswordConfirmInput").val();n.registrationScope.RegistrationForm.registrationModel_LoginInfo_Password.$invalid=!1;n.registrationScope.RegistrationForm.registrationModel_LoginInfo_PasswordConfirm.$invalid=!1}var c,y,p;t.call(this,i,h);n.registrationScope=i;c=!1;n.registrationScope.RegistrationModal=angular.element("#RegistrationModal").html().length>0;n.registrationScope.SessionService.WhenReady().then(function(){$.each(AvonModule.AvonScope.Session.Cart.Campaigns,function(n,t){$.each(t.Items,function(n,t){var i=t.AutoReplenishmentFrequency>0;i&&(AvonModule.AvonScope.Session.Customer.IsEligibleForGuestCheckout=!1)})});n.registrationScope.SetupFullRegistrationForm=function(){h.OdsIsDown||(n.registrationScope.CreateAnAccount=!0,n.registrationScope.HideCreateAnAccount=!0,n.registrationScope.RepAttachedFullRegistrationRequired=!0,n.registrationScope.RegistrationFullPageForm=!0,n.registrationScope.showAcceptedPrivacyPolicyError=!1,n.registrationScope.DisplayPasswordInstructions=!0,n.registrationScope.RequireFullAccount=!0,AVON.RequireFullAccount=!0,AVON.IsGuestCheckout=!1,n.registrationScope.ContinueAsGuest=!1,r.$broadcast("RegistrationScope.DisplayPrivacyPolicy",!0),n.registrationScope.SafeApply())};n.registrationScope.RegisteredCustomerAsGuest={CustomerId:n.registrationScope.Session.Customer.CustomerId>0?n.registrationScope.Session.Customer.CustomerId:0,Rep:n.registrationScope.Session.Rep?n.registrationScope.Session.Rep:{Hash:0,Id:0,Address:"",CityStateZip:"",CityState:"",HomepageUrl:"",Name:"",FirstName:"",LastName:"",Phone:"",AlternativePhone:"",WebUrl:"",Status:"",IsInPilot:!1,IsGemini:!1}};n.registrationScope.AccountAlreadyExists=!1;n.registrationScope.ContinueAsGuest=AVON.IsGuestCheckout});y=$("#mode");y.length>0&&y.val()==="Standard"&&(n.registrationScope.IsModal=!0,this.isModalDisplay=!0);n.registrationScope.PrivacyPolicyOnKeyCheck=function(t){var i=t.currentTarget.id;n.registrationScope.RegistrationFullPageForm&&AddressModule.addressesScope&&(d("#"+i),v(!0))};n.registrationScope.InputFocus=function(){n.registrationScope.DisplayPasswordInstructions=!0;n.registrationScope.DisplayEmailError=!1;n.registrationScope.ValidationErrorStyle=!1;n.registrationScope.ShowValidation=!1;n.registrationScope.RegistrationFullPageForm&&AddressModule.addressesScope&&(AddressModule.addressesScope.ShowValidation=!1)};n.registrationScope.CheckIfEmailExists=function(){return(n.registrationScope.AccountAlreadyExists=!1,n.registrationScope.CheckForExistingEmail=!0,!n.registrationScope.Session.Customer.HideWelcomeBackModal&&n.registrationScope.RegistrationFullPageForm&&n.registrationScope.registrationModel.LoginInfo&&n.registrationScope.IsEmailValid(n.registrationScope.registrationModel.LoginInfo.Email))?($("#registrationModel_LoginInfo_EmailInput").addClass("LoadingImage"),u.getCustomerByEmail(n.registrationScope.registrationModel.LoginInfo.Email,!1)):null};n.registrationScope.$on("RegistrationService.RegisteredCustomerAsGuestResponse",function(t,i){if($("#registrationModel_LoginInfo_EmailInput").removeClass("LoadingImage"),i.ErrorCode!=AjaxError.ValidationErrors)if(i.SaveInSession)i.Rep&&(n.registrationScope.RegisteredCustomerAsGuest.Rep=i.Rep,n.registrationScope.RegisteredCustomerAsGuest.Rep.Id>0&&(n.registrationScope.Session.Rep=n.registrationScope.RegisteredCustomerAsGuest.Rep)),i.CustomerId&&i.CustomerType==6&&(n.registrationScope.RegisteredCustomerAsGuest.CustomerId=i.CustomerId,n.registrationScope.AccountAlreadyExists=!0);else if(i.CustomerId&&i.CustomerType==6){var r={UrlToLoad:"",AllowExit:!0,KeepLoaded:!0,Model:{Email:n.registrationScope.registrationModel.LoginInfo.Email}};$("#WelcomeBack").trigger("modal",r)}});n.registrationScope.LoadSignInModal=function(){n.registrationScope.ShowLoading(AVON.messages.spinner_loading);_.defer(function(){window.location.href=n.registrationScope.Url.Action("Index","Bag")+"?overlay=LoginModal&returnurl=/checkout&email="+n.registrationScope.registrationModel.LoginInfo.Email},250)};n.registrationScope.$on("WelcomeBackScope.ContinueAsGuest",function(){$("#WelcomeBack").trigger("close")});n.registrationScope.RegisteredUserContinueAsGuest=function(t){h.OdsIsDown||(n.registrationScope.registrationModel.IsRegisteredGuestShopper=!0,n.registrationScope.RequireFullAccount=!1,AVON.RequireFullAccount=!1,n.registrationScope.ContinueAsGuest=!0,n.registrationScope.CreateAnAccount=!1,n.registrationScope.UpdateCustomerType(CustomerType.RegisteredCustomerAsGuest),t&&u.getCustomerByEmail(n.registrationScope.registrationModel.LoginInfo.Email,t),r.$broadcast("RegistrationScope.DisplayPrivacyPolicy",!1))};n.registrationScope.$on("ModalClosed",function(t,i){i==="WelcomeBack"&&(n.registrationScope.IsAutoReplenishmentInCart()||n.registrationScope.RegisteredUserContinueAsGuest(!0),n.registrationScope.HideWelcomeBackModal(!0));n.registrationScope.AccountAlreadyExists||n.registrationScope.CheckForExistingEmail||w()});$("#registrationModel_LoginInfo_FirstNameInput, #registrationModel_LoginInfo_LastNameInput").keyup(function(){n.registrationScope.RegistrationFullPageForm&&AddressModule.addressesScope&&g($(this))});n.registrationScope.privacyUrl=$("#privacyPolicyUrl").val();n.registrationScope.conditionsOfUseUrl=$("#conditionsOfUseUrl").val();$("#LoginModel_EmailInput, #LoginModel_PasswordInput").on("click",function(){n.registrationScope.ShowValidation=!1});n.registrationScope.Register=function(){c&&k();n.registrationScope.RegistrationForm.$valid&&n.registrationScope.PreValidationRules()?(n.registrationScope.CreateAnAccount&&(nt(),n.registrationScope.ShowLoading(AVON.messages.spinner_registering),n.registrationScope.registrationModel.ReturnUrl=$("#registrationModel_ReturnUrl").val(),n.registrationScope.RegistrationModal&&(n.registrationScope.registrationModel.PrivacyPolicy=n.registrationScope.RegistrationForm.registrationModel_PrivacyPolicy.$modelValue)),u.register(n.registrationScope.registrationModel,$("form[name=RegistrationForm]"))):b()};n.registrationScope.invalidPhonenumber=AVON.messages.validate_invalid_phonenumber;n.registrationScope.HasPhoneNumber=function(){var t=n.registrationScope.registrationModel.LoginInfo.PhoneNumber;return t?!t.Area||t.Area.length!==3?!1:!t.Prefix||t.Prefix.length!==3?!1:!t.Number||t.Number.length!==4?!1:!0:!1};n.registrationScope.PreValidationRules=function(){n.registrationScope.showAcceptedPrivacyPolicyError=!1;n.registrationScope.PasswordsEmpty=!1;n.registrationScope.PasswordsDontMatch=!1;n.registrationScope.DisplayEmailError=!1;n.registrationScope.DisplayPasswordInstructions=!0;n.registrationScope.RegistrationForm.Number&&(n.registrationScope.RegistrationForm.Number.$invalid=!1,n.registrationScope.RegistrationForm.Number.$error.format=!1,n.registrationScope.RegistrationForm.$valid=!1);n.registrationScope.registrationModel.LoginInfo||(n.registrationScope.registrationModel.LoginInfo={});n.registrationScope.registrationModel.LoginInfo.EmailConfirm=n.registrationScope.registrationModel.LoginInfo.Email;var t=n.registrationScope.IsEmailValid(n.registrationScope.registrationModel.LoginInfo.Email);if(t||(n.registrationScope.RegistrationForm.$valid=!1),n.registrationScope.RegistrationFullPageForm&&AddressModule.addressesScope&&!n.registrationScope.HasPhoneNumber()&&n.registrationScope.RegistrationForm.Number&&(n.registrationScope.RegistrationForm.Number.$invalid=!0,n.registrationScope.RegistrationForm.Number.$error.format=!0,n.registrationScope.ShowValidation=!0,n.registrationScope.SafeApply(),n.registrationScope.RegistrationForm.$valid=!1),n.registrationScope.CreateAnAccount){if(n.registrationScope.RegistrationFullPageForm&&!n.registrationScope.RegistrationModal&&(n.registrationScope.registrationModel.PrivacyPolicy=n.registrationScope.PrivacyPolicyFromFullPage),c&&k(),!a(n.registrationScope.registrationModel.LoginInfo.Password))return n.registrationScope.RegistrationForm.registrationModel_LoginInfo_Password.$invalid=!0,!1;if(!a(n.registrationScope.registrationModel.LoginInfo.PasswordConfirm))return n.registrationScope.RegistrationForm.registrationModel_LoginInfo_PasswordConfirm.$invalid=!0,!1;if(n.registrationScope.registrationModel.LoginInfo.Password!==n.registrationScope.registrationModel.LoginInfo.PasswordConfirm)return n.registrationScope.RegistrationForm.registrationModel_LoginInfo_Password.$invalid=!0,n.registrationScope.RegistrationForm.registrationModel_LoginInfo_PasswordConfirm.$invalid=!0,n.registrationScope.RegistrationForm.$valid=!1,n.registrationScope.ShowPasswordValidation=!0,n.registrationScope.DisplayPasswordInstructions=!1,!1;if(n.registrationScope.registrationModel.PrivacyPolicy===!1)return n.registrationScope.showAcceptedPrivacyPolicyError=!0,n.registrationScope.RegistrationForm.$valid=!1,!1;n.registrationScope.RegistrationForm.registrationModel_LoginInfo_FirstName.$invalid===!1&&n.registrationScope.RegistrationForm.registrationModel_LoginInfo_LastName.$invalid===!1&&n.registrationScope.RegistrationForm.registrationModel_LoginInfo_Email.$invalid===!1&&n.registrationScope.RegistrationForm.registrationModel_LoginInfo_Password.$invalid===!1&&n.registrationScope.RegistrationForm.registrationModel_LoginInfo_PasswordConfirm.$invalid===!1&&n.registrationScope.RegistrationForm.registrationModel_LoginInfo_PasswordHint.$invalid===!1&&(n.registrationScope.RegistrationForm.$valid=!0,n.registrationScope.RegistrationFullPageForm&&AddressModule.addressesScope&&!n.registrationScope.HasPhoneNumber()&&(n.registrationScope.RegistrationForm.$valid=!1))}else tt();return!0};n.registrationScope.$on("AddressesScope.AddressValidation",function(){n.registrationScope.ShowValidation=!0;n.registrationScope.registrationModel.PrivacyPolicy=!1;n.registrationScope.RegistrationForm.ServerErrors.Summary||(n.registrationScope.RegistrationForm.ServerErrors.Summary=[]);n.registrationScope.RegistrationForm.ServerErrors.Summary.length&&(n.registrationScope.RegistrationForm.ServerErrors.Summary.$invalid=!0);n.registrationScope.RegistrationForm.registrationModel_LoginInfo_FirstName.$invalid===!1&&n.registrationScope.RegistrationForm.registrationModel_LoginInfo_LastName.$invalid===!1&&n.registrationScope.RegistrationForm.registrationModel_LoginInfo_Email.$invalid===!1&&(n.registrationScope.RegistrationForm.$valid=!0);n.registrationScope.HideLoading()});n.registrationScope.SubmitFullForm=function(){n.registrationScope.registrationModel.PrivacyPolicy=!1;n.registrationScope.registrationModel.LoginInfo.Password="";n.registrationScope.registrationModel.LoginInfo.PasswordConfirm="";n.registrationScope.registrationModel.LoginInfo.PasswordHint="";n.registrationScope.registrationModel.IsGuestShopper=!1};n.registrationScope.NewCustomerRegister=function(){n.registrationScope.showAcceptedPrivacyPolicyError=!1;n.registrationScope.CreateAnAccount?n.registrationScope.Register():(n.registrationScope.PreValidationRules(),n.registrationScope.RegistrationForm.$valid?(n.registrationScope.ShowLoading(AVON.messages.spinner_loading),u.register(n.registrationScope.registrationModel,$("form[name=RegistrationForm]"))):(n.registrationScope.ShowValidation=!0,n.registrationScope.TrackUserValidationErrors(n.registrationScope.RegistrationForm.$error),n.registrationScope.SafeApply()))};n.registrationScope.PrivacyCheckBoxClick=function(){n.registrationScope.showAcceptedPrivacyPolicyError=!1};n.registrationScope.TrackUserValidationErrors=function(t){if(n.registrationScope.IsMobile!==!1){var i=[];t&&$.each(t,function(n,t){t&&(i.push("err-"+n),$.each(t,function(n,t){i.push(t.$name)}))});i=null}};n.registrationScope.ViewPrivacyPolicy=function(){window.open(n.registrationScope.privacyUrl,"AVONPop","toolbar=no,width=640,height=550,status=no,scrollbars=yes,resize=yes,menubar=no").focus()};n.registrationScope.ViewConditionsOfUse=function(){window.open(n.registrationScope.conditionsOfUseUrl,"AVONPop","toolbar=no,width=640,height=550,status=no,scrollbars=yes,resize=yes,menubar=no").focus()};p=this;n.registrationScope.$on("RegistrationService.RegisterResponse",function(t,i){var u,e,s;if(i.ErrorCode===AjaxError.None&&i.Data==="RegisterDuplicateFacebookUser"&&($("#RegistrationModal").trigger("close"),u={AllowExit:!0,Model:null,KeepLoaded:!1,UrlToLoad:"/login/facebookuserresetpassword"},n.registrationScope.OpenDynamicModal("FacebookUserPasswordResetModal",u)),i.ErrorCode===AjaxError.None&&i.Data==="RegisterGuestShopperWithRepId"&&(r.$broadcast("RegistrationScope.DisplayPrivacyPolicy",!0),n.registrationScope.registrationModel.LoginInfo.Password="",n.registrationScope.registrationModel.LoginInfo.PasswordConfirm="",n.registrationScope.registrationModel.LoginInfo.PasswordHint="",n.registrationScope.registrationModel.IsGuestShopper=!1,n.registrationScope.registrationModel.PrivacyPolicy=!1,n.registrationScope.CreateAnAccount=!0,n.registrationScope.RegistrationFullPageForm=!0,n.registrationScope.showAcceptedPrivacyPolicyError=!1,n.registrationScope.DisplayPasswordInstructions=!0,n.registrationScope.RequireFullAccount=!0,n.registrationScope.SafeApply(),n.registrationScope.PreValidationRules(),r.$broadcast("RegistrationScope.GuestShopperWithRepId",!0)),i.ErrorCode===AjaxError.ValidationErrors&&(n.registrationScope.ProcessAjaxValidationErrors(i),$.each(i.ValidationErrors,function(t,i){var r="registrationModel_"+i.FieldName.replace(".","_"),u;n.registrationScope.RegistrationForm!=undefined&&n.registrationScope.RegistrationForm[r]!=undefined&&(n.registrationScope.RegistrationForm[r].$invalid=!0,r=="registrationModel_LoginInfo_Email"&&(n.registrationScope.DisplayEmailError=!0,n.registrationScope.ValidationErrorStyle=!0));u=$(".ErrorSummaryContainer .ValidationSummaryServer span a");o(u)(n.registrationScope)}),n.registrationScope.CreateAnAccount||n.registrationScope.CleanPrivacyPolicy(n.registrationScope.RegistrationForm)),i.Data!=="RegisterGuestShopperWithRepId"&&(i.ErrorCode!==AjaxError.None&&(n.registrationScope.registrationModel.PrivacyPolicy=!1),i.ErrorCode===AjaxError.None&&(p.isModalDisplay===!1||n.registrationScope.RegistrationFullPageForm))){if(n.registrationScope.RegistrationFullPageForm){n.registrationScope.registrationModel.IsGuestShopper||(e={Type:TrackingEventType.CartNewCustAcct,Data:{customerId:AvonModule.AvonScope.Session.Customer.CustomerId}},f.TrackEventItem(e));AddressModule.addressesScope.billingAddress=null;AddressModule.addressesScope.shippingAddress=null;n.registrationScope.ShowLoading(AVON.messages.spinner_loading);r.$broadcast("AddressesScope.SaveAddresses");return}n.registrationScope.CreateAnAccount?AvonModule.AvonScope.postLoginAction&&AVON.RedirectToBazaarVoice&&(i.Processed=!0,setTimeout(function(){AvonModule.AvonScope.ShowLoading(AVON.messages.spinner_loading);AvonModule.AvonScope.postLoginAction()},750)):AvonModule.AvonScope.postLoginAction&&AVON.RedirectToBazaarVoice&&(i.Processed=!0,setTimeout(function(){AvonModule.AvonScope.ShowLoading(AVON.messages.spinner_loading);AvonModule.AvonScope.postLoginAction()},750))}n.registrationScope.IsMobile&&i.ErrorCode==AjaxError.ValidationErrors&&(s=[],$.each(i.ValidationErrors,function(n,t){s.push(t.FieldName+"-"+t.Problem)}))});n.registrationScope.$on("RegistrationScope.ValidatePersonalInfo",function(t,i,u){n.registrationScope.CreateAnAccount=i;n.registrationScope.RequireFullAccount=i;n.registrationScope.PrivacyPolicyFromFullPage=u;n.registrationScope.PreValidationRules()!=!1&&n.registrationScope.RegistrationForm.$valid||(b(),n.registrationScope.registrationModel.PrivacyPolicy=!1,n.registrationScope.SafeApply(),r.$broadcast("RegistrationScope.RegistrationValidation"));r.$broadcast("AddressesScope.ValidateAddresses",n.registrationScope.RegistrationForm.$valid)});n.registrationScope.$on("RegistrationScope.SaveDetails",function(){n.registrationScope.PreValidationRules();n.registrationScope.NewCustomerRegister()});n.registrationScope.$on("RegistrationScopeFullPage.UpdateNotifySpecialOffers",function(t,i){n.registrationScope.registrationModel.NotifySpecialOffers=i});n.registrationScope.updatePhoneNumber=function(){var t=n.registrationScope.registrationModel.LoginInfo.PhoneNumber.FullNumber;t&&t.length>0?(n.registrationScope.registrationModel.LoginInfo.PhoneNumber.Area=n.registrationScope.registrationModel.LoginInfo.PhoneNumber.FullNumber.substring(0,3),n.registrationScope.registrationModel.LoginInfo.PhoneNumber.Prefix=n.registrationScope.registrationModel.LoginInfo.PhoneNumber.FullNumber.substring(3,6),n.registrationScope.registrationModel.LoginInfo.PhoneNumber.Number=n.registrationScope.registrationModel.LoginInfo.PhoneNumber.FullNumber.substring(6,10)):(n.registrationScope.registrationModel.LoginInfo.PhoneNumber.Area="",n.registrationScope.registrationModel.LoginInfo.PhoneNumber.Prefix="",n.registrationScope.registrationModel.LoginInfo.PhoneNumber.Number="");AddressModule.addressesScope.billingAddress.PhoneNumber.Area=n.registrationScope.registrationModel.LoginInfo.PhoneNumber.Area;AddressModule.addressesScope.billingAddress.PhoneNumber.Prefix=n.registrationScope.registrationModel.LoginInfo.PhoneNumber.Prefix;AddressModule.addressesScope.billingAddress.PhoneNumber.Number=n.registrationScope.registrationModel.LoginInfo.PhoneNumber.Number;AddressModule.addressesScope.billingAddress.PhoneNumber.FullNumber=n.registrationScope.registrationModel.LoginInfo.PhoneNumber.FullNumber};n.registrationScope.$on("FormDirective.HidValidation",function(){n.registrationScope.RegistrationForm!=null&&(n.registrationScope.RegistrationForm.ServerErrors=[]);n.registrationScope.ShowValidation&&(n.registrationScope.ShowValidation=!1)});$(function(){var i;c=$("html").hasClass("ie9");w();var t=$(document),u="#DisplayLoginModal",f="#DisplayForgotPassword",o="#Registration",s=function(){$("#RegistrationModal").trigger("close");n.registrationScope.ShowLoginModal()};n.registrationScope.registrationModel||(n.registrationScope.registrationModel={});n.registrationScope.registrationModel.LoginInfo||(n.registrationScope.registrationModel.LoginInfo={});n.registrationScope.registrationModel||(n.registrationScope.registrationModel={});n.registrationScope.registrationModel.LoginInfo||(n.registrationScope.registrationModel.LoginInfo={});AVON.TempModalModel&&AVON.TempModalModel.Email&&(n.registrationScope.registrationModel.LoginInfo.Email=AVON.TempModalModel.Email);t.off("click",u);t.on("click",u,function(){return s(),!1});t.off("click",f);t.on("click",f,function(){return e.displayForgotPassword=!0,e.forgotEmail=n.registrationScope.registrationModel.LoginInfo.Email,s(),!1});i=!1;t.off("keydown",o);t.on("keydown",o,function(t){var r=t.keyCode||t.which;r!==9||n.registrationScope.registrationModel.LoginInfo.FirstName!==""||i||($("[id=registrationModel_LoginInfo_FirstNameInput]").focus(),i=!0)});n.registrationScope.Session.Customer.CustomerType!==CustomerType.RegisteredCustomerAsGuest&&(AVON.IsGuestCheckout||r.$broadcast("RegistrationScope.DisplayPrivacyPolicy",!0),n.registrationScope.Session.Rep.Id>0&&n.registrationScope.SetupFullRegistrationForm());n.registrationScope.Session.Customer.CustomerType===CustomerType.RegisteredCustomerAsGuest&&(n.registrationScope.IsAutoReplenishmentInCart()||AVON.IsGuestCheckout==!1?n.registrationScope.SetupFullRegistrationForm():n.registrationScope.RegisteredUserContinueAsGuest(!1),h.OdsIsDown==!1&&n.registrationScope.Session.Customer.IsEligibleForGuestCheckout===!1&&_.defer(function(){n.registrationScope.QueryString().redirectFromCheckout&&r.$broadcast("RegistrationScope.GuestShopperWithRepId",!0)},250))});n.registrationScope.UpdateCustomerType=function(t){n.registrationScope.SessionService.PostJson("/api/session/updatecustomertype",{customerType:t});n.registrationScope.Session.Customer.CustomerType=t}}return __extends(i,t),i.$inject=["$scope","$rootScope","registrationService","trackingService","loginService","$compile","$timeout","$window"],i}(BaseAngularController);n.RegistrationController=t}(RegistrationModule||(RegistrationModule={}));app.controller("RegistrationController",RegistrationModule.RegistrationController),function(n){var t=function(n){function t(t,i,r){n.call(this,t);this.searchService=i;this.$window=r;var u=t;u.searchTerm=i.searchTerm;u.getSearchResultsForTypeahead=function(n){var t;if(angular.element(".custom-popup-wrapper").scrollTop(0),t=i.sanitizeSearchTerm(n,i.suppliedSearchRegex),!t)return[];var r=i.getCelebrosResults(t),u=i.getArticleResults(t);return r.then(function(n){return u.then(function(t){return n.slice(0,i.maxNumberOfSuggestionsPerType).concat(t.slice(0,i.maxNumberOfSuggestionsPerType))})})};u.onSearchResultSelected=function(n){var t;t=n.type==SearchTermType.Content?n.resultObject.RelativeUrl:i.processSelectedSearchTermByType(u.searchTerm,n);u.IsLeavingFundraiserPageWithoutShopping()||u.RedirectToUrl(t)};u.onSearchResultManual=function(){var n=i.processSelectedSearchTermByType(u.searchTerm);u.RedirectToUrl(n)};u.hasSearchInputValue=function(){return!u.isNullOrWhiteSpace(u.searchTerm.value)};u.clearSearchInputValue=function(){i.searchTerm.value=""};u.onKeyPress=function(n){if(n.which===13){n.preventDefault();u.onSearchResultSelected(n.target.value,null,null,n)}else u.searchTerm.value.length==0&&(i.searchContainsResults=!1)}}return __extends(t,n),t.$inject=["$scope","searchService","$window"],t}(BaseAngularController);n.SearchController=t}(SearchModule||(SearchModule={}));app.controller("SearchController",SearchModule.SearchController),function(n){var t=function(n){function t(t,i){function r(n,t){n.setAttribute("style","height: "+t+"px")}function u(){var n=$("#TabsContainer li .tip-tab.selected"),i;n&&(i=n[0],t.calculateElementHeightForArrow(null,i))}function f(){var t=$(".TipsModule section .ImageContainer .LPMImageContainer img"),n;if(t)for(n=0;n<t.length;n++)t[n].setAttribute("style","max-height: none")}n.call(this,t);t.activeTabNumber=0;t.TabClick=function(n){t.activeTabNumber=n};t.$on("ProductService.ProductsLoaded",function(){i.find(window.location.hash).length>0&&(t.LoadOperationsCount+=1,t.LoadOperationsCount>=2&&_.delay(function(){t.ScrollToTop(i,!1)},1e3))});t.$on("ProductService.PromotionsLoaded",function(){i.find(window.location.hash).length>0&&(t.LoadOperationsCount+=1,t.LoadOperationsCount>=2&&_.delay(function(){t.ScrollToTop(i,!1)},1e3))});t.applySelectedClass=function(n){return t.activeTabNumber===n?"selected":""};t.calculateElementHeightForArrow=function(n,t){var i=n!==null?n.currentTarget:t,f=i.clientHeight,e=i.querySelector(".Arrow"),o=i.querySelector(".Arrow img"),u=f-1;r(e,u);r(o,u)};angular.element(document).ready(function(){u();f()});_.defer(function(){i.find(window.location.hash.substring(1)).length>0&&i.find(window.location.hash.substring(1))[0].click()})}return __extends(t,n),t.$inject=["$scope","$element"],t}(BaseAngularController);n.TipsModuleController=t}(TipsModule||(TipsModule={}));app.controller("TipsModuleController",TipsModule.TipsModuleController);angular.module("ui.select2",[]).value("uiSelect2Config",{}).directive("uiSelect2",["uiSelect2Config","$timeout",function(n,t){$(".touch").length>0&&(n.minimumResultsForSearch=-1);n.width="resolve";n.formatResult=dropdownFormatting;n.formatSelection=dropdownFormatting;n.selectOnBlur=!0;n.openOnEnter=!1;n.escapeMarkup=function(n){return n};n.matcher=function(n,t){return t.toUpperCase().indexOf(n.toUpperCase())>=0};n.sortResults=function(n,t,i){return i.term?(i.term=i.term.toUpperCase(),n.sort(function(n,t){var r=n&&n.text&&n.text.toUpperCase().indexOf(i.term)===0,u=t&&t.text&&t.text.toUpperCase().indexOf(i.term)===0;return r&&!u?-1:!r&&u?1:0})):n};var i={};return n&&angular.extend(i,n),{require:"ngModel",priority:1,compile:function(n,r){var e,u,o,f=n.is("select"),s=angular.isDefined(r.multiple);return n.is("select")&&(u=n.find("optgroup[ng-repeat], optgroup[data-ng-repeat], option[ng-repeat], option[data-ng-repeat]"),u.length&&(o=u.attr("ng-repeat")||u.attr("data-ng-repeat"),e=jQuery.trim(o.split("|")[0]).split(" ").pop())),function(n,u,o,h){var c=angular.extend({},i,n.$eval(o.uiSelect2)),l=function(n){var t;return c.simple_tags?(t=[],angular.forEach(n,function(n){t.push(n.id)})):t=n,t},v=function(n){var t=[];return n?(c.simple_tags?(t=[],angular.forEach(n,function(n){t.push({id:n,text:n})})):t=n,t):t},a;f?(delete c.multiple,delete c.initSelection):s&&(c.multiple=!0);h&&(n.$watch(r.ngModel,function(n,t){n&&n!==t&&h.$render()},!0),h.$render=function(){if(f)u.select2("val",h.$viewValue);else if(c.multiple){var n=h.$viewValue;angular.isString(n)&&(n=n.split(","));u.select2("data",v(n))}else angular.isObject(h.$viewValue)?u.select2("data",h.$viewValue):h.$viewValue?u.select2("val",h.$viewValue):u.select2("data",null)},e&&n.$watch(e,function(n,i){angular.equals(n,i)||t(function(){u.select2("val",h.$viewValue);u.trigger("change");n&&!i&&h.$setPristine&&h.$setPristine(!0)})}),h.$parsers.push(function(n){var t=u.prev();return t.toggleClass("ng-invalid",!h.$valid).toggleClass("ng-valid",h.$valid).toggleClass("ng-invalid-required",!h.$valid).toggleClass("ng-valid-required",h.$valid).toggleClass("ng-dirty",h.$dirty).toggleClass("ng-pristine",h.$pristine),n}),f||(u.bind("change",function(t){(t.stopImmediatePropagation(),n.$$phase||n.$root.$$phase)||n.SafeApply(function(){h.$setViewValue(l(u.select2("data")))})}),c.initSelection&&(a=c.initSelection,c.initSelection=function(n,t){a(n,function(n){var i=h.$pristine;h.$setViewValue(l(n));t(n);i&&h.$setPristine();u.prev().toggleClass("ng-pristine",h.$pristine)})})));u.bind("$destroy",function(){u.select2("destroy")});o.$observe("disabled",function(n){u.select2("enable",!n)});o.$observe("readonly",function(n){u.select2("readonly",!!n)});o.ngMultiple&&n.$watch(o.ngMultiple,function(n){o.$set("multiple",!!n);u.select2(c)});t(function(){if(u.select2(c),u.select2("data",h.$modelValue),h.$render(),!c.initSelection&&!f){var n=h.$pristine;h.$setViewValue(l(u.select2("data")));n&&h.$setPristine();u.prev().toggleClass("ng-pristine",h.$pristine)}})}}}}]);$(document).off("select2-loaded");$(document).on("select2-loaded","select",function(){$(".select2-results").mCustomScrollbar({scrollInertia:0,mouseWheel:!0,keyboard:!0,advanced:{updateOnContentResize:!0,updateOnBrowserResize:!0}})});$(document).off("select2-close");$(document).on("select2-close","select",function(){_.defer(function(){$(".select2-results").mCustomScrollbar("destroy")},200)});$(document).off("select2-open");$(document).on("select2-open","select",function(n){var t=$(n.target),i=t.parents("#QuickView").length>0;i&&$("#select2-drop").css({zIndex:3e4})})