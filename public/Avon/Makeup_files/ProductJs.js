var __extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},MobileProductListModule,ShopByLineNumberServiceModule,ProductDetailModule,ProductListModule,ShopByLineNumberModule;(function(n){var t=function(){function n(){}return n.Brand="B",n.Category="C",n.Search="S",n}();n.DeptType=t})(MobileProductListModule||(MobileProductListModule={})),function(n){(function(n){n[n.None=0]="None";n[n.Filter=1]="Filter";n[n.Sort=2]="Sort"})(n.FacetHeaderType||(n.FacetHeaderType={}));var t=n.FacetHeaderType}(MobileProductListModule||(MobileProductListModule={})),function(n){var t=function(){function n(){}return n.Brands="Brands",n.BrandsES="Marcas",n.Category="Category",n.CategoryES="Categoría",n.Categories="Categories",n.CategoriesES="Categorías",n.Outlet="Outlet",n}();n.GroupName=t}(MobileProductListModule||(MobileProductListModule={})),function(n){(function(n){n[n.None=0]="None";n[n.AddToBag=1]="AddToBag";n[n.SelectVariant=2]="SelectVariant";n[n.NotifyMe=3]="NotifyMe"})(n.PlpActionButton||(n.PlpActionButton={}));var t=n.PlpActionButton}(MobileProductListModule||(MobileProductListModule={})),function(n){(function(n){n[n.None=0]="None";n[n.Adding=1]="Adding";n[n.Added=2]="Added"})(n.AddingToBagStatus||(n.AddingToBagStatus={}));var t=n.AddingToBagStatus}(MobileProductListModule||(MobileProductListModule={})),function(n){var t=function(){function n(){}return n}();n.ProductListProductViewModel=t}(MobileProductListModule||(MobileProductListModule={})),function(n){var t=function(t){function i(r,u,f,e,o,s,h,c,l,a,v,y){var p=this,w;t.call(this,r);this.historyService=y;this.debounceDiscountSliderMaxRight=_.debounce(function(){return p.sliderMaxRight($("#discountSlider > rzslider > span:nth-child(9)"),$("#discountSlider > rzslider > span:nth-child(1) > span"))},250,!1);this.debouncePriceSliderMaxRight=_.debounce(function(){return p.sliderMaxRight($("#priceSlider > rzslider > span:nth-child(9)"),$("#priceSlider > rzslider > span:nth-child(1) > span"))},250,!1);this.sliderMaxRight=function(n,t){var u=parseInt(n.css("left")),i=parseInt(t.css("left"))+parseInt(t.css("width")),r=parseInt(n.css("width"));u>i-r&&n.css("left",i-r+"px")};u.$broadcast("ProductListController.CategoryLoading");n.ProductListScope=r;n.ProductListScope.ratingFacets=[];n.ProductListScope.brandFacets=[];n.ProductListScope.SelectedFacetIds=[];n.ProductListScope.PriceSliderChangeIndex=0;n.ProductListScope.DiscountSliderChangeIndex=0;n.ProductListScope.AllProductCategoryIds=[];n.ProductListScope.StateIndex=0;AVON.Navigation&&(n.ProductListScope.Navigation=AVON.Navigation);n.ProductListScope.categoryDeepLinkModel=AVON.CategoryDeepLinksModel;n.ProductListScope.HasContent=AVON.HasContent;n.ProductListScope.ShowProductList=AVON.ShowProductList==null?!0:AVON.ShowProductList;n.ProductListScope.ProductsLoaded=!1;n.ProductListScope.products=AVON.productList||[];_.each(n.ProductListScope.products,function(t){t.Name=n.ProductListScope.SecureHtml(t.Name)});n.ProductListScope.isShopAllPage=AVON.IsShopAllPage?!0:!1;n.ProductListScope.deptFacetsToShow=[];n.ProductListScope.facetsToShow=[];n.ProductListScope.facetClicked=!1;n.ProductListScope.validRatings=[];n.ProductListScope.selectedFacetHeader=n.FacetHeaderType.None;n.ProductListScope.facetHeaderTypes={None:n.FacetHeaderType.None,Filter:n.FacetHeaderType.Filter,Sort:n.FacetHeaderType.Sort};n.ProductListScope.setRatingFacet=function(t){n.ProductListScope.RatingSelected=!0;p.updateFacetCheckboxes("rating",t,p.updateRatingsFacetList);p.updateDiscountAndPriceModel()};n.ProductListScope.setBrandFacet=function(n,t){p.updateFacetCheckboxes("brand",n,p.updateBrandsFacetList,t)};n.ProductListScope.UpdateSelectedFacets=function(t,r,u,f,e){var s,o,c,l,h;n.ProductListScope.SkipPushState||(n.ProductListScope.SelectedFacetIds=[]);s=t&&t.target.checked;e?s&&AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.indexOf(u)<0?AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.push(u):!s&&AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.indexOf(u)>=0&&(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets=_(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets).without(u)):(o=_(AvonModule.AvonScope.LeftNavigationSelectedFacets).findWhere({Title:r}),o==null&&(o={Title:r,Facets:[],ValidDeptIds:[],IsDepartmentShopBy:e},AvonModule.AvonScope.LeftNavigationSelectedFacets.push(o)),s&&_(o.Facets).chain().pluck("Id").flatten().uniq().value().indexOf(u)<0?(c={Id:u,Text:f},o.Facets.push(c)):!s&&_(o.Facets).chain().pluck("Id").flatten().uniq().value().indexOf(u)>=0&&(o.Facets=_(o.Facets).filter(function(n){return n.Id!=u}),AvonModule.AvonScope.LeftNavigationSelectedFacets=_(AvonModule.AvonScope.LeftNavigationSelectedFacets).filter(function(n){return n.Facets.length>0})));n.ProductListScope.ProductSearchLoaded||n.ProductListScope.SkipPushState||!p.historyService.IsPushStateSupported||(p.hasUserSelectedFacets()||y.PushStateUrl(window.location.href),p.getSelectedFacetIds(),l=n.ProductListScope.GetUpdatedUrl(n.ProductListScope.FacetQueryStringParamName,n.ProductListScope.SelectedFacetIds),h=p.getCurrentPageState(),y.ReplaceState(i.HistoryStateKey,h,l),n.ProductListScope.DeepLinkPageState&&(n.ProductListScope.DeepLinkPageState=h));p.updateFacets();n.ProductListScope.facetClicked=!0;p.updateDiscountAndPriceModel()};y.OnPopState(i.HistoryStateKey,function(t){var i,f;if(n.ProductListScope.SkipPushState=!0,i=t.state,i&&i.Index!==undefined&&(f=n.ProductListScope.PopStateIndex!==undefined?i.Index>0&&i.Index<n.ProductListScope.PopStateIndex?"back":"forward":i.Index>0&&i.Index<n.ProductListScope.StateIndex?"back":"forward",n.ProductListScope.PopStateIndex=i.Index),(!f||f==="back")&&p.pageStateIsUnchanged(i)){n.ProductListScope.ShowLoading("");y.Go(-1);return}var r=app.GetQuerystringParameterByName(n.ProductListScope.FacetQueryStringParamName),h=app.GetQuerystringParameterByName(n.ProductListScope.RatingsQueryStringParamName),e=app.GetQuerystringParameterByName(n.ProductListScope.PriceQueryStringParamName),o=app.GetQuerystringParameterByName(n.ProductListScope.DiscountQueryStringParamName),s=app.GetQuerystringParameterByName(n.ProductListScope.SortByQueryStringParamName);i&&i.SelectedFacetIds?(n.ProductListScope.SelectedFacetIds.length>0&&p.updateFacetsFromState(n.ProductListScope.SelectedFacetIds,r),n.ProductListScope.ratingFacets.length>0&&p.updateRatings(n.ProductListScope.ratingFacets,r),n.ProductListScope.SelectedFacetIds=i.SelectedFacetIds,n.ProductListScope.ratingFacets=i.SelectedRatings,n.ProductListScope.PriceRangeFacetSelected=i.SelectedPriceRange.PriceRangeFacetSelected,n.ProductListScope.DiscountRangeFacetSelected=i.SelectedDiscountRange.DiscountRangeFacetSelected):n.ProductListScope.SelectedFacetIds.length===0&&(_.each(AvonModule.AvonScope.LeftNavigationSelectedFacets,function(t){t.Facets.map(function(t){n.ProductListScope.SelectedFacetIds.push(t.Id)})}),n.ProductListScope.SelectedFacetIds=n.ProductListScope.SelectedFacetIds.concat(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets));n.ProductListScope.PriceRangeFacetSelected&&i&&i.SelectedDiscountRange&&e.length>0?(n.ProductListScope.priceRangeModel.minimumDisplayValue=i.SelectedPriceRange.Minimum,n.ProductListScope.priceRangeModel.maximumDisplayValue=i.SelectedPriceRange.Maximum,n.ProductListScope.priceRangeModel.floor=0,n.ProductListScope.priceRangeModel.ceil=i.SelectedPriceRange.Ceil,n.ProductListScope.onPriceRangeSliderChange(),n.ProductListScope.SafeApply()):(n.ProductListScope.PriceRangeFacetSelected=!1,e.length===0?p.updateDiscountAndPriceModel():(n.ProductListScope.priceRangeModel.minimumDisplayValue=n.ProductListScope.PageLoadPriceRange.minimumDisplayValue,n.ProductListScope.priceRangeModel.maximumDisplayValue=n.ProductListScope.PageLoadPriceRange.maximumDisplayValue,n.ProductListScope.priceRangeModel.floor=0,n.ProductListScope.priceRangeModel.ceil=n.ProductListScope.PageLoadPriceRange.ceil,n.ProductListScope.onPriceRangeSliderChange()),n.ProductListScope.SafeApply());n.ProductListScope.DiscountRangeFacetSelected&&i&&i.SelectedDiscountRange&&o.length>0?(n.ProductListScope.discountLevelModel.minimum=i.SelectedDiscountRange.Minimum,n.ProductListScope.discountLevelModel.maximum=i.SelectedDiscountRange.Maximum,n.ProductListScope.discountLevelModel.floor=0,n.ProductListScope.discountLevelModel.ceil=i.SelectedDiscountRange.Ceil,n.ProductListScope.onDiscountLevelSliderChange(),n.ProductListScope.SafeApply()):(n.ProductListScope.DiscountRangeFacetSelected=!1,o.length===0?p.updateDiscountAndPriceModel():(n.ProductListScope.discountLevelModel.minimum=n.ProductListScope.PageLoadDiscountRange.minimum,n.ProductListScope.discountLevelModel.maximum=n.ProductListScope.PageLoadDiscountRange.maximum,n.ProductListScope.discountLevelModel.floor=0,n.ProductListScope.discountLevelModel.ceil=n.ProductListScope.PageLoadDiscountRange.ceil,n.ProductListScope.onDiscountLevelSliderChange()),n.ProductListScope.SafeApply());s.length===0&&u.$broadcast("productListScope.SortByUpdated",SortOption.None);p.updateRatings(n.ProductListScope.ratingFacets,h);p.updateFacetsFromState(n.ProductListScope.SelectedFacetIds,r);p.updateSort(s);_.defer(function(){n.ProductListScope.SkipPushState=!1;n.ProductListScope.facetClicked=!n.ProductListScope.facetClicked&&r.length>0;n.ProductListScope.RatingSelected=!n.ProductListScope.RatingSelected&&h.length>0;n.ProductListScope.PriceRangeFacetSelected=!n.ProductListScope.PriceRangeFacetSelected&&e.length>0||i&&i.SelectedPriceRange&&i.SelectedPriceRange.PriceRangeFacetSelected;n.ProductListScope.DiscountRangeFacetSelected=!n.ProductListScope.DiscountRangeFacetSelected&&o.length>0||i&&i.SelectedDiscountRange&&i.SelectedDiscountRange.DiscountRangeFacetSelected;n.ProductListScope.SortingSelected=!n.ProductListScope.SortingSelected&&s.length>0})});n.ProductListScope.filterLeftNavByProducts=function(){var t=n.ProductListScope.products;return AvonModule.AvonScope.LeftNavigationSelectedFacets&&AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0&&_.each(AvonModule.AvonScope.LeftNavigationSelectedFacets,function(n){t=_.filter(t,function(t){var i=!0;return _.each(n.Facets,function(n){_.contains(t.Facets,n.Id)||(i=!1)}),i})}),AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets&&AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0&&(t=_.filter(t,function(n){var t=!0;return _.each(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets,function(i){_.contains(n.CategoryIds,i)||(t=!1)}),t})),t=_.filter(t,function(n){return p.productHasSelectedRating(n)})};n.ProductListScope.filterLeftNavRatingsByProducts=function(){var t=n.ProductListScope.products;return AvonModule.AvonScope.LeftNavigationSelectedFacets&&AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0?_.each(AvonModule.AvonScope.LeftNavigationSelectedFacets,function(n){t=_.filter(t,function(t){var i=_(n.Facets).chain().pluck("Id").flatten().uniq().intersection(t.Facets).value().length>0,r=AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length===0||_.intersection(t.CategoryIds,AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets).length>0;return i&&r})}):AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets&&AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0&&(t=_.filter(t,function(n){return AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length===0||_.intersection(n.CategoryIds,AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets).length>0})),t};n.ProductListScope.filterLeftNavDeptByProducts=function(){var t=n.ProductListScope.products;return AvonModule.AvonScope.LeftNavigationSelectedFacets&&AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0?_.each(AvonModule.AvonScope.LeftNavigationSelectedFacets,function(n){t=_.filter(t,function(t){var i=_(n.Facets).chain().pluck("Id").flatten().uniq().intersection(t.Facets).value().length>0;return p.productHasSelectedRating(t)&&i})}):t=_.filter(t,function(n){return p.productHasSelectedRating(n)}),t};n.ProductListScope.filterLeftNavByFacets=function(t,i){var r=_(t).chain().pluck("Facets").flatten().value(),f=r,u,e;return i&&(_.each(r,function(n){n.IsEnabled=!0}),AvonModule.AvonScope.LeftNavigationSelectedFacets&&AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0&&_.each(AvonModule.AvonScope.LeftNavigationSelectedFacets,function(n){var i=_.find(t,function(t){return t.Title===n.Title}),u=i.Facets;r=p.getFacetsFromAvailableProducts(r,!0,u,n)}),AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets&&AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0&&(u=_.find(t,function(n){return n.IsDepartmentShopBy}),e=u.Facets,r=p.getFacetsFromAvailableProducts(r,!1,e,u)),n.ProductListScope.ratingFacets&&n.ProductListScope.ratingFacets.length>0&&(r=p.getFacetsFromAvailableProducts(r,!1,null,null)),f=_.filter(r,function(n){return n.IsEnabled===!0})),f};n.ProductListScope.setFacetHeaderItemActive=function(t,i){t=p.setFacetHeaderItemToNoneIfAlreadyActive(t);t===n.FacetHeaderType.Filter&&(e(function(){r.$broadcast("rzSliderForceRender");p.resetScrollPositionForFilterBody()},100),_.each(n.ProductListScope.brandFacets,function(n){n.selected&&$("#brand-"+n.id).prop("checked",!0)}));t===n.FacetHeaderType.None&&i===!0&&n.ProductListScope.ClearAllFacets();n.ProductListScope.selectedFacetHeader=t};n.ProductListScope.ClearAllFacets=function(){n.ProductListScope.clearBrands();n.ProductListScope.clearCustomShopBys();n.ProductListScope.clearRatings();n.ProductListScope.clearPriceRange();n.ProductListScope.clearDiscountLevel();p.updateFacets();n.ProductListScope.SafeApply()};n.ProductListScope.applyFacetContainerActiveClass=function(n){return p.isFacetHeaderItemActive(n)?"active":""};n.ProductListScope.applySortingActiveClass=function(t){return n.ProductListScope.isSortOptionActive(t)?"active":""};n.ProductListScope.isSortOptionActive=function(t){return n.ProductListScope.selectedSortingValue===parseInt(t)};n.ProductListScope.onDiscountLevelSliderTranslate=function(n){return n+"%"};n.ProductListScope.onPriceRangeSliderTranslate=function(n){return"$"+n};n.ProductListScope.onDiscountLevelSliderChange=function(){return p.applySliderChangeToFacetModel(n.ProductListScope.discountLevelModel,SliderFacetModelNames.discountLevelModel),p.debounceDiscountSliderMaxRight()};n.ProductListScope.onPriceRangeSliderChange=function(){return p.applySliderChangeToFacetModel(n.ProductListScope.priceRangeModel,SliderFacetModelNames.priceRangeModel),p.debouncePriceSliderMaxRight()};n.ProductListScope.showPriceRange=function(){return p.showSliderFacet(SliderFacetModelNames.priceRangeModel)};n.ProductListScope.showDiscountLevel=function(){return p.showSliderFacet(SliderFacetModelNames.discountLevelModel)};n.ProductListScope.showRatings=function(){return n.ProductListScope.ratingFacets.length>0};n.ProductListScope.showBrandsFacetGroup=function(){return n.ProductListScope.brandFacets.length>0};n.ProductListScope.showBrands=function(){return _.any(n.ProductListScope.brandFacets,function(n){return n.selected})};n.ProductListScope.showFacetClear=function(t){if(t==="Brands")return _.any(n.ProductListScope.brandFacets,function(n){return AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.indexOf(n.id)>=0});var i=_(AvonModule.AvonScope.LeftNavigationSelectedFacets).findWhere({Title:t});return i!=null&&i.Facets.length>0};n.ProductListScope.clearFacets=function(t){var r,f,e,u;if(p.getSelectedFacetIds(),r=_(AvonModule.AvonScope.LeftNavigationSelectedFacets).findWhere({Title:t}),t==="Brands"&&(n.ProductListScope.clearBrands(),p.updateFacets(),n.ProductListScope.SafeApply()),r!=null){_.each(r.Facets,function(t){var i=n.ProductListScope.SelectedFacetIds.indexOf(t.Id);i>-1&&n.ProductListScope.SelectedFacetIds.splice(i,1)});for(f in r.Facets)$("input#brand-"+r.Facets[f].Id).prop("checked",!1);r.Facets=[];AvonModule.AvonScope.LeftNavigationSelectedFacets=_(AvonModule.AvonScope.LeftNavigationSelectedFacets).filter(function(n){return n.Facets.length>0});p.updateFacets();n.ProductListScope.facetClicked=!0}!n.ProductListScope.ProductSearchLoaded&&p.historyService.IsPushStateSupported&&(e=n.ProductListScope.GetUpdatedUrl(n.ProductListScope.FacetQueryStringParamName,n.ProductListScope.SelectedFacetIds),p.hasUserSelectedFacets()||y.PushStateUrl(window.location.href),u=p.getCurrentPageState(),y.ReplaceState(i.HistoryStateKey,u,e),n.ProductListScope.DeepLinkPageState&&(n.ProductListScope.DeepLinkPageState=u));p.updateDiscountAndPriceModel()};n.ProductListScope.clearPriceRange=function(){var r=_.reduce(n.ProductListScope.products,function(n,t){return n.push(p.getLowestProductPrice(t)),n},[]),u,t;n.ProductListScope.priceRangeModel&&(n.ProductListScope.priceRangeModel.minimum=Math.floor(_.min(r)),n.ProductListScope.priceRangeModel.maximum=Math.floor(_.max(r)));n.ProductListScope.PriceRangeFacetSelected=!1;p.updateDiscountAndPriceModel();p.updateFacets();!n.ProductListScope.ProductSearchLoaded&&p.historyService.IsPushStateSupported&&(u=n.ProductListScope.GetUpdatedUrl(n.ProductListScope.PriceQueryStringParamName,null),p.hasUserSelectedFacets()||y.PushStateUrl(window.location.href),t=p.getCurrentPageState(),y.ReplaceState(i.HistoryStateKey,t,u),n.ProductListScope.DeepLinkPageState&&(n.ProductListScope.DeepLinkPageState=t))};n.ProductListScope.clearDiscountLevel=function(t,r){var f,e,u;t===void 0&&(t=!0);r===void 0&&(r=!1);f=_.reduce(n.ProductListScope.products,function(n,t){return n.push(p.getProductDiscountPercent(t)),n},[]);n.ProductListScope.discountLevelModel&&(n.ProductListScope.discountLevelModel.minimum=0,n.ProductListScope.discountLevelModel.maximum=_.max(f));n.ProductListScope.DiscountRangeFacetSelected=!1;p.updateDiscountAndPriceModel();p.updateFacets();!n.ProductListScope.ProductSearchLoaded&&p.historyService.IsPushStateSupported&&(e=n.ProductListScope.GetUpdatedUrl(n.ProductListScope.DiscountQueryStringParamName,null),p.hasUserSelectedFacets()||y.PushStateUrl(window.location.href),u=p.getCurrentPageState(),y.ReplaceState(i.HistoryStateKey,u,e),n.ProductListScope.DeepLinkPageState&&(n.ProductListScope.DeepLinkPageState=u))};n.ProductListScope.clearRatings=function(){var r,t;n.ProductListScope.RatingSelected=!1;n.ProductListScope.SkipPushState=!0;n.ProductListScope.ratingFacets.forEach(function(n){p.updateFacetCheckboxes("rating",n,p.updateRatingsFacetList,!1)});n.ProductListScope.SkipPushState=!1;n.ProductListScope.ratingFacets=[];!n.ProductListScope.ProductSearchLoaded&&p.historyService.IsPushStateSupported&&(r=n.ProductListScope.GetUpdatedUrl(n.ProductListScope.RatingsQueryStringParamName,n.ProductListScope.ratingFacets),p.hasUserSelectedFacets()||y.PushStateUrl(window.location.href),t=p.getCurrentPageState(),y.ReplaceState(i.HistoryStateKey,t,r),n.ProductListScope.DeepLinkPageState&&(n.ProductListScope.DeepLinkPageState=t));p.updateDiscountAndPriceModel()};n.ProductListScope.clearBrands=function(t){_.each(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets,function(i){$("#brand-"+i).prop("checked",!1);t&&t.push(i);var r=n.ProductListScope.SelectedFacetIds.indexOf(i);r>-1&&n.ProductListScope.SelectedFacetIds.splice(r,1)});AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets=[]};n.ProductListScope.clearCustomShopBys=function(){_.each(AvonModule.AvonScope.LeftNavigationSelectedFacets,function(t){n.ProductListScope.clearFacets(t.Title)})};n.ProductListScope.isValidRating=function(t){return n.ProductListScope.RatingSelected&&$("#rating-"+t).prop("checked")===!0?!0:n.ProductListScope.validRatings.indexOf(t)>=0};n.ProductListScope.filterProductsByFacets=function(n){return n.visible=p.isProductVisible(n),p.updatedRefinedProductsCount(),n.visible};n.ProductListScope.facetsApplied=function(){return n.ProductListScope.numberOfFacetsUsed=0,n.ProductListScope.showBrands()&&(n.ProductListScope.numberOfFacetsUsed+=1),n.ProductListScope.showRatings()&&(n.ProductListScope.numberOfFacetsUsed+=1),n.ProductListScope.showDiscountLevel()&&(n.ProductListScope.numberOfFacetsUsed+=1),n.ProductListScope.showPriceRange()&&(n.ProductListScope.numberOfFacetsUsed+=1),AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0&&(n.ProductListScope.numberOfFacetsUsed+=1),_(AvonModule.AvonScope.LeftNavigationSelectedFacets).each(function(t){t.Facets.length>0&&(n.ProductListScope.numberOfFacetsUsed+=1)}),n.ProductListScope.numberOfFacetsUsed>0};n.ProductListScope.isFacetModelReady=function(t){return!_.isEmpty(t)&&t.facets.length>0&&!n.ProductListScope.ProductSearchLoaded};n.ProductListScope.defaultSliderModel={discountLevelModel:{},priceRangeModel:{}};n.ProductListScope.IsPromotionsPage=$("body").hasClass("Controller_Promotions");n.ProductListScope.CategoryDepth=AVON.CategoryDepth||1;n.ProductListScope.SelectedCategoryId=AVON.SelectedCategoryId;AvonModule.AvonScope.LeftNavigationSelectedLink=AVON.SelectedCategoryId;AvonModule.AvonScope.LeftNavigationSelectedLinkParent=AVON.SelectedCategoryId;n.ProductListScope.SelectedCategoryName=AVON.SelectedCategoryName;n.ProductListScope.SelectedCategoryType=AVON.SelectedCategoryType;n.ProductListScope.SelectedCategoryBrandType=AVON.SelectedCategoryBrandType;n.ProductListScope.InitialSubcategoryId=AVON.InitialSubCategoryId;n.ProductListScope.InitialSubcategoryName=AVON.InitialSubCategoryName;n.ProductListScope.topCategoryName=AVON.TopCategoryName||"";n.ProductListScope.level3CategoryName=AVON.Level3CategoryName||"";n.ProductListScope.level4CategoryName=AVON.Level4CategoryName||"";w={None:[],Default:["-IsAvailable","ListIndex","-PriceModel.IsOnSale","-HasPromotion","PriceModel.ListPrice"],Price:["-IsAvailable","PriceModel.Price","-PriceModel.IsOnSale","-HasPromotion","PriceModel.ListPrice","ListIndex"],Rating:["-IsAvailable","-HasRating","-Rating","-PriceModel.IsOnSale","-HasPromotion","PriceModel.ListPrice","ListIndex"],Name:["-IsAvailable","Name","-PriceModel.IsOnSale","-HasPromotion","PriceModel.ListPrice"],Relevance:["-IsAvailable","-PriceModel.IsOnSale","-HasPromotion","PriceModel.ListPrice","ListIndex"],SearchRelevance:["ListIndex","-IsAvailable","-PriceModel.IsOnSale","-HasPromotion","PriceModel.ListPrice"],Discount:["-IsAvailable","-PriceModel.DiscountPercent","-HasPromotion","PriceModel.ListPrice"]};n.ProductListScope.selectedSortingValue=SortOption.None;n.ProductListScope.sortingOptions={None:SortOption.None,Default:SortOption.Default,Price:SortOption.Price,Rating:SortOption.Rating,Name:SortOption.Name,Relevance:SortOption.Relevance,Discount:SortOption.Discount,SearchRelevance:SortOption.SearchRelevance};n.ProductListScope.sortingFilterValue=w.Default;AVON.SearchTerm!==undefined?(n.ProductListScope.searchTerm=AVON.SearchTerm,n.ProductListScope.sortingFilterValue=w.SearchRelevance,f.GetProductsBySearch(AVON.SearchTerm)):n.ProductListScope.SelectedCategoryId&&f.GetProductsInCategory(n.ProductListScope.SelectedCategoryId);n.ProductListScope.CustomMessages="";n.ProductListScope.RefinedProductCount=n.ProductListScope.products.length;n.ProductListScope.categoryTotalProductCount=n.ProductListScope.products.length;n.ProductListScope.selectedView="list";n.ProductListScope.getConditionForSelectedCategoryBrandType=function(t,i){i===void 0&&(i=!1);switch(t){case 3:return i?n.ProductListScope.SelectedCategoryBrandType<t:n.ProductListScope.SelectedCategoryBrandType>=t;case 4:if(i)return n.ProductListScope.SelectedCategoryBrandType<t}};n.ProductListScope.anyProductsOnPage=function(){return n.ProductListScope.products.length>0};n.ProductListScope.isBrandDeptType=function(){return n.ProductListScope.DeptType===n.DeptType.Brand};n.ProductListScope.isCategoryDeptType=function(){return n.ProductListScope.DeptType===n.DeptType.Category};n.ProductListScope.searchShowAmountLimit=n.ProductListScope.ClientConfiguration.MobileProductListPageSize;n.ProductListScope.SegmentAsSubSegmentUrl=function(t,i){return t.replace(n.ProductListScope.topCategoryName.formatUrlNugget(),n.ProductListScope.topCategoryName.formatUrlNugget()+"/"+i)};n.ProductListScope.selectSortingValue=function(t,r){var f,e,u;n.ProductListScope.selectedSortingValue=parseInt(t,10);n.ProductListScope.selectedSortingValue===SortOption.Default&&AVON.SearchTerm!==undefined&&(n.ProductListScope.selectedSortingValue=SortOption.SearchRelevance);switch(n.ProductListScope.selectedSortingValue){case SortOption.Price:n.ProductListScope.sortingFilterValue=w.Price;break;case SortOption.Rating:n.ProductListScope.sortingFilterValue=w.Rating;break;case SortOption.Name:n.ProductListScope.sortingFilterValue=w.Name;break;case SortOption.Relevance:n.ProductListScope.sortingFilterValue=w.Relevance;break;case SortOption.SearchRelevance:n.ProductListScope.sortingFilterValue=w.SearchRelevance;break;case SortOption.Default:case SortOption.None:n.ProductListScope.sortingFilterValue=w.Default;break;case SortOption.Discount:n.ProductListScope.sortingFilterValue=w.Discount}r&&r.stopPropagation();n.ProductListScope.ProductSearchLoaded||n.ProductListScope.SkipPushState||!p.historyService.IsPushStateSupported||n.ProductListScope.selectedSortingValue===SortOption.None||(f=[n.ProductListScope.selectedSortingValue],e=n.ProductListScope.GetUpdatedUrl(n.ProductListScope.SortByQueryStringParamName,f),p.hasUserSelectedFacets()||y.PushStateUrl(window.location.href),u=p.getCurrentPageState(),y.ReplaceState(i.HistoryStateKey,u,e),n.ProductListScope.SkipPushState||(n.ProductListScope.SortingSelected=!0),n.ProductListScope.DeepLinkPageState&&(n.ProductListScope.DeepLinkPageState=u));n.ProductListScope.setFacetHeaderItemActive(n.ProductListScope.facetHeaderTypes.None)};n.ProductListScope.showSortByDiscount=function(){return _.isUndefined(n.ProductListScope.discountLevelModel)?!1:n.ProductListScope.discountLevelModel.facets.length>0};n.ProductListScope.IncreaseSearchShowAmountLimit=function(){n.ProductListScope.searchShowAmountLimit+=n.ProductListScope.ClientConfiguration.MobileProductListPageSize;n.ProductListScope.VisibleProductsCount=n.ProductListScope.RefinedProductCount>n.ProductListScope.searchShowAmountLimit?n.ProductListScope.searchShowAmountLimit:n.ProductListScope.RefinedProductCount;n.ProductListScope.VisibleProductsCount>n.ProductListScope.products.length&&(n.ProductListScope.VisibleProductsCount=n.ProductListScope.products.length);n.ProductListScope.SafeApply()};n.ProductListScope.GetSelectedCategoryNameEncoded=function(){switch(n.ProductListScope.CategoryDepth){case 3:return n.ProductListScope.level3CategoryName;case 3:return n.ProductListScope.level4CategoryName;default:return n.ProductListScope.TopLevelCategoryName}};n.ProductListScope.ShowPromotionOverlay=function(n){var i=$(angular.element(n.currentTarget)[0]),t=$(i).parents(".ProductSummary").find(".Expandable");t.hasClass("Expanded")?t.removeClass("Expanded"):t.addClass("Expanded")};n.ProductListScope.HidePromotionOverlay=function(n){var t=$(angular.element(n.currentTarget)[0]);$(t).parents(".Expandable.Expanded").removeClass("Expanded")};n.ProductListScope.GoToProductPage=function(t,i){if($(".ie").length>0){var r=[];$("div[data-product-summary-id]").each(function(){var n=parseInt($(this).attr("data-product-summary-id"),10);n>0&&r.push(n)});n.ProductListScope.SetValueIntoSessionStorage("ListedProductsIdsOrder",r)}n.ProductListScope.RedirectToUrl(n.ProductListScope.Url.Action("Details","Product",i+"-"+t),!0)};n.ProductListScope.IsCategoryOutlet=function(){return n.ProductListScope.TopLevelCategoryName===n.GroupName.Outlet};n.ProductListScope.GetPageHeading=function(){var t=n.ProductListScope.InitialSubcategoryName?n.ProductListScope.InitialSubcategoryName:n.ProductListScope.SelectedCategoryName;return n.ProductListScope.IsCategoryOutlet()&&t.indexOf(n.GroupName.Outlet)<0&&(t+=" "+n.GroupName.Outlet),t};n.ProductListScope.addToBag=function(n){var t={Sku:n,Quantity:1};u.$broadcast("AddToBag",t)};n.ProductListScope.UpdateSelectedCategory=function(t,i,r,u){$(window).scrollTop(0);n.ProductListScope.topCategoryName=t;u?(n.ProductListScope.level3CategoryName=r,n.ProductListScope.level4CategoryName=""):n.ProductListScope.level4CategoryName=r;n.ProductListScope.SelectedCategoryName=r;n.ProductListScope.SelectedCategoryId=i;u&&(n.ProductListScope.ShowLoading(AVON.messages.spinner_loading),f.GetProductsInCategory(n.ProductListScope.SelectedCategoryId));n.ProductListScope.updateContentData();n.ProductListScope.SafeApply();n.ProductListScope.selectedSortingValue=SortOption.None};n.ProductListScope.updateContentData=function(){$(".SupplementHeroHeader").addClass("Hidden");$(".LeftNavPromotionSpot.BottomSpot").addClass("Hidden");f.LoadCategoryHeroAndPromoSpots(n.ProductListScope.topCategoryName,n.ProductListScope.level3CategoryName,n.ProductListScope.level4CategoryName)};n.ProductListScope.hasCategoryChildren=function(t){return n.ProductListScope.GetChildCategories(t.groupName).length>0};n.ProductListScope.isCategoryDepthTopLevel=function(){return n.ProductListScope.GetCategoryDepth()===2};n.ProductListScope.GetCategoryDepth=function(){return n.ProductListScope.level4CategoryName!==""?4:n.ProductListScope.level3CategoryName!==""?3:2};n.ProductListScope.IsProductVisible=function(n){return n.IsVisible};n.ProductListScope.CategoryHasActiveProducts=function(t){return _.contains(n.ProductListScope.AllProductCategoryIds,t)};_.defer(function(){r.$watch("products",function(){_.defer(function(){app.safeLoadImages($(".ProductList"))})},!0);r.$watch("visibleCount",function(){_.defer(function(){app.safeLoadImages($(".ProductList"))})})});n.ProductListScope.$on("ProductListService.HeroSpotLoaded",function(t,i){i.indexOf('<div id="ErrorInfo">')<0&&(n.ProductListScope.rawHeroModule=i,n.ProductListScope.SafeApply(),e(function(){$(".ProductHeroSpot .BodyModuleContainers").children().length===0?$(".SupplementHeroHeader").removeClass("Hidden"):$(".ProductHeroSpot").removeClass("Hidden")}),_.delay(function(){$(".ProductHeroSpot .BodyModuleContainers").children().length===0?$(".SupplementHeroHeader").removeClass("Hidden"):$(".ProductHeroSpot").removeClass("Hidden")},500))});n.ProductListScope.ValidSortOptions=_.reduce(n.ProductListScope.sortingOptions,function(n,t){return n.push(t),n},[]);n.ProductListScope.$on("ProductListService.ProductCategoryLoaded",function(t,i){var f,e,r;n.ProductListScope.AllProductCategoryIds=i.AllProductCategoryIds;i.SelectedCategoryId!==null?(e=_.filter(i.Products,function(t){return _.contains(t.CategoryIds,n.ProductListScope.InitialSubcategoryId)}),f=p.getUniqueProductsList(e)):f=p.getUniqueProductsList(i.Products);n.ProductListScope.products=p.InitializeViewModel(f);p.updateMenuItemGroupNames();p.populateBrandAndCategoryFacets();n.ProductListScope.ShowRatings=p.showRatings();n.ProductListScope.AvailableProductRatings=n.ProductListScope.products.filter(function(t){return n.ProductListScope.ShowProductRating(t)}).map(function(n){return Math.floor(n.Rating)});n.ProductListScope.AvailableProductRatings=_.uniq(n.ProductListScope.AvailableProductRatings);r=p.getDiscountAndPriceModel();r&&(n.ProductListScope.discountLevelModel=r.discountLevelModel,n.ProductListScope.priceRangeModel=r.priceRangeModel,p.setDefaultSliderModelValues(SliderFacetModelNames.discountLevelModel),p.setDefaultSliderModelValues(SliderFacetModelNames.priceRangeModel),n.ProductListScope.PageLoadPriceRange=$.extend({},n.ProductListScope.priceRangeModel),n.ProductListScope.PageLoadDiscountRange=$.extend({},n.ProductListScope.discountLevelModel));n.ProductListScope.HasContent||(n.ProductListScope.ShowProductList=!0);u.$broadcast("ProductListController.CategoryLoaded");n.ProductListScope.ProductsLoaded=!0;n.ProductListScope.searchShowAmountLimit=n.ProductListScope.products.length;n.ProductListScope.RefinedProductCount=n.ProductListScope.products.length;n.ProductListScope.categoryTotalProductCount=n.ProductListScope.products.length;n.ProductListScope.categoryDeepLinkModel&&_.defer(function(){p.processQueryStringFromFacets()});p.updateFacets();n.ProductListScope.SafeApply();n.ProductListScope.PageLoadUrl=document.location.href});n.ProductListScope.$on("productListScope.UpdateDiscountAndPriceModel",function(){p.updateDiscountAndPriceModel()});n.ProductListScope.$on("ProductListService.ProductSearchRedirection",function(t,i){n.ProductListScope.RedirectToUrl(i)});n.ProductListScope.$on("ProductListService.ProductSearchLoaded",function(t,i){var u,f,r;n.ProductListScope.ProductSearchLoaded=!0;n.ProductListScope.products=i.Data.products;n.ProductListScope.IsDeadEndSearch=i.Data.IsDeadEndSearch;n.ProductListScope.CustomMessages=i.Data.CustomMessages;n.ProductListScope.VisibleProductsCount=n.ProductListScope.ClientConfiguration.MobileProductListPageSize>n.ProductListScope.products.length?n.ProductListScope.products.length:20;n.ProductListScope.RefinedProductCount=n.ProductListScope.products.length;n.ProductListScope.categoryTotalProductCount=n.ProductListScope.products.length;n.ProductListScope.ShowRatings=p.showRatings();n.ProductListScope.searchTerm!==undefined&&(n.ProductListScope.IsDeadEndSearch?$("#SearchArea .InputContainer").addClass("NoResults"):$("#HeaderSearchInput").val(n.ProductListScope.searchTerm));n.ProductListScope.ProductsLoaded=!0;n.ProductListScope.SafeApply();n.ProductListScope.selectedSortingValue=SortOption.None;n.ProductListScope.HideLoading();u={SearchResultsCount:n.ProductListScope.products.length,SearchTerm:AVON.SearchTerm};f={Type:TrackingEventType.SearchResults,Data:u};o.TrackEventItem(f);r=h.Initialize();r.qwisersearchsessionid=i.Data.CelebrosSessionId;r.qwisersearchloghandle=i.Data.CelebrosLogHandle;r.pagereferrer=document.referrer;h.LogSearchResult(r);n.ProductListScope.MenuItems=i.Data.leftNavigationModel.MenuItems;n.ProductListScope.SubCategoryId=i.Data.leftNavigationModel.SubCategoryId;n.ProductListScope.TopLevelCategoryName=i.Data.leftNavigationModel.TopLevelCategoryName;n.ProductListScope.DeptType=i.Data.leftNavigationModel.DeptType;p.updateMenuItemGroupNames();p.updateFacets();n.ProductListScope.SafeApply()});n.ProductListScope.ShowAllProducts=function(){n.ProductListScope.HasContent=!1;n.ProductListScope.ShowProductList=!0;y.PushState(i.HistoryStateKey,null,"#all-products");n.ProductListScope.SafeApply();y.OnPopState(i.HistoryStateKey,function(){n.ProductListScope.HasContent=!0;n.ProductListScope.ShowProductList=!1;n.ProductListScope.SafeApply()})};AVON.LeftNavigation&&(n.ProductListScope.MenuItems=AVON.LeftNavigation.MenuItems,n.ProductListScope.SubCategoryId=AVON.LeftNavigation.SubCategoryId,n.ProductListScope.TopLevelCategoryName=AVON.LeftNavigation.TopLevelCategoryName,n.ProductListScope.Level3CategoryName=AVON.Level3CategoryName,n.ProductListScope.DeptType=AVON.LeftNavigation.DeptType);n.ProductListScope.AllGroupNames=[];n.ProductListScope.CategoryGroupNames=[];n.ProductListScope.GetCategoryGroups=function(){return _.filter(n.ProductListScope.AllGroupNames,function(t){return n.ProductListScope.IsGroupNameCategories(t.groupName)})};n.ProductListScope.GetBrandGroups=function(){return _.filter(n.ProductListScope.AllGroupNames,function(t){return n.ProductListScope.IsGroupNameBrands(t.groupName)})};n.ProductListScope.GetShopByGroups=function(t){var i=_.filter(n.ProductListScope.AllGroupNames,function(i){return!n.ProductListScope.IsGroupNameCategories(i.groupName)&&(t||!n.ProductListScope.IsGroupNameBrands(i.groupName))});return n.ProductListScope.DeptType===n.DeptType.Brand&&_.each(i,function(t){n.ProductListScope.IsGroupNameBrands(t.groupName)&&(t.Caption=n.ProductListScope.LanguageCode=="es"?"Submarcas":"Sub-Brands")}),i};n.ProductListScope.GetChildCategories=function(t){var r=_.find(n.ProductListScope.AllGroupNames,function(n){return n.groupName===t}),i,u;return r?(i=r.menuItem.GroupedChildren[r.groupName],n.ProductListScope.IsGroupTypeCategories(t)&&n.ProductListScope.level3CategoryName&&(u=_.find(i,function(t){return t.Id==n.ProductListScope.SelectedCategoryId}),u&&(i=u.Children)),_.filter(i,function(n){return n.IncludeInLeftNavigation})):[]};n.ProductListScope.GetFeaturedCategories=function(t){var i=_.find(n.ProductListScope.AllGroupNames,function(n){return n.groupName===t}),r;return i?(r=i.menuItem.Featured,_.filter(r,function(n){return n.IncludeInLeftNavigation})):[]};n.ProductListScope.RedirectToCategory=function(t){n.ProductListScope.RedirectToUrl(t.Url,!0)};n.ProductListScope.IsGroupTypeCategories=function(t){return n.ProductListScope.DeptType!==n.DeptType.Search&&n.ProductListScope.SubCategoryId==0||n.ProductListScope.DeptType===n.DeptType.Brand&&n.ProductListScope.IsGroupNameBrands(t)||n.ProductListScope.DeptType===n.DeptType.Category&&n.ProductListScope.IsGroupNameCategories(t)};n.ProductListScope.IsGroupNameCategories=function(t){return t===n.GroupName.Categories||t===n.GroupName.CategoriesES||t===n.GroupName.Category||t==n.GroupName.CategoryES};n.ProductListScope.IsGroupNameBrands=function(t){return t===n.GroupName.Brands||t===n.GroupName.BrandsES};n.ProductListScope.$on("ProductListService.ProductSearchLoaded",function(t,i){n.ProductListScope.MenuItems=i.Data.leftNavigationModel.MenuItems;n.ProductListScope.SubCategoryId=i.Data.leftNavigationModel.SubCategoryId;n.ProductListScope.TopLevelCategoryName=i.Data.leftNavigationModel.TopLevelCategoryName;n.ProductListScope.DeptType=i.Data.leftNavigationModel.DeptType;p.updateMenuItemGroupNames();p.updateFacets();n.ProductListScope.SafeApply()});n.ProductListScope.ToggleMenu=function(t){n.ProductListScope.FilterMenuSelected=n.ProductListScope.FilterMenuSelected!==t?t:"None"};n.ProductListScope.SelectSubcategory=function(t){n.ProductListScope.ToggleMenu("");n.ProductListScope.ShowLoading(AVON.messages.spinner_loading);n.ProductListScope.RedirectToUrl(t.Url)};n.ProductListScope.ShowLinkGroup=function(t){var i=_(t.Links).findWhere({Id:n.ProductListScope.SelectedCategoryId});return i!=undefined&&t.Title.toLocaleLowerCase()!="featured"&&t.Title.toLocaleLowerCase()!="destacado"&&t.Links.length>0&&i.SubLinks.length>0};n.ProductListScope.GetValidLinks=function(t){var i=_(t.Links).findWhere({Id:n.ProductListScope.SelectedCategoryId});return i!=undefined?i.SubLinks:[]};n.ProductListScope.FacetsToShow=function(){return _(n.ProductListScope.products).chain().pluck("Facets").flatten().uniq().value()};n.ProductListScope.DepartmentFacetsToShow=function(){return _(n.ProductListScope.products).chain().pluck("CategoryIds").flatten().uniq().value()};n.ProductListScope.filterFacets=function(t){return n.ProductListScope.FacetsToShow().indexOf(t.Id)>=0};n.ProductListScope.filterDepartmentFacets=function(t){return n.ProductListScope.DepartmentFacetsToShow().indexOf(t.Id)>=0};n.ProductListScope.filterShopBysByDepartment=function(t){var i=t.IsDepartmentShopBy||t.ValidDeptIds.indexOf(AvonModule.AvonScope.LeftNavigationSelectedLink)>=0,r=t.IsDepartmentShopBy?c("filter")(t.Facets,n.ProductListScope.filterDepartmentFacets).length>0:c("filter")(t.Facets,n.ProductListScope.filterFacets).length>0;return i&&r};n.ProductListScope.isEnabledFacet=function(t,i,r){if(r===void 0&&(r=!1),!n.ProductListScope.facetClicked&&!n.ProductListScope.RatingSelected||$("#brand-"+i.Id).prop("checked")===!0)return!0;var u;return u=r?n.ProductListScope.deptFacetsToShow.indexOf(i.Id)>-1:n.ProductListScope.facetsToShow.indexOf(i.Id)>-1,i.IsEnabled=u,u};n.ProductListScope.ShowWishListIcon=function(){return n.ProductListScope.Session.Customer.IsLoggedIn};n.ProductListScope.GetCategorySelectorAnalyticsValue=function(n){var t;return AVON.TopCategoryName?t=AVON.TopCategoryName:AVON.breadcrumbs.length>1&&(t=AVON.breadcrumbs[1].Text),t.toLowerCase()+(n?"-qcklnks-ftrs":"-qcklnks-cat")};n.ProductListScope.GetCategoryLinkAnalyticsValue=function(){for(var n=[],t=0;t<arguments.length;t++)n[+t]=arguments[t];return AVON.TopCategoryName?n.unshift(AVON.TopCategoryName):AVON.breadcrumbs.length>1&&n.unshift(AVON.breadcrumbs[1].Text),l.GetAnalyticsAttributeValue("navbtm",n)};n.ProductListScope.SelectVariantClicked=function(n){n.VariantsContainerOpen=!n.VariantsContainerOpen;n.VariantsContainerOpen&&(n.ShowVariantsList=!0,n.VariantGroups&&n.VariantGroups.length!=0||(n.LoadingVariants=!0,s.GetProductWithId(n.Id).then(function(t){n.VariantGroups=p.InitializeVariantsViewModel(t.VariantGroups);n.LoadingVariants=!1})))};n.ProductListScope.VariantsCloseButtonClicked=function(n){n.VariantsContainerOpen=!1};n.ProductListScope.VariantButtonClicked=function(n,t,i){t.SelectedVariant=i;t.ShowVariantsList=!1;var r=$(n.currentTarget).closest(".ProductSummary").offset().top-$("#FixedMenu").height();$("html, body").stop().animate({scrollTop:r},500,"swing")};n.ProductListScope.VariantSelectButtonClicked=function(n){n.ShowVariantsList=!0};n.ProductListScope.AddToBagButtonClicked=function(t){var e=2e3,u=new AddBagItem,i,f;u.Quantity=1;t.HasVariants&&t.TotalVariants>1?(i=t.SelectedVariant,u.Sku=i.Sku):u.Sku=t.Sku;f=_.throttle(function(i){t.AddingToBagStatus=i;r.SafeApply();i==n.AddingToBagStatus.Added&&_.delay(function(){t.AddingToBagStatus=n.AddingToBagStatus.None;r.SafeApply()},e)},1e3);f(n.AddingToBagStatus.Adding);a.addItemToBag(u,!1).then(function(){t.HasVariants&&t.TotalVariants>1?i.AddedToBagCount=i.AddedToBagCount?i.AddedToBagCount+1:1:t.AddedToBagCount=t.AddedToBagCount?t.AddedToBagCount+1:1;f(n.AddingToBagStatus.Added)})};n.ProductListScope.DisplayVariantLineNumber=function(n,t){return ProductHelper.DisplayVariantLineNumber(n,t)};n.ProductListScope.IsVariantAvailableSoon=function(n){return n.Availability==CanBuy.AvailableSoon};n.ProductListScope.GetVariantSelectPlaceholderText=function(n,t){return n+" "+AVON.VariantTypesLocalized[t].toLocaleLowerCase()};n.ProductListScope.GetVariantName=function(t,i){var r=""+t.VariantValue+ProductHelper.DisplayVariantLineNumber(t,!0);return n.ProductListScope.IsVariantAvailableSoon(t)&&(r+=" — "+i),r};n.ProductListScope.NotifyMeButtonClicked=function(n,t){return v.OpenNotifyMeModal(n,t)};n.ProductListScope.GetButtonToDisplay=function(t){return t.PriceModel.AutoReplenishmentPrice?n.PlpActionButton.None:t.IsAvailable||t.CanBuy!=CanBuy.AvailableSoon?t.HasVariants&&t.TotalVariants>1?n.PlpActionButton.SelectVariant:n.PlpActionButton.AddToBag:n.PlpActionButton.NotifyMe}}return __extends(i,t),i.prototype.InitializeViewModel=function(t){var i=this;return _.map(t,function(t){var r=t;return r.SelectedVariant=null,r.AddedToBagCount=0,r.AddingToBagStatus=n.AddingToBagStatus.None,r.ShowVariantsList=!1,r.VariantsContainerOpen=!1,r.LoadingVariants=!1,r.VariantGroups=i.InitializeVariantsViewModel(t.VariantGroups),r})},i.prototype.InitializeVariantsViewModel=function(n){return _.map(n,function(n){var t=n;return t.Variants=_.map(t.Variants,function(n){var t=n;return t.AddedToBagCount=0,t}),t})},i.prototype.getVisibleUniqueProducts=function(){var t=n.ProductListScope.products;return(AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0||AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0||n.ProductListScope.ratingFacets&&n.ProductListScope.ratingFacets.length>0)&&(t=_.filter(n.ProductListScope.products,function(t){return n.ProductListScope.filterProductsByFacets(t)})),t},i.prototype.getDiscountAndPriceModel=function(){var t=this,f=this.getVisibleUniqueProducts(),n=_.reduce(f,function(n,i){var r,u;return i.PriceModel.DiscountPercent>0&&(r=t.facetValueExists(n.discountLevelFacets,i.PriceModel.DiscountPercent),r||n.discountLevelFacets.push({isChecked:!1,value:i.PriceModel.DiscountPercent,facetModelName:SliderFacetModelNames.discountLevelModel})),u=t.facetValueExists(n.priceRangeFacets,t.getLowestProductPrice(i)),u||n.priceRangeFacets.push({isChecked:!1,value:t.getLowestProductPrice(i),facetModelName:SliderFacetModelNames.priceRangeModel}),n},{discountLevelFacets:[],priceRangeFacets:[]}),r=_.max(n.discountLevelFacets,this.getMinimumMaximumPriceIterator).value,i;_.isUndefined(r)&&(r=0);i={facets:this.sortFacetsByValue(n.discountLevelFacets),minimum:0,maximum:r,floor:0};this.debounceDiscountSliderMaxRight();var e=Math.floor(_.min(n.priceRangeFacets,this.getMinimumMaximumPriceIterator).value),o=Math.ceil(_.max(n.priceRangeFacets,this.getMinimumMaximumPriceIterator).value),u={facets:this.sortFacetsByValue(n.priceRangeFacets),minimum:Math.floor(_.min(n.priceRangeFacets,this.getMinimumMaximumPriceIterator).value),maximum:Math.ceil(_.max(n.priceRangeFacets,this.getMinimumMaximumPriceIterator).value),minimumDisplayValue:e,maximumDisplayValue:o,floor:0};return this.debouncePriceSliderMaxRight(),i.ceil=i.maximum,u.ceil=u.maximum,{discountLevelModel:i,priceRangeModel:u}},i.prototype.setDefaultSliderModelValues=function(t){n.ProductListScope.defaultSliderModel[t].maximum=n.ProductListScope[t].maximum;n.ProductListScope.defaultSliderModel[t].minimum=n.ProductListScope[t].minimum},i.prototype.sortFacetsByValue=function(n){return _.sortBy(n,function(n){return n.value})},i.prototype.getMinimumMaximumPriceIterator=function(n){return n.value},i.prototype.getLowestProductPrice=function(n){var t=n.PriceModel.SalePrice,i=n.PriceModel.ListPrice;return t>0?t:i},i.prototype.processQueryStringFromFacets=function(){var t=this;_.each(n.ProductListScope.categoryDeepLinkModel.Filters,function(i){switch(i.Name.toLowerCase()){case n.ProductListScope.RatingsQueryStringParamName:t.processRatingsFacetDeepLinks(i.Value);break;case n.ProductListScope.DiscountQueryStringParamName:t.processFacetModelDeepLinks(SliderFacetModelNames.discountLevelModel,i.Value);break;case n.ProductListScope.PriceQueryStringParamName:t.processFacetModelDeepLinks(SliderFacetModelNames.priceRangeModel,i.Value);break;case n.ProductListScope.FacetQueryStringParamName:t.processBrandFacetDeepLinks(i.Value);break;case n.ProductListScope.SortByQueryStringParamName:t.processSortByDeepLinks(i.Value)}});n.ProductListScope.categoryDeepLinkModel&&n.ProductListScope.categoryDeepLinkModel.Filters&&(n.ProductListScope.categoryDeepLinkModel.Filters=[])},i.prototype.processRatingsFacetDeepLinks=function(t){var i=this;n.ProductListScope.SkipPushState=!0;_.each(t,function(t){n.ProductListScope.AvailableProductRatings&&n.ProductListScope.AvailableProductRatings.indexOf(t)>-1&&i.updateFacetCheckboxes("rating",t,i.updateRatingsFacetList,!0)});this.updateDiscountAndPriceModel();n.ProductListScope.SkipPushState=!1},i.prototype.updateFacetCheckboxes=function(n,t,i,r){var f=$("#"+n+"-"+t),u;i(t);r===null?(u=f.prop("checked"),u=!u):f.prop("checked",r)},i.prototype.processBrandFacetDeepLinks=function(t){var r=this;_.defer(function(){n.ProductListScope.SkipPushState=!0;_.each(t,function(n){var t=$("#brand-"+n);t.length>0&&t.trigger("click")});n.ProductListScope.SkipPushState=!1;n.ProductListScope.DeepLinkPageState=r.getCurrentPageState();r.historyService.ReplaceState(i.HistoryStateKey,n.ProductListScope.DeepLinkPageState,window.location.href)})},i.prototype.processSortByDeepLinks=function(t){if(t&&t.length>0){var i=_.indexOf(n.ProductListScope.ValidSortOptions,t[0])!==-1;i&&(n.ProductListScope.selectedSortingValue=t[0],n.ProductListScope.selectSortingValue(n.ProductListScope.selectedSortingValue.toString()))}},i.prototype.processFacetModelDeepLinks=function(t,i){var h=_.any(i,function(n){return n===null});if(!h){var s=!1,r=n.ProductListScope[t],u=i[0],f=i[1],e,o;t===SliderFacetModelNames.priceRangeModel&&(e=this.centsToDollars(u),o=this.centsToDollars(f),u=parseFloat(e),f=parseFloat(o));u>=r.floor&&u<=r.maximum&&(s=!0,r.minimum=u,e&&(r.minimumDisplayValue=Math.floor(e)));f<=r.maximum&&f>=r.minimum&&(s=!0,r.maximum=f,o&&(r.maximumDisplayValue=Math.ceil(o)));_.each(r.facets,function(n){n.value>=r.minimum&&n.value<=r.maximum&&(n.isChecked=!0)});s&&(this.updateFacets(),t===SliderFacetModelNames.discountLevelModel&&(n.ProductListScope.DiscountRangeFacetSelected=!0,n.ProductListScope.PageLoadDiscountRange=$.extend({},r)),t===SliderFacetModelNames.priceRangeModel&&(n.ProductListScope.PriceRangeFacetSelected=!0,n.ProductListScope.PageLoadPriceRange=$.extend({},r)))}},i.prototype.centsToDollars=function(n){return parseInt(n)===0?n:(parseInt(n,10)/100).toFixed(2)},i.prototype.updateDiscountAndPriceModel=function(){var t=this.getDiscountAndPriceModel();t&&(n.ProductListScope.DiscountRangeFacetSelected||(n.ProductListScope.discountLevelModel=t.discountLevelModel,this.setDefaultSliderModelValues(SliderFacetModelNames.discountLevelModel),n.ProductListScope.PageLoadDiscountRange=$.extend({},n.ProductListScope.discountLevelModel)),n.ProductListScope.PriceRangeFacetSelected||(n.ProductListScope.priceRangeModel=t.priceRangeModel,this.setDefaultSliderModelValues(SliderFacetModelNames.priceRangeModel),n.ProductListScope.PageLoadPriceRange=$.extend({},n.ProductListScope.priceRangeModel)))},i.prototype.updateFacets=function(){var i,r,u,t;this.facetsLogicUseAnd()?(t=n.ProductListScope.ProductSearchLoaded||AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0||AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0||n.ProductListScope.ratingFacets.length>0?n.ProductListScope.filterLeftNavByProducts():n.ProductListScope.products,n.ProductListScope.facetsToShow=_(t).chain().pluck("Facets").flatten().value(),n.ProductListScope.deptFacetsToShow=_(t).chain().pluck("CategoryIds").flatten().uniq().value(),n.ProductListScope.validRatings=_(t).chain().filter(function(t){return n.ProductListScope.ShowProductRating(t)}).map(function(n){return Math.floor(n.Rating+.3)}).uniq().sortBy(function(n){return n}).value()):(i=n.ProductListScope.ProductSearchLoaded||AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0||AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0?n.ProductListScope.filterLeftNavRatingsByProducts():n.ProductListScope.products,r=n.ProductListScope.ProductSearchLoaded||AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0||n.ProductListScope.ratingFacets.length>0?n.ProductListScope.filterLeftNavDeptByProducts():n.ProductListScope.products,n.ProductListScope.facetsToShow=[],AVON.Navigation&&AVON.Navigation.ShopBys&&(u=n.ProductListScope.ProductSearchLoaded||AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0||AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0||n.ProductListScope.ratingFacets.length>0?n.ProductListScope.filterLeftNavByFacets(AVON.Navigation.ShopBys,!0):n.ProductListScope.filterLeftNavByFacets(AVON.Navigation.ShopBys,!1),n.ProductListScope.facetsToShow=_(u).chain().pluck("Id").flatten().uniq().value()),n.ProductListScope.deptFacetsToShow=_(r).chain().pluck("CategoryIds").flatten().uniq().value(),n.ProductListScope.validRatings=_(i).chain().filter(function(t){return n.ProductListScope.ShowProductRating(t)}).map(function(n){return Math.floor(n.Rating+.3)}).uniq().sortBy(function(n){return n}).value())},i.prototype.facetsLogicUseAnd=function(){return!0},i.prototype.productHasSelectedRating=function(t){if(this.facetsLogicUseAnd()){for(var i in n.ProductListScope.ratingFacets)return n.ProductListScope.ratingFacets[i]!==Math.floor(t.Rating+.3)?!1:n.ProductListScope.ShowProductRating(t);return!0}return n.ProductListScope.ratingFacets.length===0||n.ProductListScope.ShowProductRating(t)&&_.contains(n.ProductListScope.ratingFacets,Math.floor(t.Rating+.3))},i.prototype.updateRatingsFacetList=function(t){var u,r;_.contains(n.ProductListScope.ratingFacets,t)?n.ProductListScope.ratingFacets=_.reject(n.ProductListScope.ratingFacets,function(n){return n===t}):n.ProductListScope.ratingFacets.push(t);n.ProductListScope.ProductSearchLoaded||n.ProductListScope.SkipPushState||!this.historyService.IsPushStateSupported||(u=n.ProductListScope.GetUpdatedUrl(n.ProductListScope.RatingsQueryStringParamName,n.ProductListScope.ratingFacets),this.hasUserSelectedFacets()||this.historyService.PushStateUrl(window.location.href),r=this.getCurrentPageState(),this.historyService.ReplaceState(i.HistoryStateKey,r,u),n.ProductListScope.DeepLinkPageState&&(n.ProductListScope.DeepLinkPageState=r));this.updateFacets()},i.prototype.updateBrandsFacetList=function(t){_.each(n.ProductListScope.brandFacets,function(n){n.id==t&&(n.selected=!n.selected)});this.updateFacets()},i.prototype.setFacetHeaderItemToNoneIfAlreadyActive=function(t){return this.isFacetHeaderItemActive(t)&&(t=n.FacetHeaderType.None),t},i.prototype.resetScrollPositionForFilterBody=function(){$("#filter-body").scrollTop(0)},i.prototype.getFacetsFromAvailableProducts=function(t,i,r,u){var f=this,e=_.filter(n.ProductListScope.products,function(n){var t=!0,r;return i&&(t=_(u.Facets).chain().pluck("Id").flatten().uniq().intersection(n.Facets).value().length>0),r=AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length===0||_.intersection(n.CategoryIds,AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets).length>0,f.productHasSelectedRating(n)&&t&&r}),o=_(e).chain().pluck("Facets").flatten().uniq().value();return _.each(t,function(n){var t=_.any(o,function(t){return t===n.Id}),i=_.any(r,function(t){return t.Id===n.Id});t||i||(n.IsEnabled=!1)}),t},i.prototype.productIsVisible=function(n){var t,i;if(this.facetsLogicUseAnd()){for(t in AvonModule.AvonScope.LeftNavigationSelectedFacets)if(AvonModule.AvonScope.LeftNavigationSelectedFacets[t].Facets.length>0)for(i in AvonModule.AvonScope.LeftNavigationSelectedFacets[t].Facets)if(!_.contains(n.Facets,AvonModule.AvonScope.LeftNavigationSelectedFacets[t].Facets[i].Id))return!1}else for(t in AvonModule.AvonScope.LeftNavigationSelectedFacets)if(AvonModule.AvonScope.LeftNavigationSelectedFacets[t].Facets.length>0&&_(AvonModule.AvonScope.LeftNavigationSelectedFacets[t].Facets).chain().pluck("Id").flatten().uniq().intersection(n.Facets).value().length===0)return!1;return!0},i.prototype.productIsVisibleByDepartment=function(n){if(this.facetsLogicUseAnd()){for(var t in AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets)if(!_.contains(n.CategoryIds,AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets[t]))return!1;return!0}return AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length===0||_.intersection(n.CategoryIds,AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets).length>0},i.prototype.isProductVisible=function(n){var t=this.productIsVisible(n),i=this.productIsVisibleByDepartment(n);return this.productHasSelectedRating(n)&&this.productHasSelectedBrand(n)&&this.productInBetweenSelectedDiscounts(n)&&this.productInBetweenSelectedPrice(n)&&t&&i},i.prototype.updatedRefinedProductsCount=function(){n.ProductListScope.RefinedProductCount=_.filter(n.ProductListScope.products,function(n){return n.visible}).length;n.ProductListScope.VisibleProductsCount=n.ProductListScope.searchShowAmountLimit>n.ProductListScope.RefinedProductCount?n.ProductListScope.RefinedProductCount:n.ProductListScope.searchShowAmountLimit>n.ProductListScope.ClientConfiguration.MobileProductListPageSize?n.ProductListScope.searchShowAmountLimit:n.ProductListScope.ClientConfiguration.MobileProductListPageSize},i.prototype.productHasSelectedBrand=function(t){var i=_.reduce(n.ProductListScope.brandFacets,function(n,t){return t.selected&&n.push(t.id),n},[]);return i.length===0?!0:_.any(i,function(n){return _.any(t.CategoryIds,function(t){return t===n})})},i.prototype.productInBetweenSelectedDiscounts=function(t){return _.isUndefined(n.ProductListScope.discountLevelModel)||!n.ProductListScope.DiscountRangeFacetSelected?!0:t.DiscountPercent>=n.ProductListScope.discountLevelModel.minimum&&t.DiscountPercent<=n.ProductListScope.discountLevelModel.maximum?!0:!1},i.prototype.isFacetHeaderItemActive=function(t){return n.ProductListScope.selectedFacetHeader===t},i.prototype.dollarsToCents=function(n){return(n*100).toFixed(2)},i.prototype.sliderValueChangedFromDefault=function(t){return _.isUndefined(n.ProductListScope[t])?!1:n.ProductListScope[t].minimum!==n.ProductListScope.defaultSliderModel[t].minimum||n.ProductListScope[t].maximum!==n.ProductListScope.defaultSliderModel[t].maximum},i.prototype.applySliderChangeToFacetModel=function(t,r){var e,o,f,u,h,c,s;r===SliderFacetModelNames.priceRangeModel&&(e=t.minimumDisplayValue,o=t.maximumDisplayValue,t.minimum=e,t.maximum=o);f=this.sliderValueChangedFromDefault(r);r===SliderFacetModelNames.priceRangeModel?n.ProductListScope.PriceRangeFacetSelected=f:n.ProductListScope.DiscountRangeFacetSelected=f;n.ProductListScope.ProductSearchLoaded||n.ProductListScope.SkipPushState||!this.historyService.IsPushStateSupported||(u=[],h=r===SliderFacetModelNames.priceRangeModel?n.ProductListScope.PriceQueryStringParamName:n.ProductListScope.DiscountQueryStringParamName,f&&(r===SliderFacetModelNames.priceRangeModel?(u.push(Math.floor(this.dollarsToCents(e))),u.push(Math.ceil(this.dollarsToCents(o)))):(u.push(t.minimum),u.push(t.maximum))),c=n.ProductListScope.GetUpdatedUrl(h,u),this.hasUserSelectedFacets()||this.historyService.PushStateUrl(window.location.href),s=this.getCurrentPageState(),this.historyService.ReplaceState(i.HistoryStateKey,s,c),n.ProductListScope.DeepLinkPageState&&(n.ProductListScope.DeepLinkPageState=s));n.ProductListScope[r]=t;_.each(n.ProductListScope[r].facets,function(n){n.value>=t.minimum&&n.value<=t.maximum&&(n.isChecked=!0)})},i.prototype.getProductDiscountPercent=function(n){return n.PriceModel.DiscountPercent>0?n.PriceModel.DiscountPercent:0},i.prototype.showSliderFacet=function(t){return!_.isUndefined(n.ProductListScope[t])&&!isNaN(n.ProductListScope[t].minimum)&&!isNaN(n.ProductListScope.defaultSliderModel[t].minimum)&&!isNaN(n.ProductListScope[t].maximum)&&!isNaN(n.ProductListScope.defaultSliderModel[t].maximum)?n.ProductListScope[t].minimum!==n.ProductListScope.defaultSliderModel[t].minimum||n.ProductListScope[t].maximum!==n.ProductListScope.defaultSliderModel[t].maximum:!1},i.prototype.productInBetweenSelectedPrice=function(t){if(_.isUndefined(n.ProductListScope.priceRangeModel)||!n.ProductListScope.PriceRangeFacetSelected||n.ProductListScope.priceRangeModel.minimum===0&&n.ProductListScope.priceRangeModel.maximum===0)return!0;var i=this.getLowestProductPrice(t);return i>=n.ProductListScope.priceRangeModel.minimum&&i<=n.ProductListScope.priceRangeModel.maximum?!0:!1},i.prototype.updateMenuItemGroupNames=function(){var e=[],o=[],t,i,r,u,f;if(n.ProductListScope.MenuItems)for(t=0;t<n.ProductListScope.MenuItems.length;t++)for(i=n.ProductListScope.MenuItems[t],r=0;r<i.GroupNames.length;r++)u=i.GroupNames[r],f={menuItem:i,groupName:u,Caption:u},o.push(f),n.ProductListScope.IsGroupTypeCategories(u)&&(n.ProductListScope.level4CategoryName||e.push(f));n.ProductListScope.CategoryGroupNames=e;n.ProductListScope.AllGroupNames=o},i.prototype.populateBrandAndCategoryFacets=function(){var t=this.getCategoriesBrandsIdsForProducts();n.ProductListScope.brandFacets=this.constructFacets(n.ProductListScope.GetBrandGroups(),t)},i.prototype.constructFacets=function(t,i){var r=[];return _.each(t,function(t){var i=n.ProductListScope.GetChildCategories(t.groupName);_.each(i,function(n){r.push({id:n.Id,caption:n.Caption,selected:!1})})}),_.filter(r,function(n){return _.contains(i,n.id)})},i.prototype.getCategoriesBrandsIdsForProducts=function(){var i=[],t=[];return _.each(n.ProductListScope.products,function(n){i.push(n.CategoryIds)}),t=t.concat.apply(t,i),_.uniq(t,!1,function(n){return n})},i.prototype.getUniqueProductsList=function(n){return _.uniq(n,!1,function(n){return n.Sku})},i.prototype.facetValueExists=function(n,t){return _.any(n,function(n){return n.value===t})},i.prototype.getCurrentPageState=function(){this.getSelectedFacetIds();return{Index:n.ProductListScope.StateIndex++,SelectedFacetIds:n.ProductListScope.SelectedFacetIds,SelectedRatings:n.ProductListScope.ratingFacets,SelectedPriceRange:{PriceRangeFacetSelected:n.ProductListScope.PriceRangeFacetSelected,Minimum:n.ProductListScope.priceRangeModel.minimumDisplayValue,Maximum:n.ProductListScope.priceRangeModel.maximumDisplayValue,Floor:n.ProductListScope.priceRangeModel.floor,Ceil:n.ProductListScope.priceRangeModel.ceil},SelectedDiscountRange:{DiscountRangeFacetSelected:n.ProductListScope.DiscountRangeFacetSelected,Minimum:n.ProductListScope.discountLevelModel.minimum,Maximum:n.ProductListScope.discountLevelModel.maximum,Floor:n.ProductListScope.discountLevelModel.floor,Ceil:n.ProductListScope.discountLevelModel.ceil},SelectedSortByValue:n.ProductListScope.selectedSortingValue}},i.prototype.compareWithDeepLinkPageState=function(t){var i=!1;return n.ProductListScope.DeepLinkPageState&&(t?(i=n.ProductListScope.DeepLinkPageState.SelectedFacetIds.sort().join(",")===t.SelectedFacetIds.sort().join(","),i&&(i=n.ProductListScope.DeepLinkPageState.SelectedRatings.sort().join(",")===t.SelectedRatings.sort().join(",")),i&&(i=n.ProductListScope.DeepLinkPageState.SelectedSortByValue===t.SelectedSortByValue),i&&(i=n.ProductListScope.DeepLinkPageState.SelectedPriceRange.Minimum===t.SelectedPriceRange.Minimum&&n.ProductListScope.DeepLinkPageState.SelectedPriceRange.Maximum===t.SelectedPriceRange.Maximum),i&&(i=n.ProductListScope.DeepLinkPageState.SelectedDiscountRange.Minimum===t.SelectedDiscountRange.Minimum&&n.ProductListScope.DeepLinkPageState.SelectedDiscountRange.Maximum===t.SelectedDiscountRange.Maximum)):(i=n.ProductListScope.DeepLinkPageState.SelectedFacetIds.sort().join(",")===n.ProductListScope.SelectedFacetIds.sort().join(","),i&&(i=n.ProductListScope.DeepLinkPageState.SelectedRatings.sort().join(",")===n.ProductListScope.ratingFacets.sort().join(",")),i&&(i=n.ProductListScope.DeepLinkPageState.SelectedSortByValue===n.ProductListScope.selectedSortingValue),i&&(i=n.ProductListScope.DeepLinkPageState.SelectedPriceRange.Minimum===n.ProductListScope.priceRangeModel.minimumDisplayValue&&n.ProductListScope.DeepLinkPageState.SelectedPriceRange.Maximum===n.ProductListScope.priceRangeModel.maximum),i&&(i=n.ProductListScope.DeepLinkPageState.SelectedDiscountRange.Minimum===n.ProductListScope.discountLevelModel.minimum&&n.ProductListScope.DeepLinkPageState.SelectedDiscountRange.Maximum===n.ProductListScope.discountLevelModel.maximum))),i},i.prototype.pageStateIsUnchanged=function(t){return t?this.compareWithDeepLinkPageState(t):n.ProductListScope.DeepLinkPageState?this.compareWithDeepLinkPageState(t):n.ProductListScope.SelectedFacetIds.length===0&&n.ProductListScope.ratingFacets.length===0&&n.ProductListScope.selectedSortingValue===SortOption.None&&!n.ProductListScope.PriceRangeFacetSelected&&!n.ProductListScope.DiscountRangeFacetSelected},i.prototype.showRatings=function(){var t=window.ProductModule,i;return t!=null&&t.productScope!=null?(i=_.any(n.ProductListScope.products,function(n){return t.productScope.displayProductBasedOnShowHideFlag(n,"IncludeInPowerReviews")}),i&&_.each(n.ProductListScope.products,function(n){t.productScope.displayProductBasedOnShowHideFlag(n,"IncludeInPowerReviews")||(n.Rating=0)}),i):!0},i.prototype.getSelectedFacetIds=function(){n.ProductListScope.SelectedFacetIds=[];_.each(AvonModule.AvonScope.LeftNavigationSelectedFacets,function(t){t.Facets.map(function(t){n.ProductListScope.SelectedFacetIds.push(t.Id)})});n.ProductListScope.SelectedFacetIds=n.ProductListScope.SelectedFacetIds.concat(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets)},i.prototype.hasUserSelectedFacets=function(){return n.ProductListScope.PageLoadUrl!==document.location.href},i.prototype.updateSort=function(t){n.ProductListScope.selectedSortingValue=t.length===0?SortOption.None:parseInt(t);var i=_.indexOf(n.ProductListScope.ValidSortOptions,n.ProductListScope.selectedSortingValue)!==-1;i&&(n.ProductListScope.selectSortingValue(n.ProductListScope.selectedSortingValue.toString()),n.ProductListScope.SafeApply())},i.prototype.updateFacetsFromState=function(n,t){_.each(n,function(n){var i=$("#brand-"+n);i&&i.is(":checked")&&t.indexOf(n.toString())===-1&&i.trigger("click");i&&!i.is(":checked")&&t.indexOf(n.toString())>=0&&i.trigger("click")})},i.prototype.updateRatings=function(n,t){_.each(n,function(n){var i=$("#rating-"+n);i&&i.is(":checked")&&t.indexOf(n.toString())===-1&&i.trigger("click");i&&!i.is(":checked")&&t.indexOf(n.toString())>=0&&i.trigger("click")})},i.$inject=["$scope","$rootScope","productListService","$timeout","trackingService","productService","celebrosService","$filter","analyticsService","bagService","NotifyMeService","historyService"],i.HistoryStateKey="LayoutLeftNavigation",i}(BaseAngularController);n.MobileProductListCtrl=t}(MobileProductListModule||(MobileProductListModule={}));app.controller("MobileProductListController",MobileProductListModule.MobileProductListCtrl),function(n){var t=function(n){function t(i,r,u){n.call(this,i,r,u);t.rootScope=i;t.http=r;t.q=u}return __extends(t,n),t.prototype.getProductNameByLineNumber=function(n,i){this.PostJson("/api/shopbylinenumber/getproductnamebylinenumber",{RowId:n.rowId,LineNumber:n.lineNumber,CampaignNumber:n.campaignNumber}).success(function(n){n!==null&&t.rootScope.$broadcast("ShopByLineNumberService.ShopByLineNumberServiceResponse",n,i)}).error(function(){})},t.prototype.searchProductsByName=function(n){this.PostJson("/api/shopbylinenumber/searchproductsbyname",{SearchTerm:n.searchTerm,CampaignNumber:n.campaignNumber}).success(function(n){n!==null&&t.rootScope.$broadcast("ShopByLineNumberService.SearchProductsByNameResponse",n)}).error(function(){})},t.$inject=["$rootScope","$http","$q"],t}(BaseAvonService);n.ShopByLineNumberService=t}(ShopByLineNumberServiceModule||(ShopByLineNumberServiceModule={}));app.service("shopByLineNumberService",ShopByLineNumberServiceModule.ShopByLineNumberService);__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t=function(t){function i(i,r,u){function c(){$("#BVRRDisplayContentBodyID").length===0?setTimeout(function(){c()},2e3):$("#BVRRDisplayContentNoReviewsID").length===0&&(n.productDetailScope.DisplayProductReviews=!0,n.productDetailScope.SafeApply())}function l(){if($("#BVRRDisplayContentBodyID").length===0)setTimeout(function(){l()},2e3);else if($(".BaazarVoice #BVRRQuickTakeContentContainerID").length>0){var n=0,t=$(".BaazarVoice .BVRRHistogram"),i=$(".BaazarVoice .BVRRHistogram .BVRRHistogramBarRow .BVRRHistAbsLabel");i.each(function(t,i){var r=parseInt($(i).html().replace(",","").replace(".",""));n<r&&(n=r)});n>999&&(n<1e4?t.addClass("medium"):n<1e5?t.addClass("large"):t.addClass("larger"))}}var f,e,s,h,o;if(t.call(this,i),n.productDetailScope=i,n.productDetailScope.reviewsLoaded=!1,n.productDetailScope.product=AVON.product,n.productDetailScope.DisplayProductReviews=!1,n.productDetailScope.DisplayCrossSells=!1,n.productDetailScope.DisplayCustomerBuys=!1,n.productDetailScope.ShowCaroselSlide=function(t,i){var r=i!=null&&i.IsAvailable,u=t;return r&&(u===CarouselType.CustomerBuys?n.productDetailScope.DisplayCustomerBuys=!0:u===CarouselType.CrossSells&&(n.productDetailScope.DisplayCrossSells=!0)),r},f=n.productDetailScope.GetValueFromSessionStorage("ListedProductsIdsOrder"),f){if(e=f.indexOf(n.productDetailScope.product.Id),e<0){n.productDetailScope.SetValueIntoSessionStorage("ListedProductsIdsOrder",[]);return}e>0&&(s=f[e-1],$("head").append('<link rel="prev" href="'+n.productDetailScope.Url.Action("Details","Product")+"/"+s+'" />'));e<f.length-1&&(h=f[e+1],$("head").append('<link rel="next" href="'+n.productDetailScope.Url.Action("Details","Product")+"/"+h+'" />'))}n.productDetailScope.SessionService.WhenReady().then(function(){var t=u.Initialize();t.pagereferrer=document.referrer;t.productsku=n.productDetailScope.product.Sku;t.productname=n.productDetailScope.product.Name;t.productprice=n.productDetailScope.product.PriceModel.ListPrice.toString();t.websessionid=n.productDetailScope.Session.WebSessionId;t.qwisersearchsessionid=n.productDetailScope.Session.Search.SessionId;t.qwisersearchloghandle=n.productDetailScope.Session.Search.LogHandle;u.LogProductResult(t)});o=function(n){var t=!1;return angular.forEach(ProductModule.productScope.LoadedProducts,function(i){!t&&n.indexOf(i.Id)>=0&&(t=!0)}),t};n.productDetailScope.ShowPDPCarouselTopCrossSells=function(){var r=window.ProductModule,u=n.productDetailScope.product.HasCrossSells&&n.productDetailScope.product.CrossSellProducts.length>0&&n.productDetailScope.DisplayCrossSells,t=r.productScope.LoadedRecommendations.product1_rr,f=t&&t.length>0,i=!1;return f&&(i=o(t)),u||i};n.productDetailScope.ShowPDPCarouselBottomCrossSells=function(){var r=window.ProductModule,u=n.productDetailScope.product.CustomerBuys&&n.productDetailScope.product.CustomerBuys.length>0&&n.productDetailScope.DisplayCustomerBuys,t=r.productScope.LoadedRecommendations.product2_rr,f=t&&t.length>0,i=!1;return f&&(i=o(t)),u||i};_.defer(function(){i.$watch("products",function(){_.defer(function(){app.safeLoadImages($(".ProductList"))})},!0);i.$watch("visibleCount",function(){_.defer(function(){app.safeLoadImages($(".ProductList"))})});setTimeout(function(){c();l()},4e3)})}return __extends(i,t),i.$inject=["$scope","$rootScope","celebrosService"],i}(BaseAngularController);n.ProductDetailController=t}(ProductDetailModule||(ProductDetailModule={}));app.controller("ProductDetailController",ProductDetailModule.ProductDetailController),function(n){var t=function(t){function i(i,r,u,f,e,o,s,h,c){var l=this,a,y,p,w,v;t.call(this,i,h);this.$rootScope=r;this.productListService=u;this.getDiscountAndPriceModel=function(){var f=l.getVisibleUniqueProducts(),t,i;if(f.length>0){t=_.reduce(f,function(n,t){var i,r;return t.PriceModel.DiscountPercent>0&&(i=l.facetValueExists(n.discountLevelFacets,t.PriceModel.DiscountPercent),i||n.discountLevelFacets.push({isChecked:!1,value:t.PriceModel.DiscountPercent,facetModelName:SliderFacetModelNames.discountLevelModel})),r=l.facetValueExists(n.priceRangeFacets,l.getLowestProductPrice(t)),r||n.priceRangeFacets.push({isChecked:!1,value:l.getLowestProductPrice(t),facetModelName:SliderFacetModelNames.priceRangeModel}),n},{discountLevelFacets:[],priceRangeFacets:[]});i=_.max(t.discountLevelFacets,l.getMinimumMaximumPriceIterator).value;_.isUndefined(i)&&(i=0);var r={facets:l.sortFacetsByValue(t.discountLevelFacets),minimum:0,maximum:i,floor:0},e=Math.floor(_.min(t.priceRangeFacets,l.getMinimumMaximumPriceIterator).value),o=Math.ceil(_.max(t.priceRangeFacets,l.getMinimumMaximumPriceIterator).value),u={facets:l.sortFacetsByValue(t.priceRangeFacets),minimum:e,maximum:o,minimumDisplayValue:e,maximumDisplayValue:o,floor:0};return r.floor=0,r.ceil=r.maximum,u.floor=0,n.productListScope.PriceRangeFacetSelected||(u.ceil=u.maximumDisplayValue),{discountLevelModel:r,priceRangeModel:u}}return null};this.getVisibleUniqueProducts=function(){var t=n.productListScope.productCategoryStructure.Products.length>0?n.productListScope.productCategoryStructure.Products:n.productListScope.uniqueProducts;return(AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0||AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0||n.productListScope.ratings&&n.productListScope.ratings.length>0)&&(t=_.filter(n.productListScope.productCategoryStructure.Products,function(t){return n.productListScope.filterProductsByFacets(t)})),t};this.sortFacetsByValue=function(n){return _.sortBy(n,function(n){return n.value})};this.getLowestProductPrice=function(n){var t=n.PriceModel.SalePrice,i=n.PriceModel.ListPrice;return t>0?t:i};this.getMinimumMaximumPriceIterator=function(n){return n.value};this.getStructureForBrandWithSubBrands=function(t,i){var r={};return angular.copy(t,r),r.Children=[],r.Products=[],_.each(t.Children,function(n){_.each(n.Products,function(n){_.contains(n.CategoryIds,i)&&r.Products.push(n)})}),n.productListScope.uniqueProducts=l.getUniqueProducts(r.Products),r.Products=n.productListScope.uniqueProducts,r};n.productListScope=i;n.productListScope.minimumNumberOfProductsForSort=12;n.productListScope.ShowProductList=AVON.ShowProductList==null?!0:AVON.ShowProductList;n.productListScope.CategoryDeepLinkModel=AVON.CategoryDeepLinksModel;n.productListScope.products=AVON.productList||[];_.each(n.productListScope.products,function(t){t.Name=n.productListScope.SecureHtml(t.Name)});n.productListScope.uniqueProducts=[];n.productListScope.SelectedFacetIds=[];n.productListScope.SelectedCategoryId=AVON.SelectedCategoryId;n.productListScope.SelectedCategoryName=AVON.SelectedCategoryName;n.productListScope.SelectedCategoryType=AVON.SelectedCategoryType;n.productListScope.InitialSubCategoryId=AVON.InitialSubCategoryId;n.productListScope.topCategoryName=AVON.TopCategoryName||"";n.productListScope.level3CategoryName=AVON.Level3CategoryName||"";n.productListScope.level4CategoryName=AVON.Level4CategoryName||"";n.productListScope.RatingFudge=.3;n.productListScope.selectedFacets={};n.productListScope.flatSelectedFacets=[];n.productListScope.primeFacets=[];n.productListScope.ratings=[];n.productListScope.facetNames={};n.productListScope.defaultSliderModel={discountLevelModel:{},priceRangeModel:{}};n.productListScope.initialProductLoad=!1;n.productListScope.CustomMessages="";n.productListScope.searchShowAmountLimit=n.productListScope.IsBlog()?n.productListScope.ClientConfiguration.BlogProductListPageSize:n.productListScope.ClientConfiguration.ProductListPageSize;n.productListScope.FilterNavigationSelectedDepartmentFacets=function(t){if(!n.productListScope.ProductSearchLoaded||!n.productListScope.SelectedFlitersToShowInSearchUi)return!0;var i=_.find(n.productListScope.SelectedFlitersToShowInSearchUi,function(n){return n.FacetId===t});return!i||!i.ExcludeFacetFromShowingInUi};a={None:[],Default:["-IsAvailable","ListIndex","-PriceModel.IsOnSale","-HasPromotion","PriceModel.ListPrice"],Price:["-IsAvailable","PriceModel.Price","-PriceModel.IsOnSale","-HasPromotion","PriceModel.ListPrice","ListIndex"],Rating:["-IsAvailable","-HasRating","-Rating","-PriceModel.IsOnSale","-HasPromotion","PriceModel.ListPrice","ListIndex"],Name:["-IsAvailable","Name","-PriceModel.IsOnSale","-HasPromotion","PriceModel.ListPrice"],Relevance:["-IsAvailable","-PriceModel.IsOnSale","-HasPromotion","PriceModel.ListPrice","ListIndex"],SearchRelevance:["ListIndex","-IsAvailable","-PriceModel.IsOnSale","-HasPromotion","PriceModel.ListPrice"],Discount:["-IsAvailable","-PriceModel.DiscountPercent","-HasPromotion","PriceModel.ListPrice"]};n.productListScope.selectedSortingValue=SortOption.None;n.productListScope.sortingOptions={None:SortOption.None,Default:SortOption.Default,Price:SortOption.Price,Rating:SortOption.Rating,Name:SortOption.Name,Relevance:SortOption.Relevance,Discount:SortOption.Discount,SearchRelevance:SortOption.SearchRelevance};n.productListScope.sortingFilterValue=a.Default;n.productListScope.productCategoryStructure={};n.productListScope.temporaryProductCategoryStructure={};n.productListScope.filterCategoryStructureByMenuLevel=function(t){switch(t.MenuLevel){case Level.Level2:return n.productListScope.SelectedCategoryHasChildCategoryDepartments?ProductCategorySection.Category:ProductCategorySection.Featured;case Level.PDept:return ProductCategorySection.None}};n.productListScope.isSortByContainerAllowedToShow=function(){if(_.isEmpty(n.productListScope.productCategoryStructure))return!1;var t=0;return!l.productCategoryStructureHasZeroChildren()&&(_.each(n.productListScope.productCategoryStructure.Children,function(n){t+=n.Products.length}),t>n.productListScope.minimumNumberOfProductsForSort)?!0:n.productListScope.productCategoryStructure.Products.length>n.productListScope.minimumNumberOfProductsForSort?!0:!1};n.productListScope.$on("productListScope.SortByUpdated",function(t,i){n.productListScope.selectedSortingValue=i;y();n.productListScope.SafeApply()});y=function(){var t,i,u;n.productListScope.SortByUpdated=!0;t=parseInt(n.productListScope.selectedSortingValue,10);switch(t){case SortOption.Price:l.swapProductsWithUniqueProducts();n.productListScope.sortingFilterValue=a.Price;break;case SortOption.Rating:l.swapProductsWithUniqueProducts();n.productListScope.sortingFilterValue=a.Rating;break;case SortOption.Name:l.swapProductsWithUniqueProducts();n.productListScope.sortingFilterValue=a.Name;break;case SortOption.Default:case SortOption.None:v();n.productListScope.sortingFilterValue=a.Default;break;case SortOption.Relevance:n.productListScope.sortingFilterValue=a.Relevance;break;case SortOption.SearchRelevance:n.productListScope.sortingFilterValue=a.SearchRelevance;break;case SortOption.Discount:l.swapProductsWithUniqueProducts();n.productListScope.sortingFilterValue=a.Discount}!n.productListScope.ProductSearchLoaded&&c.IsPushStateSupported&&n.productListScope.selectedSortingValue!==SortOption.None&&(i=[t],u=n.productListScope.GetUpdatedUrl(n.productListScope.SortByQueryStringParamName,i),r.$broadcast("productListScope.setSortUrl",u,t));n.productListScope.SortByUpdated=!1};i.$watch("selectedSortingValue",function(){y()});n.productListScope.showSortBySubBrand=function(){return n.productListScope.SelectedCategoryType==CategoryType.Brand&&!l.isCurrentMenuLevelDept()&&!l.isSortOptionNoneOrDefault()};n.productListScope.showSortByCategory=function(){return n.productListScope.SelectedCategoryType==CategoryType.Category&&!l.isCurrentMenuLevelDept()&&!l.isSortOptionNoneOrDefault()};n.productListScope.showSortByRelevance=function(){return!l.isSortOptionNoneOrDefault()&&n.productListScope.SelectedCategoryType===undefined&&AVON.SearchTerm==undefined};n.productListScope.showSortBySearchRelevance=function(){return!l.isSortOptionNoneOrDefault()&&n.productListScope.SelectedCategoryType===undefined&&AVON.SearchTerm!==undefined};n.productListScope.showSortByDiscount=function(){return _.isUndefined(n.productListScope.discountLevelModel)?!1:n.productListScope.discountLevelModel.facets.length>0};n.productListScope.IncreaseSearchShowAmountLimit=function(){n.productListScope.searchShowAmountLimit+=n.productListScope.IsBlog()?n.productListScope.ClientConfiguration.BlogProductListPageSize:n.productListScope.ClientConfiguration.ProductListPageSize;n.productListScope.visibleProductsCount=n.productListScope.RefinedProductCount>n.productListScope.searchShowAmountLimit?n.productListScope.searchShowAmountLimit:n.productListScope.RefinedProductCount;n.productListScope.visibleProductsCount>n.productListScope.products.length&&(n.productListScope.visibleProductsCount=n.productListScope.products.length);n.productListScope.visibleProductsCountUpdated=!0;n.productListScope.SafeApply()};n.productListScope.ShowPromotionOverlay=function(n){var i=$(angular.element(n.currentTarget)[0]),t,r;i.siblings("div").addClass("active");t=i.siblings(".Overlay.active");t.width(t.parent().width()-(t.outerWidth(!0)-t.width()));r=i.siblings(".RotatedCaret45.active");r.css({"margin-left":t.outerWidth(!0)/2-r.width()/2})};n.productListScope.HidePromotionOverlay=function(n){var t=$(angular.element(n.currentTarget)[0]);t.children(".active").removeClass("active")};n.productListScope.GoToProductPage=function(t,i){if($(".ie").length>0){var r=[];$("div[data-product-summary-id]").each(function(){var n=parseInt($(l).attr("data-product-summary-id"),10);n>0&&r.push(n)});n.productListScope.SetValueIntoSessionStorage("ListedProductsIdsOrder",r)}n.productListScope.RedirectToUrl(n.productListScope.Url.Action("Details","Product")+"/"+i+"-"+t)};n.productListScope.GetPageHeading=function(){var i=$(".LeftNavItem  .SelectedCategory:first, .LeftNavFeaturedItem .SelectedCategory:first"),t=i.text();return n.productListScope.initialProductLoad?"":t.length>0?t:n.productListScope.SelectedCategoryName};n.productListScope.addToBag=function(n){var t={Sku:n,Quantity:1};r.$broadcast("AddToBag",t)};n.productListScope.updateSelectedFacets=function(t,i,r,u){var f,e;n.productListScope.SelectedFacetIds=[];u?AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.indexOf(i)>=0&&(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets=_(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets).without(i)):(f=_(AvonModule.AvonScope.LeftNavigationSelectedFacets).findWhere({Title:t}),_(f.Facets).chain().pluck("Id").flatten().uniq().value().indexOf(i)>=0&&(f.Facets=_(f.Facets).filter(function(n){return n.Id!=i}),AvonModule.AvonScope.LeftNavigationSelectedFacets=_(AvonModule.AvonScope.LeftNavigationSelectedFacets).filter(function(n){return n.Facets.length>0})));$("#LeftNavCheckbox-"+i).prop("checked",!1);AvonModule.AvonScope.$broadcast("productListScope.UpdateFacetState");AvonModule.AvonScope.$broadcast("productListScope.facetRemoved",i);AvonModule.AvonScope.$broadcast("productListScope.EnableFacetClear",i);n.productListScope.ProductSearchLoaded||l.updateDiscountAndPriceModel();v();n.productListScope.ProductSearchLoaded&&AVON.NavigationOriginalSearchFacets&&(n.productListScope.MatchedHiddenFacetsForSearch||(n.productListScope.MatchedHiddenFacetsForSearch=_.filter(AVON.NavigationOriginalSearchFacets,function(n){return n.Text===r&&n.Id!==i})),n.productListScope.MatchedHiddenFacetsForSearch&&(n.productListScope.MatchedHiddenFacetsForSearch.length>0?(e=n.productListScope.MatchedHiddenFacetsForSearch.pop(),n.productListScope.updateSelectedFacets(t,e.Id,e.Text,u)):n.productListScope.MatchedHiddenFacetsForSearch=null))};n.productListScope.getDepartmentName=function(n){return $("#facet-"+n).text().trim()};n.productListScope.setExclusiveFacet=function(t,i){n.productListScope.selectedFacets={};n.productListScope.selectedFacets[t]=[];n.productListScope.selectedFacets[t].push(i);n.productListScope.flatSelectedFacets=[];n.productListScope.flatSelectedFacets.push(i);n.productListScope.hiddenExclusiveFacet=i;n.productListScope.updatedRefinedProductsCount()};n.productListScope.updateRatings=function(t){if(n.productListScope.ratings=t,n.productListScope.ratings.length===0){v();AvonModule.AvonScope.$broadcast("productListScope.facetRemoved");return}l.swapProductsWithUniqueProducts();n.productListScope.SafeApply();n.productListScope.updatedRefinedProductsCount();AvonModule.AvonScope.$broadcast("productListScope.facetRemoved");l.updateDiscountAndPriceModel()};n.productListScope.removeRating=function(t){var i=_.indexOf(n.productListScope.ratings,t),r;i!==-1&&(n.productListScope.ratings.splice(i,1),$("#rating-"+t).prop("checked",!1),n.productListScope.updateRatings(n.productListScope.ratings));!n.productListScope.ProductSearchLoaded&&c.IsPushStateSupported&&(r=n.productListScope.GetUpdatedUrl(n.productListScope.RatingsQueryStringParamName,n.productListScope.ratings),c.ReplaceStateUrl(r));AvonModule.AvonScope.$broadcast("productListScope.facetRemoved");AvonModule.AvonScope.$broadcast("productListScope.RatingRemoved",t);l.updateDiscountAndPriceModel()};n.productListScope.filterProductsByFacets=function(t){var i=l.productIsVisible(t),r=l.productIsVisibleByDepartment(t);return t.visible=l.productHasSelectedRating(t)&&l.productInBetweenSelectedDiscounts(t)&&l.productInBetweenSelectedPrice(t)&&i&&r,t.Id===n.productListScope.products[n.productListScope.products.length-1].Id&&n.productListScope.updatedRefinedProductsCount(),t.visible};n.productListScope.filterLeftNavRatingsByProducts=function(n){return AvonModule.AvonScope.LeftNavigationSelectedFacets&&AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0?_.each(AvonModule.AvonScope.LeftNavigationSelectedFacets,function(t){n=_.filter(n,function(n){var i=_(t.Facets).chain().pluck("Id").flatten().uniq().intersection(n.Facets).value().length>0,r=AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length===0||_.intersection(n.CategoryIds,AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets).length>0;return i&&r})}):AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets&&AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0&&(n=_.filter(n,function(n){return AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length===0||_.intersection(n.CategoryIds,AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets).length>0})),n};n.productListScope.filterLeftNavDeptByProducts=function(n){return AvonModule.AvonScope.LeftNavigationSelectedFacets&&AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0?_.each(AvonModule.AvonScope.LeftNavigationSelectedFacets,function(t){n=_.filter(n,function(n){var i=_(t.Facets).chain().pluck("Id").flatten().uniq().intersection(n.Facets).value().length>0;return l.productHasSelectedRating(n)&&i})}):n=_.filter(n,function(n){return l.productHasSelectedRating(n)}),n};n.productListScope.filterLeftNavByProducts=function(n){return AvonModule.AvonScope.LeftNavigationSelectedFacets&&AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0&&_.each(AvonModule.AvonScope.LeftNavigationSelectedFacets,function(t){n=_.filter(n,function(n){var i=!0;return _.each(t.Facets,function(t){_.contains(n.Facets,t.Id)||(i=!1)}),i})}),AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets&&AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0&&(n=_.filter(n,function(n){var t=!0;return _.each(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets,function(i){_.contains(n.CategoryIds,i)||(t=!1)}),t})),n=_.filter(n,function(n){return l.productHasSelectedRating(n)})};n.productListScope.filterLeftNavByFacets=function(t,i,r){var u=_(t).chain().pluck("Facets").flatten().value(),e=u,f,o;return i&&(_.each(u,function(n){n.IsEnabled=!0}),AvonModule.AvonScope.LeftNavigationSelectedFacets&&AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0&&_.each(AvonModule.AvonScope.LeftNavigationSelectedFacets,function(n){var i=_.find(t,function(t){return t.Title===n.Title}),f=i.Facets;u=l.getFacetsFromAvailableProducts(u,!0,f,n,r)}),AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets&&AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0&&(f=_.find(t,function(n){return n.IsDepartmentShopBy}),o=f.Facets,u=l.getFacetsFromAvailableProducts(u,!1,o,f,r)),n.productListScope.ratings&&n.productListScope.ratings.length>0&&(u=l.getFacetsFromAvailableProducts(u,!1,null,null,r)),e=_.filter(u,function(n){return n.IsEnabled===!0})),e};n.productListScope.updatedRefinedProductsCount=function(){if(n.productListScope.RefinedProductCount=_.filter(n.productListScope.productCategoryStructure.Products,function(n){return n.visible}).length,!n.productListScope.visibleProductsCountUpdated){var t=n.productListScope.IsBlog()?n.productListScope.ClientConfiguration.BlogProductListPageSize:n.productListScope.ClientConfiguration.ProductListPageSize;n.productListScope.visibleProductsCount=n.productListScope.searchShowAmountLimit>n.productListScope.RefinedProductCount?n.productListScope.RefinedProductCount:n.productListScope.searchShowAmountLimit>t?n.productListScope.searchShowAmountLimit:t}};n.productListScope.productSelectedByFacets=function(t){for(var i in n.productListScope.selectedFacets)if(n.productListScope.selectedFacets[i].length>0&&_.intersection(n.productListScope.selectedFacets[i],t).length===0)return!1;return!0};n.productListScope.getFacetNames=function(){var t,i;if(AVON.Navigation!=null){t=_(AVON.Navigation.ShopBys).chain().pluck("Facets").flatten().value();for(i in t)n.productListScope.facetNames["facet"+t[i].Id]=t[i].Text}};n.productListScope.getPromoSpot=function(t,i,r){var f,o,u,e;if(n.productListScope.promotionSpots!=null&&(n.productListScope.flatSelectedFacets==null||n.productListScope.flatSelectedFacets.length===0)&&(n.productListScope.ratings==null||n.productListScope.ratings.length===0)&&n.productListScope.selectedSortingValue==SortOption.None){if(f=[],AVON.IsShopAllPage){for(o=[],u=0;u<n.productListScope.promotionSpots.length;u++)n.productListScope.promotionSpots[u].CategoryLeafName.toLowerCase()===i.toLowerCase()&&o.push(n.productListScope.promotionSpots[u]);f=o}else f=n.productListScope.promotionSpots;for(u=0;u<f.length;u++)if(e=f[u],r){if(e.IndexLocation>t)return l.isPromoStackEmpty(l.getCurrentPromo(e,i))}else if(e.IndexLocation==t)return l.isPromoStackEmpty(l.getCurrentPromo(e,i))}return null};_.defer(function(){i.$watch("products",function(){_.defer(function(){app.safeLoadImages($(".ProductList"))})},!0);i.$watch("visibleCount",function(){_.defer(function(){app.safeLoadImages($(".ProductList"))})})});n.productListScope.$on("productListScope.UpdateSelectedCategory",function(n,t,i,r,u,f){l.UpdateSelectedCategory(t,i,r,u,f)});n.productListScope.$on("productListScope.UpdateSelectedFacets",function(){n.productListScope.visibleProductsCountUpdated=!1});n.productListScope.$on("productListScope.SetExclusiveFacet",function(t,i,r){n.productListScope.setExclusiveFacet(i,r);n.productListScope.visibleProductsCountUpdated=!1});n.productListScope.$on("productListScope.UpdateMultipleSelectedFacets",function(t,i,r){for(var u=0;u<r.length;u++);n.productListScope.visibleProductsCountUpdated=!1;n.productListScope.ShowProductList=!0});n.productListScope.$on("productListScope.UpdateRatings",function(t,i){n.productListScope.updateRatings(i);n.productListScope.visibleProductsCountUpdated=!1});n.productListScope.$on("productListScope.updateFacets",function(n,t,i){l.updateFacets(t,i)});n.productListScope.$on("ProductListService.HeroSpotLoaded",function(t,i){i.indexOf('<div id="ErrorInfo">')<0&&(n.productListScope.rawHeroModule=i,n.productListScope.SafeApply(),e(function(){$(".ProductHeroSpot .BodyModuleContainers").children().length===0?$(".SupplementHeroHeader").removeClass("Hidden"):$(".ProductHeroSpot").removeClass("Hidden");_.delay(function(){n.productListScope.ShowProductList=AVON.ShowProductList==null?!0:AVON.ShowProductList;n.productListScope.HideLoading()},500)}))});n.productListScope.$on("ProductListService.ProductSpotsLoaded",function(t,i){i.PageTitle.length>0?$(document).prop("title",i.PageTitle):$(document).prop("title",n.productListScope.SelectedCategoryName+" | AVON");n.productListScope.promotionSpots=i.ProductPromotionSpots;n.productListScope.SafeApply()});n.productListScope.clearPriceRange=function(t){t===void 0&&(t=!0);n.productListScope.PriceRangeFacetSelected=!1;n.productListScope.hasInitialPriceFilter=!1;n.productListScope.priceRangeModel&&n.productListScope.defaultSliderModel&&(n.productListScope.priceRangeModel.minimum=n.productListScope.defaultSliderModel[SliderFacetModelNames.priceRangeModel].minimum,n.productListScope.priceRangeModel.maximum=n.productListScope.defaultSliderModel[SliderFacetModelNames.priceRangeModel].maximum);l.updateDiscountAndPriceModel();r.$broadcast("productListScope.PriceRangeCleared",t);v()};n.productListScope.clearDiscountLevel=function(t){t===void 0&&(t=!0);n.productListScope.DiscountRangeFacetSelected=!1;n.productListScope.hasInitialDiscountFilter=!1;n.productListScope.discountLevelModel&&n.productListScope.defaultSliderModel&&(n.productListScope.discountLevelModel.minimum=n.productListScope.defaultSliderModel[SliderFacetModelNames.discountLevelModel].minimum,n.productListScope.discountLevelModel.maximum=n.productListScope.defaultSliderModel[SliderFacetModelNames.discountLevelModel].maximum);l.updateDiscountAndPriceModel();r.$broadcast("productListScope.DiscountRangeCleared",t)};n.productListScope.$on("productListScope.SetDiscountRangeSelected",function(t,i){n.productListScope.hasInitialDiscountFilter=!1;n.productListScope.DiscountRangeFacetSelected=i});n.productListScope.$on("productListScope.SetPriceRangeSelected",function(t,i){n.productListScope.hasInitialPriceFilter=!1;n.productListScope.PriceRangeFacetSelected=i});n.productListScope.showPriceRange=function(){return l.showSliderFacet(SliderFacetModelNames.priceRangeModel,n.productListScope.hasInitialPriceFilter)};n.productListScope.showDiscountLevel=function(){return l.showSliderFacet(SliderFacetModelNames.discountLevelModel,n.productListScope.hasInitialDiscountFilter)};n.productListScope.showListFilter=function(){var t=n.productListScope.LeftNavigationSelectedDepartmentFacets.length>0||n.productListScope.LeftNavigationSelectedFacets.length>0||n.productListScope.ratings&&n.productListScope.ratings.length>0;return t=t||n.productListScope.productCategoryStructure.Children&&n.productListScope.productCategoryStructure.Children.length===0&&(n.productListScope.showPriceRange()||n.productListScope.showDiscountLevel()),t=t||n.productListScope.isSortByContainerAllowedToShow()&&n.productListScope.ShowProductList,AVON.SearchTerm===undefined||t||(t=n.productListScope.CustomMessages&&n.productListScope.CustomMessages!=="",t=t||n.productListScope.products&&n.productListScope.products.length>0,t=t||n.productListScope.SearchResultDisplayTextModel&&n.productListScope.SearchResultDisplayTextModel.DisplayText!==""),t};p=function(){var t=window.ProductModule,i;return t!=null&&t.productScope!=null?(i=_.any(n.productListScope.products,function(n){return t.productScope.displayProductBasedOnShowHideFlag(n,"IncludeInPowerReviews")}),i&&_.each(n.productListScope.uniqueProducts,function(n){t.productScope.displayProductBasedOnShowHideFlag(n,"IncludeInPowerReviews")||(n.Rating=0)}),i):!0};n.productListScope.$on("ProductListService.ProductCategoryLoaded",function(t,i){n.productListScope.temporaryProductCategoryStructure={};l.populateProductCategoryStructureWithProducts(i.ProductCategoryStructure,i.Products);_.isNull(i.SelectedCategoryId)||i.ProductCategoryStructure.Id===i.SelectedCategoryId?n.productListScope.productCategoryStructure=i.ProductCategoryStructure:(_.isEmpty(n.productListScope.temporaryProductCategoryStructure)&&(n.productListScope.temporaryProductCategoryStructure=i.ProductCategoryStructure),n.productListScope.productCategoryStructure=_.findWhere(n.productListScope.temporaryProductCategoryStructure.Children,{Id:i.SelectedCategoryId}));n.productListScope.SelectedCategoryHasChildCategoryDepartments=_.find(n.productListScope.productCategoryStructure.Children,function(n){return n.Section===ProductCategorySection.Category&&n.IncludeInLeftMenu});n.productListScope.products=i.Products;n.productListScope.uniqueProducts=l.getUniqueProducts(n.productListScope.products);n.productListScope.ShowRatings=p();AvonModule.AvonScope.$broadcast("ProductListController.ProductsLoaded",n.productListScope.ShowRatings);n.productListScope.AvailableProductRatings=n.productListScope.uniqueProducts.filter(function(t){return n.productListScope.ShowProductRating(t)}).map(function(n){return Math.floor(n.Rating)});n.productListScope.AvailableProductRatings=_.uniq(n.productListScope.AvailableProductRatings);var u=l.getDiscountAndPriceModel();u&&(n.productListScope.discountLevelModel=u.discountLevelModel,l.setDefaultSliderModelValues(SliderFacetModelNames.discountLevelModel),r.$broadcast("productListScope.discountLevelModelPopulated",n.productListScope.discountLevelModel),n.productListScope.priceRangeModel=u.priceRangeModel,l.setDefaultSliderModelValues(SliderFacetModelNames.priceRangeModel),r.$broadcast("productListScope.priceRangeModelPopulated",n.productListScope.priceRangeModel));l.populatePromotionsToLoad(n.productListScope.products);n.productListScope.RefinedProductCount=n.productListScope.productCategoryStructure.Products.length;n.productListScope.categoryTotalProductCount=n.productListScope.productCategoryStructure.Products.length;_.defer(function(){n.productListScope.initialProductLoad&&(n.productListScope.initialProductLoad=!1,n.productListScope.ShowProductList=!0,$("#link"+n.productListScope.InitialSubCategoryId).click());var t=!1;_.each(n.productListScope.CategoryDeepLinkModel.Filters,function(i){switch(i.Name.toLowerCase()){case n.productListScope.RatingsQueryStringParamName:l.processRatingsFacetDeepLinks(i.Value);break;case n.productListScope.DiscountQueryStringParamName:l.processFacetModelDeepLinks(SliderFacetModelNames.discountLevelModel,i.Value);n.productListScope.hasInitialDiscountFilter=!0;break;case n.productListScope.PriceQueryStringParamName:l.processFacetModelDeepLinks(SliderFacetModelNames.priceRangeModel,i.Value);n.productListScope.hasInitialPriceFilter=!0;break;case n.productListScope.FacetQueryStringParamName:l.processCategoryFacetDeepLinks(i.Value);break;case n.productListScope.SortByQueryStringParamName:t=!0}});t&&l.processSortByDeepLinks();n.productListScope.CategoryDeepLinkModel&&n.productListScope.CategoryDeepLinkModel.Filters&&n.productListScope.CategoryDeepLinkModel.Filters.length>0&&(AvonModule.AvonScope.$broadcast("ProductListController.DeepLinkProcessed"),n.productListScope.CategoryDeepLinkModel.Filters=[]);n.productListScope.SafeApply()});n.productListScope.promotionSpots=AVON.ProductPromotionSpots;AVON.FindMostSpecificLevel&&w(i.SelectedCategoryId)});w=function(n){var i=window.location.pathname.split("/").pop(),t;_.each(AVON.Navigation.LinkGroups,function(n){_.each(n.Links,function(n){if(n.Text.formatUrlNugget()===i.formatUrlNugget()){t=n;return}})});t&&t.Id!==n&&r.$broadcast("ProductListController.UpdateSelectedCategory",t)};n.productListScope.$on("productListScope.EnableFacetClear",function(t,i){var f=$("#LeftNavCheckbox-"+i),r=f.parents(".LeftNavGroupItem"),u=r.find(".LeftNavClearItem");r.find("input:checked").length?u.addClass("Active"):u.removeClass("Active");n.productListScope.SafeApply()});n.productListScope.$on("productListScope.UpdateDiscountAndPriceModel",function(){l.updateDiscountAndPriceModel()});n.productListScope.$on("ProductListService.ProductSearchRedirection",function(t,i){n.productListScope.RedirectToUrl(i)});n.productListScope.$on("ProductListService.ProductSearchLoaded",function(t,i){var h,r,e,u,f,c,l,a;for(n.productListScope.ProductSearchLoaded=!0,n.productListScope.productCategoryStructure.Products=i.Data.products,n.productListScope.productCategoryStructure.Children=[],n.productListScope.getFacetNames(),n.productListScope.IsDeadEndSearch=i.Data.IsDeadEndSearch,n.productListScope.products=i.Data.products,n.productListScope.RefinedProductCount=n.productListScope.products.length,n.productListScope.categoryTotalProductCount=n.productListScope.products.length,n.productListScope.SearchResultDisplayTextModel=i.Data.SearchResultDisplayTextModel,n.productListScope.CustomMessages=i.Data.CustomMessages,n.productListScope.ShowRatings=p(),n.productListScope.SafeApply(),n.productListScope.HideLoading(),h=n.productListScope.IsBlog()?n.productListScope.ClientConfiguration.BlogProductListPageSize:n.productListScope.ClientConfiguration.ProductListPageSize,n.productListScope.visibleProductsCount=h>n.productListScope.products.length?n.productListScope.products.length:h,n.productListScope.visibleProductsCountUpdated=!0,r=[],e=0;e<n.productListScope.products.length;e++)if(u=n.productListScope.products[e],u.HasPromotion)for(f=0;f<u.Promotions.length;f++)r.indexOf(u.Promotions[f].PromotionId)<0&&r.push(u.Promotions[f].PromotionId);r.length>0&&AvonModule.AvonScope.$broadcast("GlobalProductController.LoadPromotions",r);AvonModule.AvonScope.$broadcast("layoutLeftNavigationScope.UpdatePrimeFacets",n.productListScope.primeFacets);c=!n.productListScope.SearchResultDisplayTextModel&&n.productListScope.products.length>0&&n.productListScope.IsDeadEndSearch?0:n.productListScope.products.length;l={SearchResultsCount:c,SearchTerm:AVON.SearchTerm};a={Type:TrackingEventType.SearchResults,Data:l};o.TrackEventItem(a);n.productListScope.SessionService.WhenReady().then(function(){var t=s.Initialize();t.pagereferrer=document.referrer;t.websessionid=n.productListScope.Session.WebSessionId;t.qwisersearchsessionid=n.productListScope.Session.Search.SessionId;t.qwisersearchloghandle=n.productListScope.Session.Search.LogHandle;s.LogSearchResult(t)});$("#ProductsSortBy").val($("#ProductsSortBy option:first").val())});n.productListScope.$on("Navigation.SelectedLinkUpdated",function(){u.GetProductsInCategory(AvonModule.AvonScope.LeftNavigationSelectedLink);n.productListScope.SkipPushState=!0;n.productListScope.clearPriceRange(!1);n.productListScope.clearDiscountLevel(!1);n.productListScope.SkipPushState=!1});n.productListScope.$on("layoutLeftNavigationScope.ClearPriceAndDiscount",function(){n.productListScope.clearDiscountLevel(!0);n.productListScope.clearPriceRange(!0)});n.productListScope.$on("layoutLeftNavigationScope.FacetAdded",function(t,i,r,u){if(n.productListScope.visibleProductsCountUpdated=!1,l.swapProductsWithUniqueProducts(),n.productListScope.ProductSearchLoaded){n.productListScope.SelectedFlitersToShowInSearchUi||(n.productListScope.SelectedFlitersToShowInSearchUi=[]);var f={Text:r,FacetId:i,ExcludeFacetFromShowingInUi:u};_.findWhere(n.productListScope.SelectedFlitersToShowInSearchUi,f)||n.productListScope.SelectedFlitersToShowInSearchUi.push(f)}});v=function(){var t=parseInt(n.productListScope.selectedSortingValue,10);_.isEmpty(n.productListScope.temporaryProductCategoryStructure)||AvonModule.AvonScope.LeftNavigationSelectedFacets.length!==0||AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length!==0||n.productListScope.PriceRangeFacetSelected||n.productListScope.DiscountRangeFacetSelected||t!==SortOption.Default&&t!==SortOption.None||n.productListScope.level4CategoryName||n.productListScope.ratings.length!==0||l.swapProductsWithUniqueProducts(!0)};n.productListScope.$on("layoutLeftNavigationScope.FacetRemoved",function(){n.productListScope.visibleProductsCountUpdated=!1;v()});n.productListScope.getFacetNames();n.productListScope.ShowProductList&&n.productListScope.ShowLoading(AVON.messages.spinner_loading);_.defer(function(){AVON.SearchTerm!==undefined?($("#BreadCrumbs").addClass("HideBreadcrumbs"),n.productListScope.sortingFilterValue=a.SearchRelevance,u.GetProductsBySearch(AVON.SearchTerm.trim())):(n.productListScope.SelectedCategoryId!=n.productListScope.InitialSubCategoryId&&(n.productListScope.initialProductLoad=!0,n.productListScope.ShowProductList=!1,n.productListScope.ShowLoading(AVON.messages.spinner_loading)),u.GetProductsInCategory(n.productListScope.SelectedCategoryId),n.productListScope.searchShowAmountLimit=9006);n.productListScope.SafeApply()})}return __extends(i,t),i.prototype.UpdateContentData=function(t,i,r){$(".SupplementHeroHeader").addClass("Hidden");$(".LeftNavPromotionSpot.BottomSpot").addClass("Hidden");n.productListScope.promotionSpots=[];n.productListScope.ShowProductList=!1;this.productListService.LoadCategoryHeroAndPromoSpots(t,i,r)},i.prototype.UpdateSelectedCategory=function(t,r,u,f,e){var o,c,h,a;if($(window).scrollTop(0),n.productListScope.primeFacets=[],n.productListScope.ratings=[],n.productListScope.topCategoryName=t,n.productListScope.SelectedCategoryName=r.Caption,n.productListScope.SelectedCategoryId=r.Id,n.productListScope.selectedSortingValue=SortOption.None,_.isEmpty(n.productListScope.temporaryProductCategoryStructure)&&angular.copy(n.productListScope.productCategoryStructure,n.productListScope.temporaryProductCategoryStructure),r.Url!=""&&(o=r.Url.match(i.CategoryUrlRegex),n.productListScope.level3CategoryName=o.length>=3?o[2]:"",n.productListScope.level4CategoryName=o.length>=5&&o[4]!==undefined?o[4]:""),e?r.Url===""&&(n.productListScope.level3CategoryName=r.Caption,n.productListScope.level4CategoryName=""):(r.Url===""&&(n.productListScope.level4CategoryName=r.Caption),n.productListScope.temporaryProductCategoryStructure.Children&&n.productListScope.temporaryProductCategoryStructure.Children.length?(c=_.findWhere(n.productListScope.temporaryProductCategoryStructure.Children,{Id:r.Id}),n.productListScope.productCategoryStructure=_.isUndefined(c)?this.getStructureForBrandWithSubBrands(n.productListScope.temporaryProductCategoryStructure,n.productListScope.SelectedCategoryId):c):n.productListScope.productCategoryStructure=this.getStructureForBrandWithoutSubBrands(n.productListScope.temporaryProductCategoryStructure,n.productListScope.SelectedCategoryId)),h=this.getDiscountAndPriceModel(),h&&(n.productListScope.discountLevelModel=h.discountLevelModel,this.setDefaultSliderModelValues(SliderFacetModelNames.discountLevelModel),this.$rootScope.$broadcast("productListScope.discountLevelModelPopulated",n.productListScope.discountLevelModel),n.productListScope.priceRangeModel=h.priceRangeModel,this.setDefaultSliderModelValues(SliderFacetModelNames.priceRangeModel),this.$rootScope.$broadcast("productListScope.priceRangeModelPopulated",n.productListScope.priceRangeModel)),n.productListScope.ShowLoading(AVON.messages.spinner_loading),AVON.languageId===2){var l="",s="",v="";e?(l=t,s=n.productListScope.SelectedCategoryName):(l=t,s=n.productListScope.temporaryProductCategoryStructure.NuggetName,a=_.find(n.productListScope.temporaryProductCategoryStructure.Children,function(t){return t.Id===n.productListScope.SelectedCategoryId}),a&&(v=a.NuggetName));s.formatUrlNugget()===n.productListScope.level4CategoryName&&(s=n.productListScope.temporaryProductCategoryStructure.NuggetName);this.UpdateContentData(l,s,n.productListScope.level4CategoryName)}else this.UpdateContentData(t,n.productListScope.level3CategoryName,n.productListScope.level4CategoryName);n.productListScope.SafeApply();n.productListScope.RefinedProductCount=n.productListScope.productCategoryStructure.Products.length},i.prototype.facetValueExists=function(n,t){return _.any(n,function(n){return n.value===t})},i.prototype.getUniqueProducts=function(n){return _.uniq(n,!1,function(n){return n.Sku})},i.prototype.getStructureForBrandWithoutSubBrands=function(t,i){var r={},u;return angular.copy(t,r),u=_.filter(r.Products,function(n){return _.contains(n.CategoryIds,i)}),n.productListScope.uniqueProducts=this.getUniqueProducts(u),r.Products=n.productListScope.uniqueProducts,r},i.prototype.setDefaultSliderModelValues=function(t){n.productListScope.defaultSliderModel[t].maximum=n.productListScope[t].maximum;n.productListScope.defaultSliderModel[t].minimum=n.productListScope[t].minimum},i.prototype.updateFacets=function(t,i){var r,u,f;if(n.productListScope[i]=t,_.each(n.productListScope[i].facets,function(n){n.value>=t.minimum&&n.value<=t.maximum&&(n.isChecked=!0)}),r=_.any(n.productListScope[i].facets,function(n){return n.isChecked}),!r&&(u=Math.floor(_.min(n.productListScope[i].facets,this.getMinimumMaximumPriceIterator).value),f=Math.ceil(_.max(n.productListScope[i].facets,this.getMinimumMaximumPriceIterator).value),r=parseInt(n.productListScope[i].minimum)!==f||parseInt(n.productListScope[i].maximum)!==u,!r)){_.isEmpty(n.productListScope.temporaryProductCategoryStructure)||this.swapProductsWithUniqueProducts(!0);return}this.swapProductsWithUniqueProducts();n.productListScope.updatedRefinedProductsCount();n.productListScope.visibleProductsCountUpdated=!1},i.prototype.swapProductsWithUniqueProducts=function(t){if(t===void 0&&(t=!1),t||n.productListScope.SortByUpdated||!(this.isCurrentMenuLevelDept()||this.productCategoryStructureHasZeroChildren())){if(t&&!_.isEmpty(n.productListScope.temporaryProductCategoryStructure)){n.productListScope.productCategoryStructure=n.productListScope.temporaryProductCategoryStructure;n.productListScope.temporaryProductCategoryStructure={};return}this.productCategoryStructureHasZeroChildren()||_.isEmpty(n.productListScope.temporaryProductCategoryStructure)&&(angular.copy(n.productListScope.productCategoryStructure,n.productListScope.temporaryProductCategoryStructure),n.productListScope.productCategoryStructure.Children=[],n.productListScope.productCategoryStructure.Products=n.productListScope.uniqueProducts)}},i.prototype.isSortOptionNoneOrDefault=function(){return n.productListScope.selectedSortingValue===SortOption.None||n.productListScope.selectedSortingValue===SortOption.Default},i.prototype.isCurrentMenuLevelDept=function(){return n.productListScope.productCategoryStructure.MenuLevel===Level.Dept},i.prototype.productCategoryStructureHasZeroChildren=function(){return n.productListScope.productCategoryStructure.Children&&n.productListScope.productCategoryStructure.Children.length===0},i.prototype.facetsLogicUseAnd=function(){return!0},i.prototype.productHasSelectedRating=function(t){if(this.facetsLogicUseAnd()){for(var i in n.productListScope.ratings)return n.productListScope.ratings[i]!==Math.floor(t.Rating+n.productListScope.RatingFudge)?!1:n.productListScope.ShowProductRating(t);return!0}return n.productListScope.ratings.length===0||n.productListScope.ShowProductRating(t)&&_.contains(n.productListScope.ratings,Math.floor(t.Rating+n.productListScope.RatingFudge))},i.prototype.productInBetweenSelectedDiscounts=function(t){return _.isUndefined(n.productListScope.discountLevelModel)||!n.productListScope.DiscountRangeFacetSelected?!0:t.DiscountPercent>=n.productListScope.discountLevelModel.minimum&&t.DiscountPercent<=n.productListScope.discountLevelModel.maximum?!0:!1},i.prototype.productInBetweenSelectedPrice=function(t){if(_.isUndefined(n.productListScope.priceRangeModel)||!n.productListScope.PriceRangeFacetSelected||n.productListScope.priceRangeModel.minimum===0&&n.productListScope.priceRangeModel.maximum===0)return!0;var i=this.getLowestProductPrice(t);return i>=n.productListScope.priceRangeModel.minimum&&i<=n.productListScope.priceRangeModel.maximum?!0:!1},i.prototype.productIsVisible=function(n){var t,i;if(this.facetsLogicUseAnd()){for(t in AvonModule.AvonScope.LeftNavigationSelectedFacets)if(AvonModule.AvonScope.LeftNavigationSelectedFacets[t].Facets.length>0)for(i in AvonModule.AvonScope.LeftNavigationSelectedFacets[t].Facets)if(!_.contains(n.Facets,AvonModule.AvonScope.LeftNavigationSelectedFacets[t].Facets[i].Id))return!1}else for(t in AvonModule.AvonScope.LeftNavigationSelectedFacets)if(AvonModule.AvonScope.LeftNavigationSelectedFacets[t].Facets.length>0&&_(AvonModule.AvonScope.LeftNavigationSelectedFacets[t].Facets).chain().pluck("Id").flatten().uniq().intersection(n.Facets).value().length===0)return!1;return!0},i.prototype.productIsVisibleByDepartment=function(n){if(this.facetsLogicUseAnd()){for(var t in AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets)if(!_.contains(n.CategoryIds,AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets[t]))return!1;return!0}return AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length===0||_.intersection(n.CategoryIds,AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets).length>0},i.prototype.getFacetsFromAvailableProducts=function(n,t,i,r,u){var f=this,e=_.filter(u,function(n){var i=!0,u;return t&&(i=_(r.Facets).chain().pluck("Id").flatten().uniq().intersection(n.Facets).value().length>0),u=AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length===0||_.intersection(n.CategoryIds,AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets).length>0,f.productHasSelectedRating(n)&&i&&u}),o=_(e).chain().pluck("Facets").flatten().uniq().value();return _.each(n,function(n){var t=_.any(o,function(t){return t===n.Id}),r=_.any(i,function(t){return t.Id===n.Id});t||r||(n.IsEnabled=!1)}),n},i.prototype.isPromoStackEmpty=function(n){return!_.isNull(n)&&!_.isUndefined(n)&&!_.isUndefined(n.Stack)&&(n.Stack.ImageItems.length>0||n.Stack.RichTextItems.length>0||n.Stack.VideoItems.length>0)?n:null},i.prototype.getCurrentPromo=function(t,i){var r=i.formatUrlNugget(),u=$(".GroupProductListContainer").find("h3").length>0?$(".GroupProductListContainer").find("h3").first().text().formatUrlNugget():"";if(t.DisplayOnSegmentPage&&(AVON.IsShopAllPage||n.productListScope.level3CategoryName.length>0)&&n.productListScope.level4CategoryName.length===0){if((t.CategoryLeafName.length===0||t.CategoryLeafName==r||t.CategoryLeafName==n.productListScope.level3CategoryName.formatUrlNugget())&&(r.length===0||r.length>0&&(r==t.CategoryLeafName||r==u)))return t}else if(t.DisplayOnSubSegmentPage&&(AVON.IsShopAllPage||n.productListScope.level3CategoryName.length>0)&&n.productListScope.level4CategoryName.length>0&&(t.CategoryLeafName.length===0||t.CategoryLeafName==r||t.CategoryLeafName==n.productListScope.level3CategoryName.formatUrlNugget()||t.CategoryLeafName==n.productListScope.level4CategoryName.formatUrlNugget()))return t},i.prototype.buildProductCategoryStructureTree=function(n,t){var i=this;n.Children.length>0?_.each(n.Children,function(n){i.buildProductCategoryStructureTree(n,t)}):_.contains(t.CategoryIds,n.Id)&&n.Products.push(t)},i.prototype.populateProductCategoryStructureWithProducts=function(n,t){var i=this;_.each(t,function(t){i.buildProductCategoryStructureTree(n,t)});_.each(n.Children,function(n){if(n.MenuLevel===Level.PDept&&n.Section===ProductCategorySection.Category){var r=[],t=[],u;i.populateTopLevelCategoryWithProducts(n,r);t=t.concat.apply(t,r);u=i.getUniqueProducts(t);n.Products=u}})},i.prototype.populateTopLevelCategoryWithProducts=function(n,t){var i=this;n.Children.length>0?_.each(n.Children,function(n){i.populateTopLevelCategoryWithProducts(n,t)}):t.push(n.Products)},i.prototype.populatePromotionsToLoad=function(t){var i=[];_.each(t,function(t){n.productListScope.primeFacets=_.union(n.productListScope.primeFacets,t.CategoryIds);t.HasPromotion&&_.each(t.Promotions,function(n){i.indexOf(n.PromotionId)<0&&i.push(n.PromotionId)})});i.length>0&&this.$rootScope.$broadcast("GlobalProductController.LoadPromotions",i);this.$rootScope.$broadcast("layoutLeftNavigationScope.UpdatePrimeFacets",n.productListScope.primeFacets)},i.prototype.processRatingsFacetDeepLinks=function(t){var i=[];_.each(t,function(t){if(n.productListScope.AvailableProductRatings&&n.productListScope.AvailableProductRatings.indexOf(t)>-1){var r=$(".LeftNavGroupItem #rating-"+t);r.length>0&&(i.push(t),r.prop("checked",!0))}});i.length>0&&(this.$rootScope.$broadcast("productListScope.UpdateRatings",i),this.$rootScope.$broadcast("layoutLeftNavigationScope.PopulateSelectedRatings",i))},i.prototype.processCategoryFacetDeepLinks=function(n){var t=this;_.each(n,function(n){t.$rootScope.$broadcast("productListScope.CategoryFacetDeepLink",n)})},i.prototype.centsToDollars=function(n){return(parseInt(n,10)/100).toFixed(2)},i.prototype.processFacetModelDeepLinks=function(t,i){var c=_.any(i,function(n){return n===null}),h;if(!c){var s=!1,r=n.productListScope[t],u=i[0],f=i[1],e,o;t===SliderFacetModelNames.priceRangeModel&&(e=this.centsToDollars(u),o=this.centsToDollars(f),u=parseFloat(e),f=parseFloat(o));u>=r.floor&&u<=r.maximum&&(s=!0,r.minimum=u,e&&(r.minimumDisplayValue=Math.floor(e)));f<=r.maximum&&f>=r.minimum&&(s=!0,r.maximum=f,o&&(r.maximumDisplayValue=Math.ceil(o)));s&&(_.each(r.facets,function(n){n.value>=r.minimum&&n.value<=r.maximum&&(n.isChecked=!0)}),h=t==="discountLevelModel"?"productListScope.discountLevelModelPopulated":"productListScope.priceRangeModelPopulated",this.$rootScope.$broadcast(h,t==="discountLevelModel"?n.productListScope.discountLevelModel:n.productListScope.priceRangeModel),t==="discountLevelModel"&&(n.productListScope.DiscountRangeFacetSelected=!0),t==="priceRangeModel"&&(n.productListScope.PriceRangeFacetSelected=!0),this.updateFacets(r,t),this.$rootScope.$broadcast(h,r),this.$rootScope.$broadcast("productListScope.FacetModelDeepLink",t,r))}},i.prototype.updateDiscountAndPriceModel=function(){var t=this.getDiscountAndPriceModel();t&&(n.productListScope.DiscountRangeFacetSelected||(n.productListScope.discountLevelModel=t.discountLevelModel,this.setDefaultSliderModelValues(SliderFacetModelNames.discountLevelModel),this.$rootScope.$broadcast("productListScope.discountLevelModelPopulated",n.productListScope.discountLevelModel)),n.productListScope.PriceRangeFacetSelected||(n.productListScope.priceRangeModel=t.priceRangeModel,this.setDefaultSliderModelValues(SliderFacetModelNames.priceRangeModel),this.$rootScope.$broadcast("productListScope.priceRangeModelPopulated",n.productListScope.priceRangeModel)))},i.prototype.processSortByDeepLinks=function(){var t=_.find(n.productListScope.CategoryDeepLinkModel.Filters,function(n){return n.Name.toLowerCase()==="sortby"});if(t){var i=$(".SortByContainer select option"),r=$.map(i,function(n){return parseInt(n.value)}),u=_.indexOf(r,t.Value[0])!==-1;u&&(n.productListScope.selectedSortingValue=t.Value[0])}},i.prototype.showSliderFacet=function(t,i){return _.isUndefined(n.productListScope[t]&&this.getVisibleUniqueProducts().length>0)?!1:n.productListScope[t].minimum!==n.productListScope.defaultSliderModel[t].minimum||n.productListScope[t].maximum!==n.productListScope.defaultSliderModel[t].maximum||i},i.$inject=["$scope","$rootScope","productListService","$sce","$timeout","trackingService","celebrosService","$window","historyService"],i.CategoryUrlRegex=/\/category\/([0-9a-zA-Z_-]*)\/([0-9a-zA-Z_-]*)(\/([0-9a-zA-Z_-]*))?/i,i}(BaseAngularController);n.ProductListCtrl=t}(ProductListModule||(ProductListModule={}));app.controller("ProductListController",ProductListModule.ProductListCtrl),function(n){var t=function(t){function i(i,r,u,f,e,o){t.call(this,r);n.shopByLineNumberScope=r;n.shopByLineNumberScope.buttonDisabled=!1;n.shopByLineNumberScope.itemsAddedCount=0;n.shopByLineNumberScope.itemAdded=!1;n.shopByLineNumberScope.invalidLineNumbers=AVON.InvalidLineNumbers;n.shopByLineNumberScope.addProductsToBag=function(){for(var i,r,t,o,u=[],s=[],f=0;f<n.shopByLineNumberScope.productRows.length;f++)if(i=n.shopByLineNumberScope.productRows[f],r={Campaign:0,LineNumber:"",Quantity:0,Sku:"",Fsc:""},i.hasBeenFilled){if(t={Quantity:0,Sku:"",Fsc:"",LineNumber:"",CampaignNumber:0,OrderType:"LI",Id:0},o=parseInt(i.quantity,10),t.Quantity=isNaN(o)?1:o,r.Quantity=t.Quantity,t.Quantity===0)return;t.Id=i.id;t.LineNumber=i.lineNumber;t.CampaignNumber=i.selectedCampaign;t.Sku=i.sku;t.Fsc=i.fsc;r.LineNumber=t.LineNumber;r.Campaign=t.CampaignNumber;r.Sku=t.Sku;r.Fsc=t.Fsc;t.Quantity>0&&(u.push(t),s.push(r))}u.length>0&&(n.shopByLineNumberScope.ShowLoading(AVON.messages.spinner_adding),e.lineEntryAddProductsToBag(u))};n.shopByLineNumberScope.searchAndAddProductsToBag=function(t){n.shopByLineNumberScope.searchProductNameByLineNumber(t,!0)};n.shopByLineNumberScope.setFilled=function(t){var i=n.shopByLineNumberScope.productRows[t],r;if(i.quantity.length>0&&(r=parseInt(i.quantity,10),r===0)){i.isInvalidLineNumber=!0;return}i.quantity.length>0||i.name.length>0?i.lineNumber.length===0&&(i.hasBeenFilled=!0):i.lineNumber.length===0&&(i.hasBeenFilled=!1)};n.shopByLineNumberScope.addProductSearchResultToList=function(t){for(var u,r=n.shopByLineNumberScope.currentPageLines[t],f=!1,i=0;i<n.shopByLineNumberScope.productRows.length;i++)if(n.shopByLineNumberScope.productRows[i].lineNumber===""){n.shopByLineNumberScope.productRows[i].selectedCampaign=n.shopByLineNumberScope.searchSelectedCampaign;n.shopByLineNumberScope.productRows[i].name=r.fullName;n.shopByLineNumberScope.productRows[i].quantity="1";n.shopByLineNumberScope.productRows[i].lineNumber=r.lineNumber.toString();n.shopByLineNumberScope.productRows[i].sku=r.sku;n.shopByLineNumberScope.productRows[i].hasBeenFilled=!0;n.shopByLineNumberScope.productRows[i].fsc=r.fsc;f=!0;break}f||(u=n.shopByLineNumberScope.productRows.length,n.shopByLineNumberScope.addRows(1,u),n.shopByLineNumberScope.productRows[u].selectedCampaign=n.shopByLineNumberScope.searchSelectedCampaign,n.shopByLineNumberScope.productRows[u].name=r.fullName,n.shopByLineNumberScope.productRows[u].quantity="1",n.shopByLineNumberScope.productRows[u].lineNumber=r.lineNumber.toString(),n.shopByLineNumberScope.productRows[i].sku=r.sku,n.shopByLineNumberScope.productRows[u].hasBeenFilled=!0,n.shopByLineNumberScope.productRows[i].fsc=r.fsc);r.hasBeenAdded=!0;n.shopByLineNumberScope.itemAdded=!0};$("#search-results-dialog").on("close",function(){if(n.shopByLineNumberScope.itemAdded){var t=$("#product-list").first();t.scrollintoview({duration:400,direction:"both",complete:null,offsetY:-150})}n.shopByLineNumberScope.searchTerm="";n.shopByLineNumberScope.itemAdded=!1});n.shopByLineNumberScope.addRepProductToBag=function(t){var r=n.shopByLineNumberScope.productRows[t],f=[],i,u,o;r.hasBeenFilled&&(i={Quantity:1,Sku:"",LineNumber:"",CampaignNumber:0,OrderType:"LI",Id:0},u=parseInt(r.quantity,10),i.Quantity=isNaN(u)?1:u,i.Quantity===0&&(i.Quantity=1),i.Id=r.id,i.LineNumber=r.lineNumber,i.CampaignNumber=r.selectedCampaign,i.Sku=r.sku,i.Quantity>0&&(o={ForceAddWhenAvailableSoon:!0},$.extend(i,o),f.push(i)),n.shopByLineNumberScope.ShowLoading(AVON.messages.spinner_adding),e.lineEntryAddProductsToBag(f))};n.shopByLineNumberScope.addProductToNotify=function(t){n.shopByLineNumberScope.ShowLoading(AVON.messages.spinner_loading);var i=n.shopByLineNumberScope.productRows[t],r={AllowExit:!0,Model:null,KeepLoaded:!1,UrlToLoad:"/product/notifymemodalbylinenumber?lineNumber="+i.lineNumber+"&campaignNumber="+i.selectedCampaign+""};$("#NotifyMeModal").trigger("modal",r);_.defer(function(){n.shopByLineNumberScope.resetProductRow(t)})};n.shopByLineNumberScope.getFormattedCampaignNumbers=function(){for(var u,i=n.shopByLineNumberScope.getCampaignNumbers(),r=[],t=0;t<i.length;t++)u={label:i[t].substring(4).toString(),value:parseInt(i[t])},r.push(u);return r};n.shopByLineNumberScope.$on("BagService.LineEntryAddSingleProductToBag",function(t,i){var r=i.Data;i.ErrorCode===AjaxError.ValidationErrors&&n.shopByLineNumberScope.ProcessAjaxValidationErrors(i)});n.shopByLineNumberScope.$on("BagService.LineEntryAddProductsToBag",function(t,r){var h,o,f,s,c,v;if(n.shopByLineNumberScope.HideLoading(),h=r.Data,r.ValidationErrors!=null&&r.ValidationErrors.length>0)n.shopByLineNumberScope.ProcessAjaxValidationErrors(r);else{for(n.shopByLineNumberScope.itemsAdded=[],n.shopByLineNumberScope.itemsAddedCount=0,o=0;o<h.ItemsAdded.length;o++){var f=h.ItemsAdded[o],y=n.shopByLineNumberScope.productRows[f.Id].name,p={Id:f.Id,Name:y,Quantity:f.Quantity,Sku:f.Sku};n.shopByLineNumberScope.itemsAdded.push(p);n.shopByLineNumberScope.itemsAddedCount+=f.Quantity;n.shopByLineNumberScope.resetProductRow(f.Id)}for(o=0;o<h.ItemsFailed.length;o++)f=h.ItemsFailed[o],s=n.shopByLineNumberScope.productRows[f.Id],f.AvailableSoon?(s.isAvailable=!1,s.isAvailableSoon=!0,c=$(".warning-message").first(),c.length&&n.shopByLineNumberScope.ScrollToTop()):f.ErrorMessages!=null&&f.ErrorMessages.length>0&&(s.isInvalidProduct=!1,s.hasAddToBagFailed=!0,s.isCurrentlyAvailable=!0,s.addToBagErrorMessage=f.ErrorMessages[0]),(f.DeliveryType==1||f.DeliveryType==2)&&(s.canBeRepDelivered=!0);if(n.shopByLineNumberScope.itemsAddedCount>0){var l=$(".AddToBagSuccessMsg"),e=$(".button-bag"),a=$("#ClearFormLink");l.show();e.removeClass("Loading").addClass("Button2");e.prop("disabled",!0);n.shopByLineNumberScope.buttonDisabled=!0;a.hide();v=n.shopByLineNumberScope.itemsAddedCount===1?e.data("single-add-to-bag"):e.data("multiple-add-to-bag");e.text(v.replace("{0}",n.shopByLineNumberScope.itemsAddedCount));u(function(){l.hide();e.text(e.data("add-msg"));e.removeClass("Button2").addClass("Button");e.prop("disabled",!1);n.shopByLineNumberScope.buttonDisabled=!1;a.show();var t=$("#product-list").first();t.scrollintoview({duration:400,direction:"both",complete:null,offsetY:-150})},3e3)}i.$broadcast("BagService.AddToBagSuccess",null)}});n.shopByLineNumberScope.$on("ShopByLineNumberService.ShopByLineNumberServiceResponse",function(t,i,r){if(!i.ErrorCode||i.ErrorCode!=AjaxError.ValidationErrors){var f={rowId:i.Data.rowId,productName:i.Data.productName,invalidLineNumber:i.Data.invalidLineNumber,sku:i.Data.sku,fsc:i.Data.fsc},u=n.shopByLineNumberScope.productRows[f.rowId];if(u.lineNumber.length===0)return;u.isInvalidProduct=f.invalidLineNumber;u.sku=i.Data.sku;u.fsc=i.Data.fsc;u.isCurrentlyAvailable=i.Data.isCurrentlyAvailable;u.name="";u.hasBeenFilled=!1;u.isAvailable=!0;!u.isInvalidProduct&&u.isCurrentlyAvailable?(u.name=f.productName,u.hasBeenFilled=!0,r&&n.shopByLineNumberScope.addProductsToBag()):u.hasAddToBagFailed=!1}});n.shopByLineNumberScope.$on("ShopByLineNumberService.SearchProductsByNameResponse",function(t,i){var s,h,v,e,p,w;if(!i.ErrorCode||i.ErrorCode!=AjaxError.ValidationErrors){var b=0,c=0,f=[],y=0,l=Math.floor(i.Data.Items.length/n.shopByLineNumberScope.defaultSearchRowCount),a=i.Data.Items.length%n.shopByLineNumberScope.defaultSearchRowCount;for(a>0&&l++,s=0;s<l;s++){for(h={pageNumber:++b,lines:[],startNonVersionLinePageIndex:c,endNonVersionLinePageIndex:c},v=!1,e=0;e<n.shopByLineNumberScope.defaultSearchRowCount;e++){if(s+1==l&&a>0&&e>=a)break;var u=n.shopByLineNumberScope.defaultSearchRowCount*s+e,k=i.Data.Items[u].ListPrice,d=i.Data.Items[u].SalePrice,r={listPrice:k.toFixed(2),lineNumber:i.Data.Items[u].LineNumber.replace("-",""),name:i.Data.Items[u].Name,fullName:i.Data.Items[u].FullName,salePrice:d.toFixed(2),isVersion:i.Data.Items[u].IsVersion,hasVersions:i.Data.Items[u].HasVersions,hasBeenAdded:!1,id:e,fullDisplayName:i.Data.Items[u].FullName,sku:i.Data.Items[u].Sku,fsc:i.Data.Items[u].Fsc};r.isVersion?r.fullDisplayName=r.fullDisplayName+" - "+r.lineNumber:(c++,h.endNonVersionLinePageIndex++,y++,r.hasVersions||(r.fullDisplayName=r.fullDisplayName+" - "+r.lineNumber));r.isVersion||v||(h.startNonVersionLinePageIndex=c,v=!0);r.isVersion||!r.isVersion&&!r.hasVersions;h.lines.push(r)}f.push(h);p={Type:TrackingEventType.ShopbyProductNumberSearchResults,Data:{searchTerm:n.shopByLineNumberScope.searchTerm,campaignNumber:n.shopByLineNumberScope.searchSelectedCampaign,resultsNo:i.Data.HasExactMatchBeenFound?i.Data.Items.length:"zero"}};o.TrackEventItem(p)}n.shopByLineNumberScope.searchActualProductCount=y;n.shopByLineNumberScope.areResultsSuggestions=f[0]?!i.Data.HasExactMatchBeenFound:!0;n.shopByLineNumberScope.searchResultsPages=f;n.shopByLineNumberScope.currentPage=f[0];n.shopByLineNumberScope.currentPageLines=f[0]?f[0].lines:[];n.shopByLineNumberScope.currentPageNumber=1;n.shopByLineNumberScope.movePreviousPageActive=!1;n.shopByLineNumberScope.moveNextPageActive=f.length>1;n.shopByLineNumberScope.HideLoading();$("#search-results-dialog").hasClass("Shown")||(w={AllowExit:!0,Model:null,KeepLoaded:!1,UrlToLoad:null},n.shopByLineNumberScope.displaySearchResultsDialog(w))}});n.shopByLineNumberScope.initializeRenderView=function(){n.shopByLineNumberScope.addRows(n.shopByLineNumberScope.defaultRowSize,0)};n.shopByLineNumberScope.getCurrentCampaign=function(){return AVON.campaign.toString()};n.shopByLineNumberScope.instantiateEmptyRow=function(){return{id:0,selectedCampaign:null,availableCampaignOptions:[],hasBeenFilled:!1,name:"",quantity:"",abbreviatedCampaignNumber:"",campaignNumber:0,lineNumber:"",isInvalidLineNumber:!1,isInvalidProduct:!1,isAvailable:!0,isNoLongerAvailable:!1,isAvailableSoon:!1,isPromotionNotMet:!1,isCurrentlyAvailable:!0,canBeRepDelivered:!1,hasAddToBagFailed:!1,addToBagErrorMessage:"",sku:"",fsc:""}};n.shopByLineNumberScope.addRows=function(t,i){var u,r;if(t>0)for(u=0;u<t;u++)r=n.shopByLineNumberScope.instantiateEmptyRow(),r.id=i+u,r.availableCampaignOptions=n.shopByLineNumberScope.getFormattedCampaignNumbers(),r.selectedCampaign=r.availableCampaignOptions[0].value,n.shopByLineNumberScope.productRows.push(r)};n.shopByLineNumberScope.searchProductNameByLineNumber=function(t,i){var r,u,e;t<0||t>=n.shopByLineNumberScope.productRows.length||(r=n.shopByLineNumberScope.productRows[t].lineNumber,r.length>0?(u=n.shopByLineNumberScope.productRows[t].selectedCampaign,e={rowId:t,lineNumber:r,campaignNumber:u},f.getProductNameByLineNumber(e,i)):n.shopByLineNumberScope.resetProductRow(t))};n.shopByLineNumberScope.getNumberFromCampaignString=function(){var i=n.shopByLineNumberScope.getCurrentCampaign(),t=i.substring(4);return t.substring(0,1)==="0"&&(t=t.substring(1)),parseInt(t,10)};n.shopByLineNumberScope.getCampaignNumbers=function(){var u=n.shopByLineNumberScope.getCurrentCampaign(),f,i,e,o,t,r;if(u.length!==6)return["000000","000000","000000"];if(f=u.substring(0,4),i=n.shopByLineNumberScope.getNumberFromCampaignString(),i<3){if(e=(parseInt(f,10)-1).toString(),i===1)return[u,e+"26",e+"25"];if(i===2)return[u,f+"01",e+"26"]}for(o=[],r=0;r<3;r+=1)t=(i-r).toString(),t=t.length<2?"0"+t:t,o[r]=f+t;return o};n.shopByLineNumberScope.resetProductRow=function(t){var i=n.shopByLineNumberScope.productRows[t];i.quantity="";i.hasBeenFilled=!1;i.isInvalidLineNumber=!1;i.isInvalidProduct=!1;i.lineNumber="";i.name="";i.isAvailable=!0;i.isNoLongerAvailable=!1;i.isAvailableSoon=!1;i.canBeRepDelivered=!1;i.addToBagErrorMessage="";i.hasAddToBagFailed=!1;i.isCurrentlyAvailable=!0;i.selectedCampaign=n.shopByLineNumberScope.productRows[t].availableCampaignOptions[0].value};n.shopByLineNumberScope.resetForm=function(){for(var t,r=n.shopByLineNumberScope.productRows.slice(0,n.shopByLineNumberScope.defaultRowSize),i=0;i<r.length;i++)t=r[i],t.quantity="",t.hasBeenFilled=!1,t.isInvalidLineNumber=!1,t.isInvalidProduct=!1,t.lineNumber="",t.name="",t.quantity="",t.isAvailable=!0,t.isNoLongerAvailable=!1,t.isAvailableSoon=!1,t.canBeRepDelivered=!1,t.selectedCampaign=n.shopByLineNumberScope.productRows[i].availableCampaignOptions[0].value,t.addToBagErrorMessage="",t.hasAddToBagFailed=!1,t.isCurrentlyAvailable=!0;n.shopByLineNumberScope.productRows=r};n.shopByLineNumberScope.addAdditionalRows=function(){n.shopByLineNumberScope.addRows(5,n.shopByLineNumberScope.productRows.length)};n.shopByLineNumberScope.clearAdditionalInformation=function(t){if(!(t<0)&&!(t>=n.shopByLineNumberScope.productRows.length)){var i=n.shopByLineNumberScope.productRows[t];i.isInvalidLineNumber=!1;i.isInvalidProduct=!1;i.hasAddToBagFailed=!1;i.isCurrentlyAvailable=!0}};n.shopByLineNumberScope.checkForInvalidLineNumbers=function(){var t=n.shopByLineNumberScope.searchTerm.replace("-","");return $.inArray(t,n.shopByLineNumberScope.invalidLineNumbers)>-1?!0:!1};n.shopByLineNumberScope.searchProductsByTerm=function(){if(n.shopByLineNumberScope.checkForInvalidLineNumbers()){n.shopByLineNumberScope.invalidSearchTerm=!0;n.shopByLineNumberScope.searchTerm="";return}if(n.shopByLineNumberScope.invalidSearchTerm=!1,/\S/.test(n.shopByLineNumberScope.searchTerm)){n.shopByLineNumberScope.ShowLoading(AVON.messages.spinner_loading);var t={searchTerm:n.shopByLineNumberScope.searchTerm,campaignNumber:n.shopByLineNumberScope.searchSelectedCampaign};f.searchProductsByName(t)}};n.shopByLineNumberScope.moveToPreviousPage=function(){n.shopByLineNumberScope.currentPageNumber>1&&n.shopByLineNumberScope.currentPageNumber--;n.shopByLineNumberScope.currentPage=n.shopByLineNumberScope.searchResultsPages[n.shopByLineNumberScope.currentPageNumber-1];n.shopByLineNumberScope.currentPageLines=n.shopByLineNumberScope.searchResultsPages[n.shopByLineNumberScope.currentPageNumber-1].lines;n.shopByLineNumberScope.updatePagerButtons()};n.shopByLineNumberScope.moveToNextPage=function(){n.shopByLineNumberScope.currentPageNumber<n.shopByLineNumberScope.searchResultsPages.length&&n.shopByLineNumberScope.currentPageNumber++;n.shopByLineNumberScope.currentPage=n.shopByLineNumberScope.searchResultsPages[n.shopByLineNumberScope.currentPageNumber-1];n.shopByLineNumberScope.currentPageLines=n.shopByLineNumberScope.searchResultsPages[n.shopByLineNumberScope.currentPageNumber-1].lines;n.shopByLineNumberScope.updatePagerButtons()};n.shopByLineNumberScope.moveToPage=function(t){n.shopByLineNumberScope.currentPageNumber=t<1?1:t>n.shopByLineNumberScope.searchResultsPages.length?n.shopByLineNumberScope.searchResultsPages.length:t;n.shopByLineNumberScope.currentPage=n.shopByLineNumberScope.searchResultsPages[n.shopByLineNumberScope.currentPageNumber-1];n.shopByLineNumberScope.currentPageLines=n.shopByLineNumberScope.searchResultsPages[n.shopByLineNumberScope.currentPageNumber-1].lines;n.shopByLineNumberScope.updatePagerButtons()};n.shopByLineNumberScope.updatePagerButtons=function(){n.shopByLineNumberScope.movePreviousPageActive=n.shopByLineNumberScope.currentPageNumber>1;n.shopByLineNumberScope.moveNextPageActive=n.shopByLineNumberScope.currentPageNumber<n.shopByLineNumberScope.searchResultsPages.length};n.shopByLineNumberScope.displaySearchResultsDialog=function(t){n.shopByLineNumberScope.HideLoading();$("#search-results-dialog").trigger("modal",t)};n.shopByLineNumberScope.defaultRowSize=10;n.shopByLineNumberScope.productRows=[];n.shopByLineNumberScope.searchTerm="";n.shopByLineNumberScope.searchAvailableCampaignOptions=n.shopByLineNumberScope.getFormattedCampaignNumbers();n.shopByLineNumberScope.searchSelectedCampaign=n.shopByLineNumberScope.searchAvailableCampaignOptions[0].value;n.shopByLineNumberScope.defaultSearchRowCount=8;n.shopByLineNumberScope.initializeRenderView()}return __extends(i,t),i.$inject=["$rootScope","$scope","$timeout","shopByLineNumberService","bagService","trackingService"],i}(BaseAngularController);n.ShopByLineNumberController=t}(ShopByLineNumberModule||(ShopByLineNumberModule={}));app.controller("ShopByLineNumberController",ShopByLineNumberModule.ShopByLineNumberController);"function"!=typeof Object.create&&(Object.create=function(n){function t(){}return t.prototype=n,new t}),function(n){function i(){n(".RolloverToZoom").hide();n(".ClickToEnlarge").show()}function t(){n(".RolloverToZoom").show();n(".ClickToEnlarge").hide()}var r={init:function(t,i){var r=this;r.elem=i;r.$elem=n(i);r.imageSrc=r.$elem.data("zoom-image")?r.$elem.data("zoom-image"):r.$elem.attr("src");r.options=n.extend({},n.fn.elevateZoom.options,t);r.options.tint&&(r.options.lensColour="none",r.options.lensOpacity="1");"inner"==r.options.zoomType&&(r.options.showLens=!1);r.$elem.parent().removeAttr("title").removeAttr("alt");r.zoomImage=r.imageSrc;r.refresh(1);n("#"+r.options.gallery+" a").click(function(t){return r.options.galleryActiveClass&&(n("#"+r.options.gallery+" a").removeClass(r.options.galleryActiveClass),n(this).addClass(r.options.galleryActiveClass)),t.preventDefault(),r.zoomImagePre=n(this).data("zoom-image")?n(this).data("zoom-image"):n(this).data("image"),r.swaptheimage(n(this).data("image"),r.zoomImagePre),!1})},refresh:function(n){var t=this;setTimeout(function(){t.fetch(t.imageSrc)},n||t.options.refresh)},fetch:function(n){var t=this,i=new Image;i.onload=function(){t.largeWidth=i.width;t.largeHeight=i.height;t.startZoom();t.currentImage=t.imageSrc;t.options.onZoomedImageLoaded(t.$elem)};i.src=n},startZoom:function(){var r=this,u;(r.nzWidth=r.$elem.data("zoom-max-width")?parseInt(r.$elem.data("zoom-max-width")):r.$elem.width(),r.nzHeight=r.$elem.data("zoom-max-height")?parseInt(r.$elem.data("zoom-max-height")):r.$elem.height(),r.isWindowActive=!1,r.isLensActive=!1,r.isTintActive=!1,r.overWindow=!1,r.options.imageCrossfade&&(r.zoomWrap=r.$elem.wrap('<div style="height:'+r.nzHeight+"px;width:"+r.nzWidth+'px;" class="zoomWrapper" />'),r.$elem.css("position","absolute")),r.zoomLock=1,r.scrollingLock=!1,r.changeBgSize=!1,r.currentZoomLevel=r.options.zoomLevel,r.nzOffset=r.$elem.offset(),r.widthRatio=r.largeWidth/r.currentZoomLevel/r.nzWidth,r.heightRatio=r.largeHeight/r.currentZoomLevel/r.nzHeight,"window"==r.options.zoomType&&(r.zoomWindowStyle="overflow: hidden;background-position: 0px 0px;text-align:center;background-color: "+String(r.options.zoomWindowBgColour)+";width: "+String(r.options.zoomWindowWidth)+"px;height: "+String(r.options.zoomWindowHeight)+"px;float: left;background-size: "+r.largeWidth/r.currentZoomLevel+"px "+r.largeHeight/r.currentZoomLevel+"px;display: none;z-index:100;border: "+String(r.options.borderSize)+"px solid "+r.options.borderColour+";background-repeat: no-repeat;cursor: none;position: absolute;"),"inner"==r.options.zoomType)&&(u=r.$elem.css("border-left-width"),r.zoomWindowStyle="overflow: hidden;margin-left: "+String(u)+";margin-top: "+String(u)+";background-position: 0px 0px;width: "+String(r.nzWidth)+"px;height: "+String(r.nzHeight)+"px;float: left;display: none;cursor: none;px solid "+r.options.borderColour+";background-repeat: no-repeat;position: absolute;");"window"==r.options.zoomType&&(lensHeight=r.nzHeight<r.options.zoomWindowWidth/r.widthRatio?r.nzHeight:String(r.options.zoomWindowHeight/r.heightRatio),lensWidth=r.largeWidth<r.options.zoomWindowWidth?r.nzWidth:r.options.zoomWindowWidth/r.widthRatio,r.lensStyle="background-position: 0px 0px;width: "+String(r.options.zoomWindowWidth/r.widthRatio)+"px;height: "+String(r.options.zoomWindowHeight/r.heightRatio)+"px;float: right;display: none;overflow: hidden;z-index: 999;-webkit-transform: translateZ(0);opacity:"+r.options.lensOpacity+";filter: alpha(opacity = "+100*r.options.lensOpacity+"); zoom:1;width:"+lensWidth+"px;height:"+lensHeight+"px;background-color:"+r.options.lensColour+";cursor: none;border: "+r.options.lensBorderSize+"px solid "+r.options.lensBorderColour+";background-repeat: no-repeat;position: absolute;");r.tintStyle="display: block;position: absolute;background-color: "+r.options.tintColour+";filter:alpha(opacity=0);opacity: 0;width: "+r.nzWidth+"px;height: "+r.nzHeight+"px;cursor: none;";r.lensRound="";"lens"==r.options.zoomType&&(r.lensStyle="background-position: 0px 0px;float: left;display: none;border: "+String(r.options.borderSize)+"px solid "+r.options.borderColour+";width:"+String(r.options.lensSize)+"px;height:"+String(r.options.lensSize)+"px;background-repeat: no-repeat;position: absolute;cursor: none;");"round"==r.options.lensShape&&(r.lensRound="border-top-left-radius: "+String(r.options.lensSize/2+r.options.borderSize)+"px;border-top-right-radius: "+String(r.options.lensSize/2+r.options.borderSize)+"px;border-bottom-left-radius: "+String(r.options.lensSize/2+r.options.borderSize)+"px;border-bottom-right-radius: "+String(r.options.lensSize/2+r.options.borderSize)+"px;cursor: none;");r.zoomContainer=n('<div class="zoomContainer" style="-webkit-transform: translateZ(0);position:absolute;overflow:hidden;left:'+r.nzOffset.left+"px;top:"+r.nzOffset.top+"px;height:"+r.nzHeight+"px;width:"+r.nzWidth+'px;cursor: none;"><\/div>');r.options.sameParentElement?r.$elem.after(r.zoomContainer):n("body").append(r.zoomContainer);r.options.containLensZoom&&"lens"==r.options.zoomType&&r.zoomContainer.css("overflow","hidden");"inner"!=r.options.zoomType&&(r.zoomLens=n("<div class='zoomLens' style='"+r.lensStyle+r.lensRound+"'>&nbsp;<\/div>").appendTo(r.zoomContainer).click(function(){r.$elem.trigger("click")}),r.options.tint&&(r.tintContainer=n("<div/>").addClass("tintContainer"),r.zoomTint=n("<div class='zoomTint' style='"+r.tintStyle+"'><\/div>"),r.zoomLens.wrap(r.tintContainer),r.zoomTintcss=r.zoomLens.after(r.zoomTint),r.zoomTintImage=n('<img style="position: absolute; left: 0px; top: 0px; max-width: none; width: '+r.nzWidth+"px; height: "+r.nzHeight+'px;" src="'+r.imageSrc+'">').appendTo(r.zoomLens).click(function(){r.$elem.trigger("click")})));r.zoomWindow=isNaN(r.options.zoomWindowPosition)?n("<div style='z-index:999;left:"+r.windowOffsetLeft+"px;top:"+r.windowOffsetTop+"px;"+r.zoomWindowStyle+"' class='zoomWindow'>&nbsp;<\/div>").appendTo("body").click(function(){r.$elem.trigger("click")}):n("<div style='z-index:999;left:"+r.windowOffsetLeft+"px;top:"+r.windowOffsetTop+"px;"+r.zoomWindowStyle+"' class='zoomWindow'>&nbsp;<\/div>").appendTo(r.zoomContainer).click(function(){r.$elem.trigger("click")});r.zoomWindowContainer=n("<div/>").addClass("zoomWindowContainer").css("width",r.options.zoomWindowWidth);r.zoomWindow.wrap(r.zoomWindowContainer);"lens"==r.options.zoomType&&r.zoomLens.css({backgroundImage:"url('"+r.imageSrc+"')"});"window"==r.options.zoomType&&r.zoomWindow.css({backgroundImage:"url('"+r.imageSrc+"')"});"inner"==r.options.zoomType&&r.zoomWindow.css({backgroundImage:"url('"+r.imageSrc+"')"});r.$elem.bind("touchmove",function(n){n.preventDefault();var t=n.originalEvent.touches[0]||n.originalEvent.changedTouches[0];r.setPosition(t)});r.zoomContainer.bind("touchmove",function(n){"inner"==r.options.zoomType&&r.showHideWindow("show");n.preventDefault();var t=n.originalEvent.touches[0]||n.originalEvent.changedTouches[0];r.setPosition(t)});r.zoomContainer.bind("touchend",function(){r.showHideWindow("hide");r.options.showLens&&r.showHideLens("hide");r.options.tint&&"inner"!=r.options.zoomType&&r.showHideTint("hide")});r.$elem.bind("touchend",function(){r.showHideWindow("hide");r.options.showLens&&r.showHideLens("hide");r.options.tint&&"inner"!=r.options.zoomType&&r.showHideTint("hide")});r.options.showLens&&(r.zoomLens.bind("touchmove",function(n){n.preventDefault();var t=n.originalEvent.touches[0]||n.originalEvent.changedTouches[0];r.setPosition(t)}),r.zoomLens.bind("touchend",function(){r.showHideWindow("hide");r.options.showLens&&r.showHideLens("hide");r.options.tint&&"inner"!=r.options.zoomType&&r.showHideTint("hide")}));r.$elem.bind("mousemove",function(n){0==r.overWindow&&r.setElements("show");r.lastX===n.clientX&&r.lastY===n.clientY||(r.setPosition(n),r.currentLoc=n);r.lastX=n.clientX;r.lastY=n.clientY});r.zoomContainer.bind("mousemove",function(n){0==r.overWindow&&r.setElements("show");r.lastX===n.clientX&&r.lastY===n.clientY||(r.setPosition(n),r.currentLoc=n);r.lastX=n.clientX;r.lastY=n.clientY});"inner"!=r.options.zoomType&&r.zoomLens.bind("mousemove",function(n){r.lastX===n.clientX&&r.lastY===n.clientY||(r.setPosition(n),r.currentLoc=n);r.lastX=n.clientX;r.lastY=n.clientY});r.options.tint&&"inner"!=r.options.zoomType&&r.zoomTint.bind("mousemove",function(n){r.lastX===n.clientX&&r.lastY===n.clientY||(r.setPosition(n),r.currentLoc=n);r.lastX=n.clientX;r.lastY=n.clientY});"inner"==r.options.zoomType&&r.zoomWindow.bind("mousemove",function(n){r.lastX===n.clientX&&r.lastY===n.clientY||(r.setPosition(n),r.currentLoc=n);r.lastX=n.clientX;r.lastY=n.clientY});r.zoomContainer.add(r.$elem).mouseenter(function(){0==r.overWindow&&r.setElements("show");i()}).mouseleave(function(){r.scrollLock||r.setElements("hide");t()});"inner"!=r.options.zoomType&&r.zoomWindow.mouseenter(function(){r.overWindow=!0;r.setElements("hide");i()}).mouseleave(function(){r.overWindow=!1;t()});r.options.zoomLevel;r.minZoomLevel=r.options.minZoomLevel?r.options.minZoomLevel:2*r.options.scrollZoomIncrement;r.options.scrollZoom&&r.zoomContainer.add(r.$elem).bind("mousewheel DOMMouseScroll MozMousePixelScroll",function(i){r.scrollLock=!0;clearTimeout(n.data(this,"timer"));n.data(this,"timer",setTimeout(function(){r.scrollLock=!1;t()},250));var u=i.originalEvent.wheelDelta||-1*i.originalEvent.detail;return i.stopImmediatePropagation(),i.stopPropagation(),i.preventDefault(),u/120>0?r.currentZoomLevel>=r.minZoomLevel&&r.changeZoomLevel(r.currentZoomLevel-r.options.scrollZoomIncrement):r.options.maxZoomLevel?r.currentZoomLevel<=r.options.maxZoomLevel&&r.changeZoomLevel(parseFloat(r.currentZoomLevel)+r.options.scrollZoomIncrement):r.changeZoomLevel(parseFloat(r.currentZoomLevel)+r.options.scrollZoomIncrement),!1})},setElements:function(n){var t=this;if(!t.options.zoomEnabled)return!1;"show"==n&&t.isWindowSet&&("inner"==t.options.zoomType&&t.showHideWindow("show"),"window"==t.options.zoomType&&t.showHideWindow("show"),t.options.showLens&&t.showHideLens("show"),t.options.tint&&"inner"!=t.options.zoomType&&t.showHideTint("show"));"hide"==n&&("window"==t.options.zoomType&&t.showHideWindow("hide"),t.options.tint||t.showHideWindow("hide"),t.options.showLens&&t.showHideLens("hide"),t.options.tint&&t.showHideTint("hide"))},setPosition:function(n){var t=this,i;if(!t.options.zoomEnabled)return!1;t.nzHeight=t.$elem.height();t.nzWidth=t.$elem.width();t.nzOffset=t.$elem.offset();t.options.tint&&"inner"!=t.options.zoomType&&(t.zoomTint.css({top:0}),t.zoomTint.css({left:0}));t.options.responsive&&!t.options.scrollZoom&&t.options.showLens&&(lensHeight=t.nzHeight<t.options.zoomWindowWidth/t.widthRatio?t.nzHeight:String(t.options.zoomWindowHeight/t.heightRatio),lensWidth=t.largeWidth<t.options.zoomWindowWidth?t.nzWidth:t.options.zoomWindowWidth/t.widthRatio,t.widthRatio=t.largeWidth/t.nzWidth,t.heightRatio=t.largeHeight/t.nzHeight,"lens"!=t.options.zoomType&&(lensHeight=t.nzHeight<t.options.zoomWindowWidth/t.widthRatio?t.nzHeight:String(t.options.zoomWindowHeight/t.heightRatio),lensWidth=t.options.zoomWindowWidth<t.options.zoomWindowWidth?t.nzWidth:t.options.zoomWindowWidth/t.widthRatio,t.zoomLens.css("width",lensWidth),t.zoomLens.css("height",lensHeight),t.options.tint&&(t.zoomTintImage.css("width",t.nzWidth),t.zoomTintImage.css("height",t.nzHeight))),"lens"==t.options.zoomType&&t.zoomLens.css({width:String(t.options.lensSize)+"px",height:String(t.options.lensSize)+"px"}));i=t.options.sameParentElement?t.$elem.position():t.$elem.offset();t.zoomContainer.css({top:i.top});t.zoomContainer.css({left:i.left});t.mouseLeft=parseInt(n.pageX-t.nzOffset.left);t.mouseTop=parseInt(n.pageY-t.nzOffset.top);"window"==t.options.zoomType&&(t.Etoppos=t.mouseTop<t.zoomLens.height()/2,t.Eboppos=t.mouseTop>t.nzHeight-t.zoomLens.height()/2-2*t.options.lensBorderSize,t.Eloppos=t.mouseLeft<0+t.zoomLens.width()/2,t.Eroppos=t.mouseLeft>t.nzWidth-t.zoomLens.width()/2-2*t.options.lensBorderSize);"inner"==t.options.zoomType&&(t.Etoppos=t.mouseTop<t.nzHeight/2/t.heightRatio,t.Eboppos=t.mouseTop>t.nzHeight-t.nzHeight/2/t.heightRatio,t.Eloppos=t.mouseLeft<0+t.nzWidth/2/t.widthRatio,t.Eroppos=t.mouseLeft>t.nzWidth-t.nzWidth/2/t.widthRatio-2*t.options.lensBorderSize);t.mouseLeft<=0||t.mouseTop<0||t.mouseLeft>t.nzWidth||t.mouseTop>t.nzHeight?t.setElements("hide"):(t.options.showLens&&(t.lensLeftPos=String(t.mouseLeft-t.zoomLens.width()/2),t.lensTopPos=String(t.mouseTop-t.zoomLens.height()/2)),t.Etoppos&&(t.lensTopPos=0),t.Eloppos&&(t.windowLeftPos=0,t.lensLeftPos=0,t.tintpos=0),"window"==t.options.zoomType&&(t.Eboppos&&(t.lensTopPos=Math.max(t.nzHeight-t.zoomLens.height()-2*t.options.lensBorderSize,0)),t.Eroppos&&(t.lensLeftPos=t.nzWidth-t.zoomLens.width()-2*t.options.lensBorderSize)),"inner"==t.options.zoomType&&(t.Eboppos&&(t.lensTopPos=Math.max(t.nzHeight-2*t.options.lensBorderSize,0)),t.Eroppos&&(t.lensLeftPos=t.nzWidth-t.nzWidth-2*t.options.lensBorderSize)),"lens"==t.options.zoomType&&(t.windowLeftPos=String(-1*((n.pageX-t.nzOffset.left)*t.widthRatio-t.zoomLens.width()/2)),t.windowTopPos=String(-1*((n.pageY-t.nzOffset.top)*t.heightRatio-t.zoomLens.height()/2)),t.zoomLens.css({backgroundPosition:t.windowLeftPos+"px "+t.windowTopPos+"px"}),t.changeBgSize&&(t.nzHeight>t.nzWidth?("lens"==t.options.zoomType&&t.zoomLens.css({"background-size":t.largeWidth/t.newvalueheight+"px "+t.largeHeight/t.newvalueheight+"px"}),t.zoomWindow.css({"background-size":t.largeWidth/t.newvalueheight+"px "+t.largeHeight/t.newvalueheight+"px"})):("lens"==t.options.zoomType&&t.zoomLens.css({"background-size":t.largeWidth/t.newvaluewidth+"px "+t.largeHeight/t.newvaluewidth+"px"}),t.zoomWindow.css({"background-size":t.largeWidth/t.newvaluewidth+"px "+t.largeHeight/t.newvaluewidth+"px"})),t.changeBgSize=!1),t.setWindowPostition(n)),t.options.tint&&"inner"!=t.options.zoomType&&t.setTintPosition(n),"window"==t.options.zoomType&&t.setWindowPostition(n),"inner"==t.options.zoomType&&t.setWindowPostition(n),t.options.showLens&&(t.fullwidth&&"lens"!=t.options.zoomType&&(t.lensLeftPos=0),t.zoomLens.css({left:t.lensLeftPos+"px",top:t.lensTopPos+"px"})))},showHideWindow:function(n){var t=this;"show"==n&&(t.isWindowActive||(t.options.zoomWindowFadeIn?t.zoomWindow.stop(!0,!0,!1).fadeIn(t.options.zoomWindowFadeIn):t.zoomWindow.show(),t.isWindowActive=!0));"hide"==n&&t.isWindowActive&&(t.options.zoomWindowFadeOut?t.zoomWindow.stop(!0,!0).fadeOut(t.options.zoomWindowFadeOut):t.zoomWindow.hide(),t.isWindowActive=!1)},showHideLens:function(n){var t=this;"show"==n&&(t.isLensActive||(t.options.lensFadeIn?t.zoomLens.stop(!0,!0,!1).fadeIn(t.options.lensFadeIn):t.zoomLens.show(),t.isLensActive=!0));"hide"==n&&t.isLensActive&&(t.options.lensFadeOut?t.zoomLens.stop(!0,!0).fadeOut(t.options.lensFadeOut):t.zoomLens.hide(),t.isLensActive=!1)},showHideTint:function(n){var t=this;"show"==n&&(t.isTintActive||(t.options.zoomTintFadeIn?t.zoomTint.css({opacity:t.options.tintOpacity}).animate().stop(!0,!0).fadeIn("slow"):(t.zoomTint.css({opacity:t.options.tintOpacity}).animate(),t.zoomTint.show()),t.isTintActive=!0));"hide"==n&&t.isTintActive&&(t.options.zoomTintFadeOut?t.zoomTint.stop(!0,!0).fadeOut(t.options.zoomTintFadeOut):t.zoomTint.hide(),t.isTintActive=!1)},setLensPostition:function(){},setWindowPostition:function(t){var i=this;if(isNaN(i.options.zoomWindowPosition))i.externalContainer=n("#"+i.options.zoomWindowPosition),i.externalContainerWidth=i.externalContainer.width(),i.externalContainerHeight=i.externalContainer.height(),i.externalContainerOffset=i.externalContainer.offset(),i.windowOffsetTop=i.externalContainerOffset.top,i.windowOffsetLeft=i.externalContainerOffset.left;else switch(i.options.zoomWindowPosition){case 1:i.windowOffsetTop=i.options.zoomWindowOffety;i.windowOffsetLeft=+i.nzWidth;break;case 2:i.options.zoomWindowHeight>i.nzHeight&&(i.windowOffsetTop=-1*(i.options.zoomWindowHeight/2-i.nzHeight/2),i.windowOffsetLeft=i.nzWidth);break;case 3:i.windowOffsetTop=i.nzHeight-i.zoomWindow.height()-2*i.options.borderSize;i.windowOffsetLeft=i.nzWidth;break;case 4:i.windowOffsetTop=i.nzHeight;i.windowOffsetLeft=i.nzWidth;break;case 5:i.windowOffsetTop=i.nzHeight;i.windowOffsetLeft=i.nzWidth-i.zoomWindow.width()-2*i.options.borderSize;break;case 6:i.options.zoomWindowHeight>i.nzHeight&&(i.windowOffsetTop=i.nzHeight,i.windowOffsetLeft=-1*(i.options.zoomWindowWidth/2-i.nzWidth/2+2*i.options.borderSize));break;case 7:i.windowOffsetTop=i.nzHeight;i.windowOffsetLeft=0;break;case 8:i.windowOffsetTop=i.nzHeight;i.windowOffsetLeft=-1*(i.zoomWindow.width()+2*i.options.borderSize);break;case 9:i.windowOffsetTop=i.nzHeight-i.zoomWindow.height()-2*i.options.borderSize;i.windowOffsetLeft=-1*(i.zoomWindow.width()+2*i.options.borderSize);break;case 10:i.options.zoomWindowHeight>i.nzHeight&&(i.windowOffsetTop=-1*(i.options.zoomWindowHeight/2-i.nzHeight/2),i.windowOffsetLeft=-1*(i.zoomWindow.width()+2*i.options.borderSize));break;case 11:i.windowOffsetTop=i.options.zoomWindowOffety;i.windowOffsetLeft=-1*(i.zoomWindow.width()+2*i.options.borderSize);break;case 12:i.windowOffsetTop=-1*(i.zoomWindow.height()+2*i.options.borderSize);i.windowOffsetLeft=-1*(i.zoomWindow.width()+2*i.options.borderSize);break;case 13:i.windowOffsetTop=-1*(i.zoomWindow.height()+2*i.options.borderSize);i.windowOffsetLeft=0;break;case 14:i.options.zoomWindowHeight>i.nzHeight&&(i.windowOffsetTop=-1*(i.zoomWindow.height()+2*i.options.borderSize),i.windowOffsetLeft=-1*(i.options.zoomWindowWidth/2-i.nzWidth/2+2*i.options.borderSize));break;case 15:i.windowOffsetTop=-1*(i.zoomWindow.height()+2*i.options.borderSize);i.windowOffsetLeft=i.nzWidth-i.zoomWindow.width()-2*i.options.borderSize;break;case 16:i.windowOffsetTop=-1*(i.zoomWindow.height()+2*i.options.borderSize);i.windowOffsetLeft=i.nzWidth;break;default:i.windowOffsetTop=i.options.zoomWindowOffety;i.windowOffsetLeft=i.nzWidth}i.isWindowSet=!0;i.windowOffsetTop=i.windowOffsetTop+i.options.zoomWindowOffety;i.windowOffsetLeft=i.windowOffsetLeft+i.options.zoomWindowOffetx;i.zoomWindow.css({top:i.windowOffsetTop});i.zoomWindow.css({left:i.windowOffsetLeft});"inner"==i.options.zoomType&&(i.zoomWindow.css({top:0}),i.zoomWindow.css({left:0}));i.windowLeftPos=String(-1*((t.pageX-i.nzOffset.left)*i.widthRatio-i.zoomWindow.width()/2));i.windowTopPos=String(-1*((t.pageY-i.nzOffset.top)*i.heightRatio-i.zoomWindow.height()/2));i.Etoppos&&(i.windowTopPos=0);i.Eloppos&&(i.windowLeftPos=0);i.Eboppos&&(i.windowTopPos=-1*(i.largeHeight/i.currentZoomLevel-i.zoomWindow.height()));i.Eroppos&&(i.windowLeftPos=-1*(i.largeWidth/i.currentZoomLevel-i.zoomWindow.width()));i.fullheight&&(i.windowTopPos=0);i.fullwidth&&(i.windowLeftPos=0);"window"!=i.options.zoomType&&"inner"!=i.options.zoomType||(1==i.zoomLock&&(i.widthRatio<=1&&(i.windowLeftPos=0),i.heightRatio<=1&&(i.windowTopPos=0)),i.largeHeight<i.options.zoomWindowHeight&&(i.windowTopPos=0),i.largeWidth<i.options.zoomWindowWidth&&(i.windowLeftPos=0),i.options.easing?(i.xp||(i.xp=0),i.yp||(i.yp=0),i.loop||(i.loop=setInterval(function(){i.xp+=(i.windowLeftPos-i.xp)/i.options.easingAmount;i.yp+=(i.windowTopPos-i.yp)/i.options.easingAmount;i.scrollingLock?(clearInterval(i.loop),i.xp=i.windowLeftPos,i.yp=i.windowTopPos,i.xp=-1*((t.pageX-i.nzOffset.left)*i.widthRatio-i.zoomWindow.width()/2),i.yp=-1*((t.pageY-i.nzOffset.top)*i.heightRatio-i.zoomWindow.height()/2),i.changeBgSize&&(i.nzHeight>i.nzWidth?("lens"==i.options.zoomType&&i.zoomLens.css({"background-size":i.largeWidth/i.newvalueheight+"px "+i.largeHeight/i.newvalueheight+"px"}),i.zoomWindow.css({"background-size":i.largeWidth/i.newvalueheight+"px "+i.largeHeight/i.newvalueheight+"px"})):("lens"!=i.options.zoomType&&i.zoomLens.css({"background-size":i.largeWidth/i.newvaluewidth+"px "+i.largeHeight/i.newvalueheight+"px"}),i.zoomWindow.css({"background-size":i.largeWidth/i.newvaluewidth+"px "+i.largeHeight/i.newvaluewidth+"px"})),i.changeBgSize=!1),i.zoomWindow.css({backgroundPosition:i.windowLeftPos+"px "+i.windowTopPos+"px"}),i.scrollingLock=!1,i.loop=!1):(i.changeBgSize&&(i.nzHeight>i.nzWidth?("lens"==i.options.zoomType&&i.zoomLens.css({"background-size":i.largeWidth/i.newvalueheight+"px "+i.largeHeight/i.newvalueheight+"px"}),i.zoomWindow.css({"background-size":i.largeWidth/i.newvalueheight+"px "+i.largeHeight/i.newvalueheight+"px"})):("lens"!=i.options.zoomType&&i.zoomLens.css({"background-size":i.largeWidth/i.newvaluewidth+"px "+i.largeHeight/i.newvaluewidth+"px"}),i.zoomWindow.css({"background-size":i.largeWidth/i.newvaluewidth+"px "+i.largeHeight/i.newvaluewidth+"px"})),i.changeBgSize=!1),i.zoomWindow.css({backgroundPosition:i.xp+"px "+i.yp+"px"}))},16))):(i.changeBgSize&&(i.nzHeight>i.nzWidth?("lens"==i.options.zoomType&&i.zoomLens.css({"background-size":i.largeWidth/i.newvalueheight+"px "+i.largeHeight/i.newvalueheight+"px"}),i.zoomWindow.css({"background-size":i.largeWidth/i.newvalueheight+"px "+i.largeHeight/i.newvalueheight+"px"})):("lens"==i.options.zoomType&&i.zoomLens.css({"background-size":i.largeWidth/i.newvaluewidth+"px "+i.largeHeight/i.newvaluewidth+"px"}),i.largeHeight/i.newvaluewidth<i.options.zoomWindowHeight?i.zoomWindow.css({"background-size":i.largeWidth/i.newvaluewidth+"px "+i.largeHeight/i.newvaluewidth+"px"}):i.zoomWindow.css({"background-size":i.largeWidth/i.newvalueheight+"px "+i.largeHeight/i.newvalueheight+"px"})),i.changeBgSize=!1),i.zoomWindow.css({backgroundPosition:i.windowLeftPos+"px "+i.windowTopPos+"px"})))},setTintPosition:function(n){var t=this;t.nzOffset=t.$elem.offset();t.tintpos=String(-1*(n.pageX-t.nzOffset.left-t.zoomLens.width()/2));t.tintposy=String(-1*(n.pageY-t.nzOffset.top-t.zoomLens.height()/2));t.Etoppos&&(t.tintposy=0);t.Eloppos&&(t.tintpos=0);t.Eboppos&&(t.tintposy=-1*(t.nzHeight-t.zoomLens.height()-2*t.options.lensBorderSize));t.Eroppos&&(t.tintpos=-1*(t.nzWidth-t.zoomLens.width()-2*t.options.lensBorderSize));t.options.tint&&(t.fullheight&&(t.tintposy=0),t.fullwidth&&(t.tintpos=0),t.zoomTintImage.css({left:t.tintpos+"px"}),t.zoomTintImage.css({top:t.tintposy+"px"}))},swaptheimage:function(t,i){var r=this,u=new Image;r.options.loadingIcon&&(r.spinner=n("<div style=\"background: url('"+r.options.loadingIcon+"') no-repeat center;height:"+r.nzHeight+"px;width:"+r.nzWidth+'px;z-index: 2000;position: absolute; background-position: center center;"><\/div>'),r.$elem.after(r.spinner));r.options.onImageSwap(r.$elem);u.onload=function(){r.largeWidth=u.width;r.largeHeight=u.height;r.zoomImage=i;r.zoomWindow.css({"background-size":r.largeWidth+"px "+r.largeHeight+"px"});r.zoomWindow.css({"background-size":r.largeWidth+"px "+r.largeHeight+"px"});r.swapAction(t,i)};u.src=i},swapAction:function(t,i){var r=this,u=new Image,f,e,o,s;(u.onload=function(){r.nzHeight=u.height;r.nzWidth=u.width;r.options.onImageSwapComplete(r.$elem);r.doneCallback()},u.src=t,r.currentZoomLevel=r.options.zoomLevel,r.options.maxZoomLevel=!1,"lens"==r.options.zoomType&&r.zoomLens.css({backgroundImage:"url('"+i+"')"}),"window"==r.options.zoomType&&r.zoomWindow.css({backgroundImage:"url('"+i+"')"}),"inner"==r.options.zoomType&&r.zoomWindow.css({backgroundImage:"url('"+i+"')"}),r.currentImage=i,r.options.imageCrossfade)?(f=r.$elem,e=f.clone(),(r.$elem.attr("src",t),r.$elem.after(e),e.stop(!0).fadeOut(r.options.imageCrossfade,function(){n(this).remove()}),r.$elem.width("auto").removeAttr("width"),r.$elem.height("auto").removeAttr("height"),f.fadeIn(r.options.imageCrossfade),r.options.tint&&"inner"!=r.options.zoomType)&&(o=r.zoomTintImage,s=o.clone(),r.zoomTintImage.attr("src",i),r.zoomTintImage.after(s),s.stop(!0).fadeOut(r.options.imageCrossfade,function(){n(this).remove()}),o.fadeIn(r.options.imageCrossfade),r.zoomTint.css({height:r.$elem.height()}),r.zoomTint.css({width:r.$elem.width()})),r.zoomContainer.css("height",r.$elem.height()),r.zoomContainer.css("width",r.$elem.width()),"inner"==r.options.zoomType&&(r.options.constrainType||(r.zoomWrap.parent().css("height",r.$elem.height()),r.zoomWrap.parent().css("width",r.$elem.width()),r.zoomWindow.css("height",r.$elem.height()),r.zoomWindow.css("width",r.$elem.width()))),r.options.imageCrossfade&&(r.zoomWrap.css("height",r.$elem.height()),r.zoomWrap.css("width",r.$elem.width()))):(r.$elem.attr("src",t),r.options.tint&&(r.zoomTintImage.attr("src",i),r.zoomTintImage.attr("height",r.$elem.height()),r.zoomTintImage.css({height:r.$elem.height()}),r.zoomTint.css({height:r.$elem.height()})),r.zoomContainer.css("height",r.$elem.height()),r.zoomContainer.css("width",r.$elem.width()),r.options.imageCrossfade&&(r.zoomWrap.css("height",r.$elem.height()),r.zoomWrap.css("width",r.$elem.width())));r.options.constrainType&&("height"==r.options.constrainType&&(r.zoomContainer.css("height",r.options.constrainSize),r.zoomContainer.css("width","auto"),r.options.imageCrossfade?(r.zoomWrap.css("height",r.options.constrainSize),r.zoomWrap.css("width","auto"),r.constwidth=r.zoomWrap.width()):(r.$elem.css("height",r.options.constrainSize),r.$elem.css("width","auto"),r.constwidth=r.$elem.width()),"inner"==r.options.zoomType&&(r.zoomWrap.parent().css("height",r.options.constrainSize),r.zoomWrap.parent().css("width",r.constwidth),r.zoomWindow.css("height",r.options.constrainSize),r.zoomWindow.css("width",r.constwidth)),r.options.tint&&(r.tintContainer.css("height",r.options.constrainSize),r.tintContainer.css("width",r.constwidth),r.zoomTint.css("height",r.options.constrainSize),r.zoomTint.css("width",r.constwidth),r.zoomTintImage.css("height",r.options.constrainSize),r.zoomTintImage.css("width",r.constwidth))),"width"==r.options.constrainType&&(r.zoomContainer.css("height","auto"),r.zoomContainer.css("width",r.options.constrainSize),r.options.imageCrossfade?(r.zoomWrap.css("height","auto"),r.zoomWrap.css("width",r.options.constrainSize),r.constheight=r.zoomWrap.height()):(r.$elem.css("height","auto"),r.$elem.css("width",r.options.constrainSize),r.constheight=r.$elem.height()),"inner"==r.options.zoomType&&(r.zoomWrap.parent().css("height",r.constheight),r.zoomWrap.parent().css("width",r.options.constrainSize),r.zoomWindow.css("height",r.constheight),r.zoomWindow.css("width",r.options.constrainSize)),r.options.tint&&(r.tintContainer.css("height",r.constheight),r.tintContainer.css("width",r.options.constrainSize),r.zoomTint.css("height",r.constheight),r.zoomTint.css("width",r.options.constrainSize),r.zoomTintImage.css("height",r.constheight),r.zoomTintImage.css("width",r.options.constrainSize))))},doneCallback:function(){var n=this;n.options.loadingIcon&&n.spinner.hide();n.nzOffset=n.$elem.offset();n.nzWidth=n.$elem.width();n.nzHeight=n.$elem.height();n.currentZoomLevel=n.options.zoomLevel;n.widthRatio=n.largeWidth/n.nzWidth;n.heightRatio=n.largeHeight/n.nzHeight;"window"==n.options.zoomType&&(lensHeight=n.nzHeight<n.options.zoomWindowWidth/n.widthRatio?n.nzHeight:String(n.options.zoomWindowHeight/n.heightRatio),lensWidth=n.options.zoomWindowWidth<n.options.zoomWindowWidth?n.nzWidth:n.options.zoomWindowWidth/n.widthRatio,n.zoomLens&&(n.zoomLens.css("width",lensWidth),n.zoomLens.css("height",lensHeight)))},getCurrentImage:function(){return this.zoomImage},getGalleryList:function(){var t=this;return t.gallerylist=[],t.options.gallery?n("#"+t.options.gallery+" a").each(function(){var i="";n(this).data("zoom-image")?i=n(this).data("zoom-image"):n(this).data("image")&&(i=n(this).data("image"));i==t.zoomImage?t.gallerylist.unshift({href:""+i,title:n(this).find("img").attr("title")}):t.gallerylist.push({href:""+i,title:n(this).find("img").attr("title")})}):t.gallerylist.push({href:""+t.zoomImage,title:n(this).find("img").attr("title")}),t.gallerylist},changeZoomLevel:function(n){var t=this;t.scrollingLock=!0;t.newvalue=parseFloat(n).toFixed(2);newvalue=parseFloat(n).toFixed(2);maxheightnewvalue=t.largeHeight/(t.options.zoomWindowHeight/t.nzHeight*t.nzHeight);maxwidthtnewvalue=t.largeWidth/(t.options.zoomWindowWidth/t.nzWidth*t.nzWidth);"inner"!=t.options.zoomType&&(maxheightnewvalue<=newvalue?(t.heightRatio=t.largeHeight/maxheightnewvalue/t.nzHeight,t.newvalueheight=maxheightnewvalue,t.fullheight=!0):(t.heightRatio=t.largeHeight/newvalue/t.nzHeight,t.newvalueheight=newvalue,t.fullheight=!1),maxwidthtnewvalue<=newvalue?(t.widthRatio=t.largeWidth/maxwidthtnewvalue/t.nzWidth,t.newvaluewidth=maxwidthtnewvalue,t.fullwidth=!0):(t.widthRatio=t.largeWidth/newvalue/t.nzWidth,t.newvaluewidth=newvalue,t.fullwidth=!1),"lens"==t.options.zoomType&&(maxheightnewvalue<=newvalue?(t.fullwidth=!0,t.newvaluewidth=maxheightnewvalue):(t.widthRatio=t.largeWidth/newvalue/t.nzWidth,t.newvaluewidth=newvalue,t.fullwidth=!1)));"inner"==t.options.zoomType&&(maxheightnewvalue=parseFloat(t.largeHeight/t.nzHeight).toFixed(2),maxwidthtnewvalue=parseFloat(t.largeWidth/t.nzWidth).toFixed(2),newvalue>maxheightnewvalue&&(newvalue=maxheightnewvalue),newvalue>maxwidthtnewvalue&&(newvalue=maxwidthtnewvalue),maxheightnewvalue<=newvalue?(t.heightRatio=t.largeHeight/newvalue/t.nzHeight,t.newvalueheight=newvalue>maxheightnewvalue?maxheightnewvalue:newvalue,t.fullheight=!0):(t.heightRatio=t.largeHeight/newvalue/t.nzHeight,t.newvalueheight=newvalue>maxheightnewvalue?maxheightnewvalue:newvalue,t.fullheight=!1),maxwidthtnewvalue<=newvalue?(t.widthRatio=t.largeWidth/newvalue/t.nzWidth,t.newvaluewidth=newvalue>maxwidthtnewvalue?maxwidthtnewvalue:newvalue,t.fullwidth=!0):(t.widthRatio=t.largeWidth/newvalue/t.nzWidth,t.newvaluewidth=newvalue,t.fullwidth=!1));scrcontinue=!1;"inner"==t.options.zoomType&&(t.nzWidth>t.nzHeight&&(t.newvaluewidth<=maxwidthtnewvalue?scrcontinue=!0:(scrcontinue=!1,t.fullheight=!0,t.fullwidth=!0)),t.nzHeight>t.nzWidth&&(t.newvaluewidth<=maxwidthtnewvalue?scrcontinue=!0:(scrcontinue=!1,t.fullheight=!0,t.fullwidth=!0)));"inner"!=t.options.zoomType&&(scrcontinue=!0);scrcontinue&&(t.zoomLock=0,t.changeZoom=!0,t.options.zoomWindowHeight/t.heightRatio<=t.nzHeight&&(t.currentZoomLevel=t.newvalueheight,"lens"!=t.options.zoomType&&"inner"!=t.options.zoomType&&(t.changeBgSize=!0,t.zoomLens.css({height:String(t.options.zoomWindowHeight/t.heightRatio)+"px"})),"lens"!=t.options.zoomType&&"inner"!=t.options.zoomType||(t.changeBgSize=!0)),t.options.zoomWindowWidth/t.widthRatio<=t.nzWidth&&("inner"!=t.options.zoomType&&t.newvaluewidth>t.newvalueheight&&(t.currentZoomLevel=t.newvaluewidth),"lens"!=t.options.zoomType&&"inner"!=t.options.zoomType&&(t.changeBgSize=!0,t.zoomLens.css({width:String(t.options.zoomWindowWidth/t.widthRatio)+"px"})),"lens"!=t.options.zoomType&&"inner"!=t.options.zoomType||(t.changeBgSize=!0)),"inner"==t.options.zoomType&&(t.changeBgSize=!0,t.nzWidth>t.nzHeight&&(t.currentZoomLevel=t.newvaluewidth),t.nzHeight>t.nzWidth&&(t.currentZoomLevel=t.newvaluewidth)));t.setPosition(t.currentLoc)},closeAll:function(){self.zoomWindow&&self.zoomWindow.hide();self.zoomLens&&self.zoomLens.hide();self.zoomTint&&self.zoomTint.hide()},changeState:function(n){var t=this;"enable"==n&&(t.options.zoomEnabled=!0);"disable"==n&&(t.options.zoomEnabled=!1)}};n.fn.elevateZoom=function(t){return this.each(function(){var i=Object.create(r);i.init(t,this);n.data(this,"elevateZoom",i)})};n.fn.elevateZoom.options={zoomActivation:"hover",zoomEnabled:!0,preloading:1,zoomLevel:1,scrollZoom:!1,scrollZoomIncrement:.1,minZoomLevel:!1,maxZoomLevel:!1,easing:!1,easingAmount:12,lensSize:200,zoomWindowWidth:400,zoomWindowHeight:400,zoomWindowOffetx:0,zoomWindowOffety:0,zoomWindowPosition:1,zoomWindowBgColour:"#fff",lensFadeIn:!1,lensFadeOut:!1,debug:!1,zoomWindowFadeIn:!1,zoomWindowFadeOut:!1,zoomWindowAlwaysShow:!1,zoomTintFadeIn:!1,zoomTintFadeOut:!1,borderSize:4,showLens:!0,borderColour:"#888",lensBorderSize:1,lensBorderColour:"#000",lensShape:"square",zoomType:"window",containLensZoom:!1,lensColour:"white",lensOpacity:.4,lenszoom:!1,tint:!1,tintColour:"#333",tintOpacity:.4,gallery:!1,galleryActiveClass:"zoomGalleryActive",imageCrossfade:!1,constrainType:!1,constrainSize:!1,loadingIcon:!1,cursor:"default",responsive:!0,onComplete:n.noop,onZoomedImageLoaded:function(){},onImageSwap:n.noop,onImageSwapComplete:n.noop}}(jQuery,window,document)