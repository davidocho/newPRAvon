var __extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},PaymentServiceModule,ConfirmationModule,SampleServiceModule,CheckoutModule,CouponModule,MiniViewBagModule,OrderDetailsModule,AddressModule,PaymentModule,SampleModule,ViewBagModule;(function(n){var t=function(n){function t(i,r,u,f){n.call(this,i,r,f);t.rootScope=i;t.http=r;t.q=f;t.trackingService=u}return __extends(t,n),t.prototype.submitOrderWithCreditCard=function(n,i,r,u){n.Cvv2=1e3-parseInt(n.CvvNumber,10)%300;var f="/api/checkout/submitorderwithcreditcard";i&&(f="/api/checkout/submitguestshopperorder");this.PostJson(f,{creditCardModel:n,compatibleBrowser:u},r).success(function(n){n!==null&&t.rootScope.$broadcast("PaymentService.SubmitOrderResponse",n)}).error(function(n){t.rootScope.$broadcast("PaymentService.SubmitOrderResponse",n)})},t.prototype.submitOrderWithStoredCreditCard=function(n,i,r){n.Cvv2=1e3-parseInt(n.CvvNumber)%300;this.PostJson("/api/checkout/submitorderwithstoredcreditcard",{storedCreditCardModel:n,compatibleBrowser:r},i).success(function(n){n!==null&&t.rootScope.$broadcast("PaymentService.SubmitOrderResponse",n)}).error(function(n){t.rootScope.$broadcast("PaymentService.SubmitOrderResponse",n)})},t.prototype.submitOrderRepDelivery=function(n,i){this.PostJson("/api/checkout/submitorderrepdelivery",{compatibleBrowser:i},n).success(function(n){n!==null&&t.rootScope.$broadcast("PaymentService.SubmitOrderResponse",n)}).error(function(n){t.rootScope.$broadcast("PaymentService.SubmitOrderResponse",n)})},t.prototype.saveCreditCardDetails=function(n,i){this.PostJson("/api/creditcard/save",{creditCardModel:n},i).success(function(n){n!==null&&t.rootScope.$broadcast("PaymentService.SaveCreditCardResponse",n)}).error(function(n){t.rootScope.$broadcast("PaymentService.SaveCreditCardResponse",n)})},t.prototype.updateGiftMessage=function(n){this.PostJson("/api/checkout/updategiftmessage",{giftMessageModel:n}).success(function(n){n!==null&&t.rootScope.$broadcast("PaymentService.UpdateGiftMessageResponse",n)}).error(function(n){t.rootScope.$broadcast("PaymentService.UpdateGiftMessageResponse",n)})},t.prototype.clearGiftMessage=function(){this.PostJson("/api/checkout/cleargiftmessage",{}).success(function(n){n!==null&&t.rootScope.$broadcast("PaymentService.ClearGiftMessageResponse",n)}).error(function(n){t.rootScope.$broadcast("PaymentService.ClearGiftMessageResponse",n)})},t.prototype.submitPayPalOrder=function(n){this.PostJson("/api/paypal/submitorder",{},n).success(function(n){n!==null&&t.rootScope.$broadcast("PaymentService.SubmitOrderResponse",n)}).error(function(n){t.rootScope.$broadcast("PaymentService.SubmitOrderResponse",n)})},t.prototype.IsContactable=function(){this.PostJson("/api/checkout/iscontactable",{}).success(function(n){t.rootScope.$broadcast("PaymentService.IsContactable",n)})},t.prototype.UpdateContactPreferences=function(n,i,r){this.PostJson("/api/checkout/updatecontactpreferences",{byEmail:n,byPhone:i,byAddress:r}).success(function(){t.rootScope.$broadcast("PaymentService.ContactPreferencesUpdated")})},t.prototype.NoLongerAvailableProducts=function(){this.PostJson("/api/checkout/nolongeravailableproducts",{}).success(function(n){t.rootScope.$broadcast("PaymentService.NoLongerAvailableProducts",n)})},t.prototype.UndeliverableProducts=function(){this.PostJson("/api/checkout/undeliverableproducts",{}).success(function(n){t.rootScope.$broadcast("PaymentService.UndeliverableProducts",n)})},t.prototype.CheckoutStep1SaveDetails=function(n,i){this.PostJson("/api/checkout/checkoutstep1",{model:n},i).success(function(n){t.rootScope.$broadcast("PaymentService.CheckoutStep1SaveDetails",n)}).error(function(n){t.rootScope.$broadcast("PaymentService.CheckoutStep1SaveDetails",n)})},t.prototype.UpdateCheckoutAddresses=function(n,i,r){this.PostJson("/api/checkout/updatecheckoutaddresses",{model:n,isBillingUpdate:i},r).success(function(n){t.rootScope.$broadcast("PaymentService.CheckoutAddressesSaveDetails",n)}).error(function(n){t.rootScope.$broadcast("PaymentService.CheckoutAddressesSaveDetails",n)})},t.prototype.GetEstimatedTax=function(n,i){this.PostJson("/api/bag/getestimatedtax",{zipCode:n,updateSession:i}).success(function(n){t.rootScope.$broadcast("PaymentService.GetEstimatedTaxSuccess",n)}).error(function(){t.rootScope.$broadcast("PaymentService.GetEstimatedTaxFailure")})},t.prototype.getRepDeliveryItemsForRemoval=function(n){for(var u,t,i,e,f=[],r=0;r<n.length;r++)for(u=0;u<n[r].Items.length;u++)t=n[r].Items[u],i=this.getItemVariantBySku(t),t.RepDeliveryOnly&&(e={Name:t.ProductName,ProductId:t.PfId,VariantName:i?i.VariantValue:"",DisplayLineNumber:i?ProductHelper.DisplayVariantLineNumber(i,!1):"",ThumbnailImageUrl:t.Images[0]},f.push(e));return f},t.prototype.getItemVariantBySku=function(n){var i,t,r;if(n.HasVariants)for(i=n.VariantGroups[0].Variants,t=0;t<i.length;t++)if(r=i[t],r.Sku===n.Sku)return r;return null},t.$inject=["$rootScope","$http","trackingService","$q"],t}(BaseAvonService);n.PaymentService=t})(PaymentServiceModule||(PaymentServiceModule={}));app.service("paymentService",PaymentServiceModule.PaymentService),function(n){var t=function(n){function t(t,i,r,u,f,e,o,s,h,c,l,a){var v=this;n.call(this,t,i);this.$scope=t;this.bagService=f;this.paymentService=e;this.trackingService=s;this.fundraiserService=c;this.sessionService=l;this.$q=a;t.AutoReplenishmentBagItemsPreviouslySubscribed=[];t.CheckoutPromoModel=AVON.CheckoutPromoModel;t.DonationAmounts=[{value:"2"},{value:"5"},{value:"10"},{value:"25"},{value:"50"},{value:"75"},{value:"100"}];t.ShowMoreDonate=!1;t.ShowTaxCalculator=!1;t.ShowZipCodeErrorMessage=!1;t.EstimatedTax=AVON.EstimatedTax;t.PreviousEnrollmentModal=function(){$("div.AutoReplenishmentPreviousEnrollment").trigger("modal",{UrlToLoad:"",AllowExit:!1,KeepLoaded:!0,Model:null})};t.GetProductLinkByProductId=function(n){return t.GetProductLinkAnyCampaign({PfId:n})};t.GetProductLink=function(n){var i="";return n&&n.IsAvailableInCurrentCampaign&&(i=t.Url.Action("Details","Product")+"/"+n.ProductName.formatUrlNugget()+"-"+n.PfId),i};t.GetProductLinkAnyCampaign=function(n){return t.Url.Action("Details","Product")+"/"+n.PfId};t.PreviousEnrollmentSubmitButton=function(){t.ShowLoading(AVON.messages.spinner_loading);t.RemoveAlreadySubscribedItems();angular.element("div.AutoReplenishmentPreviousEnrollment").trigger("close")};t.RemoveAlreadySubscribedItems=function(){var n=[];$.each(t.AutoReplenishmentBagItemsPreviouslySubscribed,function(t,i){var r={CampaignNumber:i.Campaign.Number,Sku:i.BagItem.Sku,Quantity:i.BagItem.QuantityAfterRemove,AutoReplenishmentFrequency:i.BagItem.AutoReplenishmentFrequency,AutoReplenishmentMultibuy:!1,AutoReplenishmentOverrideToBeOneTimeOnly:!1};i.BagItem.DualPurchaseSelected===1&&(i.BagItem.DualPurchaseSelected=0,i.BagItem.NewAutoReplenishmentFrequency=0,i.BagItem.AutoReplenishmentOverrideToBeOneTimeOnly=!0,r.Quantity=i.BagItem.Quantity,r.NewAutoReplenishmentFrequency=i.BagItem.NewAutoReplenishmentFrequency,r.AutoReplenishmentMultibuy=i.BagItem.AutoReplenishmentMultibuy,r.AutoReplenishmentOverrideToBeOneTimeOnly=i.BagItem.AutoReplenishmentOverrideToBeOneTimeOnly);n.push(r)});f.update(n);t.IsMobile&&t.estimatedTaxZipCode&&t.estimatedTaxZipCode.length>0&&(t.ShowLoading(AVON.messages.spinner_coupon),e.GetEstimatedTax(t.estimatedTaxZipCode,!1));t.AutoReplenishmentBagItemsPreviouslySubscribed=[]};t.ShortCampaignNumber=function(n){return n.toString().length===6?parseInt(n.toString().substr(4,2),10):n};t.OpenNotifyMe=function(n,i,r){var u="/product/notifymemodal?pfid="+n+"&fsc="+i,f;r&&(u+="&campaignNumber="+r);t.ShowLoading(AVON.messages.spinner_loading);f={AllowExit:!0,Model:null,KeepLoaded:!1,UrlToLoad:u};$("#ContentModal").trigger("modal",f)};t.RemoveItem=function(n,i){t.ShowLoading(AVON.messages.spinner_updatingBag);var r=[],u={CampaignNumber:n.Number,Sku:i.Sku,Quantity:i.QuantityAfterRemove,AutoReplenishmentFrequency:t.AutoReplenishFrequencyCheck(i),AutoReplenishmentMultibuy:i.AutoReplenishmentMultibuy,AutoReplenishmentOverrideToBeOneTimeOnly:i.AutoReplenishmentOverrideToBeOneTimeOnly};r.push(u);f.update(r);s.TrackCartRemoveEvent(i.Fsc,i.Sku,i.ProductBusinessCategory,i.ProductBusinessUnit);t.IsMobile&&t.estimatedTaxZipCode&&t.estimatedTaxZipCode.length>0&&(t.ShowLoading(AVON.messages.spinner_coupon),e.GetEstimatedTax(t.estimatedTaxZipCode,!1))};t.GetOfferLink=function(n){return n.ProductId>0?t.Url.Action("Details","Product")+"/"+n.ProductId+"?promo_id="+n.PromotionId+"&inm=bag-viewoffer-lnk":t.Url.Action("Index","Promotions")+"/"+n.PromotionId+"?inm=bag-viewoffer-lnk"};t.ShadeChanged=function(n,i,r){if(n){t.ShowLoading(AVON.messages.spinner_updatingBag);var u={CampaignNumber:i.Number,Sku:r.Sku,NewSku:n,Quantity:r.Quantity,AutoReplenishmentFrequency:t.AutoReplenishFrequencyCheck(r),AutoReplenishmentMultibuy:r.AutoReplenishmentMultibuy,AutoReplenishmentOverrideToBeOneTimeOnly:!1};f.swapVariants(u)}};t.$on("BagService.SwapVariantsSuccess",function(){t.AutoReplenishmentFrequencyListRefresh()});t.$on("BagService.SwapVariantsSuccess",function(){t.AutoReplenishmentFrequencyListRefresh()});t.ChangeAutoReplenishmentFrequency=function(n,i,r){i.NewAutoReplenishmentFrequency=i.AutoReplenishmentFrequency;i.AutoReplenishmentFrequency=r;t.UpdateCart(n.Number,i)};t.SetDualPurchaseSelected=function(n,i,r){r.DualPurchaseSelected!==n&&(r.DualPurchaseSelected=n,n===DualPurchase.OneTime?r.NewAutoReplenishmentFrequency=0:(r.NewAutoReplenishmentFrequency=r.AutoReplenishmentFrequencyList[0],r.AutoReplenishmentFrequency=0),t.UpdateCart(i.Number,r))};t.UpdateCart=function(n,i){var r,u,o,h;i.DualPurchaseSelected===DualPurchase.OneTime&&(i.NewAutoReplenishmentFrequency==null||i.NewAutoReplenishmentFrequency==undefined)&&(i.AutoReplenishmentFrequency=0);r=i.Quantity;r!==""&&(t.ShowLoading(AVON.messages.spinner_updatingBag),u=[],o={CampaignNumber:n,Sku:i.Sku,Quantity:i.Quantity,AutoReplenishmentFrequency:i.AutoReplenishmentFrequency,NewAutoReplenishmentFrequency:i.NewAutoReplenishmentFrequency,AutoReplenishmentMultibuy:i.AutoReplenishmentMultibuy,AutoReplenishmentOverrideToBeOneTimeOnly:i.AutoReplenishmentOverrideToBeOneTimeOnly},u.push(o),f.update(u).success(function(){t.DisplayBagModal()}),r==0?s.TrackCartRemoveEvent(i.Fsc,i.Sku,i.ProductBusinessCategory,i.ProductBusinessUnit):(h={Type:TrackingEventType.UpdateItemInBag,Data:{Fsc:i.Fsc,Sku:i.Sku,Quantity:r,findingMethod:"shopping bag"}},s.TrackEventItem(h)),t.IsMobile&&t.estimatedTaxZipCode&&t.estimatedTaxZipCode.length>0&&(t.ShowLoading(AVON.messages.spinner_coupon),e.GetEstimatedTax(t.estimatedTaxZipCode,!1)))};t.PreviouslySubscribedCheck=function(n,i){if(i.AutoReplenishmentFrequency>0&&!i.AutoReplenishmentOverrideToBeOneTimeOnly&&(i.ProductCanBuy===CanBuy.Available&&i.DualPurchaseSelected===DualPurchase.AutoReplenishment||i.ProductCanBuy===CanBuy.AutoReplenishmentOnly)&&r.IsSubscribedToProductWithSku(i.Sku)){var u={Campaign:n,BagItem:i,AutoReplenishmentItemFrequency:r.GetProductSubscriptionFrequency(i.Sku)};_.where(t.AutoReplenishmentBagItemsPreviouslySubscribed.map(function(n){return n.BagItem.Sku}),u.BagItem.Sku).length===0&&t.AutoReplenishmentBagItemsPreviouslySubscribed.push(u)}};t.DisplayBagModal=function(){t.Session.Customer&&t.Session.Customer.IsLoggedIn&&($.each(t.Session.Cart.Campaigns,function(n,i){$.each(i.Items,function(n,r){t.PreviouslySubscribedCheck(i,r);t.ConsolidationCheck(i.Number,r)})}),t.AutoReplenishmentBagItemsPreviouslySubscribed.length>0?t.PreviousEnrollmentModal():t.Session.AutoReplenishmentConsolidation.length>0&&t.ShowConsolidationModal(),t.AutoReplenishmentFrequencyListRefresh())};t.$on("BagService.UpdateAutoReplenishmentConsolidationItems",function(){t.AutoReplenishmentFrequencyListRefresh()});t.ShowConsolidationModal=function(){var i=_.where(t.Session.AutoReplenishmentConsolidation,{ActionTaken:!1}).length,n;i>0&&(n={UrlToLoad:"",AllowExit:!1,KeepLoaded:!0,Model:null},$(".AutoReplenishmentConsolidationModal").trigger("modal",n))};t.NextShipmentDateByFrequency=function(n){var t=r.GetNextShipmentDateByFrequency(n);return t?u("date")(t,"MM/dd/yyyy"):""};t.ResolveAutoReplenishmentConsolidation=function(){var n=[],i=[];$.each(t.Session.AutoReplenishmentConsolidation,function(t,r){if(parseInt(r.OptionSelected.toString())===ConsolidationOption.ShipNextScheduledDate){var u={CampaignNumber:r.CampaignAdded,Sku:r.Sku,Quantity:0,AutoReplenishmentFrequency:r.AutoReplenishmentFrequency,AutoReplenishmentMultibuy:r.AutoReplenishmentMultiBuy,AutoReplenishmentOverrideToBeOneTimeOnly:!1};n.push(u);i.push({Frequency:u.AutoReplenishmentFrequency,ProductToAdd:{ProductId:r.ProductId,Sku:r.Sku,Quantity:r.Quantity}})}});t.ShowLoading(AVON.messages.spinner_updatingBag);i.length>0?f.autoSubscribeToBagItems(i).success(function(){v.UpdateConsolidationItemsAndUpdateCart(n)}):v.UpdateConsolidationItemsAndUpdateCart(n);t.Session.AutoReplenishmentConsolidation=[];$(".AutoReplenishmentConsolidationModal").trigger("close")};t.ResolveAutoReplenishmentConsolidation=function(){var n=[],i=[];$.each(t.Session.AutoReplenishmentConsolidation,function(r,u){if(parseInt(u.OptionSelected.toString())===ConsolidationOption.ShipNextScheduledDate){t.ShowLoading(AVON.messages.spinner_updatingBag);var f={CampaignNumber:u.CampaignAdded,Sku:u.Sku,Quantity:0,AutoReplenishmentFrequency:u.AutoReplenishmentFrequency,AutoReplenishmentMultibuy:u.AutoReplenishmentMultiBuy,AutoReplenishmentOverrideToBeOneTimeOnly:!1};n.push(f);i.push({Frequency:f.AutoReplenishmentFrequency,ProductToAdd:{ProductId:u.ProductId,Sku:u.Sku,Quantity:u.Quantity}})}});t.ShowLoading(AVON.messages.spinner_updatingBag);i.length>0?f.autoSubscribeToBagItems(i).success(function(){v.UpdateConsolidationItemsAndUpdateCart(n)}):v.UpdateConsolidationItemsAndUpdateCart(n);$(".AutoReplenishmentConsolidationModal").trigger("close")};t.ConsolidationCheck=function(n,i){if((i.AutoReplenishmentFrequency>0||i.NewAutoReplenishmentFrequency>0)&&(i.ProductCanBuy===CanBuy.Available&&i.DualPurchaseSelected===DualPurchase.AutoReplenishment||i.ProductCanBuy===CanBuy.AutoReplenishmentOnly)){var u=i.NewAutoReplenishmentFrequency>0?i.NewAutoReplenishmentFrequency:i.AutoReplenishmentFrequency,e=r.HasSubscriptionWithFrequency(u),o=r.IsSubscribedToProductWithSku(i.Sku),f;$.each(t.Session.AutoReplenishmentConsolidation,function(n,t){t.Sku===i.Sku&&t.AutoReplenishmentFrequency===u&&(f=!0)});!e||o||f||t.Session.AutoReplenishmentConsolidation.push({ProductId:i.PfId,Name:i.ProductName,Image:i.Images[0],Sku:i.Sku,Quantity:i.Quantity,AutoReplenishmentFrequency:u,CampaignAdded:n,NextShipmentDate:null,OptionSelected:ConsolidationOption.ShipToday,ActionTaken:!1,IsResubscribedItem:i.AutoReplenishmentId>0,AutoReplenishmentMultiBuy:i.AutoReplenishmentMultibuy})}};t.BagContainsAutoReplenishmentProductsAndNotLoggedIn=function(){var n=!1;return $.each(t.Session.Cart.Campaigns,function(t,i){$.each(i.Items,function(t,i){i.AutoReplenishmentFrequency>0&&(n=!0,i.ProductCanBuy===CanBuy.Available&&i.DualPurchaseSelected!==DualPurchase.AutoReplenishment&&(n=!1))})}),t.Session.Customer.IsLoggedIn===!1&&n};t.FilterByNoActionTaken=function(n){return!n.ActionTaken};t.SetConsolidationModalOptionSelected=function(n,t){t.OptionSelected=n};t.ClearZipCodeValidation=function(){t.ShowZipCodeErrorMessage=!1};t.OpenTaxCalculator=function(){t.ShowTaxCalculator=!0};t.FocusZipCodeEdit=function(){t.ClearZipCodeValidation()};t.ApplyZipCode=function(){t.ClearZipCodeValidation();var n=$("#estimatedTaxZipCode").val();n.length>0?(t.ShowLoading(AVON.messages.spinner_updatingBag),e.GetEstimatedTax(n,!0)):t.ShowZipCodeErrorMessage=!0};t.$on("PaymentService.GetEstimatedTaxSuccess",function(n,i){if(i.ErrorCode===AjaxError.None){var r=i.Data;r.IsValid?(t.Session.Cart.EstimatedTaxZipCode=r.ZipCode,t.estimatedTaxZipCode=r.ZipCode,t.EstimatedTax=r.TaxEstimate,t.ShowTaxCalculator=!1):t.ShowZipCodeErrorMessage=!0}else t.ShowZipCodeErrorMessage=!0});t.$on("PaymentService.GetEstimatedTaxFailure",function(){t.ShowZipCodeErrorMessage=!0});t.RemoveSelectedProductFromWishList=function(n,i,r,u){var f,e,s;t.Session.Customer.IsLoggedIn?(f=angular.element(u.currentTarget),f.addClass("loading-spinner"),f.attr("disabled","true"),t.HideWishListTooltip(u),e=o.GetWishListProduct(n,i),e&&(s=o.RemoveFromWishList(e.WishlistProductId),s.finally(function(){f.removeClass("loading-spinner");f.removeAttr("disabled")}))):t.ShowLoginModal("wishlist");u.preventDefault();u.stopPropagation()};t.AutoReplenishmentFrequencyListRefresh=function(){t.SessionService.WhenReady().then(function(){$.each(t.Session.Cart.Campaigns,function(n,t){$.each(t.Items,function(n,t){t.AutoReplenishmentFrequencyList&&t.AutoReplenishmentFrequencyList.length>0&&t.AutoReplenishmentFrequency===0&&(t.AutoReplenishmentFrequency=Number(t.AutoReplenishmentFrequencyList[0]))})})})};t.AutoReplenishFrequencyCheck=function(n){return n.ProductCanBuy===CanBuy.AutoReplenishmentOnly?n.AutoReplenishmentFrequency:n.DualPurchaseSelected===DualPurchase.AutoReplenishment?n.AutoReplenishmentFrequency:0};t.IsInWishListViewBag=function(n,t,i){var r={ProductId:n,Sku:t,AutoReplenishmentFrequency:i?i:null,Availability:CanBuy.Available};return o.CheckIfExactVariantExistsInWishList(r)};t.AddSelectedProductsToWishList=function(n,i,r,u,f){var e,c,l,a,v;t.Session.Customer.IsLoggedIn?(e=angular.element(f.currentTarget),e.addClass("loading-spinner"),e.attr("disabled","true"),t.HideWishListTooltip(f),c=r&&!u?r:null,l=o.AddToWishList([new WishListItem(n,i,c,CanBuy.Available)]),l.finally(function(){var n,r;e.removeClass("loading-spinner");e.removeAttr("disabled");n=[];n.push(i);r={Type:TrackingEventType.WishListItemsAdded,Data:{trackingItems:n,wishListState:t.Session.Customer.WishList.Products.length>0?"exist":"new",findingMethod:"Shopping Bag"}};s.TrackEventItem(r)})):t.IsMobile?(a=h.absUrl(),v=t.SignInPageUrl("wishlist")+"&returnurl="+encodeURIComponent(a),t.RedirectToUrl(v)):t.ShowLoginModal("wishlist");f.preventDefault();f.stopPropagation()};t.DisplayAutoReplenishUpsellBanner=function(){t.SessionService.WhenReady().then(function(){var u=[],n=[],e=[],i,f,o;for($.each(t.Session.Cart.Campaigns,function(t,i){$.each(i.Items,function(t,i){var f,r;if(u.push(i.PfId),i.LinkToAutoReplenishmentProducts&&i.LinkToAutoReplenishmentProducts.length>0){for(f=i.LinkToAutoReplenishmentProducts.split(","),r=0;r<f.length;r++)f[r].length>0&&n.push(parseInt(f[r]));i.ShowAutoReplenishUpsell=!0}})}),n=_.uniq(n),i=0;i<u.length;i++)for(f=0;f<n.length;f++)u[i]===n[f]&&e.push(u[i]);o=r.GetActiveSubscriptionsProductIds();$.each(t.Session.Cart.Campaigns,function(n,t){$.each(t.Items,function(n,t){if(t.LinkToAutoReplenishmentProducts&&t.LinkToAutoReplenishmentProducts.length>0){for(var i=0;i<e.length;i++)if(t.LinkToAutoReplenishmentProducts.indexOf(e[i])>-1){t.ShowAutoReplenishUpsell=!1;break}_.any(o,function(n){return t.LinkToAutoReplenishmentProducts.indexOf(n.toString())>-1})&&(t.ShowAutoReplenishUpsell=!1)}})})})};t.ContinueToCheckoutButtonClicked=function(){t.ShowLoading(AVON.messages.spinner_loading);v.checkIfFundraiserHasEnded().then(function(n){n||v.continueToCheckout()})};this.checkIfFundraiserHasEnded()}return __extends(t,n),t.prototype.checkIfFundraiserHasEnded=function(){var t=this,n=this.$q.defer();return this.sessionService.WhenReady().then(function(i){i.Fundraiser!=null?t.fundraiserService.RefreshIdentityFundraiser().then(function(i){i&&t.fundraiserService.DisplayFundraiserHasEndedModel();n.resolve(i)}):n.resolve(!1)}),n.promise},t.prototype.continueToCheckout=function(){this.trackingService.TrackEventItem({Type:TrackingEventType.CartViewBagCheckoutButtonClick});this.trackingService.TrackEventItem({Type:TrackingEventType.CartViewBagSignInModal});this.$scope.IsMobile||AVON.OdsIsDown||this.$scope.Session.Customer.IsLoggedIn&&(AVON.CustomerType===CustomerType.AttachedEcommerce||AVON.CustomerType===CustomerType.UnattachedEcommerce||AVON.CustomerType===CustomerType.TraditionalShopper)||this.$scope.Session.Customer.BillingAddress.Address1&&AVON.CustomerType===CustomerType.GuestShopper||AVON.CustomerType===CustomerType.RegisteredCustomerAsGuest?(this.$scope.ShowLoading(AVON.messages.spinner_loading),location.href=this.$scope.Url.Action("Index","Checkout")):(AVON.TempModalModel={Mode:"FullRegistration"},this.$scope.ShowLoginModal("checkout",this.$scope.Url.Action("Index","Checkout")))},t.prototype.UpdateConsolidationItemsAndUpdateCart=function(n){var t=this;this.$scope.ShowLoading(AVON.messages.spinner_updatingBag);this.bagService.updateAutoReplenishmentConsolidationItems().success(function(){n.length>0&&(t.$scope.ShowLoading(AVON.messages.spinner_updatingBag),t.bagService.update(n),t.$scope.IsMobile&&t.$scope.estimatedTaxZipCode&&t.$scope.estimatedTaxZipCode.length>0&&(t.$scope.ShowLoading(AVON.messages.spinner_coupon),t.paymentService.GetEstimatedTax(t.$scope.estimatedTaxZipCode,!1)))})},t}(BaseAngularController);n.CommonViewBagController=t}(ViewBagModule||(ViewBagModule={})),function(n){"use strict";var t=function(t){function i(i,r,u,f,e){t.call(this,i);this.trackingService=u;n.ConfirmationScope=i;i.FundraiserImageLoaded=!1;i.IsMobile||($(".StepProgressBar .step1").addClass("completedStep"),$(".StepProgressBar .step2").addClass("completedStep"),$(".StepProgressBar .step3").addClass("activeStep"));i.DisplayCreateAccount=!0;i.DisplayCreateAccountThanksMessage=!1;i.registrationModel=AVON.registrationModel;i.privacyUrl=$("#privacyPolicyUrl").val();i.conditionsOfUseUrl=$("#conditionsOfUseUrl").val();i.DisplayPasswordInstructions=!0;i.InputFocus=function(n){if(i.DisplayPasswordInstructions=!0,i.ValidationErrorStyle=!1,i.ShowValidation=!1,i.IsMobile){var t=$(angular.element(n.currentTarget)[0]).attr("id");(t==="registrationModel_LoginInfo_PasswordInput"||t==="registrationModel_LoginInfo_PasswordConfirmInput")&&_.defer(function(){$("[id=registrationModel_LoginInfo_PasswordInput]").placeholder();$("[id=registrationModel_LoginInfo_PasswordConfirmInput]").placeholder()})}};i.RegisterGuestShopper=function(){i.showAcceptedPrivacyPolicyError=!1;i.PasswordsEmpty=!1;i.PasswordsDontMatch=!1;i.ValidationErrorStyle=!1;i.ShowValidation=!1;i.IsMobile||(i.ValidationErrorStyle=!1,i.ShowValidation=!1);var n=i.standardizeEmpty(i.registrationModel.LoginInfo.Password),t=i.standardizeEmpty(i.registrationModel.LoginInfo.PasswordConfirm);if(n!==t){i.PasswordsDontMatch=!0;i.DisplayPasswordInstructions=!1;i.ValidationErrorStyle=!0;i.ShowValidation=!0;i.RegistrationForm.registrationModel_LoginInfo_Password.$invalid=!0;i.RegistrationForm.registrationModel_LoginInfo_PasswordConfirm.$invalid=!0;i.SafeApply();return}if(i.RegistrationForm.$valid){if(i.registrationModel.PrivacyPolicy===!1){i.showAcceptedPrivacyPolicyError=!0;i.SafeApply();return}i.registrationModel.LoginInfo.EmailConfirm=i.registrationModel.LoginInfo.Email;i.registrationModel.LoginInfo.PasswordConfirm=i.registrationModel.LoginInfo.Password;i.ShowLoading(AVON.messages.spinner_registering);i.registrationModel.ReturnUrl=$("#registrationModel_ReturnUrl").val();f.register(i.registrationModel,$("form[name=RegistrationForm]"))}else i.registrationModel.PrivacyPolicy===!1&&(i.showAcceptedPrivacyPolicyError=!0),i.RegistrationForm.ServerErrors.Summary===undefined||i.ShowValidation||(i.RegistrationForm.ServerErrors.Summary.$invalid=!1),i.RegistrationForm.registrationModel_LoginInfo_Password.$invalid&&(i.DisplayPasswordInstructions=!1,i.ValidationErrorStyle=!1,n===""&&t===""&&(i.PasswordsEmpty=!0,i.ValidationErrorStyle=i.IsMobile?!0:!1),n!==t&&(i.PasswordsDontMatch=!0,i.ValidationErrorStyle=!0)),i.ShowValidation=!0,i.TrackUserValidationErrors(i.RegistrationForm.$error),i.SafeApply()};i.standardizeEmpty=function(n){return n===undefined||n===null?"":n};i.$on("ConfirmationService.RegisterResponse",function(n,t){t.ErrorCode===AjaxError.ValidationErrors?(i.ProcessAjaxValidationErrors(t),i.CleanPrivacyPolicy(i.RegistrationForm)):_.defer(function(){i.DisplayCreateAccount=!1;i.DisplayCreateAccountThanksMessage=!0})});i.ContactMeRepModal=function(n){r.$broadcast("AvonController.ShowRepresentativeContactMeForm",n,"order_question")};i.ViewPrivacyPolicy=function(){i.IsMobile?window.open(i.privacyUrl,"_blank"):window.open(i.privacyUrl,"AVONPop","toolbar=no,width=640,height=550,status=no,scrollbars=yes,resize=yes,menubar=no").focus()};i.ViewConditionsOfUse=function(){i.IsMobile?window.open(i.conditionsOfUseUrl,"_blank"):window.open(i.conditionsOfUseUrl,"AVONPop","toolbar=no,width=640,height=550,status=no,scrollbars=yes,resize=yes,menubar=no").focus()};i.TrackUserValidationErrors=function(n){if(i.IsMobile!==!1){var t=[];n&&$.each(n,function(n,i){i&&(t.push("err-"+n),$.each(i,function(n,i){t.push(i.$name)}))});t=null}};i.KeepShoppingFundraiser=function(n,t){e.StartShoppingFundraiser(t).then(function(){var n=i.Url.Action("Index","Fundraiser",t);i.RedirectToUrl(n)})};this.TrackCartConfirmation(AVON.CartCreatedPlatform);_.defer(function(){i.IsMobile||i.Session.Customer.IsLoggedIn||($(".TopAccountBarUserOverlay").addClass("GuestUserOverlay"),$(".TopAccountOverlayCaret").addClass("GuestUserOverlay"));window.lpTag!=undefined&&(window.lpTag.sdes=window.lpTag.sdes||[],window.lpTag.sdes.push(AVON.LivePersonData))});i.FundraiserOrganizationImageOnLoad=function(){i.FundraiserImageLoaded=!0}}return __extends(i,t),i.prototype.TrackCartConfirmation=function(n){n in Platform&&(this.trackingService.UTagData.order_cart_origin=Platform[n].toLocaleLowerCase());this.trackingService.TrackEvent({event_name:"order_confirmation"})},i.$inject=["$scope","$rootScope","trackingService","confirmationService","fundraiserService"],i}(BaseAngularController);n.ConfirmationController=t}(ConfirmationModule||(ConfirmationModule={}));app.controller("ConfirmationController",ConfirmationModule.ConfirmationController),function(n){var t=function(n){function t(t){n.call(this,t);t.IsOdsDown=AVON.isOdsDown;t.preCheckoutChecksResult=AVON.preCheckoutChecks;t.preCheckoutChecksResult=AVON.preCheckoutChecks;t.HasAutoReplenishmentItemInBag=!1;t.ShowFundraiserRepDeliveryModal=function(){$("#FundraiserRepDeliveryModal").trigger("modal",{AllowExit:!1,KeepLoaded:!0,Model:null})};t.OnClickFundraiserEditBagButton=function(){var n=t.Url.Action("index","bag");t.RedirectToUrl(n,!0)};t.CheckCardAboutToExpire=function(){var n=(new Date).getMonth()+1,i=(new Date).getFullYear();$.each(t.paymentViewModel.CreditCards,function(r,u){u.Id===t.storedCreditCardModel.Id&&(t.IsCreditCardAboutToExpire=u.ExpiryYear===i&&u.ExpiryMonth===n?!0:!1)})};t.IsPaymentTypePayPal=function(){return!t.IsRepDelivery()&&t.paymentViewModel.PaymentModel.PaymentType==PaymentType.PayPal&&!t.HasAutoReplenishmentItemInBag};t.IsRepDelivery=function(){return t.SelectedShippingOption==ShippingOptionCode.rep_delivery};t.ShowShippingRestrictionRepDeliveryButton=function(){return!t.IsOdsDown&&t.Session.Cart.OrderDetails.RepDeliveryEnabled&&t.Session.Customer.IsAttached&&(t.Session.Customer.DeliveryType==DeliveryType.RepOrDirect||t.Session.Customer.DeliveryType==DeliveryType.RepOnly)&&!t.HasAutoReplenishmentItemInBag&&!t.IsPaymentTypePayPal()&&!t.preCheckoutChecksResult.IsShoppingFundraiser&&!t.preCheckoutChecksResult.CustomerAcceptsDirectDeliveryOnly&&!t.preCheckoutChecksResult.CartContainsDirectDeliveryOnlyItems&&!t.preCheckoutChecksResult.ShippingMethodsRestrictedToDirectDeliveryOnly}}return __extends(t,n),t}(BaseAngularController);n.CommonPaymentController=t}(PaymentModule||(PaymentModule={})),function(n){var t=function(n){function t(i,r,u){n.call(this,i,r,u);t.rootScope=i;t.http=r;t.q=u}return __extends(t,n),t.prototype.getSamplesByCategoryId=function(n){var i=this;n&&t.rootScope.SessionService.WhenReady().then(function(){var r="/api/samples/category/"+n;i.GetJson(r,!0,!0,!1).then(function(n){t.rootScope.$broadcast("SampleService.SamplesLoaded",n)})})},t.$inject=["$rootScope","$http","$q"],t}(BaseAvonService);n.SampleService=t}(SampleServiceModule||(SampleServiceModule={}));app.service("sampleService",SampleServiceModule.SampleService);__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){"use strict";var t=function(t){function i(i,r,u){var f=this;t.call(this,i);this.IsPhoneNumberRequiredLength=function(){return n.checkoutAddressesScope.CheckoutAddressesModel.PhoneNumber&&n.checkoutAddressesScope.CheckoutAddressesModel.PhoneNumber.length===10};this.setValidationOnInput=function(t,i,r){var u=n.checkoutAddressesScope.CheckoutAddressesForm[n.checkoutAddressesScope.FormModelPrefix+"_"+t];u&&u.$setValidity(i,r)};n.checkoutAddressesScope=i;n.checkoutAddressesScope.FormModelPrefix="CheckoutAddressesModel";n.checkoutAddressesScope.Countries=AVON.Countries;n.checkoutAddressesScope.SessionService.WhenReady().then(function(){n.checkoutAddressesScope.PaymentService=r;n.checkoutAddressesScope.CheckoutAddressesModel=_.clone(AVON.CheckoutAddressesModel);n.checkoutAddressesScope.BillingStates=AVON.BillingStates;n.checkoutAddressesScope.ShippingStates=AVON.ShippingStates;n.checkoutAddressesScope.InvalidPhoneNumber=AVON.messages.validate_invalid_phonenumber});n.checkoutAddressesScope.IsPayPalAddress=function(t){return n.checkoutAddressesScope.SessionReady&&n.checkoutAddressesScope.Session.Customer.IsPayPalCustomerLoggedIn&&t===!1};n.checkoutAddressesScope.IsBillingUsaAddress=function(){return n.checkoutAddressesScope.CheckoutAddressesModel.BillingCountry==="US"};n.checkoutAddressesScope.IsBillingInternationalAddress=function(){return n.checkoutAddressesScope.IsBillingUsaAddress()===!1};n.checkoutAddressesScope.SwitchToInternationalAddressView=function(){n.checkoutAddressesScope.CheckoutAddressesModel.BillingCountry=""};u.TrackEventItem({Type:TrackingEventType.CartCheckout2});n.checkoutAddressesScope.ResetValidation=function(){n.checkoutAddressesScope.ShowValidation=!1;n.checkoutAddressesScope.ShowPhoneNumberErrorMessage=!1;f.setValidationOnInput("BillingPostalCode","validatePostalCode",!0)};n.checkoutAddressesScope.InputFocus=function(){n.checkoutAddressesScope.ResetValidation()};n.checkoutAddressesScope.KeyPress=function(t){(t.target.id.indexOf("ShippingZip")>-1||t.target.id.indexOf("BillingZip")>-1&&t.target.value.length>5)&&n.checkoutAddressesScope.ResetValidation()};n.checkoutAddressesScope.FormattedPhoneNumber=function(){if(f.IsPhoneNumberRequiredLength()){var t=n.checkoutAddressesScope.CheckoutAddressesModel.PhoneNumber.substring(0,3),i=n.checkoutAddressesScope.CheckoutAddressesModel.PhoneNumber.substring(3,6),r=n.checkoutAddressesScope.CheckoutAddressesModel.PhoneNumber.substring(6,10);return t+"-"+i+"-"+r}return""};n.checkoutAddressesScope.CloseEditAddress=function(){n.checkoutAddressesScope.ResetValidation();n.checkoutAddressesScope.CheckoutAddressesModel.SharedAddressDetails=!0;n.checkoutAddressesScope.CheckoutAddressesModel.SaveAddressDetails=!1;r.GetEstimatedTax(n.checkoutAddressesScope.CheckoutAddressesModel.ShippingZip,!0);n.checkoutAddressesScope.$root.$broadcast("PaymentController.CloseEditAddress")};n.checkoutAddressesScope.CancelEditAddress=function(){PaymentModule.paymentScope.EditingBillingAddress?(n.checkoutAddressesScope.CheckoutAddressesModel.BillingFirstName=AVON.CheckoutAddressesModel.BillingFirstName,n.checkoutAddressesScope.CheckoutAddressesModel.BillingLastName=AVON.CheckoutAddressesModel.BillingLastName,n.checkoutAddressesScope.CheckoutAddressesModel.BillingAddress1=AVON.CheckoutAddressesModel.BillingAddress1,n.checkoutAddressesScope.CheckoutAddressesModel.BillingAddress2=AVON.CheckoutAddressesModel.BillingAddress2,n.checkoutAddressesScope.CheckoutAddressesModel.BillingZip=AVON.CheckoutAddressesModel.BillingZip,n.checkoutAddressesScope.CheckoutAddressesModel.BillingCity=AVON.CheckoutAddressesModel.BillingCity,n.checkoutAddressesScope.CheckoutAddressesModel.BillingState=AVON.CheckoutAddressesModel.BillingState,n.checkoutAddressesScope.CheckoutAddressesModel.BillingProvince=AVON.CheckoutAddressesModel.BillingProvince,n.checkoutAddressesScope.CheckoutAddressesModel.BillingPostalCode=AVON.CheckoutAddressesModel.BillingPostalCode,n.checkoutAddressesScope.CheckoutAddressesModel.BillingCountry=AVON.CheckoutAddressesModel.BillingCountry,f.setValidationOnInput("BillingPostalCode","validatePostalCode",!0),f.setValidationOnInput("BillingCity","validateCity",!0),f.setValidationOnInput("BillingState","validateState",!0),f.setValidationOnInput("BillingZip","validateZipcode",!0)):(n.checkoutAddressesScope.CheckoutAddressesModel.ShippingFirstName=AVON.CheckoutAddressesModel.ShippingFirstName,n.checkoutAddressesScope.CheckoutAddressesModel.ShippingLastName=AVON.CheckoutAddressesModel.ShippingLastName,n.checkoutAddressesScope.CheckoutAddressesModel.ShippingAddress1=AVON.CheckoutAddressesModel.ShippingAddress1,n.checkoutAddressesScope.CheckoutAddressesModel.ShippingAddress2=AVON.CheckoutAddressesModel.ShippingAddress2,n.checkoutAddressesScope.CheckoutAddressesModel.ShippingZip=AVON.CheckoutAddressesModel.ShippingZip,n.checkoutAddressesScope.CheckoutAddressesModel.ShippingCity=AVON.CheckoutAddressesModel.ShippingCity,n.checkoutAddressesScope.CheckoutAddressesModel.ShippingState=AVON.CheckoutAddressesModel.ShippingState,n.checkoutAddressesScope.CheckoutAddressesModel.ShippingCountry=AVON.CheckoutAddressesModel.ShippingCountry,f.setValidationOnInput("ShippingZip","validateZipcode",!0),f.setValidationOnInput("ShippingCity","validateCity",!0),f.setValidationOnInput("ShippingState","validateState",!0));n.checkoutAddressesScope.CloseEditAddress()};n.checkoutAddressesScope.UpdateOtherAddress=function(){if(n.checkoutAddressesScope.CheckoutAddressesModel.SharedAddressDetails!==!1)if(PaymentModule.paymentScope.EditingBillingAddress){if(n.checkoutAddressesScope.IsBillingInternationalAddress())return;n.checkoutAddressesScope.CheckoutAddressesModel.ShippingFirstName=n.checkoutAddressesScope.CheckoutAddressesModel.BillingFirstName;n.checkoutAddressesScope.CheckoutAddressesModel.ShippingLastName=n.checkoutAddressesScope.CheckoutAddressesModel.BillingLastName;n.checkoutAddressesScope.CheckoutAddressesModel.ShippingAddress1=n.checkoutAddressesScope.CheckoutAddressesModel.BillingAddress1;n.checkoutAddressesScope.CheckoutAddressesModel.ShippingAddress2=n.checkoutAddressesScope.CheckoutAddressesModel.BillingAddress2;n.checkoutAddressesScope.CheckoutAddressesModel.ShippingZip=n.checkoutAddressesScope.CheckoutAddressesModel.BillingZip;n.checkoutAddressesScope.CheckoutAddressesModel.ShippingCity=n.checkoutAddressesScope.CheckoutAddressesModel.BillingCity;n.checkoutAddressesScope.CheckoutAddressesModel.ShippingState=n.checkoutAddressesScope.CheckoutAddressesModel.BillingState;n.checkoutAddressesScope.CheckoutAddressesModel.ShippingCountry=n.checkoutAddressesScope.CheckoutAddressesModel.BillingCountry}else n.checkoutAddressesScope.CheckoutAddressesModel.BillingFirstName=n.checkoutAddressesScope.CheckoutAddressesModel.ShippingFirstName,n.checkoutAddressesScope.CheckoutAddressesModel.BillingLastName=n.checkoutAddressesScope.CheckoutAddressesModel.ShippingLastName,n.checkoutAddressesScope.CheckoutAddressesModel.BillingAddress1=n.checkoutAddressesScope.CheckoutAddressesModel.ShippingAddress1,n.checkoutAddressesScope.CheckoutAddressesModel.BillingAddress2=n.checkoutAddressesScope.CheckoutAddressesModel.ShippingAddress2,n.checkoutAddressesScope.CheckoutAddressesModel.BillingZip=n.checkoutAddressesScope.CheckoutAddressesModel.ShippingZip,n.checkoutAddressesScope.CheckoutAddressesModel.BillingCity=n.checkoutAddressesScope.CheckoutAddressesModel.ShippingCity,n.checkoutAddressesScope.CheckoutAddressesModel.BillingState=n.checkoutAddressesScope.CheckoutAddressesModel.ShippingState,n.checkoutAddressesScope.CheckoutAddressesModel.BillingCountry=n.checkoutAddressesScope.CheckoutAddressesModel.ShippingCountry};n.checkoutAddressesScope.FormValidationChecks=function(){n.checkoutAddressesScope.ResetValidation();PaymentModule.paymentScope.EditingBillingAddress&&f.IsPhoneNumberRequiredLength()===!1&&(n.checkoutAddressesScope.CheckoutAddressesForm[n.checkoutAddressesScope.FormModelPrefix+"_PhoneNumber"].$invalid=!0,n.checkoutAddressesScope.ShowPhoneNumberErrorMessage=!0)};n.checkoutAddressesScope.CheckoutAddressesFormSubmit=function(){if(n.checkoutAddressesScope.FormValidationChecks(),!n.checkoutAddressesScope.CheckoutAddressesForm.$valid){n.checkoutAddressesScope.ShowValidation=!0;return}n.checkoutAddressesScope.UpdateOtherAddress();n.checkoutAddressesScope.ShowLoading(AVON.messages.spinner_addresses);r.UpdateCheckoutAddresses(n.checkoutAddressesScope.CheckoutAddressesModel,PaymentModule.paymentScope.EditingBillingAddress,$("form[name=CheckoutAddressesForm]"))};n.checkoutAddressesScope.$on("PaymentService.CheckoutAddressesSaveDetails",function(t,i){if(i.ErrorCode===AjaxError.ValidationErrors){n.checkoutAddressesScope.HideLoading();n.checkoutAddressesScope.ShowValidation=!0;n.checkoutAddressesScope.ProcessAjaxValidationErrors(i);$.each(i.ValidationErrors,function(t,i){var r=n.checkoutAddressesScope.FormModelPrefix+i.FieldName.replace("model.","_");n.checkoutAddressesScope.CheckoutAddressesForm!=undefined&&n.checkoutAddressesScope.CheckoutAddressesForm[r]!=undefined&&(n.checkoutAddressesScope.CheckoutAddressesForm[r].$invalid=!0,i.Problem.indexOf("CheckoutAddressesModel")===-1&&(i.FieldName.indexOf("BillingAddress")>-1||i.FieldName.indexOf("ShippingAddress")>-1,i.FieldName.indexOf("PhoneNumber")>-1&&(n.checkoutAddressesScope.ShowPhoneNumberErrorMessage=!0),i.FieldName.indexOf("BillingZip")>-1&&f.setValidationOnInput("BillingZip","validateZipcode",!1),i.FieldName.indexOf("BillingPostalCode")>-1&&f.setValidationOnInput("BillingPostalCode","validatePostalCode",!1),i.FieldName.indexOf("ShippingZip")>-1&&f.setValidationOnInput("ShippingZip","validateZipcode",!1)))});return}AVON.CheckoutAddressesModel=_.clone(n.checkoutAddressesScope.CheckoutAddressesModel);n.checkoutAddressesScope.CloseEditAddress()});n.checkoutAddressesScope.$on("AddressesScope.ZipCodeDetails",function(t,i,r){i.IsValidZip?r?(n.checkoutAddressesScope.CheckoutAddressesModel.BillingCity=i.City,n.checkoutAddressesScope.CheckoutAddressesModel.BillingState=i.State):(n.checkoutAddressesScope.CheckoutAddressesModel.ShippingCity=i.City,n.checkoutAddressesScope.CheckoutAddressesModel.ShippingState=i.State):_.defer(function(){n.checkoutAddressesScope.ShowValidation=!0;r?f.setValidationOnInput("BillingZip","validateZipcode",!1):f.setValidationOnInput("ShippingZip","validateZipcode",!1)},500)});n.checkoutAddressesScope.UpdateWaterMarks=function(){n.checkoutAddressesScope.UpdateInlineWaterMark()};n.checkoutAddressesScope.$on("AvonController.PageCompete",function(){n.checkoutAddressesScope.UpdateWaterMarks()})}return __extends(i,t),i.$inject=["$scope","paymentService","trackingService"],i}(BaseAngularController);n.CheckoutAddressesController=t}(CheckoutModule||(CheckoutModule={}));app.controller("CheckoutAddressesController",CheckoutModule.CheckoutAddressesController),function(n){"use strict";var t,i=function(n){function i(i){n.call(this,i);t=i;t.CartContainsReplenishmentItems=function(){var n,i;for(n in t.Session.Cart.Campaigns)for(i in t.Session.Cart.Campaigns[n].Items)if(t.Session.Cart.Campaigns[n].Items[i].AutoReplenishmentPrice>0&&t.Session.Cart.Campaigns[n].Items[i].AutoReplenishmentFrequency>0)return!0;return!1};t.$on("LoginService.FacebookLoginResponse",function(n,i){i.data.Data.Success&&t.RedirectToUrl(t.Url.Action("BillingAndShipping","Checkout"))})}return __extends(i,n),i.$inject=["$scope","bagService","paymentService","trackingService"],i}(BaseAngularController);n.CheckoutSignInController=i}(CheckoutModule||(CheckoutModule={}));app.controller("checkoutSignInController",CheckoutModule.CheckoutSignInController),function(n){"use strict";var t=function(t){function i(i,r,u,f,e){var o=this;t.call(this,i);n.checkoutStep1Scope=i;n.checkoutStep1Scope.RegistrationService=f;n.checkoutStep1Scope.FormModelPrefix="CheckoutStep1Model";n.checkoutStep1Scope.Countries=AVON.Countries;n.checkoutStep1Scope.SessionService.WhenReady().then(function(){$(".StepProgressBar .step1").addClass("activeStep");n.checkoutStep1Scope.PaymentService=r;n.checkoutStep1Scope.CheckoutStep1Model=AVON.CheckoutStep1ViewModel;n.checkoutStep1Scope.BillingStates=AVON.BillingStates;n.checkoutStep1Scope.ShippingStates=AVON.ShippingStates;n.checkoutStep1Scope.InvalidPhoneNumber=AVON.messages.validate_invalid_phonenumber;n.checkoutStep1Scope.IsRepAttachedInSession=n.checkoutStep1Scope.Session.Rep.Id>0;n.checkoutStep1Scope.EstimatedTax=AVON.EstimatedTax;$("#"+n.checkoutStep1Scope.FormModelPrefix+"_FirstNameInput").focus();n.checkoutStep1Scope.QueryString().invalidDetails==="1"&&n.checkoutStep1Scope.Session.Customer.IsLoggedIn&&_.defer(function(){n.checkoutStep1Scope.CheckoutStep1Model.BillingCity&&n.checkoutStep1Scope.CheckoutStep1Model.BillingState&&(n.checkoutStep1Scope.ShowBillingCityState=!0);n.checkoutStep1Scope.CheckoutStep1Model.ShippingCity&&n.checkoutStep1Scope.CheckoutStep1Model.ShippingState&&(n.checkoutStep1Scope.ShowShippingCityState=!0,r.GetEstimatedTax(n.checkoutStep1Scope.CheckoutStep1Model.ShippingZip,!0));n.checkoutStep1Scope.CheckoutStep1FormSubmit()},500)});n.checkoutStep1Scope.IsBillingUsaAddress=function(){return n.checkoutStep1Scope.CheckoutStep1Model.BillingCountry==="US"};n.checkoutStep1Scope.IsBillingInternationalAddress=function(){return n.checkoutStep1Scope.IsBillingUsaAddress()===!1};n.checkoutStep1Scope.SwitchToInternationalAddressView=function(){n.checkoutStep1Scope.CheckoutStep1Model.BillingCountry=""};n.checkoutStep1Scope.GetEstimatedTax=function(){n.checkoutStep1Scope.estimatedTaxZipCode&&n.checkoutStep1Scope.estimatedTaxZipCode.length>0&&(n.checkoutStep1Scope.ShowLoading(AVON.messages.spinner_coupon),r.GetEstimatedTax(n.checkoutStep1Scope.estimatedTaxZipCode,!1))};u.TrackEventItem({Type:TrackingEventType.CartCheckout1});n.checkoutStep1Scope.KeyPress=function(t){t.target.id.indexOf("FirstName")>-1&&(n.checkoutStep1Scope.CheckoutStep1Model.ShippingFirstName=$(t.target).val());t.target.id.indexOf("LastName")>-1&&(n.checkoutStep1Scope.CheckoutStep1Model.ShippingLastName=$(t.target).val());(t.target.id.indexOf("ShippingZip")>-1||t.target.id.indexOf("BillingZip")>-1&&t.target.value.length>5)&&n.checkoutStep1Scope.ResetValidation();_.defer(function(){n.checkoutStep1Scope.SafeApply();n.checkoutStep1Scope.UpdateInlineWaterMark()},250)};n.checkoutStep1Scope.ToggleBillingSameAsShipping=function(){n.checkoutStep1Scope.CheckoutStep1Model.SharedAddressDetails||(n.checkoutStep1Scope.CheckoutStep1Model.BillingCountry="US",n.checkoutStep1Scope.CheckoutStep1Model.BillingFirstName=n.checkoutStep1Scope.CheckoutStep1Model.ShippingFirstName,n.checkoutStep1Scope.CheckoutStep1Model.BillingLastName=n.checkoutStep1Scope.CheckoutStep1Model.ShippingLastName,n.checkoutStep1Scope.CheckoutStep1Model.BillingAddress1="",n.checkoutStep1Scope.CheckoutStep1Model.BillingAddress2="",n.checkoutStep1Scope.CheckoutStep1Model.BillingCity="",n.checkoutStep1Scope.CheckoutStep1Model.BillingState="",n.checkoutStep1Scope.CheckoutStep1Model.BillingZip="",n.checkoutStep1Scope.ShowBillingCityState=!1)};n.checkoutStep1Scope.ResetValidation=function(){$("#"+n.checkoutStep1Scope.FormModelPrefix+"_Password").removeClass("FormError");n.checkoutStep1Scope.ShowValidation=!1;n.checkoutStep1Scope.ShowPhoneNumberErrorMessage=!1;n.checkoutStep1Scope.EmailAlreadyExists=!1;n.checkoutStep1Scope.PasswordsDontMatch=!1;n.checkoutStep1Scope.ShowEmailErrorMessage=!1;o.setValidationOnInput("BillingPostalCode","validatePostalCode",!0);o.setValidationOnInput("ShippingCity","validateCity",!0);o.setValidationOnInput("ShippingState","validateState",!0);o.setValidationOnInput("BillingCity","validateCity",!0);o.setValidationOnInput("BillingState","validateState",!0)};n.checkoutStep1Scope.InputFocus=function(){n.checkoutStep1Scope.ResetValidation()};n.checkoutStep1Scope.SetFormDividerHeight=function(){return n.checkoutStep1Scope.CheckoutStep1Model.SharedAddressDetails&&n.checkoutStep1Scope.ShowShippingCityState?"formDividerLine ShippingZipCodeRetrieved":!n.checkoutStep1Scope.CheckoutStep1Model.SharedAddressDetails&&!n.checkoutStep1Scope.ShowShippingCityState&&!n.checkoutStep1Scope.ShowBillingCityState?"formDividerLine BillingFormOpen":!n.checkoutStep1Scope.CheckoutStep1Model.SharedAddressDetails&&n.checkoutStep1Scope.ShowShippingCityState&&n.checkoutStep1Scope.ShowBillingCityState?"formDividerLine BillingFormOpenWithTwoZipsRetrieved":!n.checkoutStep1Scope.CheckoutStep1Model.SharedAddressDetails&&(n.checkoutStep1Scope.ShowShippingCityState||n.checkoutStep1Scope.ShowBillingCityState)?"formDividerLine BillingFormOpenWithOneZipRetrieved":"formDividerLine"};n.checkoutStep1Scope.BillingSameAsShipping=function(){n.checkoutStep1Scope.CheckoutStep1Model.SharedAddressDetails&&(o.setShippingInputIntoBillingInput("BillingCountry","ShippingCountry"),o.setShippingInputIntoBillingInput("BillingFirstName","ShippingFirstName"),o.setShippingInputIntoBillingInput("BillingLastName","ShippingLastName"),o.setShippingInputIntoBillingInput("BillingAddress1","ShippingAddress1"),o.setShippingInputIntoBillingInput("BillingAddress2","ShippingAddress2"),o.setShippingInputIntoBillingInput("BillingCity","ShippingCity"),o.setShippingInputIntoBillingInput("BillingState","ShippingState"),o.setShippingInputIntoBillingInput("BillingZip","ShippingZip"),n.checkoutStep1Scope.CheckoutStep1Model.BillingZip=n.checkoutStep1Scope.CheckoutStep1Model.ShippingZip,n.checkoutStep1Scope.CheckoutStep1Model.BillingState=n.checkoutStep1Scope.CheckoutStep1Model.ShippingState,n.checkoutStep1Scope.IsBillingUsaAddress()&&n.checkoutStep1Scope.CheckoutStep1Model.BillingZip.length>0&&(n.checkoutStep1Scope.ShowBillingCityState=!0))};n.checkoutStep1Scope.FormValidationChecks=function(){if(n.checkoutStep1Scope.ResetValidation(),n.checkoutStep1Scope.BillingSameAsShipping(),n.checkoutStep1Scope.Session.Customer.IsLoggedIn&&(n.checkoutStep1Scope.Session.Customer.FirstName||o.setShippingInputIntoBillingInput("FirstName","ShippingFirstName"),n.checkoutStep1Scope.Session.Customer.LastName||o.setShippingInputIntoBillingInput("LastName","ShippingLastName")),n.checkoutStep1Scope.CheckoutStep1Model.PhoneNumber&&n.checkoutStep1Scope.CheckoutStep1Model.PhoneNumber.length>0&&n.checkoutStep1Scope.CheckoutStep1Model.PhoneNumber.length<10&&(n.checkoutStep1Scope.CheckoutStep1Form[n.checkoutStep1Scope.FormModelPrefix+"_PhoneNumber"].$invalid=!0,n.checkoutStep1Scope.ShowPhoneNumberErrorMessage=!0),n.checkoutStep1Scope.PasswordFieldsRequired()){var t=!1;n.checkoutStep1Scope.CheckoutStep1Model.Password&&n.checkoutStep1Scope.CheckoutStep1Model.Password.length<1&&(n.checkoutStep1Scope.CheckoutStep1Form[n.checkoutStep1Scope.FormModelPrefix+"_Password"].$invalid=!0,t=!0);n.checkoutStep1Scope.CheckoutStep1Model.PasswordConfirm&&n.checkoutStep1Scope.CheckoutStep1Model.PasswordConfirm.length<1&&(n.checkoutStep1Scope.CheckoutStep1Form[n.checkoutStep1Scope.FormModelPrefix+"_PasswordConfirm"].$invalid=!0,t=!0);n.checkoutStep1Scope.CheckoutStep1Model.PasswordHint&&n.checkoutStep1Scope.CheckoutStep1Model.PasswordHint.length<1&&(n.checkoutStep1Scope.CheckoutStep1Form[n.checkoutStep1Scope.FormModelPrefix+"_PasswordHint"].$invalid=!0,t=!0);n.checkoutStep1Scope.CheckoutStep1Model.Password!==n.checkoutStep1Scope.CheckoutStep1Model.PasswordConfirm&&($("#"+n.checkoutStep1Scope.FormModelPrefix+"_Password").addClass("FormError"),n.checkoutStep1Scope.CheckoutStep1Form[n.checkoutStep1Scope.FormModelPrefix+"_PasswordConfirm"].$invalid=!0,n.checkoutStep1Scope.PasswordsDontMatch=!0,t=!0);t&&(n.checkoutStep1Scope.ShowValidation=!0,n.checkoutStep1Scope.CheckoutStep1Form.$valid=!1)}n.checkoutStep1Scope.PasswordFieldsRequired()||n.checkoutStep1Scope.DisplayPasswordFields()||(n.checkoutStep1Scope.CheckoutStep1Model.Password="",n.checkoutStep1Scope.CheckoutStep1Model.PasswordConfirm="",n.checkoutStep1Scope.CheckoutStep1Model.PasswordHint="")};n.checkoutStep1Scope.CheckoutStep1FormSubmit=function(){if(n.checkoutStep1Scope.FormValidationChecks(),!n.checkoutStep1Scope.CheckoutStep1Form.$valid){n.checkoutStep1Scope.ShowValidation=!0;return}n.checkoutStep1Scope.ShowLoading(AVON.messages.spinner_registering);r.CheckoutStep1SaveDetails(n.checkoutStep1Scope.CheckoutStep1Model,$("form[name=CheckoutStep1Form]"))};n.checkoutStep1Scope.$on("PaymentService.CheckoutStep1SaveDetails",function(t,i){i.ErrorCode===AjaxError.ValidationErrors&&(n.checkoutStep1Scope.HideLoading(),n.checkoutStep1Scope.ShowValidation=!0,n.checkoutStep1Scope.ProcessAjaxValidationErrors(i),$.each(i.ValidationErrors,function(t,i){i.FieldName.indexOf("DuplicateEmail")>-1&&(n.checkoutStep1Scope.EmailAlreadyExists=!0);var r=n.checkoutStep1Scope.FormModelPrefix+i.FieldName.replace("model.","_");n.checkoutStep1Scope.CheckoutStep1Form!=undefined&&n.checkoutStep1Scope.CheckoutStep1Form[r]!=undefined&&(n.checkoutStep1Scope.CheckoutStep1Form[r].$invalid=!0,i.FieldName.indexOf("BillingAddress")>-1||i.FieldName.indexOf("ShippingAddress")>-1,i.FieldName.indexOf("PhoneNumber")>-1&&(n.checkoutStep1Scope.ShowPhoneNumberErrorMessage=!0),i.FieldName.indexOf("BillingZip")>-1&&o.setValidationOnInput("BillingZip","validateZipcode",!1),i.FieldName.indexOf("ShippingZip")>-1&&o.setValidationOnInput("ShippingZip","validateZipcode",!1),i.FieldName.indexOf("BillingPostalCode")>-1&&o.setValidationOnInput("BillingPostalCode","validatePostalCode",!1),i.FieldName.indexOf("PasswordConfirm")>-1&&(n.checkoutStep1Scope.PasswordsDontMatch=!0),i.FieldName.indexOf("Email")>-1&&(n.checkoutStep1Scope.ShowEmailErrorMessage=!0,n.checkoutStep1Scope.EmailErrorMessage=i.Problem))}))});n.checkoutStep1Scope.CheckIfEmailExists=function(){return!n.checkoutStep1Scope.Session.Customer.HideWelcomeBackModal&&n.checkoutStep1Scope.IsEmailValid(n.checkoutStep1Scope.CheckoutStep1Model.Email)?($("#"+n.checkoutStep1Scope.FormModelPrefix+"_EmailInput").addClass("LoadingImage"),n.checkoutStep1Scope.RegistrationService.getCustomerByEmail(n.checkoutStep1Scope.CheckoutStep1Model.Email,!1)):null};n.checkoutStep1Scope.$on("RegistrationService.RegisteredCustomerAsGuestResponse",function(t,i){var f=$("#"+n.checkoutStep1Scope.FormModelPrefix+"_EmailInput"),r,u;f.removeClass("LoadingImage");i.ErrorCode!=AjaxError.ValidationErrors&&(i.SaveInSession?i.Rep&&(r=i.Rep,r.Id>0&&(n.checkoutStep1Scope.Session.Rep=r)):i.CustomerId&&i.CustomerType==6&&(u={UrlToLoad:"",AllowExit:!0,KeepLoaded:!0,Model:{Email:n.checkoutStep1Scope.CheckoutStep1Model.Email}},$("#WelcomeBack").trigger("modal",u)))});n.checkoutStep1Scope.LoadSignInModal=function(){_.defer(function(){n.checkoutStep1Scope.ShowLoading(AVON.messages.spinner_loading)},250);var t=n.checkoutStep1Scope.HomePageUrl+"signin?returnurl=/checkout&email="+n.checkoutStep1Scope.CheckoutStep1Model.Email;n.checkoutStep1Scope.RedirectToUrl(t)};n.checkoutStep1Scope.$on("WelcomeBackScope.ContinueAsGuest",function(){n.checkoutStep1Scope.IsAutoReplenishmentInCart()||n.checkoutStep1Scope.RegisteredUserContinueAsGuest(!0);n.checkoutStep1Scope.HideWelcomeBackModal(!0)});n.checkoutStep1Scope.RegisteredUserContinueAsGuest=function(t){$("#WelcomeBack").trigger("close");n.checkoutStep1Scope.CheckoutStep1Model.IsRegisteredGuestShopper=!0;n.checkoutStep1Scope.UpdateCustomerType(CustomerType.RegisteredCustomerAsGuest);n.checkoutStep1Scope.DisplayPasswordFields();t&&n.checkoutStep1Scope.RegistrationService.getCustomerByEmail(n.checkoutStep1Scope.CheckoutStep1Model.Email,t)};n.checkoutStep1Scope.UpdateCustomerType=function(t){n.checkoutStep1Scope.SessionService.PostJson("/api/session/updatecustomertype",{customerType:t});n.checkoutStep1Scope.Session.Customer.CustomerType=t};n.checkoutStep1Scope.DisplayPasswordFields=function(){return!n.checkoutStep1Scope.CheckoutStep1Model.IsRegisteredGuestShopper&&!n.checkoutStep1Scope.Session.Customer.IsLoggedIn||!n.checkoutStep1Scope.Session.Customer.IsLoggedIn&&n.checkoutStep1Scope.IsAutoReplenishmentInCart()};n.checkoutStep1Scope.PasswordFieldsRequired=function(){var t=!1;return n.checkoutStep1Scope.DisplayPasswordFields()&&(n.checkoutStep1Scope.IsRepAttachedInSession||n.checkoutStep1Scope.IsAutoReplenishmentInCart())&&(t=!0),t};n.checkoutStep1Scope.DisplayLoginModal=function(){n.checkoutStep1Scope.ShowLoginModal()};n.checkoutStep1Scope.DisplayForgotPassword=function(){e.displayForgotPassword=!0;e.forgotEmail=n.checkoutStep1Scope.CheckoutStep1Model.Email;n.checkoutStep1Scope.ShowLoginModal()};n.checkoutStep1Scope.$on("AddressesScope.ZipCodeDetails",function(t,i,u){i.IsValidZip?(u?(n.checkoutStep1Scope.ShowBillingCityState=!0,n.checkoutStep1Scope.CheckoutStep1Model.BillingCity=i.City,n.checkoutStep1Scope.CheckoutStep1Model.BillingState=i.State):(n.checkoutStep1Scope.ShowShippingCityState=!0,n.checkoutStep1Scope.CheckoutStep1Model.ShippingCity=i.City,n.checkoutStep1Scope.CheckoutStep1Model.ShippingState=i.State,r.GetEstimatedTax(n.checkoutStep1Scope.CheckoutStep1Model.ShippingZip,!0)),n.checkoutStep1Scope.SafeApply(),n.checkoutStep1Scope.UpdateInlineWaterMark()):(n.checkoutStep1Scope.ShowValidation=!0,u?o.setValidationOnInput("BillingZip","validateZipcode",!1):o.setValidationOnInput("ShippingZip","validateZipcode",!1))});n.checkoutStep1Scope.UpdateWaterMarks=function(){n.checkoutStep1Scope.SafeApply();n.checkoutStep1Scope.UpdateInlineWaterMark();n.checkoutStep1Scope.PasswordFieldsRequired()&&($("label[for='"+n.checkoutStep1Scope.FormModelPrefix+"_PasswordInput']").append("*"),$("label[for='"+n.checkoutStep1Scope.FormModelPrefix+"_PasswordConfirmInput']").append("*"),$("label[for='"+n.checkoutStep1Scope.FormModelPrefix+"_PasswordHintInput']").append("*"))};n.checkoutStep1Scope.$on("AvonController.PageCompete",function(){$("#"+n.checkoutStep1Scope.FormModelPrefix+"_FirstNameInput").focus();n.checkoutStep1Scope.UpdateWaterMarks()});n.checkoutStep1Scope.ClearZipCodeValidation=function(){n.checkoutStep1Scope.ShowZipCodeErrorMessage=!1};n.checkoutStep1Scope.OpenTaxCalculator=function(){n.checkoutStep1Scope.ShowTaxCalculator=!0};n.checkoutStep1Scope.FocusZipCodeEdit=function(){n.checkoutStep1Scope.ClearZipCodeValidation()};n.checkoutStep1Scope.ApplyZipCode=function(){n.checkoutStep1Scope.ClearZipCodeValidation();var t=$("#estimatedTaxZipCode").val();t.length>0?(n.checkoutStep1Scope.ShowLoading(AVON.messages.spinner_updatingBag),r.GetEstimatedTax(t,!0)):n.checkoutStep1Scope.ShowZipCodeErrorMessage=!0};n.checkoutStep1Scope.$on("PaymentService.GetEstimatedTaxSuccess",function(t,i){if(i.ErrorCode===AjaxError.None){var r=i.Data;r.IsValid?(n.checkoutStep1Scope.Session.Cart.EstimatedTaxZipCode=r.ZipCode,n.checkoutStep1Scope.estimatedTaxZipCode=r.ZipCode,n.checkoutStep1Scope.EstimatedTax=r.TaxEstimate,n.checkoutStep1Scope.ShowTaxCalculator=!1):n.checkoutStep1Scope.ShowZipCodeErrorMessage=!0}else n.checkoutStep1Scope.ShowZipCodeErrorMessage=!0});n.checkoutStep1Scope.$on("PaymentService.GetEstimatedTaxFailure",function(){n.checkoutStep1Scope.ShowZipCodeErrorMessage=!0});n.checkoutStep1Scope.$on("CouponScope.ApplyCouponApplyTax",function(){n.checkoutStep1Scope.Session.Cart.EstimatedTaxZipCode&&(n.checkoutStep1Scope.estimatedTaxZipCode=n.checkoutStep1Scope.Session.Cart.EstimatedTaxZipCode);n.checkoutStep1Scope.GetEstimatedTax()})}return __extends(i,t),i.prototype.setShippingInputIntoBillingInput=function(t,i){var r=n.checkoutStep1Scope.CheckoutStep1Form[n.checkoutStep1Scope.FormModelPrefix+"_"+i],u=n.checkoutStep1Scope.CheckoutStep1Form[n.checkoutStep1Scope.FormModelPrefix+"_"+t];u&&r&&u.$setViewValue(r.$viewValue)},i.prototype.resetBillingInput=function(t,i){var r=n.checkoutStep1Scope.CheckoutStep1Form[n.checkoutStep1Scope.FormModelPrefix+"_"+t];r&&r.$setViewValue(i)},i.prototype.setValidationOnInput=function(t,i,r){var u=n.checkoutStep1Scope.CheckoutStep1Form[n.checkoutStep1Scope.FormModelPrefix+"_"+t];u&&u.$setValidity(i,r)},i.$inject=["$scope","paymentService","trackingService","registrationService","loginService"],i}(BaseAngularController);n.CheckoutStep1Controller=t}(CheckoutModule||(CheckoutModule={}));app.controller("CheckoutStep1Controller",CheckoutModule.CheckoutStep1Controller),function(n){"use strict";var t=function(t){function i(i,r,u,f){var e=this;t.call(this,i);this.trackingService=u;n.couponScope=i;n.couponScope.couponMessage=null;n.couponScope.couponErrorMessage=null;n.couponScope.newCouponCode=i.Session.Cart.Coupon.Code;AVON.paymentViewModel&&(n.couponScope.couponErrorMessage=AVON.paymentViewModel.CouponError);n.couponScope.checkForSessionOrCuponErrorMessage=function(){return n.couponScope.sessionOrCuponErrorMessage=n.couponScope.Session.Cart.Coupon.ErrorMessage||n.couponScope.couponErrorMessage,n.couponScope.sessionOrCuponErrorMessage};n.couponScope.checkForNonDiscountableErrorMessage=function(){var t=n.couponScope.Session.Cart.Coupon.Code!=null&&n.couponScope.Session.Cart.OrderDetails.HasNonDiscountableItems&&n.couponScope.Session.Cart.Coupon.Discount!=null,i;return t&&(i={en:"Coupon Code cannot be applied to products noted as ineligible for discounts.",es:"El cupn no es vlido cuando los productos indiquen que no son elegibles para descuentos."},(n.couponScope.sessionOrCuponErrorMessage===i.en||n.couponScope.sessionOrCuponErrorMessage===i.es)&&(t=!1)),t};i.ApplyCoupon=function(n,t){if(t===void 0&&(t=!0),t){i.ClearCouponValidation();i.ShowLoading(AVON.messages.spinner_coupon);var u=$("body.Controller_Checkout").length>0&&$("body.Action_Index").length>0;r.ApplyCoupon(n,u).then(function(n){e.trackCouponAdded(n,u)})}};i.RemoveCoupon=function(n){if(n===void 0&&(n=!0),n){var t=$("body.Controller_Checkout").length>0&&$("body.Action_Index").length>0;i.ClearCouponValidation();i.ShowLoading(AVON.messages.spinner_coupon);r.RemoveCoupon(t).then(function(n){e.trackCouponRemoved(n)})}};i.ClearCouponValidation=function(){n.couponScope.couponMessage=null;n.couponScope.couponErrorMessage=null};i.$on("BagService.Update",function(){n.couponScope.couponMessage=null;n.couponScope.couponErrorMessage=null});i.$on("PaymentController.SubmitOrderResponse.CouponError",function(){n.couponScope.couponMessage=null;n.couponScope.couponErrorMessage=n.couponScope.Session.Cart.Coupon.ErrorMessage});i.$on("BagService.ApplyCouponSuccess",function(t,r){var u=r.Data,e;i.couponMessage=u.Message;i.couponErrorMessage=u.ErrorMessage;i.SafeApply();u.TagLinesHtml&&(e=$("#TaglinesContainer"),e.html(u.TagLinesHtml),f(e)(i));AvonModule.AvonScope.$broadcast("CouponScope.ApplyCouponSuccess",r);n.couponScope.$root.$broadcast("CouponScope.ApplyCouponApplyTax")});i.$on("SessionService.SessionUpdated",function(){i.newCouponCode=i.Session.Cart.Coupon.Code;i.SafeApply()})}return __extends(i,t),i.prototype.trackCouponAdded=function(n,t){var i={event_name:"coupon_add",content_coupon_used:this.GetTrackingContentCouponUsedValue(n.CouponValidationCode),content_coupon_placement:t?"checkout":"bag",content_coupon_message:n.Message?n.Message:n.ErrorMessage};this.trackingService.TrackEvent(i)},i.prototype.trackCouponRemoved=function(){this.trackingService.TrackEvent({event_name:"order_checkout_coupon_remove"})},i.prototype.GetTrackingContentCouponUsedValue=function(n){var t;switch(n){case CouponValidationCode.Expired:t="Expired";break;case CouponValidationCode.StandardCoupon:t="Qualified";break;default:t="Not valid"}return t},i.$inject=["$scope","bagService","trackingService","$compile"],i}(BaseAngularController);n.CouponController=t}(CouponModule||(CouponModule={}));app.controller("CouponController",CouponModule.CouponController),function(n){"use strict";var t=function(t){function i(i,r,u,f,e,o){t.call(this,i,o);n.bagScope=i;n.bagScope.loginService=f;n.bagScope.SessionService.WhenReady().then(function(){AvonModule.AvonScope.Session.Cart.OutOfStockProducts&&AvonModule.AvonScope.Session.Cart.OutOfStockProducts.length>0&&(n.bagScope.ShowLoading(AVON.messages.spinner_updatingBag),u.NoLongerAvailableProducts())});n.bagScope.GetProductLinkAnyCampaign=function(t){return n.bagScope.Url.Action("Details","Product")+"/"+t.ProductName.formatUrlNugget()+"-"+t.PfId};n.bagScope.ShowLoadingToCheckout=function(){e.TrackEventItem({Type:TrackingEventType.CartViewBagCheckoutButtonClick});e.TrackEventItem({Type:TrackingEventType.CartViewBagSignInModal});AVON.OdsIsDown||n.bagScope.Session.Customer.IsLoggedIn&&(AVON.CustomerType===0||AVON.CustomerType===1||AVON.CustomerType===2)||n.bagScope.Session.Customer.BillingAddress.Address1&&AVON.CustomerType===3||AVON.CustomerType===6?(i.ShowLoading(AVON.messages.spinner_loading),location.href=n.bagScope.Url.Action("Index","Checkout")):(AVON.TempModalModel={Mode:"FullRegistration"},i.ShowLoginModal(null,n.bagScope.Url.Action("Index","Checkout")))};$(document).ready(function(){_.defer(function(){$(".MultipleQuantityPromo").each(function(){$(this).find("input.donationRadio").first().click()})})});n.bagScope.ShoppingCartClick=function(t){t.preventDefault();n.bagScope.SessionReady&&n.bagScope.Session.Cart.OrderDetails.ItemCount>0&&(n.bagScope.ShowLoading(AVON.messages.spinner_loading),n.bagScope.RedirectToUrl(n.bagScope.Url.Action("Index","Bag")))}}return __extends(i,t),i.$inject=["$scope","bagService","paymentService","loginService","trackingService","$window","$timeout","$rootScope","wishListService"],i}(BaseAngularController);n.MiniViewBagController=t}(MiniViewBagModule||(MiniViewBagModule={}));app.controller("MiniViewBagController",MiniViewBagModule.MiniViewBagController),function(n){"use strict";var t,i=function(n){function i(i,r,u,f){n.call(this,i);t=i;t.SessionService.WhenReady().then(function(){t.IsSignedIn=!1;$.each(t.Session.Cart.Campaigns,function(n,i){$.each(i.Items,function(n,i){var u=i.AutoReplenishmentFrequency>0,r;u&&(r=f.IsSubscribedToProductWithSku(i.Sku),r&&t.Session.Customer.IsLoggedIn&&t.RedirectToUrl(t.Url.Action("Index","Bag")))})})});$(document).ready(function(){$(".ScrollableMenu").mCustomScrollbar()})}return __extends(i,n),i.$inject=["$scope","bagService","trackingService","autoReplenishService"],i}(BaseAngularController);n.OrderDetailsController=i}(OrderDetailsModule||(OrderDetailsModule={}));app.controller("orderDetailsController",OrderDetailsModule.OrderDetailsController),function(n){"use strict";var t=function(t){function i(i,r,u,f,e,o,s,h,c){function a(){var t=[];return $.each(n.addressesScope.Session.Cart.Campaigns,function(i){$.each(n.addressesScope.Session.Cart.Campaigns[i].Items,function(r){n.addressesScope.Session.Cart.Campaigns[i].Items[r].AutoReplenishmentFrequency>0&&t.push(n.addressesScope.Session.Cart.Campaigns[i].Items[r])})}),t}function l(){return n.addressesScope.AutoReplenishmentExistsInCart=!1,$.each(n.addressesScope.Session.Cart.Campaigns,function(t){$.each(n.addressesScope.Session.Cart.Campaigns[t].Items,function(i){n.addressesScope.Session.Cart.Campaigns[t].Items[i].AutoReplenishmentFrequency>0&&(n.addressesScope.AutoReplenishmentExistsInCart=!0)})}),n.addressesScope.AutoReplenishmentExistsInCart}function v(t,i){n.addressesScope.ShowLoading(AVON.messages.spinner_saving);n.addressesScope.CustomerService.SaveMyAddresses([t],i,!1,!1)}function nt(){var t=[n.addressesScope.billingAddress];(n.addressesScope.SaveBillingAndShipping||n.addressesScope.shippingAddress.Address1)&&t.push(n.addressesScope.shippingAddress);n.addressesScope.ShowLoading(AVON.messages.spinner_saving);n.addressesScope.CustomerService.SaveMyAddresses(t,n.addressesScope.UpdateAvonAccountBilling,!1,!1)}function y(n){return n?n.match(/^(?=.*[0-9])([a-zA-Z0-9]{7,16})$/)!=null:!1}function p(t,i,r){n.addressesScope.ShowLoadingModal=t?!1:!0;n.addressesScope.IsNotCheckout=i?!1:!0;n.addressesScope.IsFirstTime=r?!0:!1;b();n.addressesScope.ValidForm=n.addressesScope.shippingAddressForm.$valid;n.addressesScope.ShippingSameAsBilling||(n.addressesScope.ValidForm=n.addressesScope.shippingAddressForm.$valid&&n.addressesScope.billingAddressForm.$valid);g();n.addressesScope.ShippingSameAsBilling||d();n.addressesScope.SaveBillingAndShipping=!0;(c.HasActiveSubscriptions()||l())&&$.each(AVON.RestrictedDevlieryStates,function(t,i){if(n.addressesScope.shippingAddress.State===i){n.addressesScope.ShowRestrictedStateModal=!0;n.addressesScope.SaveBillingAndShipping=!1;n.addressesScope.ModalOpened="IneligibleAutoReplenishment";$(".IneligibleAutoReplenishment.billingAddress").trigger("modal",{UrlToLoad:"",AllowExit:!0,KeepLoaded:!0,Model:null});n.addressesScope.AlaskaHawaiiAutoRepWarningShown=!0}})}function w(){n.addressesScope.ShowValidation=!0;n.addressesScope.RequiredInvalid=!0;n.addressesScope.SafeApply();r.$broadcast("AddressesScope.AddressValidation")}function b(){for(var i=!1,r=!1,t=0;t<n.addressesScope.ShippingStates.length;t++)if(n.addressesScope.ShippingStates[t].Code==n.addressesScope.shippingAddress.State){r=!0;break}for(r||(n.addressesScope.shippingAddress.State="",n.addressesScope.ValidForm=!1),t=0;t<n.addressesScope.BillingStates.length;t++)if(n.addressesScope.BillingStates[t].Code==n.addressesScope.billingAddress.State){i=!0;break}i||(n.addressesScope.billingAddress.State="",n.addressesScope.ValidForm=!1)}function k(t){t===void 0&&(t=!1);h(function(){n.addressesScope.ShowLoading(n.addressesScope.ShowLoadingModal?AVON.messages.spinner_registering:AVON.messages.spinner_saving)},250).then(function(){n.addressesScope.CustomerService.SaveMyAddresses([n.addressesScope.billingAddress,n.addressesScope.shippingAddress],t||!n.addressesScope.ShowLoadingModal,n.addressesScope.IsNotCheckout,n.addressesScope.IsFirstTime)})}function d(){n.addressesScope.IsBillingInternationalAddress()||(n.addressesScope.billingAddress.Zip.Code&&n.addressesScope.billingAddress.Zip.Code.length<5||n.addressesScope.billingAddressForm.Zip.$error.pattern&&n.addressesScope.billingAddressForm.Zip.$invalid)&&(n.addressesScope.billingAddressForm.Zip.$invalid=!0,n.addressesScope.billingAddressForm.Zip.$error.pattern=!0,n.addressesScope.ValidForm=!1)}function g(){(n.addressesScope.shippingAddress.Zip.Code&&n.addressesScope.shippingAddress.Zip.Code.length<5||n.addressesScope.shippingAddressForm.Zip.$error.pattern&&n.addressesScope.shippingAddressForm.Zip.$invalid)&&(n.addressesScope.shippingAddressForm.Zip.$invalid=!0,n.addressesScope.shippingAddressForm.Zip.$error.pattern=!0,n.addressesScope.ValidForm=!1)}function tt(){var t=n.addressesScope.billingAddress.PhoneNumber;t.Area&&t.Area.length===3?(n.addressesScope.billingAddressForm.Area.$invalid=!1,n.addressesScope.billingAddressForm.Area.$error.format=!1):(n.addressesScope.billingAddressForm.Area.$invalid=!0,n.addressesScope.billingAddressForm.Area.$error.format=!0,n.addressesScope.ValidForm=!1,n.addressesScope.billingAddressForm.$valid=!1);t.Prefix&&t.Prefix.length===3?(n.addressesScope.billingAddressForm.Prefix.$invalid=!1,n.addressesScope.billingAddressForm.Prefix.$error.format=!1):(n.addressesScope.billingAddressForm.Prefix.$invalid=!0,n.addressesScope.billingAddressForm.Prefix.$error.format=!0,n.addressesScope.ValidForm=!1,n.addressesScope.billingAddressForm.$valid=!1);t.Number&&t.Number.length===4?(n.addressesScope.billingAddressForm.Number.$invalid=!1,n.addressesScope.billingAddressForm.Number.$error.format=!1):(n.addressesScope.billingAddressForm.Number.$invalid=!0,n.addressesScope.billingAddressForm.Number.$error.format=!0,n.addressesScope.ValidForm=!1,n.addressesScope.billingAddressForm.$valid=!1)}t.call(this,i);this.$scope=i;this.autoReplenishService=c;this.isInternationalAddressEnabled=!1;n.addressesScope=i;n.addressesScope.CustomerService=u;n.addressesScope.RegistrationService=o;n.addressesScope.billingAddress=AVON.billingAddress;n.addressesScope.shippingAddress=AVON.shippingAddress;n.addressesScope.BillingStates=AVON.BillingStates;n.addressesScope.ShippingStates=AVON.ShippingStates;n.addressesScope.Countries=AVON.Countries;n.addressesScope.ShippingSameAsBilling=!0;n.addressesScope.ShowZipErrorMessage=!1;n.addressesScope.UpdateAvonAccountBilling=!1;n.addressesScope.UpdateAvonAccountShipping=!1;n.addressesScope.ShippingSameAsBillingPaymentForm=!1;n.addressesScope.ShowRestrictedStateModal=!1;n.addressesScope.ShowRestrictedStateInline=!1;n.addressesScope.ActiveAutoReplenishment=!1;n.addressesScope.SaveBillingAndShipping=!1;n.addressesScope.ReloadPageAfterAction=!1;n.addressesScope.ModalOpened="";n.addressesScope.RegistrationFullPageForm=angular.element("#checkoutStep1").val()=="true";n.addressesScope.PaymentPage=angular.element("#paymentPage").val()=="true";n.addressesScope.OrderingInfoPage=angular.element("#orderingInfoPage").val()=="true";n.addressesScope.RestrictedAutoRepType=RestrictedAutoRepType.None;n.addressesScope.AlaskaHawaiiAutoRepWarningShown=!1;n.addressesScope.ShowBillingCityState=AVON.isOdsDown;n.addressesScope.ShowShippingCityState=AVON.isOdsDown;n.addressesScope.ShowBillingPhoneNumber=!1;n.addressesScope.ShowShippingPhoneNumber=!1;n.addressesScope.DisplayBillingAddressEmailError=!1;n.addressesScope.EmailError=!1;n.addressesScope.HideEmailInput=!1;n.addressesScope.RequireFullAccount=AVON.RequireFullAccount;n.addressesScope.NotifySpecialOffers=!0;n.addressesScope.ShowZipValidation=!1;n.addressesScope.AccountAlreadyExists=!1;n.addressesScope.ContinueAsGuest=!1;n.addressesScope.GuestShopperWithRepId=!1;n.addressesScope.DisplayPrivacyPolicy=!0;n.addressesScope.DisplayPasswordInstructions=!0;n.addressesScope.SessionService.WhenReady().then(function(){n.addressesScope.RegisteredCustomerAsGuest={CustomerId:0,Rep:n.addressesScope.Session.Rep?n.addressesScope.Session.Rep:{Hash:0,Id:0,Address:"",CityStateZip:"",CityState:"",HomepageUrl:"",Name:"",FirstName:"",LastName:"",Phone:"",AlternativePhone:"",WebUrl:"",Status:"",IsInPilot:!1,IsGemini:!1}};n.addressesScope.Session.Rep.Id>0&&n.addressesScope.billingAddress.IsGuestShopper&&(AvonModule.AvonScope.Session.Customer.IsEligibleForGuestCheckout=!1,n.addressesScope.RequireFullAccount=!0,n.addressesScope.RepAttachedFullRegistrationRequired=!0,n.addressesScope.billingAddress.IsGuestShopper=!1,n.addressesScope.shippingAddress.IsGuestShopper=!1)});n.addressesScope.IsBillingUsaAddress=function(){return n.addressesScope.billingAddress.Country==="US"};n.addressesScope.IsBillingInternationalAddress=function(){return n.addressesScope.IsBillingUsaAddress()===!1};n.addressesScope.UseInternationalAddress=function(){n.addressesScope.billingAddress.Country=""};n.addressesScope.ShowCity=function(t){return t===!1?n.addressesScope.ShowShippingCityState:n.addressesScope.IsBillingInternationalAddress()?!0:n.addressesScope.ShowBillingCityState};n.addressesScope.DetermineIfInputShouldBeShownForUsaAddress=function(t){return t?!0:n.addressesScope.IsBillingUsaAddress()};n.addressesScope.DetermineIfInputShouldBeShownForInternationalAddress=function(t){return t?!1:n.addressesScope.IsBillingInternationalAddress()};n.addressesScope.UpdateCustomerType=function(t){n.addressesScope.SessionService.PostJson("/api/session/updatecustomertype",{customerType:t});n.addressesScope.Session.Customer.CustomerType=t};n.addressesScope.privacyUrl=$("#privacyPolicyUrl").val();n.addressesScope.conditionsOfUseUrl=$("#conditionsOfUseUrl").val();n.addressesScope.IsMyAccountPage=window.location.toString().indexOf("/orderinginfo")>-1?!0:!1;n.addressesScope.OrderInfoSaveBilling&&(n.addressesScope.UpdateAvonAccountBilling=n.addressesScope.OrderInfoSaveBilling);n.addressesScope.OrderInfoSaveShipping&&(n.addressesScope.UpdateAvonAccountShipping=n.addressesScope.OrderInfoSaveShipping);_.defer(function(){n.addressesScope.billingAddressForm.billingAddress_FirstName.$setViewValue(n.addressesScope.billingAddressForm.billingAddress_FirstName.$viewValue);n.addressesScope.billingAddressForm.billingAddress_LastName.$setViewValue(n.addressesScope.billingAddressForm.billingAddress_LastName.$viewValue);n.addressesScope.billingAddressForm.billingAddress_Address1.$setViewValue(n.addressesScope.billingAddressForm.billingAddress_Address1.$viewValue);n.addressesScope.billingAddressForm.billingAddress_Address2.$setViewValue(n.addressesScope.billingAddressForm.billingAddress_Address2.$viewValue);n.addressesScope.billingAddressForm.billingAddress_City.$setViewValue(n.addressesScope.billingAddressForm.billingAddress_City.$viewValue);n.addressesScope.IsBillingUsaAddress()&&n.addressesScope.billingAddressForm.Zip.$setViewValue(n.addressesScope.billingAddressForm.Zip.$viewValue);n.addressesScope.billingAddressForm.Area.$setViewValue(n.addressesScope.billingAddressForm.Area.$viewValue);n.addressesScope.billingAddressForm.Prefix.$setViewValue(n.addressesScope.billingAddressForm.Prefix.$viewValue);n.addressesScope.billingAddressForm.Number.$setViewValue(n.addressesScope.billingAddressForm.Number.$viewValue);n.addressesScope.billingAddress.City&&n.addressesScope.billingAddress.State&&(n.addressesScope.ShowBillingCityState=!0);n.addressesScope.shippingAddressForm.shippingAddress_FirstName.$setViewValue(n.addressesScope.shippingAddressForm.shippingAddress_FirstName.$viewValue);n.addressesScope.shippingAddressForm.shippingAddress_LastName.$setViewValue(n.addressesScope.shippingAddressForm.shippingAddress_LastName.$viewValue);n.addressesScope.shippingAddressForm.shippingAddress_Address1.$setViewValue(n.addressesScope.shippingAddressForm.shippingAddress_Address1.$viewValue);n.addressesScope.shippingAddressForm.shippingAddress_Address2.$setViewValue(n.addressesScope.shippingAddressForm.shippingAddress_Address2.$viewValue);n.addressesScope.shippingAddressForm.shippingAddress_City.$setViewValue(n.addressesScope.shippingAddressForm.shippingAddress_City.$viewValue);n.addressesScope.shippingAddressForm.Zip.$setViewValue(n.addressesScope.shippingAddressForm.Zip.$viewValue);n.addressesScope.shippingAddress.City&&n.addressesScope.shippingAddress.State&&(n.addressesScope.ShowShippingCityState=!0);var t=n.addressesScope.billingAddress.PhoneNumber.Area||"",i=n.addressesScope.billingAddress.PhoneNumber.Prefix||"",r=n.addressesScope.billingAddress.PhoneNumber.Number||"";n.addressesScope.billingAddress.PhoneNumber.FullNumber=t+i+r},200);AvonModule.AvonScope.QueryString().invalidDetails==="1"&&(n.addressesScope.HideEmailInput=!0,(n.addressesScope.billingAddress.Address1||n.addressesScope.shippingAddress.Address1)&&_.defer(function(){n.addressesScope.ShippingSameAsBilling=!1;b();n.addressesScope.billingAddress.State==""||n.addressesScope.shippingAddress.State==""?(n.addressesScope.ShowValidation=!0,n.addressesScope.RequiredInvalid=!0,n.addressesScope.SafeApply()):n.addressesScope.SaveBillingAndShippingAddresses(!0)},500));n.addressesScope.originalBillingAddress=angular.copy(n.addressesScope.billingAddress);n.addressesScope.originalShippingAddress=angular.copy(n.addressesScope.shippingAddress);n.addressesScope.updatePhoneNumber=function(){var t=n.addressesScope.billingAddress.PhoneNumber.FullNumber;t&&t.length>0?(n.addressesScope.billingAddress.PhoneNumber.Area=n.addressesScope.billingAddress.PhoneNumber.FullNumber.substring(0,3),n.addressesScope.billingAddress.PhoneNumber.Prefix=n.addressesScope.billingAddress.PhoneNumber.FullNumber.substring(3,6),n.addressesScope.billingAddress.PhoneNumber.Number=n.addressesScope.billingAddress.PhoneNumber.FullNumber.substring(6,10)):(n.addressesScope.billingAddress.PhoneNumber.Area="",n.addressesScope.billingAddress.PhoneNumber.Prefix="",n.addressesScope.billingAddress.PhoneNumber.Number="")};n.addressesScope.HasPhoneNumber=function(){var t=n.addressesScope.billingAddress.PhoneNumber;return t?!t.Area||t.Area.length!==3?!1:!t.Prefix||t.Prefix.length!==3?!1:!t.Number||t.Number.length!==4?!1:!0:!1};n.addressesScope.AllAutoRepSubscriptionsAreHazardous=function(){var t=c.AreAllSubscriptionsHazardous(),n=a(),i;return!t&&n.length===0?!1:(i=_.filter(n,function(n){return n.IsHazardous}),t&&n.length===i.length)};n.addressesScope.SomeAutoRepSubscriptionsAreHazardous=function(){var n=c.HasActiveHazardousSubscriptions(),t=a(),i=_.filter(t,function(n){return n.IsHazardous});return n||i.length>0};n.addressesScope.ZipIsValid=function(n){return n!==null&&n.length===5};n.addressesScope.ValidateRestrictedDeliveryState=function(t,i,r){n.addressesScope.ShowRestrictedStateModal=!1;n.addressesScope.ShowRestrictedStateInline=!1;n.addressesScope.ActiveAutoReplenishment=!1;n.addressesScope.ModalOpened="";n.addressesScope.SessionService.WhenReady().then(function(){if((i||n.addressesScope.UpdateAvonAccountShipping)&&(n.addressesScope.ActiveAutoReplenishment=c.HasActiveSubscriptions()),n.addressesScope.ActiveAutoReplenishment||(n.addressesScope.ActiveAutoReplenishment=l()||c.HasActiveSubscriptions()),n.addressesScope.ActiveAutoReplenishment&&(i||n.addressesScope.UpdateAvonAccountShipping)){var u=_.uniq(_.union(AVON.RestrictedDevlieryStates,AVON.SemiRestrictedDevlieryStates));$.each(u,function(i,u){if(n.addressesScope.shippingAddress.State===u)if(n.addressesScope.ShowRestrictedStateModal=!0,n.addressesScope.ModalOpened="IneligibleAutoReplenishment",n.addressesScope.RestrictedAutoRepType=_.contains(AVON.SemiRestrictedDevlieryStates,u)?n.addressesScope.SomeAutoRepSubscriptionsAreHazardous()?n.addressesScope.AllAutoRepSubscriptionsAreHazardous()?RestrictedAutoRepType.AlaskaHawaiiAllHazmat:RestrictedAutoRepType.AlaskaHawaiiSomeHazmat:RestrictedAutoRepType.AlaskaHawaiiNoHazmat:RestrictedAutoRepType.IslandState,t){var f={UrlToLoad:"",AllowExit:!0,KeepLoaded:!0,Model:null};r?$(".IneligibleAutoReplenishment.billingAddress").trigger("modal",f):$(".IneligibleAutoReplenishment.shippingAddress").trigger("modal",f);n.addressesScope.AlaskaHawaiiAutoRepWarningShown=!0}else n.addressesScope.ShowRestrictedStateInline=!0,n.addressesScope.CustomerService.ShowRestrictedStateInline(n.addressesScope.ShowRestrictedStateInline)})}});n.addressesScope.ShowRestrictedStateModal||(r?nt():n.addressesScope.SaveShippingAddress(),n.addressesScope.ShowRestrictedStateInline=!1,n.addressesScope.CustomerService.ShowRestrictedStateInline(n.addressesScope.ShowRestrictedStateInline))};n.addressesScope.InAlaskaHawaiiWithAutoRepInCart=function(){return l()&&_.contains(AVON.SemiRestrictedDevlieryStates,n.addressesScope.shippingAddress.State)};n.addressesScope.ShowIneligibleAutoRepModal=function(){n.addressesScope.DisplayShippingAddress=!0;n.addressesScope.RestrictedAutoRepType=_.contains(AVON.SemiRestrictedDevlieryStates,n.addressesScope.shippingAddress.State)?n.addressesScope.SomeAutoRepSubscriptionsAreHazardous()?n.addressesScope.AllAutoRepSubscriptionsAreHazardous()?RestrictedAutoRepType.AlaskaHawaiiAllHazmat:RestrictedAutoRepType.AlaskaHawaiiSomeHazmat:RestrictedAutoRepType.AlaskaHawaiiNoHazmat:RestrictedAutoRepType.IslandState;n.addressesScope.ModalOpened="InAlaskaHawaiiWithAutoRepInCartModal";$(".InAlaskaHawaiiWithAutoRepInCartModal").trigger("modal",{UrlToLoad:"",AllowExit:!0,KeepLoaded:!0,Model:null});n.addressesScope.AlaskaHawaiiAutoRepWarningShown=!0};n.addressesScope.$on("ModalClosed",function(){n.addressesScope.ModalOpened==="IneligibleAutoReplenishment"&&(n.addressesScope.ShowRestrictedStateInline=!1,n.addressesScope.CustomerService.ShowRestrictedStateInline(n.addressesScope.ShowRestrictedStateInline),n.addressesScope.shippingAddress.State=n.addressesScope.originalShippingAddress.State)});n.addressesScope.UpdateAutoReplenishmentSubscriptions=function(t){n.addressesScope.ModalOpened="";var i=[];$.each(n.addressesScope.Session.Cart.Campaigns,function(r){$.each(n.addressesScope.Session.Cart.Campaigns[r].Items,function(u){if(n.addressesScope.Session.Cart.Campaigns[r].Items[u].AutoReplenishmentFrequency>0&&(!t||n.addressesScope.Session.Cart.Campaigns[r].Items[u].IsHazardous)){var f={CampaignNumber:n.addressesScope.Session.Cart.Campaigns[r].Number,Sku:n.addressesScope.Session.Cart.Campaigns[r].Items[u].Sku,Quantity:0,AutoReplenishmentFrequency:n.addressesScope.Session.Cart.Campaigns[r].Items[u].AutoReplenishmentFrequency,AutoReplenishmentMultibuy:n.addressesScope.Session.Cart.Campaigns[r].Items[u].AutoReplenishmentMultibuy,AutoReplenishmentOverrideToBeOneTimeOnly:n.addressesScope.Session.Cart.Campaigns[r].Items[u].AutoReplenishmentOverrideToBeOneTimeOnly};i.push(f)}})});n.addressesScope.DeactivateAutoReplenishmentSubscriptions(t);n.addressesScope.ShowLoading(AVON.messages.spinner_loading);i.length>0&&e.update(i)};n.addressesScope.DeactivateAutoReplenishmentSubscriptions=function(t){n.addressesScope.ShowLoading(AVON.messages.spinner_saving);t?n.addressesScope.CustomerService.DiscontinueHazmatAutoReplenishmentProducts():n.addressesScope.CustomerService.DiscontinueAllAutoReplenishmentProducts();n.addressesScope.ShowRestrictedStateInline=!1;n.addressesScope.CustomerService.ShowRestrictedStateInline(n.addressesScope.ShowRestrictedStateInline)};n.addressesScope.$on("MyAccountService.DiscontinueAllAutoReplenishmentProducts",function(){n.addressesScope.SaveDetails()});n.addressesScope.$on("MyAccountService.DiscontinueHazmatAutoReplenishmentProducts",function(){n.addressesScope.SaveDetails()});n.addressesScope.SaveDetails=function(){n.addressesScope.ShowLoading(AVON.messages.spinner_saving);n.addressesScope.SaveBillingAndShipping?(n.addressesScope.ShowLoadingModal=!0,n.addressesScope.IsNotCheckout=!1,n.addressesScope.IsFirstTime=!1,k(n.addressesScope.Session.Customer.IsLoggedIn)):n.addressesScope.SaveShippingAddress()};n.addressesScope.CloseIneligibleForm=function(){n.addressesScope.ShowRestrictedStateInline=!1;n.addressesScope.CustomerService.ShowRestrictedStateInline(n.addressesScope.ShowRestrictedStateInline);n.addressesScope.shippingAddress.State=n.addressesScope.originalShippingAddress.State;n.addressesScope.billingAddress.State=n.addressesScope.originalBillingAddress.State;n.addressesScope.ShippingSameAsBillingPaymentForm=!1};n.addressesScope.ToggleShowRestrictedStateInline=function(){if(n.addressesScope.ShippingSameAsBillingPaymentForm&&n.addressesScope.ShowRestrictedStateInline){var t=n.addressesScope.billingAddress.State;n.addressesScope.CloseIneligibleForm();n.addressesScope.billingAddress.State=t}};n.addressesScope.SaveBillingAddress=function(){tt();n.addressesScope.ValidForm=n.addressesScope.billingAddressForm.$valid;d();n.addressesScope.ValidForm?n.addressesScope.ShippingSameAsBillingPaymentForm?(n.addressesScope.SaveBillingAndShipping=n.addressesScope.ShippingSameAsBillingPaymentForm,n.addressesScope.shippingAddress=angular.copy(n.addressesScope.billingAddress),n.addressesScope.shippingAddress.Type=1,n.addressesScope.ValidateRestrictedDeliveryState(n.addressesScope.IsMyAccountPage,!0,!0)):v(n.addressesScope.billingAddress,n.addressesScope.UpdateAvonAccountBilling):(n.addressesScope.ShowValidation=!0,n.addressesScope.RequiredInvalidBilling=!0)};n.addressesScope.SaveShippingAddress=function(){n.addressesScope.ValidForm=n.addressesScope.shippingAddressForm.$valid;g();n.addressesScope.ValidForm?v(n.addressesScope.shippingAddress,n.addressesScope.UpdateAvonAccountShipping):(n.addressesScope.ShowValidation=!0,n.addressesScope.RequiredInvalidShipping=!0)};n.addressesScope.SaveBillingAndShippingAddresses=function(t,i,r){if(p(t,i,r),n.addressesScope.ValidForm){if(n.addressesScope.ShippingSameAsBilling){var u=n.addressesScope.billingAddress.PhoneNumber;n.addressesScope.billingAddress=angular.copy(n.addressesScope.shippingAddress);n.addressesScope.billingAddress.Type=0;n.addressesScope.billingAddress.PhoneNumber=u}n.addressesScope.SaveBillingAndShipping&&k(n.addressesScope.Session.Customer.IsLoggedIn)}else w()};n.addressesScope.CheckIfEmailExists=function(){n.addressesScope.AccountAlreadyExists=!1;var t=$("#shippingAddress_Email");return!n.addressesScope.Session.Customer.HideWelcomeBackModal&&n.addressesScope.IsEmailValid(t.val())?(t.addClass("LoadingImage"),n.addressesScope.RegistrationService.getCustomerByEmail(t.val(),!1)):null};n.addressesScope.LoadSignInModal=function(){_.defer(function(){n.addressesScope.ShowLoading(AVON.messages.spinner_loading)},250);var t=n.addressesScope.HomePageUrl+"signin?returnurl=/checkout&email="+n.addressesScope.shippingAddress.Email;n.addressesScope.RedirectToUrl(t)};n.addressesScope.RegisteredUserContinueAsGuest=function(t){n.addressesScope.IsRegisteredGuestShopper=!0;var i=n.addressesScope.shippingAddress.Email;$("#WelcomeBack").trigger("close");n.addressesScope.ContinueAsGuest=!0;n.addressesScope.DisplayPrivacyPolicy=!1;n.addressesScope.GuestShopperWithRepId=!0;n.addressesScope.RequireFullAccount=!1;n.addressesScope.UpdateCustomerType(CustomerType.RegisteredCustomerAsGuest);t&&n.addressesScope.RegistrationService.getCustomerByEmail(i,t)};n.addressesScope.ResetContinueAsGuest=function(){n.addressesScope.ContinueAsGuest=!1};n.addressesScope.Session.Customer.CustomerType===CustomerType.RegisteredCustomerAsGuest&&n.addressesScope.QueryString().guestShopper&&n.addressesScope.RegisteredUserContinueAsGuest(!1);n.addressesScope.ValidateCustomerForm=function(){var t,i;return n.addressesScope.EmailError=!1,n.addressesScope.ShowPasswordValidation=!1,n.addressesScope.PasswordsDontMatch=!1,n.addressesScope.DisplayPasswordInstructions=!1,n.addressesScope.ValidationErrorStyle=!1,t=!1,n.addressesScope.ValidForm=!0,i=n.addressesScope.IsEmailValid(n.addressesScope.shippingAddress.Email),i||(n.addressesScope.ValidForm=!1,n.addressesScope.shippingAddressForm.shippingAddress_Email.$invalid=!0,n.addressesScope.EmailError=!0),n.addressesScope.shippingAddressForm.shippingAddress_FirstName.$invalid===!1&&n.addressesScope.shippingAddressForm.shippingAddress_LastName.$invalid===!1&&n.addressesScope.shippingAddressForm.shippingAddress_Email.$invalid===!1&&(n.addressesScope.ValidForm=!0),n.addressesScope.shippingAddressForm.Number.$invalid=!1,n.addressesScope.shippingAddressForm.Number.$error.format=!1,n.addressesScope.CreateAccount()&&(y(n.addressesScope.shippingAddress.Password)||(n.addressesScope.ValidForm=!1,t=!0,n.addressesScope.shippingAddressForm.shippingAddress_Password.$invalid=!0,n.addressesScope.ValidationErrorStyle=!0),y(n.addressesScope.shippingAddress.PasswordConfirm)||(n.addressesScope.ValidForm=!1,t=!0,n.addressesScope.shippingAddressForm.shippingAddress_PasswordConfirm.$invalid=!0,n.addressesScope.DisplayPasswordInstructions=!0,n.addressesScope.ValidationErrorStyle=!0),t===!1&&n.addressesScope.shippingAddress.Password!==n.addressesScope.shippingAddress.PasswordConfirm&&(n.addressesScope.ValidForm=!1,n.addressesScope.shippingAddressForm.shippingAddress_Password.$invalid=!0,n.addressesScope.shippingAddressForm.shippingAddress_PasswordConfirm.$invalid=!0,n.addressesScope.PasswordsDontMatch=!0,n.addressesScope.ValidationErrorStyle=!0,n.addressesScope.ValidationErrorStyle=!0),n.addressesScope.shippingAddress.PasswordHint||(n.addressesScope.ValidForm=!1,n.addressesScope.shippingAddressForm.shippingAddress_PasswordHint.$invalid=!0),n.addressesScope.shippingAddressForm.shippingAddress_FirstName.$invalid===!1&&n.addressesScope.shippingAddressForm.shippingAddress_LastName.$invalid===!1&&n.addressesScope.shippingAddressForm.shippingAddress_Email.$invalid===!1&&n.addressesScope.shippingAddressForm.shippingAddress_Password.$invalid===!1&&n.addressesScope.shippingAddressForm.shippingAddress_PasswordConfirm.$invalid===!1&&n.addressesScope.shippingAddressForm.shippingAddress_PasswordHint.$invalid===!1&&n.addressesScope.HasPhoneNumber()&&(n.addressesScope.ValidForm=!0)),n.addressesScope.PrivacyPolicyInput===!1&&(n.addressesScope.ShowAcceptedPrivacyPolicyError=!0,n.addressesScope.ValidForm=!1),n.addressesScope.ValidForm};n.addressesScope.CreateAccount=function(){return(n.addressesScope.CheckElementValue("#shippingAddress_PasswordInput")||n.addressesScope.CheckElementValue("#shippingAddress_PasswordConfirmInput")||n.addressesScope.CheckElementValue("#shippingAddress_PasswordHintInput")||n.addressesScope.RequireFullAccount)&&!n.addressesScope.GuestShopperWithRepId?!0:!1};n.addressesScope.InputFocus=function(){n.addressesScope.DisplayBillingAddressEmailError=!1;n.addressesScope.ValidationErrorStyle=!1;n.addressesScope.DisplayPasswordInstructions=!0;n.addressesScope.ShowValidation=!1;n.addressesScope.ShowAcceptedPrivacyPolicyError=!1;n.addressesScope.EmailAlreadyExists=!1};n.addressesScope.ViewPrivacyPolicy=function(){window.open(n.addressesScope.privacyUrl,"_blank")};n.addressesScope.ViewConditionsOfUse=function(){window.open(n.addressesScope.conditionsOfUseUrl,"_blank")};n.addressesScope.SubmitAddressDetails=function(t){n.addressesScope.RegistrationFullPageForm?r.$broadcast("AddressesScope.SubmitFullRegistrationDetails"):n.addressesScope.PaymentPage?(n.addressesScope.DisplayBillingAddress&&n.addressesScope.SaveBillingAddress(!0),n.addressesScope.DisplayShippingAddress&&n.addressesScope.ValidateRestrictedDeliveryState(!1)):n.addressesScope.OrderingInfoPage&&(t==="Billing"&&n.addressesScope.SaveBillingAddress(!0),t==="Shipping"&&n.addressesScope.ValidateRestrictedDeliveryState(!0,!0))};n.addressesScope.$on("AddressesScope.ValidateAddresses",function(t,i,u){n.addressesScope.ShowLoadingModal=u?!1:!0;p(n.addressesScope.ShowLoadingModal);n.addressesScope.ValidForm||w();i&&n.addressesScope.ValidForm&&r.$broadcast("RegistrationScope.SaveDetails")});n.addressesScope.$on("AddressesScope.SaveAddresses",function(){n.addressesScope.ShowLoadingModal=!0;n.addressesScope.SaveBillingAndShippingAddresses(!1)});n.addressesScope.$on("FormDirective.HidValidation",function(){n.addressesScope.billingAddressForm!=null&&(n.addressesScope.billingAddressForm.ServerErrors=[]);n.addressesScope.shippingAddressForm!=null&&(n.addressesScope.shippingAddressForm.ServerErrors=[]);n.addressesScope.ShowValidation&&(n.addressesScope.ShowValidation=!1)});n.addressesScope.$on("AddressesScope.ZipCodeDetails",function(t,i,u){i.IsValidZip?(n.addressesScope.ShowZipValidation=!1,u?(n.addressesScope.billingAddress.City=i.City,n.addressesScope.billingAddress.State=i.State,n.addressesScope.ShowBillingCityState=!0,n.addressesScope.billingAddressForm.Zip.$invalid=!1,n.addressesScope.billingAddressForm.Zip.$error.pattern=!1,$("input[name=Area]").focus()):(n.addressesScope.shippingAddress.City=i.City,n.addressesScope.shippingAddress.State=i.State,n.addressesScope.ShowShippingCityState=!0,n.addressesScope.shippingAddressForm.Zip.$invalid=!1,n.addressesScope.shippingAddressForm.Zip.$error.pattern=!1),_.defer(function(){n.addressesScope.UpdateInlineWaterMark();n.addressesScope.SafeApply();r.$broadcast("AddressController.UpdateInlineWaterMark")},250)):(n.addressesScope.ShowZipValidation=!0,u?(n.addressesScope.billingAddressForm.Zip.$invalid=!0,n.addressesScope.billingAddressForm.Zip.$error.pattern=!0):(n.addressesScope.shippingAddressForm.Zip.$invalid=!0,n.addressesScope.shippingAddressForm.Zip.$error.pattern=!0),n.addressesScope.SafeApply())});n.addressesScope.HideShippingAddress=function(){$("#EditAddressModal").trigger("close");n.addressesScope.shippingAddress=angular.copy(n.addressesScope.originalShippingAddress);n.addressesScope.ShowValidation=!1;n.addressesScope.RequiredInvalidBilling=!1;n.addressesScope.RequiredInvalidShipping=!1;n.addressesScope.shippingAddressForm.Zip.$invalid=!1;n.addressesScope.shippingAddressForm.Zip.$error.pattern=!1;n.addressesScope.IsBillingUsaAddress()&&(n.addressesScope.billingAddressForm.Zip.$invalid=!1,n.addressesScope.billingAddressForm.Zip.$error.pattern=!1);n.addressesScope.ShowZipValidation=!1;n.addressesScope.SafeApply()};n.addressesScope.GoToMyAccountHome=function(){location.href=n.addressesScope.Url.Action("Index","MyAccount")};n.addressesScope.requiredField=AVON.messages.validate_field_required;n.addressesScope.invalidEmailFormat=AVON.messages.validate_email_invalid;n.addressesScope.emailNotMatch=AVON.messages.validate_email_match;n.addressesScope.passwordInvalidFormat=AVON.messages.validate_password_invalid_format;n.addressesScope.passwordNotMatch=AVON.messages.validate_password_match;n.addressesScope.invalidNumber=AVON.messages.validate_invalid_number;n.addressesScope.invalidPhonenumber=AVON.messages.validate_invalid_phonenumber;n.addressesScope.$on("paymentController.RefreshWithPayPalAddress",function(t,i){i&&i.length==2&&(n.addressesScope.billingAddress=i[0],n.addressesScope.shippingAddress=i[1],n.addressesScope.originalBillingAddress=angular.copy(n.addressesScope.billingAddress),n.addressesScope.originalShippingAddress=angular.copy(n.addressesScope.shippingAddress),n.addressesScope.SafeApply())});n.addressesScope.$on("CustomerService.UpdateAddress",function(t,i){var u,r;i.ErrorCode===AjaxError.ValidationErrors?(n.addressesScope.RegistrationFullPageForm&&h(function(){n.addressesScope.ShowLoading(AVON.messages.spinner_registering)},250).then(function(){n.addressesScope.RedirectToUrl(n.addressesScope.Url.Action("BillingandShipping","Checkout"))}),n.addressesScope.ProcessAjaxValidationErrors(i),n.addressesScope.ShowValidation=!0,u=[],$.each(i.ValidationErrors,function(t,i){i.FieldName.indexOf("billingAddress")>-1&&(n.addressesScope.RequiredInvalidBilling=!0);i.FieldName.indexOf("shippingAddress")>-1&&(n.addressesScope.RequiredInvalidShipping=!0);i.FieldName.indexOf("PostalCode")>-1&&(n.addressesScope.billingAddressForm.billingAddress_PostalCode.$error.server=!1,n.addressesScope.billingAddressForm.billingAddress_PostalCode.$error.validatePostalCode=!0)}),n.addressesScope.IsBillingUsaAddress()&&n.addressesScope.billingAddressForm.Zip.$invalid==!1&&(n.addressesScope.ShowZipErrorMessage=!0)):n.addressesScope.RegistrationFullPageForm||window.location.href.indexOf("billingandshipping")>0?(n.addressesScope.QueryString().guest||n.addressesScope.IsRegisteredGuestShopper||(r={Type:TrackingEventType.CartNewCustAcct,Data:{customerId:AvonModule.AvonScope.Session.Customer.CustomerId}},f.TrackEventItem(r)),h(function(){n.addressesScope.ShowLoading(AVON.messages.spinner_registering)},250).then(function(){n.addressesScope.RedirectToUrl(n.addressesScope.Url.Action("Index","Checkout"))})):($(".IneligibleAutoReplenishment").trigger("close"),$("#EditAddressModal").trigger("close"),l()||(n.addressesScope.UpdateAvonAccountShipping=!1),n.addressesScope.UpdateAvonAccountBilling=!1,n.addressesScope.OrderInfoSaveBilling&&(n.addressesScope.UpdateAvonAccountBilling=n.addressesScope.OrderInfoSaveBilling),n.addressesScope.OrderInfoSaveShipping&&(n.addressesScope.UpdateAvonAccountShipping=n.addressesScope.OrderInfoSaveShipping),n.addressesScope.ShippingSameAsBillingPaymentForm=!1,n.addressesScope.ShowValidation=!1,n.addressesScope.RequiredInvalidBilling=!1,n.addressesScope.RequiredInvalidShipping=!1,n.addressesScope.originalBillingAddress=angular.copy(n.addressesScope.billingAddress),n.addressesScope.originalShippingAddress=angular.copy(n.addressesScope.shippingAddress),n.addressesScope.SafeApply())});$(document).ready(function(){$(".ErrorSummaryContainer").off("click","#DisplayLoginModal");$(".ErrorSummaryContainer").on("click","#DisplayLoginModal",function(t){t.preventDefault();n.addressesScope.ShowLoading(AVON.messages.spinner_loading);var i=n.addressesScope.HomePageUrl+"signin?email="+n.addressesScope.shippingAddress.Email;n.addressesScope.RedirectToUrl(i)});$(".ErrorSummaryContainer").off("click","#DisplayForgotPassword");$(".ErrorSummaryContainer").on("click","#DisplayForgotPassword",function(t){t.preventDefault();n.addressesScope.ShowLoading(AVON.messages.spinner_loading);n.addressesScope.RedirectToUrl(n.addressesScope.Url.Action("forgotpassword","login")+"?email="+n.addressesScope.shippingAddress.Email)});document.addEventListener("visibilitychange",function(){$(".InputContainer.inlineWaterMark.applyInlineWaterMark")&&$(window).scrollTop($(window).scrollTop()+1)})})}return __extends(i,t),i.$inject=["$scope","$rootScope","customerService","trackingService","bagService","registrationService","$compile","$timeout","autoReplenishService"],i}(BaseAngularController);n.AddressesCtrl=t}(AddressModule||(AddressModule={}));app.controller("AddressesController",AddressModule.AddressesCtrl),function(n){var t=function(t){function i(r,u,f,e,o){var s,h,c;t.call(this,r);n.paymentScope=r;n.paymentScope.PageFirstLoad=!0;n.paymentScope.ShippingOptionsHash="";n.paymentScope.ShowAmex=$("#AMEXInclude").val().toUpperCase()=="TRUE";n.paymentScope.paymentViewModel=AVON.paymentViewModel;n.paymentScope.paymentViewModel.CouponError&&(n.paymentScope.errorSummaryHeader=n.paymentScope.paymentViewModel.CouponError);n.paymentScope.IsContactable=AVON.paymentViewModel.CustomerIsContactable;n.paymentScope.creditCardModel={Type:null,Id:"00000000-0000-0000-0000-000000000000",ExpiryMonth:"",ExpiryYear:"",Name:null,CardNumber:null,CvvNumber:null,LastFourDigits:null,IsExpired:null,Cvv2:null,Cvv3:null,Cvv4:null,Address:null,SaveCreditCard:!1,SaveCreditCardAutoReplenishment:!1,IsDefault:!1};n.paymentScope.storedCreditCardModel={Type:null,CvvNumber:null,Cvv2:null,Cvv3:null,Cvv4:null,Id:"00000000-0000-0000-0000-000000000000",Address:null};n.paymentScope.paymentService=u;n.paymentScope.creditCardTypes=this.getCreditCardTypes(n.paymentScope.ShowAmex);n.paymentScope.expiryMonths=this.getExpiryMonths();n.paymentScope.expiryYears=this.getExpiryYears();n.paymentScope.AllowAllPaymentOptionsForPayPalCustomer=!1;n.paymentScope.IsCreditCardAboutToExpire=!1;n.paymentScope.ShowRestrictedStateInline=!1;n.paymentScope.recalculateLoopCount=0;n.paymentScope.RestrictedZipCodes=AVON.RestrictedZips;n.paymentScope.CartContainsAutoRepItem=function(){var t,i;for(t in n.paymentScope.Session.Cart.Campaigns)for(i in n.paymentScope.Session.Cart.Campaigns[t].Items)if(n.paymentScope.Session.Cart.Campaigns[t].Items[i].AutoReplenishmentPrice>0&&n.paymentScope.Session.Cart.Campaigns[t].Items[i].AutoReplenishmentFrequency>0)return!0;return!1};n.paymentScope.SessionService.WhenReady().then(function(){n.paymentScope.HasAutoReplenishmentItemInBag=n.paymentScope.CartContainsAutoRepItem();n.paymentScope.paymentViewModel.IsPayPalCustomerLoggedIn&&n.paymentScope.HasAutoReplenishmentItemInBag&&(n.paymentScope.paymentViewModel.IsPayPalAvailable=!1);u.GetEstimatedTax(n.paymentScope.Session.Cart.EstimatedTaxZipCode,!0)});n.paymentScope.idleSeconds=0;n.paymentScope.totalSeconds=0;n.paymentScope.paymentViewModel.IsPrivatePolicyAccepted=!1;n.paymentScope.IsAutoReplenishmentAccepted=!1;n.paymentScope.HazmatItems=[];n.paymentScope.Preferences={ByAddress:!1,ByEmail:!1,ByPhone:!1,IsContactable:!1,Source:EmailSubscriptionSource.None};n.paymentScope.EditAddressHideCancelButton=!1;n.paymentScope.ShippingRestrictionsDealtWith=!1;n.paymentScope.SetToStandardDeliveryIfAvailable=!1;n.paymentScope.CouponCodeSetOnCheckout=!1;n.paymentScope.RemoveCoupon=function(){$("#ShippingRestrictionsModal").trigger("close");n.paymentScope.CouponCodeSetOnCheckout=!1;CouponModule.couponScope.RemoveCoupon(!0)};f.TrackEventItem({Type:TrackingEventType.CartCheckout2});n.paymentScope.CheckoutGiftMessageModel={IsSet:!1,From:"",To:"",Message:""};n.paymentScope.SessionService.WhenReady().then(function(){n.paymentScope.Session.Cart.GiftMessage&&n.paymentScope.Session.Cart.GiftMessage.To.length>0&&(n.paymentScope.Session.Cart.GiftMessage.IsSet=!0,n.paymentScope.CheckoutGiftMessageModel=n.paymentScope.Session.Cart.GiftMessage,$("#WishlistMessage").hide(),$("#GiftMessageContainer").show());n.paymentScope.CheckoutGiftMessageModelTemp={IsSet:n.paymentScope.CheckoutGiftMessageModel.IsSet,From:n.paymentScope.CheckoutGiftMessageModel.From,To:n.paymentScope.CheckoutGiftMessageModel.To,Message:n.paymentScope.CheckoutGiftMessageModel.Message}});$(".StepProgressBar .step1").addClass("completedStep");$(".StepProgressBar .step2").addClass("activeStep");n.paymentScope.ValidateRestrictedDeliveryState=function(){AddressModule.addressesScope.ValidateRestrictedDeliveryState(!1)};n.paymentScope.$on("MyAccountService.ShowRestrictedStateInline",function(t,i){n.paymentScope.ShowRestrictedStateInline=i;n.paymentScope.SafeApply()});n.paymentScope.creditCardDisplay=CreditCardDisplayMode.Standard;n.paymentScope.populateForChosenCreditCard=function(t){n.paymentScope.AppendPlaceholderToCreditCardNumber(t);n.paymentScope.creditCardModel={Type:t.Type,Id:t.Id,ExpiryMonth:t.ExpiryMonth,ExpiryYear:t.ExpiryYear,Name:t.Name,CardNumber:t.CardNumber,CvvNumber:"CVV",LastFourDigits:t.LastFourDigits,IsExpired:t.IsExpired,IsDefault:t.IsDefault,SaveCreditCardAutoReplenishment:!1,Cvv2:0,Cvv3:0,Cvv4:0,Address:null,SaveCreditCard:!1}};n.paymentScope.hasStoredCreditCards=n.paymentScope.paymentViewModel.CreditCards.length>0;n.paymentScope.hasStoredCreditCards&&(n.paymentScope.storedCreditCardModel.Id=n.paymentScope.paymentViewModel.CreditCards[0].Id,n.paymentScope.storedCreditCardModel.Type=n.paymentScope.paymentViewModel.CreditCards[0].Type,n.paymentScope.creditCardModel.Type=n.paymentScope.paymentViewModel.CreditCards[0].Type,n.paymentScope.paymentViewModel.CreditCards[0].IsExpired?(n.paymentScope.populateForChosenCreditCard(n.paymentScope.paymentViewModel.CreditCards[0]),n.paymentScope.creditCardDisplay=CreditCardDisplayMode.StoredCreditCardEdit):n.paymentScope.creditCardDisplay=CreditCardDisplayMode.StoredCreditCardSelection);app.GetQuerystringParameterByName=function(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+n+"=([^&#]*)"),t=i.exec(location.search);return t==null?"":decodeURIComponent(t[1].replace(/\+/g," "))};n.paymentScope.EditShippingAddress=function(){n.paymentScope.EditingBillingAddress=!1;n.paymentScope.EditingShippingAddress=!0;$("#EditAddressModal").trigger("modal",{UrlToLoad:"",AllowExit:!1,KeepLoaded:!0,Model:null})};n.paymentScope.EditBillingAddress=function(){n.paymentScope.EditingBillingAddress=!0;n.paymentScope.EditingShippingAddress=!1;$("#EditAddressModal").trigger("modal",{UrlToLoad:"",AllowExit:!1,KeepLoaded:!0,Model:null})};n.paymentScope.$on("PaymentController.CloseEditAddress",function(){n.paymentScope.EditingBillingAddress=!1;n.paymentScope.EditingShippingAddress=!1;n.paymentScope.ScrollToTop();n.paymentScope.recalculateLoopCount=0;$('[id*="Modal"]').trigger("close")});n.paymentScope.$on("PaymentService.GetEstimatedTaxSuccess",function(t,i){if(i.ErrorCode===AjaxError.None){var u=i.Data;u.IsValid&&(r.Session.Cart.EstimatedTaxZipCode=u.ZipCode,n.paymentScope.EstimatedTax=u.TaxEstimate)}});n.paymentScope.$on("PaymentController.EditShippingAddress",function(){n.paymentScope.EditShippingAddress()});n.paymentScope.GetShippingOptionRadioButtonAnalyticsAttribute=function(n){var t;switch(n.ShippingOptionCode){case ShippingOptionCode.shipping_method_1:t="chckt-chckt2-ship-stndrd-rdbtn";break;case ShippingOptionCode.shipping_method_2:t="chckt-chckt2-ship-expdtd-rdbtn";break;case ShippingOptionCode.shipping_method_3:t="chckt-chckt2-ship-ovrnght-rdbtn";break;case ShippingOptionCode.rep_delivery:t="chckt-chckt2-ship-repdlvr-rdbtn";break;default:t=""}return t};n.paymentScope.SetupShippingOptions=function(t){n.paymentScope.ShippingOptions=[];n.paymentScope.Session.Customer.CustomerType!=CustomerType.RegisteredCustomerAsGuest&&n.paymentScope.ShippingOptions.push({Cost:0,Description:"Personal Delivery",ShippingOptionCode:ShippingOptionCode.rep_delivery,ShippingOptionId:0});n.paymentScope.ShippingOptions=_.union(t,n.paymentScope.ShippingOptions)};n.paymentScope.SetupShippingOptions(AVON.ShippingOptions);n.paymentScope.GetBrowserSingularities=function(){if(navigator.appVersion.indexOf("compatible;")>-1&&navigator.appVersion.indexOf("AOL")>-1)return"AOL"};s=function(n,t){n&&(n.ShowValidation=t)};h=function(n){return n?n.ShowValidation:!1};n.paymentScope.submitOrder=function(){if(n.paymentScope.ShowValidation=!1,s(n.paymentWithCreditCardScope,!1),s(n.paymentWithStoredCreditCardScope,!1),s(n.paymentRepDeliveryOrPaypalScope,!1),n.paymentScope.isCreditCardEditMode()){n.paymentScope.LivePersonErrorTracking();return}if(!n.paymentScope.isLoading){if(n.paymentScope.paymentViewModel.IsGuestShopper&&n.paymentScope.paymentViewModel.IsPrivatePolicyAccepted!==!0&&(n.paymentScope.showAcceptedPrivacyPolicyError=!0,n.paymentWithCreditCardScope.ShowValidation=!0),n.paymentScope.IsAutoReplenishmentAccepted=n.paymentScope.HasAutoReplenishmentItemInBag&&angular.element("[id=AutoReplenishmentAgreement]:checked").length>0,n.paymentScope.HasAutoReplenishmentItemInBag&&!n.paymentScope.IsAutoReplenishmentAccepted&&(n.paymentScope.showAcceptedAutoReplenishmentError=!0,n.paymentScope.showAcceptedAutoReplenishmentErrorMessage=!0,n.paymentScope.ShowValidation=!0),n.paymentScope.isCreditCardSelectionMode()?(n.paymentScope.storedCreditCardModel.Cvv3=n.paymentScope.totalSeconds,n.paymentWithStoredCreditCardScope.PaymentWithStoredCreditCardForm.$invalid&&(n.paymentWithStoredCreditCardScope.ShowValidation=!0)):n.paymentScope.IsRepDelivery()||n.paymentScope.IsPaymentTypePayPal()?n.paymentRepDeliveryOrPaypalScope.PaymentRepDeliveryOrPaypalForm.$invalid&&(n.paymentRepDeliveryOrPaypalScope.ShowValidation=!0):(n.paymentScope.creditCardModel.Cvv3=n.paymentScope.totalSeconds,n.paymentWithCreditCardScope.PaymentWithCreditCardForm.$invalid&&(n.paymentWithCreditCardScope.ShowValidation=!0)),n.paymentScope.ShowValidation||h(n.paymentWithCreditCardScope)||h(n.paymentWithStoredCreditCardScope)||h(n.paymentRepDeliveryOrPaypalScope)){(n.paymentWithCreditCardScope.ShowValidation||n.paymentWithStoredCreditCardScope.ShowValidation&&n.paymentScope.showAcceptedAutoReplenishmentError)&&(n.paymentScope.showAcceptedAutoReplenishmentErrorMessage=!1);n.paymentScope.LivePersonErrorTracking();return}var t=n.paymentScope.GetBrowserSingularities();n.paymentScope.isCreditCardSelectionMode()?(n.paymentScope.storedCreditCardModel.Cvv3=n.paymentScope.totalSeconds,n.paymentWithStoredCreditCardScope.PaymentWithStoredCreditCardForm.$valid&&(n.paymentScope.ShowLoading(AVON.messages.spinner_processing),u.submitOrderWithStoredCreditCard(n.paymentScope.storedCreditCardModel,$('form[name="PaymentWithStoredCreditCardForm"]'),t))):n.paymentScope.IsRepDelivery()||n.paymentScope.IsPaymentTypePayPal()?n.paymentRepDeliveryOrPaypalScope.PaymentRepDeliveryOrPaypalForm.$valid&&(n.paymentScope.ShowLoading(AVON.messages.spinner_processing),n.paymentScope.IsRepDelivery()?u.submitOrderRepDelivery($('form[name="PaymentRepDeliveryOrPaypalForm"]'),t):n.paymentScope.paymentViewModel.IsPayPalCustomerLoggedIn?u.submitPayPalOrder($('form[name="PaymentRepDeliveryOrPaypalForm"]'),t):location.href="paypal/initialize?submitOrder=true"):(n.paymentScope.creditCardModel.Cvv3=n.paymentScope.totalSeconds,n.paymentWithCreditCardScope.PaymentWithCreditCardForm.$valid&&(n.paymentScope.ShowLoading(AVON.messages.spinner_processing),u.submitOrderWithCreditCard(n.paymentScope.creditCardModel,n.paymentScope.paymentViewModel.InGuestShopperMode,$('form[name="PaymentWithCreditCardForm"]'),t)))}};n.paymentScope.getSelectedShippingOption=function(){return n.paymentScope.invalidShippingWithPOBox(n.paymentScope.SelectedShippingOption)?ShippingOptionCode.notyetspecified:n.paymentScope.SelectedShippingOption};n.paymentScope.isLimitedShipping=function(){return n.paymentScope.preCheckoutChecksResult.HasPoBox||n.paymentScope.preCheckoutChecksResult.ShippingAddressOnMilitaryBase||n.paymentScope.preCheckoutChecksResult.ShippingAddressInHawaiiAlaska};c=function(n){return n===ShippingOptionCode.shipping_method_2||n===ShippingOptionCode.shipping_method_3};n.paymentScope.invalidShippingWithPOBox=function(t){return c(t)&&n.paymentScope.isLimitedShipping()};n.paymentScope.$on("PaymentService.SubmitOrderResponse",function(t,i){var u,r,f;if(n.paymentScope.ShowValidation=!1,n.paymentScope.errorSummaryHeader="",s(n.paymentWithCreditCardScope,!1),s(n.paymentWithStoredCreditCardScope,!1),s(n.paymentRepDeliveryOrPaypalScope,!1),n.paymentScope.SessionService.WhenReady().then(function(){n.paymentScope.paymentViewModel.IsPayPalCustomerLoggedIn=n.paymentScope.Session.PayPal.IsAuthenticated}),i.ErrorCode!=AjaxError.None)if(n.paymentScope.LivePersonErrorTracking(),i.ValidationErrors&&i.ValidationErrors.length>0&&i.ValidationErrors[0].FieldName==="CouponAlreadyUsed"&&(n.paymentScope.errorSummaryHeader=i.ValidationErrors[0].Problem,n.paymentScope.$broadcast("PaymentController.SubmitOrderResponse.CouponError")),i.ErrorCode===AjaxError.ValidationErrors){if(n.paymentScope.isCreditCardSelectionMode())n.paymentWithStoredCreditCardScope.ShowValidation=!0,n.paymentWithStoredCreditCardScope.ProcessAjaxValidationErrors(i);else if(n.paymentScope.IsRepDelivery()||n.paymentScope.IsPaymentTypePayPal())n.paymentRepDeliveryOrPaypalScope.ShowValidation=!0,n.paymentRepDeliveryOrPaypalScope.ProcessAjaxValidationErrors(i);else if(n.paymentWithCreditCardScope.ShowValidation=!0,n.paymentWithCreditCardScope.ProcessAjaxValidationErrors(i),u=$("#CreditCardSummary"),u.length>0)for(r=0,f=n.paymentWithCreditCardScope.ServerErrors.length;r<f;r++)n.paymentWithCreditCardScope.ServerErrors[r].FieldName==="Summary"&&(u[0].innerHTML=n.paymentWithCreditCardScope.ServerErrors[r].Problem,n.paymentWithCreditCardScope.ServerErrors[r].Problem="",_.delay(function(){var n=$(".ValidationErrorExternal:Visible").first();n.length&&n.scrollintoview({duration:400,direction:"both",complete:null,offsetY:-130})},50))}else n.paymentScope.ShowValidation=!0,n.paymentScope.ProcessAjaxValidationErrors(i)});n.paymentScope.saveCreditCardDetails=function(){if(!n.paymentScope.isLoading)if(n.paymentScope.ShowValidation=!1,n.paymentWithCreditCardScope.ShowValidation=!1,n.paymentWithStoredCreditCardScope.ShowValidation=!1,n.paymentRepDeliveryOrPaypalScope.ShowValidation=!1,n.paymentWithCreditCardScope.PaymentWithCreditCardForm.$valid){var t=n.paymentScope.IsCreditCardNumberPlaceholderOnly(n.paymentScope.creditCardModel);t&&(n.paymentScope.creditCardModel.CardNumber="");n.paymentScope.creditCardModel.CvvNumber=n.paymentScope.creditCardModel.Type==CreditCardType.Amex?"0000":"000";n.paymentScope.creditCardModel.Id=n.paymentScope.storedCreditCardModel.Id;n.paymentScope.storedCreditCardModel.Type=n.paymentScope.creditCardModel.Type;n.paymentScope.ShowLoading(AVON.messages.spinner_processing);n.paymentScope.paymentService.saveCreditCardDetails(n.paymentScope.creditCardModel,$('form[name="PaymentWithCreditCardForm"]'));n.paymentScope.creditCardModel.CardNumber==""&&n.paymentScope.AppendPlaceholderToCreditCardNumber(n.paymentScope.creditCardModel)}else n.paymentScope.LivePersonErrorTracking(),n.paymentWithCreditCardScope.ShowValidation=!0};n.paymentScope.ShowAllPaymentOptions=function(){return n.paymentScope.paymentViewModel.IsPayPalAvailable===!1?!1:n.paymentScope.paymentViewModel.IsPayPalCustomerLoggedIn===!1?!0:n.paymentScope.AllowAllPaymentOptionsForPayPalCustomer?!0:n.paymentScope.paymentViewModel.IsPayPalCustomerLoggedIn&&n.paymentScope.HasAutoReplenishmentItemInBag?!0:!1};n.paymentScope.DisplayAllPaymentOptionsForPayPalCustomer=function(){n.paymentScope.AllowAllPaymentOptionsForPayPalCustomer=!0;n.paymentScope.paymentViewModel.PaymentModel.PaymentType=PaymentType.CreditCard};n.paymentScope.ShowHazmatOverlay=function(n){var t=$(angular.element(n.currentTarget)[0]);t.siblings("div").addClass("active")};n.paymentScope.HideHazmatOverlay=function(n){var t=$(angular.element(n.currentTarget)[0]);t.children("div").removeClass("active")};n.paymentScope.$watch("paymentViewModel.PaymentModel.PaymentType",function(){n.paymentScope.IsPaymentTypePayPal()&&n.paymentScope.AllowAllPaymentOptionsForPayPalCustomer&&(n.paymentScope.AllowAllPaymentOptionsForPayPalCustomer=!1,n.paymentScope.ShowLoading(AVON.messages.spinner_loading),o.RefreshAddressFromPayPal())});n.paymentScope.$on("CustomerService.RefreshPayPalAddress",function(t,i){n.paymentScope.SessionService.WhenReady().then(function(){n.paymentScope.$broadcast("paymentController.RefreshWithPayPalAddress",[i.Data.BillingAddressModal,i.Data.ShippingAddressModal]);e.RunPreCheckoutTests()})});n.paymentScope.$on("PaymentService.SaveCreditCardResponse",function(t,i){n.paymentScope.ShowValidation=!1;n.paymentWithCreditCardScope.ShowValidation=!1;n.paymentWithStoredCreditCardScope.ShowValidation=!1;n.paymentRepDeliveryOrPaypalScope.ShowValidation=!1;i.ErrorCode!=AjaxError.None?(n.paymentScope.LivePersonErrorTracking(),i.ErrorCode===AjaxError.ValidationErrors?(n.paymentScope.creditCardModel.CardNumber==""&&n.paymentScope.AppendPlaceholderToCreditCardNumber(n.paymentScope.creditCardModel),n.paymentScope.creditCardModel.CvvNumber="CVV",n.paymentWithCreditCardScope.ShowValidation=!0,n.paymentWithCreditCardScope.ProcessAjaxValidationErrors(i)):(n.paymentScope.ShowValidation=!0,n.paymentScope.ProcessAjaxValidationErrors(i))):(n.paymentScope.paymentViewModel.CreditCards=i.Data.CreditCards,n.paymentScope.changeCreditCardDisplayMode(CreditCardDisplayMode.StoredCreditCardSelection))});n.paymentScope.secondTimer=setInterval(function(){n.paymentScope.idleSeconds+=i.timerIntervalSeconds;n.paymentScope.totalSeconds+=i.timerIntervalSeconds;n.paymentScope.SafeApply()},i.timerIntervalSeconds*1e3);n.paymentScope.isPaymentTypeCreditCard=function(){return n.paymentScope.IsRepDelivery()?!1:n.paymentScope.paymentViewModel.IsPayPalCustomerLoggedIn&&n.paymentScope.HasAutoReplenishmentItemInBag?!0:n.paymentScope.paymentViewModel.IsPayPalCustomerLoggedIn&&n.paymentScope.AllowAllPaymentOptionsForPayPalCustomer===!1?!1:n.paymentScope.paymentViewModel.PaymentModel.PaymentType!=PaymentType.CreditCard?!1:!0};n.paymentScope.showPayPalSubmitButton=function(){return n.paymentScope.IsPaymentTypePayPal()&&!n.paymentScope.paymentViewModel.IsPayPalCustomerLoggedIn};n.paymentScope.isRepDeliveryDisabled=function(){return n.paymentScope.paymentViewModel.IsPayPalCustomerLoggedIn||n.paymentScope.IsPaymentTypePayPal()||n.paymentScope.Session.Rep&&n.paymentScope.isCustomerAttachedToRemovedRep()||n.paymentScope.preCheckoutChecksResult.IsShoppingFundraiser};n.paymentScope.isCreditCardEditMode=function(){return n.paymentScope.isPaymentTypeCreditCard()&&n.paymentScope.creditCardDisplay==CreditCardDisplayMode.StoredCreditCardEdit};n.paymentScope.isCreditCardSelectionMode=function(){return n.paymentScope.isPaymentTypeCreditCard()&&n.paymentScope.creditCardDisplay==CreditCardDisplayMode.StoredCreditCardSelection};n.paymentScope.isCreditCardStandardMode=function(){return n.paymentScope.isPaymentTypeCreditCard()&&n.paymentScope.creditCardDisplay==CreditCardDisplayMode.Standard};n.paymentScope.isCreditCardAddMode=function(){return n.paymentScope.isPaymentTypeCreditCard()&&n.paymentScope.creditCardDisplay==CreditCardDisplayMode.StoredCreditCardAdd};n.paymentScope.displayCreditCardSection=function(){return AVON.creditCardPaymentEnabled&&n.paymentScope.isPaymentTypeCreditCard()};n.paymentScope.displayStoredCreditCards=function(){return n.paymentScope.hasStoredCreditCards};n.paymentScope.displayCreditCardPaymentOption=function(){return AVON.creditCardPaymentEnabled===!1?!1:n.paymentScope.ShowAllPaymentOptions()};n.paymentScope.isSubmitButtonDisabled=function(){return AVON.creditCardPaymentEnabled===!1&&n.paymentScope.HasAutoReplenishmentItemInBag?!0:n.paymentScope.isCreditCardEditMode()?!0:!1};n.paymentScope.displayPayPalPaymentOption=function(){return n.paymentScope.Session.Customer.IsPayPalCustomerLoggedIn===!1&&n.paymentScope.ShowAllPaymentOptions()?!0:n.paymentScope.paymentViewModel.IsPayPalCustomerLoggedIn&&n.paymentScope.HasAutoReplenishmentItemInBag?!0:!1};n.paymentScope.isCreditCardPaymentDisabled=function(){return AVON.creditCardPaymentEnabled===!1};n.paymentScope.isCreditCardPaymentEnabled=function(){return AVON.creditCardPaymentEnabled};n.paymentScope.changeCreditCardDisplayMode=function(t){n.paymentScope.ShowValidation=!1;n.paymentWithCreditCardScope.ShowValidation=!1;n.paymentWithStoredCreditCardScope.ShowValidation=!1;n.paymentRepDeliveryOrPaypalScope.ShowValidation=!1;n.paymentScope.showAcceptedAutoReplenishmentError=!1;n.paymentScope.showAcceptedAutoReplenishmentErrorMessage=!1;n.paymentScope.showAcceptedPrivacyPolicyError=!1;n.paymentScope.IsCreditCardAboutToExpire=!1;n.paymentScope.creditCardDisplay=t;n.paymentScope.isCreditCardEditMode()&&(n.paymentScope.setChosenCreditCard(),_.defer(function(){return n.paymentScope.UpdateInlineWaterMark()}));(n.paymentScope.isCreditCardStandardMode()||n.paymentScope.isCreditCardAddMode())&&(n.paymentScope.creditCardModel={Type:null,Id:"00000000-0000-0000-0000-000000000000",ExpiryMonth:"",ExpiryYear:"",Name:null,CardNumber:null,CvvNumber:null,LastFourDigits:null,IsExpired:null,Cvv2:null,Cvv3:null,Cvv4:null,Address:null,SaveCreditCard:!1,SaveCreditCardAutoReplenishment:!1,IsDefault:!1},n.paymentScope.storedCreditCardModel.Id="0",_.defer(function(){return n.paymentScope.UpdateInlineWaterMark()}));n.paymentScope.isCreditCardEditMode()||n.paymentScope.CheckCardAboutToExpire();n.paymentScope.creditCardDisplay===1&&(n.paymentScope.storedCreditCardModel.Id=n.paymentScope.paymentViewModel.CreditCards[0].Id,n.paymentScope.storedCreditCardModel.Type=n.paymentScope.paymentViewModel.CreditCards[0].Type)};n.paymentScope.setChosenCreditCard=function(){var i,t;n.paymentScope.storedCreditCardModel.Id!=="0"&&(i=$.grep(n.paymentScope.paymentViewModel.CreditCards,function(t){return t.Id===n.paymentScope.storedCreditCardModel.Id}),i.length===0,t=i[0],t.IsExpired&&(n.paymentScope.creditCardDisplay=CreditCardDisplayMode.StoredCreditCardEdit),n.paymentScope.creditCardModel.Type=t.Type,n.paymentScope.storedCreditCardModel.Type=t.Type,n.paymentScope.isCreditCardEditMode()&&n.paymentScope.populateForChosenCreditCard(t))};n.paymentScope.creditCardSelectionDropDownChange=function(){if(n.paymentScope.storedCreditCardModel.CvvNumber="",n.paymentScope.ShowValidation=!1,n.paymentWithStoredCreditCardScope.ShowValidation=!1,n.paymentRepDeliveryOrPaypalScope.ShowValidation=!1,n.paymentScope.ClearServerErrorsForForm(n.paymentWithCreditCardScope.PaymentWithCreditCardForm),n.paymentWithCreditCardScope.ShowValidation=!1,n.paymentWithCreditCardScope.ServerInvalid=!1,n.paymentWithCreditCardScope.ServerErrors&&(n.paymentWithCreditCardScope.ServerErrors=[]),n.paymentWithCreditCardScope.PaymentWithCreditCardForm!=null&&(n.paymentWithCreditCardScope.PaymentWithCreditCardForm.ServerErrors=[]),n.paymentScope.storedCreditCardModel.Id==="0"){_.defer(function(){n.paymentScope.changeCreditCardDisplayMode(CreditCardDisplayMode.StoredCreditCardAdd)});return}n.paymentScope.HasAutoReplenishmentItemInBag&&n.paymentScope.CheckCardAboutToExpire();n.paymentScope.creditCardDisplay=CreditCardDisplayMode.StoredCreditCardSelection;n.paymentScope.setChosenCreditCard();_.defer(function(){return n.paymentScope.UpdateInlineWaterMark()})};n.paymentScope.PrivacyCheckBoxClick=function(){n.paymentScope.showAcceptedPrivacyPolicyError=!1};n.paymentScope.AutoReplenishmentCheckBoxClick=function(){n.paymentScope.showAcceptedAutoReplenishmentError=!1;n.paymentScope.showAcceptedAutoReplenishmentErrorMessage=!1};n.paymentScope.GiftMessageSubmit=function(){$("#CheckoutGiftMessageModel_MessageInput").val()===""&&(n.paymentScope.GiftMessageForm.$valid=!1,n.paymentScope.GiftMessageForm.CheckoutGiftMessageModel_Message.$invalid=!0);n.paymentScope.GiftMessageForm.$valid?($("#WishlistMessage").hide(),$("#GiftMessageContainer").show(),u.updateGiftMessage(n.paymentScope.CheckoutGiftMessageModel),n.paymentScope.SafeApply()):(n.paymentScope.ShowValidation=!0,n.paymentScope.TrackUserValidationErrors(n.paymentScope.GiftMessageForm.$error),n.paymentScope.SafeApply())};n.paymentScope.TrackUserValidationErrors=function(t){if(n.paymentScope.IsMobile!==!1){var i=[];t&&$.each(t,function(n,t){t&&(i.push("err-"+n),$.each(t,function(n,t){i.push(t.$name)}))});i=null}};n.paymentScope.ShowGiftMessage=function(t){t?($("#WishlistMessage").show(),n.paymentScope.CheckoutGiftMessageModel.From?$("#GiftMessageContainer").show():$("#GiftMessageContainer").hide()):(u.clearGiftMessage(),n.paymentScope.CheckoutGiftMessageModelTemp={IsSet:!1,From:"",To:"",Message:""},n.paymentScope.HideGiftMessage())};n.paymentScope.HideGiftMessage=function(){n.paymentScope.CheckoutGiftMessageModel={IsSet:n.paymentScope.CheckoutGiftMessageModelTemp.IsSet,From:n.paymentScope.CheckoutGiftMessageModelTemp.From,To:n.paymentScope.CheckoutGiftMessageModelTemp.To,Message:n.paymentScope.CheckoutGiftMessageModelTemp.Message};$("#WishlistMessage").hide();n.paymentScope.CheckoutGiftMessageModel.From?$("#GiftMessageContainer").show():$("#GiftMessageContainer").hide();n.paymentScope.ShowValidation=!1};n.paymentScope.EditGiftMessage=function(){n.paymentScope.CheckoutGiftMessageModelTemp={IsSet:n.paymentScope.CheckoutGiftMessageModel.IsSet,From:n.paymentScope.CheckoutGiftMessageModel.From,To:n.paymentScope.CheckoutGiftMessageModel.To,Message:n.paymentScope.CheckoutGiftMessageModel.Message};n.paymentScope.ShowGiftMessage(!0);$("#GiftMessageContainer").hide()};n.paymentScope.ImposeMaxLength=function(t){n.paymentScope.CheckoutGiftMessageModel.Message&&n.paymentScope.CheckoutGiftMessageModel.Message.length>t&&(n.paymentScope.CheckoutGiftMessageModel.Message=n.paymentScope.CheckoutGiftMessageModel.Message.substring(0,t))};n.paymentScope.HazmatCheck=function(){return n.paymentScope.preCheckoutChecksResult.CartContainsHazmatItems&&(n.paymentScope.preCheckoutChecksResult.ShippingAddressInHawaiiAlaska||n.paymentScope.preCheckoutChecksResult.ShippingAddressOnMilitaryBase||n.paymentScope.preCheckoutChecksResult.HasPoBox)};n.paymentScope.ShowAutoReplenishmentAgreement=function(){return n.paymentScope.HasAutoReplenishmentItemInBag&&AVON.creditCardPaymentEnabled};n.paymentScope.ResetShippingOptions=function(){var t={UrlToLoad:"",AllowExit:!1,KeepLoaded:!0,Model:null},e=_.flatten(_(n.paymentScope.Session.Cart.Campaigns).map(function(n){return n.Items})),f,u,r,i;if(n.paymentScope.HazmatItems=_.select(e,function(n){return n.IsHazardous}),(n.paymentScope.preCheckoutChecksResult.CartContainsHazmatItems||n.paymentScope.Session.Cart.OrderDetails.IsShippingOverriddenToFree)&&$(".DirectDeliveryOption").not(".StandardDeliveryOption").hide(),n.paymentScope.preCheckoutChecksResult.CartContainsHazmatItems&&$(".HazmatExpeditedExplanation").show(),n.paymentScope.RestrictedZipCodes.indexOf(n.paymentScope.Session.Customer.ShippingAddress.Zip)>=0&&n.paymentScope.Session.Cart.OrderDetails.HasRestrictedDeliveryItems?$("#RestrictedZipModal").trigger("modal",t):!n.paymentScope.ShippingRestrictionsDealtWith&&n.paymentScope.HazmatCheck()||n.paymentScope.preCheckoutChecksResult.ShippingMethodsRestrictedToRepDeliveryOnly&&!n.paymentScope.Session.Cart.OrderDetails.RepDeliveryEnabled?($("#ShippingRestrictionsModal").trigger("modal",t),n.paymentScope.ShippingRestrictionsDealtWith=!0,n.paymentScope.recalculateLoopCount=0):n.paymentScope.preCheckoutChecksResult.IsShoppingFundraiser||!n.paymentScope.preCheckoutChecksResult.CartContainsRepDeliveryOnlyItems&&n.paymentScope.Session.Customer.DeliveryType!==DeliveryType.RepOnly||n.paymentScope.HasAutoReplenishmentItemInBag?!n.paymentScope.preCheckoutChecksResult.IsShoppingFundraiser&&(n.paymentScope.preCheckoutChecksResult.CartContainsRepDeliveryOnlyItems||n.paymentScope.Session.Customer.DeliveryType===DeliveryType.RepOnly)&&n.paymentScope.HasAutoReplenishmentItemInBag||n.paymentScope.preCheckoutChecksResult.ShippingAddressOnIsland&&n.paymentScope.HasAutoReplenishmentItemInBag&&!(n.paymentScope.preCheckoutChecksResult.IsShoppingFundraiser&&n.paymentScope.preCheckoutChecksResult.CartContainsRepDeliveryOnlyItems)?$("#AutoReplenishmentRepDeliveryModal").trigger("modal",t):n.paymentScope.SetDefaultShippingIfNeeded():$("#RepDeliveryOnlyModal").trigger("modal",t),n.paymentScope.preCheckoutChecksResult.CartContainsHazmatItems){for(u=ShippingOptionCode.shipping_method_1,r=0;r<n.paymentScope.ShippingOptions.length;r++)i=n.paymentScope.ShippingOptions[r],i.ShippingOptionCode!=ShippingOptionCode.rep_delivery&&(i.ShippingOptionCode==ShippingOptionCode.shipping_method_1||i.Cost<=f)&&(f=i.Cost,u=i.ShippingOptionCode);u!=ShippingOptionCode.shipping_method_1&&(t={UrlToLoad:"",AllowExit:!0,KeepLoaded:!0,Model:null},$("#HazmatHiddenShippingMethod").trigger("modal",t))}n.paymentScope.ShippingOptionsHash=n.paymentScope.GenerateShippingOptionsHash()};n.paymentScope.$on("MyAccountService.DiscontinueAllAutoReplenishmentProducts",function(){n.paymentScope.HasAutoReplenishmentItemInBag=!1;n.paymentScope.ShowLoading(AVON.messages.spinner_loading)});n.paymentScope.SetDefaultShippingIfNeeded=function(){var t,r,u,i;if(n.paymentScope.PageFirstLoad){for(n.paymentScope.PageFirstLoad=!1,t=$("input.shippingOption:visible").not("#rep_delivery"),t.length==0&&$("#rep_delivery").is(":visible")&&(t=$("#rep_delivery")),i=0;i<t.length;i++)i==0?(r=$(t[i]).data("shippingCost"),u=$(t[i]).data("shippingCode")):$(t[i]).data("shippingCost")<=r&&(r=$(t[i]).data("shippingCost"),u=$(t[i]).data("shippingCode"));n.paymentScope.UpdateShippingOption(u)}else $(".DeliveryOption input[value="+n.paymentScope.SelectedShippingOption+"]").is(":visible")||($(".StandardDeliveryOption").is(":visible")||n.paymentScope.SetToStandardDeliveryIfAvailable?(n.paymentScope.SetToStandardDeliveryIfAvailable=!1,n.paymentScope.SelectedShippingOption=ShippingOptionCode.shipping_method_1):n.paymentScope.SelectedShippingOption=n.paymentScope.Session.Customer.IsAttached&&!n.paymentScope.IsPaymentTypePayPal()&&n.paymentScope.Session.Cart.OrderDetails.RepDeliveryEnabled?ShippingOptionCode.rep_delivery:ShippingOptionCode.notyetspecified,n.paymentScope.StandardShippingAvailable=$(".StandardDeliveryOption").is(":visible"),n.paymentScope.UpdateShippingOption(n.paymentScope.SelectedShippingOption))};n.paymentScope.UpdateShippingOptionOnCustomerChange=function(t){t===void 0&&(t=null);n.paymentScope.recalculateLoopCount=0;n.paymentScope.UpdateShippingOption(t)};n.paymentScope.UpdateShippingOption=function(t){if(t===void 0&&(t=null),n.paymentScope.recalculateLoopCount++,n.paymentScope.recalculateLoopCount>=3)n.paymentScope.ShippingRestrictionsDealtWith=!1,n.paymentScope.ResetShippingOptions();else if(t?n.paymentScope.SelectedShippingOption=t:this.shippingOption&&(n.paymentScope.SelectedShippingOption=this.shippingOption.ShippingOptionCode),n.paymentScope.SelectedShippingOption==ShippingOptionCode.rep_delivery&&n.paymentScope.ShowGiftMessage(!1),n.paymentScope.IsOdsDown||n.paymentScope.SelectedShippingOption!=ShippingOptionCode.rep_delivery||n.paymentScope.IsContactable)n.paymentScope.ShowLoading(AVON.messages.spinner_processing),n.paymentScope.bagService.recalculateBag(n.paymentScope.SelectedShippingOption),n.paymentScope.SafeApply();else $("#ContactPrefencesIssueModal").trigger("modal",{UrlToLoad:"",AllowExit:!1,KeepLoaded:!0,Model:null})};n.paymentScope.SaveContactPrefences=function(){n.paymentScope.ShowLoading(AVON.messages.spinner_processing);u.UpdateContactPreferences(n.paymentScope.Preferences.ByEmail,n.paymentScope.Preferences.ByPhone,n.paymentScope.Preferences.ByAddress)};n.paymentScope.CancelContactPreferences=function(){n.paymentScope.Preferences={ByAddress:!1,ByEmail:!1,ByPhone:!1,IsContactable:!1,Source:EmailSubscriptionSource.None};n.paymentScope.UpdateShippingOption(ShippingOptionCode.shipping_method_1)};n.paymentScope.ShippingRestrictionEditShippingAddress=function(){$('[id*="Modal"]').trigger("close");n.paymentScope.EditAddressHideCancelButton=!0;n.paymentScope.$root.$broadcast("PaymentController.EditShippingAddress")};n.paymentScope.ShippingRestrictionRemoveItems=function(){var t=n.paymentScope.Url.Action("Index","Bag")+"?showhazmats=true";n.paymentScope.RedirectToUrl(t)};n.paymentScope.RestrictedZipEditShippingAddress=function(){$('[id*="Modal"]').trigger("close");n.paymentScope.EditAddressHideCancelButton=!0;n.paymentScope.$root.$broadcast("PaymentController.EditShippingAddress")};n.paymentScope.RestrictedZipRemoveItems=function(){var t=n.paymentScope.Url.Action("Index","Bag")+"?showrestricteditems=true";n.paymentScope.RedirectToUrl(t)};n.paymentScope.ShippingRestrictionSelectRepDelivery=function(){$('[id*="Modal"]').trigger("close");n.paymentScope.UpdateShippingOption(ShippingOptionCode.rep_delivery)};n.paymentScope.CheckoutTestAlertEditShippingAddress=function(){AddressModule.addressesScope.DisplayShippingAddress=!0;AddressModule.addressesScope.DisplayBillingAddress=!1;$("#EditAddressModal").trigger("modal",{UrlToLoad:"",AllowExit:!1,KeepLoaded:!0,Model:null})};n.paymentScope.CheckoutTestAlertEditBagContents=function(){n.paymentScope.RedirectToUrl(n.paymentScope.Url.Action("Index","Bag")+"?validate=true")};n.paymentScope.RepDeliveryOnlyEditShoppingBag=function(){n.paymentScope.RedirectToUrl(n.paymentScope.Url.Action("Index","Bag"))};n.paymentScope.RepDeliveryOnlyContinueCheckout=function(){$("#RepDeliveryOnlyModal").trigger("close");n.paymentScope.recalculateLoopCount=0;n.paymentScope.UpdateShippingOption(ShippingOptionCode.rep_delivery)};n.paymentScope.GoToBagPage=function(){n.paymentScope.Url.Action("Index","Bag")};n.paymentScope.GenerateShippingOptionsHash=function(){for(var i="",t=0;t<n.paymentScope.ShippingOptions.length;t++)n.paymentScope.ShippingOptions[t].ShippingOptionCode!=11&&(i+=n.paymentScope.ShippingOptions[t].ShippingOptionCode+"/"+n.paymentScope.ShippingOptions[t].Cost+",");return i};n.paymentScope.$on("PaymentService.CheckoutAddressesSaveDetails",function(){var i=n.paymentScope.Session.Cart.Campaigns.length>0,t;n.paymentScope.recalculateLoopCount=0;i?(n.paymentScope.EditAddressHideCancelButton=!1,n.paymentScope.ShippingRestrictionsDealtWith=!1,n.paymentScope.SetToStandardDeliveryIfAvailable=!0,n.paymentScope.SafeApply(),e.RunPreCheckoutTests()):(n.paymentScope.ShowLoading(AVON.messages.spinner_loading),t=n.paymentScope.Url.Action("Index","Bag")+"?itemsremoved=1",n.paymentScope.RedirectToUrl(t))});n.paymentScope.$on("BagService.RecalculateSuccess",function(){var t=!1;_.delay(function(){n.paymentScope.SetDefaultShippingIfNeeded()},500);n.paymentScope.SessionService.WhenReady().then(function(){AvonModule.AvonScope.Session.Cart.OutOfStockProducts.length>0?u.NoLongerAvailableProducts():$(".shippingOption:visible:checked").length>0&&(t=!0)});t&&n.paymentScope.HideLoading()});n.paymentScope.LivePersonErrorTracking=function(){_.defer(function(){window.lpTag!=undefined&&(window.lpTag.sdes=window.lpTag.sdes||[],window.lpTag.sdes.push({type:"error",error:{message:"Checkout Processing Issue",code:"AVON01"}}))})};n.paymentScope.$on("BagService.RunPreCheckoutTests",function(t,i){if(n.paymentScope.preCheckoutChecksResult=i.Data,n.paymentScope.SelectedShippingOption=n.paymentScope.getSelectedShippingOption(),n.paymentScope.preCheckoutChecksResult.ShippingAddressOnIsland&&n.paymentScope.preCheckoutChecksResult.CartContainsDirectDeliveryOnlyItems){n.paymentScope.ShowLoading(AVON.messages.spinner_processing);var r=n.paymentScope.Url.Action("Index","Bag")+"?validate=true";n.paymentScope.RedirectToUrl(r);return}n.paymentScope.ResetShippingOptions()});n.paymentScope.$on("BagService.Update",function(){n.paymentScope.HasAutoReplenishmentItemInBag=n.paymentScope.CartContainsAutoRepItem();n.paymentScope.Session.Cart.Campaigns.length==0&&(n.paymentScope.ShowLoading(AVON.messages.spinner_loading),n.paymentScope.RedirectToUrl(n.paymentScope.Url.Action("Index","Bag")))});n.paymentScope.$on("CouponScope.ApplyCouponSuccess",function(t,i){n.paymentScope.errorSummaryHeader=null;var r=i.Data;n.paymentScope.recalculateLoopCount=0;n.paymentScope.SessionService.WhenReady().then(function(){n.paymentScope.Session.Cart.Coupon.Code!=null&&(n.paymentScope.CouponCodeSetOnCheckout=!0,n.paymentScope.ShippingRestrictionsDealtWith=!1)});r.ShippingOptions&&r.ShippingOptions.length>0&&(AVON.ShippingOptions=r.ShippingOptions,n.paymentScope.SetupShippingOptions(AVON.ShippingOptions),n.paymentScope.ShippingOptionsHash!=n.paymentScope.GenerateShippingOptionsHash()&&n.paymentScope.SelectedShippingOption==ShippingOptionCode.shipping_method_1&&(n.paymentScope.PageFirstLoad=!0),e.RunPreCheckoutTests())});n.paymentScope.$on("PaymentService.IsContactable",function(t,i){var r=i.Data;n.paymentScope.IsContactable=r;n.paymentScope.ResetShippingOptions()});n.paymentScope.$on("PaymentService.ContactPreferencesUpdated",function(){n.paymentScope.IsContactable=!0;$("#ContactPrefencesIssueModal").trigger("close");n.paymentScope.UpdateShippingOption(ShippingOptionCode.rep_delivery)});n.paymentScope.$on("FindARepService.SelectRepSuccess",function(){e.RunPreCheckoutTests()});$(document).ready(function(){n.paymentScope.ResetShippingOptions();n.paymentScope.HasAutoReplenishmentItemInBag&&n.paymentScope.CheckCardAboutToExpire()});$("#PaymentWithCreditCard").on("focus","input",function(){n.paymentScope.creditCardModel.Cvv4+=1;n.paymentScope.SafeApply()});$("#PaymentWithStoredCreditCard").on("focus","input",function(){n.paymentScope.storedCreditCardModel.Cvv4+=1;n.paymentScope.SafeApply()});$("#creditCardModel_Type").on("change",function(){n.paymentScope.isCreditCardEditMode()&&(n.paymentScope.creditCardModel.CardNumber="")});$("#creditCardModel_CardNumber").focusin(function(){if(n.paymentScope.isCreditCardEditMode()){var t=n.paymentScope.IsCreditCardNumberPlaceholderOnly(n.paymentScope.creditCardModel);t&&(n.paymentScope.creditCardModel.CardNumber="")}}).focusout(function(){n.paymentScope.isCreditCardEditMode()&&n.paymentScope.creditCardModel.CardNumber===""&&n.paymentScope.AppendPlaceholderToCreditCardNumber(n.paymentScope.creditCardModel)});$("#creditCardModel_CardNumber").on("keypress","input",function(t){n.paymentScope.AddressFocus(t,this)});$("#creditCardModel_Name").on("keypress","input",function(t){n.paymentScope.AddressFocus(t,this)});$("#creditCardModel_CvvNumber").on("keypress","input",function(t){n.paymentScope.AddressFocus(t,this)});$("#creditCardModel_ExpiryMonth").on("keypress","input",function(t){n.paymentScope.AddressFocus(t,this)});$("#storedCreditCardModel_CvvNumber").on("keypress","input",function(t){n.paymentScope.StoredAddressFocus(t,this)});n.paymentScope.AddressFocus=function(n,t){var i,r;n.keyCode===9&&(i=$(":input").get($(":input").index(t)+1),n.shiftKey&&(i=$(":input").get($(":input").index(t)-1)),i&&i.id==="creditCardModel_AddressInput"&&(n.preventDefault(),r=$(":input").get($(":input").index(i)+1),n.shiftKey&&(r=$(":input").get($(":input").index(i)-1)),r&&r.focus()))};n.paymentScope.StoredAddressFocus=function(n,t){var i,r;n.keyCode===9&&(i=$(":input").get($(":input").index(t)+1),i&&i.id==="storedCreditCardModel_AddressInput"&&(n.preventDefault(),r=$(":input").get($(":input").index(i)+1),r&&r.focus()))};$(document).ready(function(){n.paymentScope.preCheckoutChecksResult.IsShoppingFundraiser&&n.paymentScope.preCheckoutChecksResult.CartContainsRepDeliveryOnlyItems&&n.paymentScope.SessionService.WhenReady().then(function(){n.paymentScope.RepDeliveryOnlyItemsForRemovalIfFundraiser=u.getRepDeliveryItemsForRemoval(n.paymentScope.Session.Cart.Campaigns);n.paymentScope.ShowFundraiserRepDeliveryModal()})})}return __extends(i,t),i.prototype.getCreditCardTypes=function(n){var t=[{value:CreditCardType.Visa,label:CreditCardType[CreditCardType.Visa]},{value:CreditCardType.MasterCard,label:CreditCardType[CreditCardType.MasterCard]},{value:CreditCardType.Discover,label:CreditCardType[CreditCardType.Discover]}];return n&&t.push({value:CreditCardType.Amex,label:"American Express"}),t},i.prototype.getExpiryMonths=function(){return[{value:Month.Jan,label:"01"},{value:Month.Feb,label:"02"},{value:Month.Mar,label:"03"},{value:Month.Apr,label:"04"},{value:Month.May,label:"05"},{value:Month.Jun,label:"06"},{value:Month.Jul,label:"07"},{value:Month.Aug,label:"08"},{value:Month.Sep,label:"09"},{value:Month.Oct,label:"10"},{value:Month.Nov,label:"11"},{value:Month.Dec,label:"12"}]},i.prototype.getExpiryYears=function(){for(var t=(new Date).getFullYear(),i=[],n=t;n<=t+10;n++)i.push({value:n,label:n.toString()});return i},i.timerIntervalSeconds=1,i.$inject=["$scope","paymentService","trackingService","bagService","customerService"],i}(n.CommonPaymentController);n.PaymentController=t}(PaymentModule||(PaymentModule={}));app.controller("PaymentController",PaymentModule.PaymentController),function(n){var t=function(t){function i(i){t.call(this,i);n.paymentRepDeliveryOrPaypalScope=i;n.paymentRepDeliveryOrPaypalScope.ShowValidation=!1;n.paymentRepDeliveryOrPaypalScope.$on("FormDirective.HidValidation",function(){n.paymentRepDeliveryOrPaypalScope.ShowValidation&&(n.paymentRepDeliveryOrPaypalScope.ShowValidation=!1)})}return __extends(i,t),i.$inject=["$scope","paymentService","trackingService"],i}(BaseAngularController);n.PaymentRepDeliveryOrPaypalController=t}(PaymentModule||(PaymentModule={}));app.controller("PaymentRepDeliveryOrPaypalController",PaymentModule.PaymentRepDeliveryOrPaypalController),function(n){var t=function(t){function i(i){t.call(this,i);n.paymentWithCreditCardScope=i;n.paymentWithCreditCardScope.ShowValidation=!1;n.paymentWithCreditCardScope.$on("FormDirective.HidValidation",function(){var t=$("#CreditCardSummary");t.length>0&&(t[0].innerHTML="");n.paymentWithCreditCardScope.PaymentWithCreditCardForm!=null&&(n.paymentWithCreditCardScope.PaymentWithCreditCardForm.ServerErrors=[]);n.paymentWithCreditCardScope.ShowValidation&&(n.paymentWithCreditCardScope.ShowValidation=!1)})}return __extends(i,t),i.$inject=["$scope","paymentService","trackingService"],i}(BaseAngularController);n.PaymentWithCreditCardController=t}(PaymentModule||(PaymentModule={}));app.controller("PaymentWithCreditCardController",PaymentModule.PaymentWithCreditCardController),function(n){var t=function(t){function i(i){t.call(this,i);n.paymentWithStoredCreditCardScope=i;n.paymentWithStoredCreditCardScope.ShowValidation=!1;n.paymentWithStoredCreditCardScope.$on("FormDirective.HidValidation",function(){n.paymentWithStoredCreditCardScope.ShowValidation&&(n.paymentWithStoredCreditCardScope.ShowValidation=!1)})}return __extends(i,t),i.$inject=["$scope","paymentService","trackingService"],i}(BaseAngularController);n.PaymentWithStoredCreditCardController=t}(PaymentModule||(PaymentModule={}));app.controller("PaymentWithStoredCreditCardController",PaymentModule.PaymentWithStoredCreditCardController),function(n){"use strict";var t=function(t){function i(i,r,u){t.call(this,i);n.samplesScope=i;n.samplesScope.displayedSamples=[];n.samplesScope.samplesLoaded;n.samplesScope.categoryId=AVON.categoryId;n.samplesScope.maximumSamplesInOrder=3;n.samplesScope.selectedSamples=[];n.samplesScope.canAddToOrderIsDisabled;n.samplesScope.addOrRemoveSample;n.samplesScope.addSamplesToBag;n.samplesScope.toolTipReference="i.InfoButton";n.samplesScope.modalReference="#SamplesModal";r.getSamplesByCategoryId(n.samplesScope.categoryId);n.samplesScope.$on("SampleService.SamplesLoaded",function(t,i){if(i.Data){var r=i.Data;n.samplesScope.displayedSamples=r;n.samplesScope.displayedSamples.length>0&&(n.samplesScope.samplesLoaded=!0);n.samplesScope.SafeApply();$(".ProductListContainer").mCustomScrollbar()}});n.samplesScope.canAddToOrderIsDisabled=function(){return n.samplesScope.selectedSamples.length<=0};n.samplesScope.addOrRemoveSample=function(t){var i=n.samplesScope.selectedSamples.indexOf(t);i===-1?n.samplesScope.selectedSamples.length<n.samplesScope.maximumSamplesInOrder&&(n.samplesScope.selectedSamples.push(t),t.IsSelected=!0):(n.samplesScope.selectedSamples.splice(i,1),t.IsSelected=!1)};n.samplesScope.emptyAfterOrder=function(){for(var n=0;n<arguments.length;n++)arguments[n].length=0};n.samplesScope.addSamplesToBag=function(t){if(n.samplesScope.canAddToOrderIsDisabled()===!0){t.preventDefault();t.stopPropagation();return}var i=[];n.samplesScope.selectedSamples.forEach(function(n){n.IsSelected=!1;var t=new AddBagItem;t.Quantity=1;t.Sku=n.Sku;t.Id=n.Id;i.push(t)});u.addMultipleItemsToBag(i,!1);n.samplesScope.HideLoading();n.samplesScope.emptyAfterOrder(i,n.samplesScope.selectedSamples);n.samplesScope.ShowLoading(AVON.messages.spinner_loading);$(n.samplesScope.modalReference).trigger("close")};n.samplesScope.showInfoToolTip=function(){$(n.samplesScope.toolTipReference).addClass("Expanded")};n.samplesScope.hideInfoToolTip=function(){$(n.samplesScope.toolTipReference).removeClass("Expanded")};n.samplesScope.displayModalDialog=function(){$(n.samplesScope.modalReference).trigger("modal")}}return __extends(i,t),i.$inject=["$scope","sampleService","bagService","trackingService"],i}(BaseAngularController);n.SamplesController=t}(SampleModule||(SampleModule={}));app.controller("SamplesController",SampleModule.SamplesController),function(n){"use strict";var t=function(t){function i(i,r,u,f,e,o,s,h,c,l,a,v,y){var p=this;t.call(this,i,o,l,c,r,u,h,e,s,a,v,y);n.bagScope=i;n.bagScope.loginService=f;n.bagScope.OdsIsDown=AVON.OdsIsDown;n.bagScope.showHazmats=AVON.ShowHazmats;n.bagScope.showRestrictedItems=AVON.ShowRestrictedItems;n.bagScope.BagHasChanged=AVON.BagHasChanged;n.bagScope.donationValue=n.bagScope.DonationAmounts[0].value;n.bagScope.NotMyAccountPage=angular.element("#OrderingInfoContainer").length?!1:!0;n.bagScope.ShowReadMoreDonate=function(t){n.bagScope.ShowMoreDonate=!0;var i=$(t.currentTarget).parents(".DonationDescription");i.find(".TruncatedText").hide();i.find("a").hide();i.find(".FullText").show()};n.bagScope.GetEstimatedTax=function(){n.bagScope.estimatedTaxZipCode&&n.bagScope.estimatedTaxZipCode.length>0&&(n.bagScope.ShowLoading(AVON.messages.spinner_updatingBag),u.GetEstimatedTax(n.bagScope.estimatedTaxZipCode,!1))};AvonModule.AvonScope.QueryString().changeRep==="1"&&AvonModule.AvonScope.Session.Customer.IsAttached&&r.changeRepModal(AvonModule.AvonScope.QueryString().returnUrl);n.bagScope.SessionService.WhenReady().then(function(){if(AvonModule.AvonScope.Session.Cart.OutOfStockProducts.length>0&&(n.bagScope.ShowLoading(AVON.messages.spinner_updatingBag),u.NoLongerAvailableProducts()),n.bagScope.billingAddress=AddressHelper.MapAddressIntoMyAddress(n.bagScope.Session.Customer.BillingAddress),n.bagScope.shippingAddress=AddressHelper.MapAddressIntoMyAddress(n.bagScope.Session.Customer.ShippingAddress),n.bagScope.billingPhoneNumber=n.bagScope.Session.Customer.Phone,n.bagScope.originalBillingAddress=angular.copy(n.bagScope.billingAddress),n.bagScope.originalShippingAddress=angular.copy(n.bagScope.shippingAddress),$.each(n.bagScope.Session.Cart.Campaigns,function(n,t){$.each(t.Items,function(n,t){t.AutoReplenishmentFrequencyList&&t.AutoReplenishmentFrequencyList.length>0&&t.AutoReplenishmentFrequency===0&&t.ProductCanBuy===CanBuy.Available&&(t.AutoReplenishmentFrequency=Number(t.AutoReplenishmentFrequencyList[0]))})}),n.bagScope.IsShoppingBagPage()){var t={Type:TrackingEventType.CartViewBag};e.TrackEventItem(t)}n.bagScope.AutoReplenishBadgeImage=n.bagScope.LanguageCode==="en"?"/images/shared/auto-replenish-badge.svg":"/images/shared/auto-replenish-badge_es.svg";n.bagScope.PayPalImage="/Images/paypal/CheckoutWithPayPalLarge_"+n.bagScope.LanguageCode+".png";n.bagScope.estimatedTaxZipCode=n.bagScope.Session.Cart.EstimatedTaxZipCode});n.bagScope.FilterByNoActionTaken=function(n){return!n.ActionTaken};n.bagScope.SetConsolidationModalOptionSelected=function(n,t){t.OptionSelected=n};n.bagScope.PaypalExpressCheckoutClick=function(){p.checkIfFundraiserHasEnded().then(function(n){n||p.openPaypalExpressCheckoutModel()})};n.bagScope.setDonationValue=function(t){n.bagScope.donationValue=t;n.bagScope.ShowValidation=!1};n.bagScope.addCheckoutPromoToBag=function(t){var f=$(t.currentTarget),e,u,i;if(f.attr("id")=="AddDonationsButton"&&n.bagScope.donationValue===undefined)return n.bagScope.ShowValidation=!0,!1;e=f.attr("id")=="AddDonationsButton"?parseInt(n.bagScope.donationValue,10):1;u=$(t.currentTarget).data();n.bagScope.ShowLoading(AVON.messages.spinner_adding);i=new AddBagItem;i.Quantity=e;i.Sku=u.sku;i.Id=u.pfid;i.OrderType="Customer";r.addItemToBag(i,!1,TrackingAddToCartType.Bag);_.defer(function(){$(".MultipleQuantityPromo").each(function(){$(this).find("input.donationRadio").first().click()})})};n.bagScope.showPayPalErrorMsg=function(){return location.href.indexOf("paypalerror=1")>-1};n.bagScope.$on("BagService.Update",function(){n.bagScope.SessionService.WhenReady().then(function(){n.bagScope.DisplayBagModal();n.bagScope.GetEstimatedTax()});n.bagScope.DisplayAutoReplenishUpsellBanner();n.bagScope.AutoReplenishmentFrequencyListRefresh()});n.bagScope.$on("BagService.AddToBagSuccess",function(){n.bagScope.SessionService.WhenReady().then(function(){$.each(n.bagScope.Session.Cart.Campaigns,function(n,t){$.each(t.Items,function(n,t){t.AutoReplenishmentFrequencyList&&t.AutoReplenishmentFrequencyList.length>0&&t.AutoReplenishmentFrequency===0&&t.ProductCanBuy===CanBuy.Available&&(t.AutoReplenishmentFrequency=Number(t.AutoReplenishmentFrequencyList[0]))})})});n.bagScope.DisplayAutoReplenishUpsellBanner()});n.bagScope.$on("ModalClosed",function(t,i){i==="QuickView"&&n.bagScope.ShowConsolidationModal()});$(document).ready(function(){AVON.preCheckoutChecks&&(AVON.preCheckoutChecks.ShippingMethodsConflict||n.bagScope.OdsIsDown&&(AVON.preCheckoutChecks.CartContainsRepDeliveryOnlyItems||AVON.preCheckoutChecks.CustomerAcceptsRepDeliveryOnly))&&$("#PreCheckoutAlert").trigger("modal");_.defer(function(){$(".MultipleQuantityPromo").each(function(){$(this).find("input.donationRadio").first().click()});n.bagScope.DisplayBagModal()});n.bagScope.BagHasChanged&&$("#BagHasBeenModifiedExternally").trigger("modal")});n.bagScope.EditAddress=function(){AddressModule.addressesScope.DisplayShippingAddress=!0;$("#EditAddressModal").trigger("modal",{UrlToLoad:"",AllowExit:!0,KeepLoaded:!0,Model:null})};n.bagScope.$on("CustomerService.UpdateAddress",function(t,i){i.ErrorCode===AjaxError.ValidationErrors?(n.bagScope.ShowValidation=!0,n.bagScope.ProcessAjaxValidationErrors(i)):n.bagScope.NotMyAccountPage&&(setTimeout(function(){n.bagScope.ShowLoading(AVON.messages.spinner_loading)},200),n.bagScope.RedirectToUrl(n.bagScope.Url.Action("Index","Checkout")))});n.bagScope.ShowExtraOverlay=function(n){var t=$(angular.element(n.currentTarget)[0]),i,r;t.siblings("div").addClass("active");i=t.siblings(".Overlay.active");i.width(t.width()-(i.outerWidth(!0)-i.width()));r=t.siblings(".RotatedCaret45.active");r.css({"margin-left":t.width()/2-r.width()/2})};n.bagScope.HideExtraOverlay=function(n){var t=$(angular.element(n.currentTarget)[0]);t.children(".active").removeClass("active")};n.bagScope.UpdateAutoReplenishmentSubscriptions=function(){$("#PreCheckoutAlert").trigger("close");var t=[];$.each(n.bagScope.Session.Cart.Campaigns,function(i){$.each(n.bagScope.Session.Cart.Campaigns[i].Items,function(r){if(n.bagScope.Session.Cart.Campaigns[i].Items[r].AutoReplenishmentFrequency>0){var u={CampaignNumber:n.bagScope.Session.Cart.Campaigns[i].Number,Sku:n.bagScope.Session.Cart.Campaigns[i].Items[r].Sku,Quantity:0,AutoReplenishmentFrequency:n.bagScope.Session.Cart.Campaigns[i].Items[r].AutoReplenishmentFrequency,AutoReplenishmentMultibuy:n.bagScope.Session.Cart.Campaigns[i].Items[r].AutoReplenishmentMultibuy,AutoReplenishmentOverrideToBeOneTimeOnly:n.bagScope.Session.Cart.Campaigns[i].Items[r].AutoReplenishmentOverrideToBeOneTimeOnly};t.push(u)}})});t.length>0&&r.update(t)};n.bagScope.ShowAutoReplenishmentOverlay=function(t){var i=$(angular.element(t.currentTarget)[0]),r,u;i.siblings("div").addClass("active");r=i.siblings(".AutoReplenishmentOverlay.active");r.width(i.width()-(r.outerWidth(!0)-r.width()));u=i.siblings(".AutoReplenishmentRotatedCaret45.active");u.css({"margin-left":i.width()/2-u.width()/2});n.bagScope.ScrollIntoView($(".Overlay.active"),null,{duration:600,direction:"y",complete:null,offsetY:-30})};n.bagScope.HideAutoReplenishmentOverlay=function(n){var t=$(angular.element(n.currentTarget)[0]);t.children(".active").removeClass("active")};n.bagScope.AutoReplenishmentUpsell=function(t){var i=t.split(",");i.length>0&&(n.bagScope.ShowLoading(AVON.messages.spinner_loading),n.bagScope.ShowProductQuickView(parseInt(i[0]),"",null))};n.bagScope.GetFrequencyLabel=function(n,t,i){return n.toString()+" "+(n===1?t:i)};n.bagScope.GetShipsEveryFrequencyLabel=function(n,t,i,r){return n+" "+t.toString()+" "+(t===1?i:r)};n.bagScope.ShoppingCartClick=function(){n.bagScope.SessionReady&&n.bagScope.Session.Cart.OrderDetails.ItemCount>0&&(n.bagScope.ShowLoading(AVON.messages.spinner_loading),n.bagScope.RedirectToUrl(n.bagScope.Url.Action("Index","Bag")))};n.bagScope.DisplayVariantLineNumber=function(n,t){return ProductHelper.DisplayVariantLineNumber(n,t)};n.bagScope.CouponHasGift=function(){return n.bagScope.Session.Cart.Coupon!=null&&n.bagScope.Session.Cart.Coupon.GiftAward!=null&&n.bagScope.Session.Cart.Coupon.GiftAward.Shortfall>0};n.bagScope.IsOptionDisabled=function(n){return n==null||n.Availability==CanBuy.Available||n.Availability==CanBuy.AutoReplenishmentOnly?!1:!0};n.bagScope.isIPad=function(){return $(".ipad").length>0};n.bagScope.$on("CouponScope.ApplyCouponApplyTax",function(){n.bagScope.GetEstimatedTax()})}return __extends(i,t),i.prototype.openPaypalExpressCheckoutModel=function(){n.bagScope.OpenDynamicModal("PayPalExpressModal",{AllowExit:!0,Model:null,KeepLoaded:!1,UrlToLoad:"/paypal/confirm"});this.trackingService.TrackEventItem({Type:TrackingEventType.CartViewBagPayPalButtonClick});this.trackingService.TrackEventItem({Type:TrackingEventType.CartViewBagPayPalModal})},i.$inject=["$scope","bagService","paymentService","loginService","trackingService","$window","$location","wishListService","$filter","autoReplenishService","fundraiserService","sessionService","$q"],i}(n.CommonViewBagController);n.ViewBagController=t}(ViewBagModule||(ViewBagModule={}));app.controller("ViewBagController",ViewBagModule.ViewBagController)